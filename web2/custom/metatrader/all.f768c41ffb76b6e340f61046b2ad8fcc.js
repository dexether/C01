function $(a){return document.getElementById(a)}function Core(){this.StopProp=function(a){a=(a||window.event);if(a&&a.stopPropagation){a.stopPropagation()}else{if(window.event&&window.event.cancelBubble){window.event.cancelBubble=true}}};this.AddHandler=function(a,c,b){if(a.attachEvent){a.attachEvent("on"+c,b)}else{if(a.addEventListener){a.addEventListener(c,b,false)}}};this.addAncersToH3=function(){var c=document.getElementsByTagName("h3");for(var b=0;b<c.length;b++){var e=c[b].getAttribute("id");if(!e){continue}var a=document.createElement("a");a.innerHTML="#";a.setAttribute("href","#"+e);a.className="anchor";c[b].insertBefore(a,null)}};this.IsTouchDevice=function(){return(("ontouchstart" in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0))};this.isLocalStorageSupported=function(){var c="test_local_storage_support",b=window.localStorage;try{if(!window.localStorage){return false}b.setItem(c,"1");b.removeItem(c);return true}catch(a){return false}};this.PreventSelection=function(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection&&document.selection.clear){document.selection.clear()}}};this.SelectAllCheckboxes=function(e,a){var b=document.getElementsByTagName("INPUT");if(!b||b==null||b.length<1){return}var f=e.checked;for(var c in b){if(b[c].type!="checkbox"||b[c].name!=a){continue}b[c].checked=f}};this.FormatNumber=function(e){e=Math.round(e);e=e.toString();var f="",b=0,a=e.length;for(var c=a;c>0;c--){if(b++===3){f=" "+f;b=1}f=e.substring(c,c-1)+f}return f}}var Core=new Core();var ieVersion=(function(){var c,a=3,e=document.createElement("div"),b=e.getElementsByTagName("i");while(e.innerHTML="<!--[if gt IE "+(++a)+"]><i></i><![endif]-->",b[0]){}return a>4?a:c}());var supportsCssProp=(function(){var b=document.createElement("div");var a=["Khtml","Ms","O","Moz","Webkit","ms"];return function(e){if(e in b.style){return e}e=e.replace(/^[a-z]/,function(f){return f.toUpperCase()});var c=a.length;while(c--){if(a[c]+e in b.style){return a[c]+e}}return false}})();function isEmpty(b){if(b==null){return true}if(b.length>0){return false}if(b.length===0){return true}for(var a in b){if(b.hasOwnProperty(a)){return false}}return true}function getCharCode(b){b=b||window.event;var a=b.which||b.keyCode;return a}function getElementsByClass(a,c){if(document.getElementsByClassName){return(c||document).getElementsByClassName(a)}else{var c=c||document,h=c.getElementsByTagName("*"),b=h.length,k=a.split(/\s+/),e=k.length,l=[],g,f;for(g=0;g<b;g++){for(f=0;f<e;f++){if(h[g].className.search("\\b"+k[f]+"\\b")!=-1){l.push(h[g]);break}}}return l}}function setSelectionRange(b,e,c){if(b.setSelectionRange){b.focus();b.setSelectionRange(e,c)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",c);a.moveStart("character",c);a.select()}}}function setCursor(b,a){setSelectionRange(b,a,a)}[].indexOf||(Array.prototype.indexOf=function(a){for(var b=this.length;b--&&this[b]!==a;){}return b});function typeOf(a){if(typeof(a)=="object"){if(a.length){return"array"}else{return"object"}}else{return typeof(a)}}function S4(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}function guid(){return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4())}Class=function(g,f,a){if(!g){return}if(!g.className){if(!a){g.className=f}return}var e=g.className.split(" "),c,b;for(c=0,b=e.length;c<b;++c){if(e[c]==f){if(a){e.splice(c,1);g.className=e.join(" ")}return}}if(!a){e.push(f);g.className=e.join(" ")}};function getUrlParam(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var e=new RegExp(a);var c=e.exec(window.location.href);if(c==null){return""}else{return c[1]}}function setUrlParam(a,b){document.location.search=changeUrlParamsString(document.location.search,a,b)}function changeUrlParamsString(g,a,j){var f=false;if(!j){f=true}a=encodeURI(a);j=encodeURI(j);if(g.indexOf("?")==0){g=g.substr(1)}var c=g.split("&");var e=c.length;var h;while(e--){h=c[e].split("=");if(h[0]==a){if(f){c.splice(e,1);break}h[1]=j;c[e]=h.join("=");break}}if(e<0){c[c.length]=[a,j].join("=")}var l="";for(var b=0;b<c.length;b++){if(!c[b]){continue}if(!l){l+="?"}else{l+="&"}l+=c[b]}return l}function isHttps(){return window.location.protocol=="https:"}String.prototype.startsWith=function(a){return(this.substring(0,a.length)==a)};String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};function getFileExtension(b,f){if(!b||!b.length){return undefined}var g="";var a=false;for(var c=0;c<b.length;c++){var e=b[c];g+=e;if(e=="."){g="";a=true}}if(!a||!g){return undefined}return f?g.toLowerCase():g}function createElement(c,a,b){var e=document.createElement(a);if(b){for(key in b){if(key=="name"){e.setAttribute("name",b[key])}else{if(key=="className"){e.className=b[key]}else{if(key.indexOf("style")!=-1){alert("Invalid argument - style")}else{e[key]=b[key]}}}}}if(c){c.appendChild(e)}return(e)}function prependElement(b,a){if(b.childNodes&&b.childNodes.length>0){b.insertBefore(a,b.childNodes[0])}else{b.appendChild(a)}}function insertAfter(b,a,c){if(!c||!c.nextSibling){b.appendChild(a)}b.insertBefore(a,c.nextSibling)}function injectIframe(a,b){var c=document.createElement("iframe");c.marginHeight="0";c.marginWidth="0";c.frameBorder="0";c.scrolling="no";a.appendChild(c);c.width="100%";c.height="100%";var e=c.document;if(c.contentDocument){e=c.contentDocument}else{if(c.contentWindow){e=c.contentWindow.document}}e.open();e.writeln(b);e.close()}function encodeHtml(b){if(!b){return b}var a=b;a=a.replace(/&/g,"&amp;");a=a.replace(/>/g,"&gt;");a=a.replace(/</g,"&lt;");return a}function stripHtml(b){var a=document.createElement("DIV");a.innerHTML=b;return a.textContent||a.innerText}function GetDate(e){var a="";var c=new Date();var b=new Date(1000*e);a+=b.getFullYear();a+="."+(b.getUTCMonth()>8?b.getUTCMonth()+1:"0"+(b.getUTCMonth()+1));a+="."+(b.getUTCDate()>9?b.getUTCDate():"0"+b.getUTCDate());return(a)}function GetDateTime(e){var a="";var c=new Date();var b=new Date(1000*e);a+=b.getFullYear();a+="."+(b.getUTCMonth()>8?b.getUTCMonth()+1:"0"+(b.getUTCMonth()+1));a+="."+(b.getUTCDate()>9?b.getUTCDate():"0"+b.getUTCDate());a+=" "+(b.getUTCHours()>9?b.getUTCHours():"0"+b.getUTCHours());a+=":"+(b.getUTCMinutes()>9?b.getUTCMinutes():"0"+b.getUTCMinutes());return(a)}function objectEquals(c,b){for(var a in c){if(c.hasOwnProperty(a)){if(!b.hasOwnProperty(a)){return false}if(c[a]!=b[a]){return false}}}for(var a in b){if(b.hasOwnProperty(a)){if(!c.hasOwnProperty(a)){return false}if(c[a]!=b[a]){return false}}}return true}function toggleBlock(a){if(a.style.display=="none"){if(a.oldDisplay){a.style.display=a.oldDisplay}else{a.style.display="block"}}else{a.oldDisplay=a.style.display;a.style.display="none"}}function toggle(a){toggleBlock($(a))}function getFirstChildElement(a){if(!a&&a.nodeType!=1){return null}var b=a.firstChild;while(b&&b.nodeType!=1){b=b.nextSibling}return b}function setHotKeysPaginator(c,b,f){var e=c==""?document:document.getElementById(c);var a=e.onkeydown;e.onkeydown=function(i){if(a){a(i)}var g=window.event?window.event:i;var h=g.target?g.target:window.event.srcElement;if(g.ctrlKey){if(h.tagName=="INPUT"||h.tagName=="TEXTAREA"){return}if(g.keyCode==37&&b!=""){location.href=b}else{if(g.keyCode==39&&f!=""){location.href=f}}}}}function HashparamsContainer(){this.prototype=Object;var e=new Array();var b=new Array();var a=0;var g="";var f=function(){b=new Array();e=new Array();a=location.href.indexOf("#!");if(a==-1||location.href.length==(a+2)){return}var j=location.href.substring(a+2);var h=j.indexOf("#");if(h!=-1){g=j.substring(h);j=j.substring(0,h)}var l=j.split("&");for(var k=0;k<l.length;k++){var m=l[k].split("=");e.push(decodeURIComponent(m[0]));if(m.length==1){b.push(null)}else{b.push(decodeURIComponent(m[1]))}}};f();if(window.addEventListener){window.addEventListener("hashchange",f,false)}var c=function(){var h="";for(var j=0;j<e.length;j++){if(h.length>0){h+="&"}h+=encodeURIComponent(e[j]);if(b[j]&&b[j].toString().length>0){h+="="+encodeURIComponent(b[j].toString())}}return h};this.Get=function(i){var h=e.indexOf(i);if(h==-1){return null}return b[h]};this.GetDefaultHash=function(){return g};this.Set=function(i,j){var h=e.indexOf(i);if(h==-1){e.push(i);b.push(j)}else{b[h]=j}location=location.pathname+location.search+"#!"+c()};this.Remove=function(i){var h=e.indexOf(i);if(h==-1){return}b.splice(h,1);e.splice(h,1);var j=c();if(j){location=location.pathname+location.search+"#!"+j}else{location.hash=""}};this.Clear=function(){b=new Array();e=new Array();location=location.pathname+location.search+"#"};this.Count=function(){return e.length}}window.hashParams=new HashparamsContainer();function getWindowSize(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return{width:b,height:a}}function getDocumentBodySize(){var b=0,a=0;if(typeof(document.body&&document.body.scrollWidth)=="number"){b=document.body.scrollWidth;a=document.body.scrollHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return{width:b,height:a}}function getWindowScroll(){var b=0,a=0;if(typeof(window.pageYOffset)=="number"){a=window.pageYOffset;b=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollTop;b=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollTop;b=document.documentElement.scrollLeft}}}return{top:a,left:b}}function getOffsetSum(a){var c=0,b=0;while(a){c=c+parseFloat(a.offsetTop);b=b+parseFloat(a.offsetLeft);a=a.offsetParent}return{top:Math.round(c),left:Math.round(b)}}function getOffsetRect(e){var h=e.getBoundingClientRect();var i=document.body;var b=document.documentElement;var a=window.pageYOffset||b.scrollTop||i.scrollTop;var f=window.pageXOffset||b.scrollLeft||i.scrollLeft;var g=b.clientTop||i.clientTop||0;var j=b.clientLeft||i.clientLeft||0;var k=h.top+a-g;var c=h.left+f-j;return{top:Math.round(k),left:Math.round(c)}}function getOffset(a){if(a.getBoundingClientRect){return getOffsetRect(a)}else{return getOffsetSum(a)}}function getElementSize(a){return{width:a.clientWidth||a.offsetWidth,height:a.clientHeight||a.offsetHeight}}function dateToString(b,j,k){var g=b.getDate();var c=b.getMonth()+1;var i=b.getFullYear();var l=""+i+"-"+(c<=9?"0"+c:c)+"-"+(g<=9?"0"+g:g);if(j){var e=b.getHours();var a=b.getMinutes();l+=" "+(e<=9?("0"+e):e)+":"+(a<=9?("0"+a):a);if(k){var f=b.getSeconds();l+=":"+(f<=9?("0"+f):f)}}return l}function tooltip(h,e,k,f,j){if(h.timeoutID){clearTimeout(h.timeoutID)}var i=S4();var b=createElement(document.body,"div",{id:"tooltip_"+i,className:"customTooltip"});var l=createElement(b,"div",{id:"tooltipContent_"+i,className:"customTooltipContent"});var m;if(supportsCssProp("transform")){m=createElement(b,"span",{className:"tooltipCorner"})}b.hovered=false;b.onmouseover=function(){this.hovered=true};b.onmouseout=function(){var n=this;n.hovered=false;setTimeout(function(){if(n.hovered===true){return}try{if(f){f(n)}if($(n.id)){document.body.removeChild(n)}}catch(o){if(window.console&&window.console.log){window.console.log(o.message)}}},300)};if(typeOf(e)=="string"){l.innerHTML+=e}else{if(typeOf(e)=="object"){l.appendChild(e)}}var g=getOffset(h);g.realLeft=g.left;h.tooltipContainer=b;h.onmouseout=function(){clearTimeout(h.timeoutID);var n=b;setTimeout(function(){if(n.hovered==true){return}try{if(f){f(n)}document.body.removeChild(n)}catch(o){if(window.console&&window.console.log){window.console.log(o.message)}}},300)};h.timeoutID=setTimeout(function(){b.style.display="block";b.style.top=(g.top+30)+"px";b.style.maxWidth=(document.body.offsetWidth-10)+"px";b.style.left=a()+"px";if((b.offsetHeight+g.top)>document.body.offsetHeight){b.style.top=(g.top-20-b.offsetHeight)+"px";Class(m,"bottomCorner")}if(m){m.style.left=c()+"px"}setOpacity(b,0.01);fade(b,1,200,20);if(k){k(b)}},j||500);function c(){var n=(h.clientWidth/2)+g.left-b.offsetLeft-7;n=Math.min(b.clientWidth-15,n);n=Math.max(5,n);return n}function a(){var n=g.left-(b.clientWidth*0.2);n=Math.max(10,n);n=Math.min(n,(document.body.offsetWidth-5-b.clientWidth));return n}return l.id}function setOpacity(a,b){a.style.opacity=b;a.style.MozOpacity=b;a.style.KhtmlOpacity=b;a.style.filter="alpha(opacity="+(b*100)+");"}function animate(k,s,r,n,m,l,e,o,b,t){s=supportsCssProp(s)||s;if(n==m){return}if(b==0||!b){b=1e-7}if(!t){t=0}var k=k;var a=supportsCssProp("transition");if(a){var g={marginLeft:"margin-left",marginRight:"margin-right",paggingLeft:"pagging-left",paggingRight:"pagging-right"};var p=g[s]||s;k.style[a]="none";k.style[s]=n+r;setTimeout(function(){var i=p+" "+(e/1000)+"s "+((b&&b!=0)?" ease":" linear")+(l>0?(" "+(l/1000)+"s"):"");k.style[a]=i;k.style[s]=m+r},1);setTimeout(function(){k.style[a]="none"},e+l+10);return}var f=0;var q=m-n;var c=(q!=Math.abs(q));var f=0;for(var h=0;h<=o;h++){setTimeout(function(){var i=q*Math.pow(f/q,1/b);if(t!=0){i+=Math.sin(Math.PI*f/q)*f*t}k.style[s]=(i+n)+r;f=c==true?Math.max(f+Math.floor(q/o),q):Math.min(f+Math.ceil(q/o),q)},((h/o)*e)+l)}}function fade(e,f,g,a){if(f=="in"||f==0){f=0}else{if(f=="out"||f==1){f=1}else{return}}var e=e;var b=0;for(var c=0;c<=1;c+=(1/a)){setTimeout(function(){setOpacity(e,f==1?b:(1-b));b+=(1/a);b=Math.round((b*100))/100},c*g)}setTimeout(function(){setOpacity(e,f==1?1:0)},g)}function apearBlockVertical(i,b,f,h,e,g){if(!g){g=0.5}if(!e){e=20}if(!h){h=200}var c=createElement(null,"div");c.style.overflow="hidden";c.style.height=0;c.style.visibility="hidden";setOpacity(i,0);c.appendChild(i);i.style.display="block";if(f==true){prependElement(b,c)}else{if(f&&f.tagName){b.insertBefore(c,f)}else{b.appendChild(c)}}var a=c.scrollHeight;animate(c,"height","px",0,a,0,h,e,g);setTimeout(function(){c.style.display="none";b.insertBefore(i,c);b.removeChild(c);fade(i,"out",200,20)},h)}function disapearBlockVertical(i,b,h,f,g){if(!g){g=0.5}if(!f){f=20}if(!h){h=200}var c=i.parentNode;var e=createElement(null,"div");e.style.overflow="hidden";c.insertBefore(e,i);e.appendChild(i);var a=e.scrollHeight;e.style.height=a+"px";fade(i,"in",200,20);setTimeout(function(){animate(e,"height","px",a,0,0,h,f,g)},200);setTimeout(function(){if(!b){i.style.display="none";c.insertBefore(i,e)}e.parentNode.removeChild(e)},h+500)}function onReadyGlobalCallback(){if(!mqGlobal||!mqGlobal._onready){return}for(var a=0;a<mqGlobal._onready.length;a++){mqGlobal._onready[a]()}}var windowOldOnLoadGlobalCallback=window.onload;window.onload=onLoadGlobalCallback;function onLoadGlobalCallback(){if(mqGlobal&&mqGlobal._onload){for(var a=0;a<mqGlobal._onload.length;a++){mqGlobal._onload[a]()}}if(windowOldOnLoadGlobalCallback){windowOldOnLoadGlobalCallback()}}if(document.addEventListener){document.addEventListener("DOMContentLoaded",onReadyGlobalCallback||function(){},false)}else{var d=window.document,done=false,init=function(){if(!done){done=true;if(onReadyGlobalCallback){onReadyGlobalCallback()}}};(function(){try{d.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,50);return}init()})();d.onreadystatechange=function(){if(d.readyState=="complete"){d.onreadystatechange=null;init()}}}window.isWindowActive=false;window.isLastActiveWindow=function(){return false};(function(){var g;try{g=(window.localStorage&&(typeof(Storage)!=="undefined")&&Core.isLocalStorageSupported()&&(window.JSON&&window.JSON.stringify))?true:false}catch(j){g=false;if(window.console&&window.console.log){console.log("local storage support check: "+j)}}var m={},k={};if(g){m=sessionStorage;try{k=localStorage}catch(j){k=sessionStorage}}var h,l,a={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(h in a){if(a.hasOwnProperty(h)&&h in document){l=a[h];break}}if(l){window.isWindowActive=this[h]?false:true;document.addEventListener(l,c)}else{if(ieVersion&&ieVersion<=9){document.onfocusin=document.onfocusout=c}else{window.onfocus=window.onblur=c}}function c(e){var o=window.isWindowActive;e=e||window.event;if(e.type=="focus"||e.type=="focusin"){window.isWindowActive=true}else{if(e.type=="blur"||e.type=="focusout"){window.isWindowActive=false}else{window.isWindowActive=this[h]?false:true}}if(o!=window.isWindowActive){n(window.isWindowActive)}if(window.isWindowActive){b(i)}}function n(e){if(!mqGlobal||!mqGlobal._onvisibility){return}for(var o=0;o<mqGlobal._onvisibility.length;o++){mqGlobal._onvisibility[o](e)}}if(g){var i=guid();if(window.console&&window.console.log){console.log("current window id: "+i)}window.isLastActiveWindow=function(){var e=f();if(window.console&&window.console.log){console.log("last active window id: "+e+". ("+((e==i)?"is ":"not ")+"current)")}return e==i};if(window.isWindowActive){b(i)}}function f(){if(g){return k.getItem("mql5com_isLastActiveWindow")||null}return null}function b(e){if(g){k.setItem("mql5com_isLastActiveWindow",e+"")}}})();(function(){var a="contentEditable" in document.documentElement;var c=navigator.userAgent;if(c.indexOf("Android")>=0){var b=parseFloat(c.slice(c.indexOf("Android")+8));if(b<=2.3){a=false}}if(!a){return}var e=window.SmallRTE={};function f(h){return"__srte_"+h}function g(h){var n=$(h);var k=$(f(h));if(!n||!k){return}var m=function(j){return function(r){e.Flush(j)}};var q=function(j){return function(r){r=r||window.event;if(r&&r.preventDefault){r.preventDefault()}if(r&&r.stopPropagation){r.stopPropagation()}if(r&&r.cancelBubble){r.cancelBubble=true}return false}};k.onkeyup=k.onChange=function(){m(h)()};if(!k.addEventListener){return}var p=["copy","paste","keypress","input","textInput","blur","change","DOMNodeInserted"];var i=["drop"];for(var l=0;l<p.length;l++){k.addEventListener(p[l],m(h),true)}for(var o=0;o<i.length;o++){k.addEventListener(i[o],q(h),true)}}e.Clear=function(h){e.SetContent(h,"<br>")};e.SetContent=function(h,j){var k=$(h);var i=$(f(h));j=j+"<br>";if(k){k.value=j}if(i){i.innerHTML=j}};e.GetContent=function(h){var i=$(h);if(i){return i.value}return null};e.isEmpty=function(h){var i=e.GetContent(h);if(i){i=i.replace(/<(?!img|embed|iframe)[^>]+>|&nbsp;/gi,"")}return !i};e.GetEditor=function(h){return $(f(h))};e.Flush=function(h){var j=$(h);var i=$(f(h));if(j&&i){j.value=i.innerHTML}};e.Focus=function(i){var j=$(f(i));if(!j){return}j.focus();var h,k;if(document.createRange){h=document.createRange();h.selectNodeContents(j);h.collapse(false);k=window.getSelection();k.removeAllRanges();k.addRange(h)}else{if(document.selection){h=document.body.createTextRange();h.moveToElementText(j);h.collapse(false);h.select()}}};e.Init=function(){if(!window.SimpleRte){return}for(var j=0;j<window.SimpleRte.length;j++){var h=window.SimpleRte[j];var k=$(h.id);var l=createElement(null,"div",{id:f(h.id),contentEditable:"true",className:"smallEditor"});l.style.width=k.style.width;l.style.height=k.style.height;insertAfter(k.parentNode,l,k);k.style.display="none";g(h.id);e.SetContent(k.id,k.value)}}})();(function(){var c=window.MQTE={};var b=window.MQRTE;var a=window.SmallRTE;mqGlobal.AddOnReady(function(){if(b){b.Init(window)}if(a){a.Init()}});c.Focus=function(e){if(b&&b.Editor(e)){b.Focus(e)}else{if(a&&a.GetEditor(e)){a.Focus(e)}else{var f=$(e);if(f&&f.focus){f.focus()}}}};c.GetContent=function(e){if(b&&b.Editor(e)){return b.GetContent(e)}else{if(a&&a.GetEditor(e)){return a.GetContent(e)}else{var f=$(e);if(f){return f.value}}}return null};c.SetContent=function(e,g){if(b&&b.Editor(e)){b.SetContent(e,g)}else{if(a&&a.GetEditor(e)){a.SetContent(e,g)}else{var f=$(e);if(f){f.value=g}}}};c.InsertContent=function(e,g,h){if(b&&b.Editor(e)){b.InsertContent(e,g,h)}else{if(a&&a.GetEditor(e)){a.SetContent(e,g)}else{var f=$(e);if(f){f.value=g}}}};c.Clear=function(e){if(b&&b.Editor(e)){b.Clear(e)}else{if(a&&a.GetEditor(e)){a.Clear(e)}else{var f=$(e);if(f){f.value=f.innerHTML=""}}}};c.IsEmpty=function(e){if(b&&b.Editor(e)){return b.isEmpty(e)}else{if(a&&a.GetEditor(e)){return a.isEmpty(e)}else{var f=$(e);if(f){return(f.value.fulltrim().length==0)}}}return true};c.MarkUnchanged=function(e){if(b&&b.Editor(e)){b.MarkUnchanged(e)}};c.Changed=function(e){if(b&&b.Editor(e)){return b.Changed(e)}return false};c.Highlight=function(f,e){if(b){return b.highlight(f,e)}return e};c.Flush=function(e){if(b&&b.Editor(e)){b.Flush(e)}else{if(a&&a.GetEditor(e)){a.Flush(e)}}};c.HotKey=function(f,g,i,h,e,j){if(b&&b.Editor(f)){b.HotKey(f,g,i,h,e,j)}};c.SetValidationClass=function(g,f){var e=$(g);if(!e){return}if(b&&b.Editor(g)){var l=e.parentNode;while(l){if(f){if(l.className=="dalet-editor"){l.className="dalet-editor field-validation-error";break}}else{if(l.className){if(l.className.indexOf("field-validation-error")!=-1){var j=l.className.split(" "),k=[];for(var h in j){if(j[h]!="field-validation-error"){k.push(j[h])}}l.className=k.join(" ");break}}}l=l.parentNode}}else{if(a&&a.GetEditor(g)){var l=a.GetEditor(g);if(!l){return}if(f){if(l.className=="smallEditor"){l.className="smallEditor field-validation-error";return}}else{if(l.className){if(l.className.indexOf("field-validation-error")!=-1){var j=l.className.split(" "),k=[];for(var h in j){if(j[h]!="field-validation-error"){k.push(j[h])}}l.className=k.join(" ");return}}}}else{if(e.parentNode.nodeName=="DIV"&&e.parentNode.className.indexOf("inputWrapper")>-1){Class(e.parentNode,"field-validation-error",!f)}else{Class(e,"field-validation-error",!f)}}}}})();function doPost(g,a,c){try{g=g||window.event;if(g){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}}a+=(a.indexOf("?")>-1?"&uniqt="+new Date().getTime():"?uniqt="+new Date().getTime());var f=createElement(document.body,"form",{action:a,method:"post",target:"_top"});if(c){createElement(f,"input",{name:"__signature",type:"hidden",value:c})}f.style.position="absolute";f.style.left="-5000px";f.submit()}catch(b){alert("action failed: "+b);return}}function hasFlash(){if(navigator.plugins&&navigator.mimeTypes.length){return navigator.plugins["Shockwave Flash"]!==undefined}else{try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(a){return false}}};(function(){var e=window.Ajax={},n=[],d=240000;function i(){var o=n.shift();if(o){return o}try{if(window.XMLHttpRequest){o=new XMLHttpRequest()}else{if(window.ActiveXObject){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(p){o=new ActiveXObject("Microsoft.XMLHTTP")}}}}catch(p){o=null}return o}function k(o){o.abort();n.push(o)}function f(r){var p,q,o={};if(!r){return o}r=r.split("\n");for(p=r.length-1;p>=0;--p){q=r[p].split(":");if(q.length!=2){continue}o[q[0].toLowerCase().replace(/^\s+|\s+$/g,"")]=q[1].replace(/^\s+|\s+$/g,"")}return o}function a(v,t,p,o,u){var r,q;(r=v.onrequestready)||(r=v.onready);q=v.onendrequest;try{if(q){q.call(v,t,p,o,f(u))}if(r){r.call(v,t,p,o,f(u))}}catch(s){alert(s.message)}}function m(u,p,v,r,o,q){var s,w;(s=u.onrequesterror)||(s=u.onerror);w=u.onendrequest;try{if(w){w.call(u,v,r,p,f(q))}if(s){s.call(u,p,v,r,o,f(q))}}catch(t){alert(t.message)}}function h(r,v){if(!v){return}var o,u,p,t,q;try{o=r.status}catch(s){}try{u=r.responseText}catch(s){}try{p=r.responseXML}catch(s){}try{t=r.statusText}catch(s){}try{q=r.getAllResponseHeaders()}catch(s){}switch(o){case 200:if(q){a(v,u,p,t,q);break}else{o=0;t=""}default:m(v,o,u,p,t,q)}}function c(s){var p,q,o,r=[];if(s instanceof Array){for(q=0,o=s.length;q<o;++q){r.push([s[q][0],encodeURIComponent(s[q][1])].join("="))}}else{for(p in s){r.push([p,encodeURIComponent(s[p])].join("="))}}return r.join("&")}function g(t,u){var s=[],p,q,o;function r(v,w){s.push("--");s.push(u);s.push('\r\nContent-Disposition: form-data; name="');s.push(v);s.push('"');if(w.filename){s.push(';filename="');s.push(w.filename);s.push('"')}s.push("\r\n\r\n");if(w.value){s.push(w.value)}else{s.push(w)}s.push("\r\n")}if(t instanceof Array){for(q=0,o=t.length;q<o;++q){r(t[q][0],t[q][1])}}else{for(p in t){r(p,t[p])}}s.push("--");s.push(u);s.push("--\r\n");return s.join("")}function b(q,u){var r=q.ownerDocument,t=r.createElement("iframe"),p,o=["upload_frame",Math.random()].join("_");(p=t.style).position="absolute";p.left=p.top="-30000px";t.name=o;t.id=o;q.parentNode.insertBefore(t,q);q.target=o;(p=q.ownerDocument.parentWindow)||(p=q.ownerDocument.defaultView);if(p.frames[o].name!=o){p.frames[o].name=o}t.onload=function(){try{a(u,this.contentWindow.document.body.innerHTML,this.contentWindow.document,null,"")}catch(s){alert("call_onready error: "+s)}};q.submit();if(u&&u.onbeginrequest){u.onbeginrequest.call(u,q)}}function l(o){o.abort()}function j(o){return{ajax:o,timeout:setTimeout(function(){l(o)},d)}}e.get=function(p,t,u){var r=i(),o,q=j(r);if(!r){if(onerror){onerror()}return}if(u&&u.onbeginrequest){u.onbeginrequest.call(u,r)}t=c(t);o=p.indexOf("?")==-1?"?":"&";r.open("get",t?[p,t].join(o):p,true);r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.onreadystatechange=function(){switch(r.readyState){case 4:if(q){clearTimeout(q.timeout);q.ajax=null;q=null}h(r,u);k(r);break}};try{r.send("")}catch(s){return(false)}return q};e.post=function(p,u,o,v,r){var s=i(),q=j(s);s.open("post",p,true);s.setRequestHeader("X-Requested-With","XMLHttpRequest");if(!o){if(r){s.setRequestHeader("Content-Type","application/json");u=JSON.stringify(u)}else{s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");u=c(u)}}else{s.setRequestHeader("Content-Type","multipart/form-data; boundary=AJAX----FORM");u=g(u,"AJAX----FORM")}s.onreadystatechange=function(){switch(s.readyState){case 4:if(q){clearTimeout(q.timeout);q.ajax=null;q=null}h(s,v);k(s);break}};if(v&&v.onbeginrequest){v.onbeginrequest.call(v,s)}try{s.send(u)}catch(t){return(false)}return q};e.form=function(s,u){var t=[],p=s.elements;for(var q=0,o=p.length;q<o;++q){var r=p[q];switch(r.type.toLowerCase()){case"file":b(s,u);return false;case"text":case"password":case"hidden":case"submit":case"image":if(r.name){t.push([r.name,r.value])}continue;case"checkbox":case"radio":if(r.name&&r.checked){t.push([r.name,r.value?r.value:"on"])}continue}if(r.nodeName=="TEXTAREA"&&r.name){t.push([r.name,r.value])}else{if(r.nodeName=="SELECT"&&r.name){t.push([r.name,r.value])}}}if(s.method.toLowerCase()=="post"){e.post(s.action,t,(s.enctype=="multipart/form-data"),u)}else{e.get(s.action,t,u)}};e.stop=function(p){var o;if(!p||!(o=p.ajax)){return}clearTimeout(p.timeout);o.onreadystatechange=null;l(o)};e.url=function(o,r){var q=o.split("?");o=q[0];r=c(r);return[o,r].join("?")}})();(function(){function _(id){return document.getElementById(id)}function C(name){return document.createElement(name)}function AddCategoryInput(node,value,tag,id,parentId,mt){var i=_("edit_category"),f;node.firstChild.style.display="none";node.insertBefore(i,node.firstChild.nextSibling);i.style.display="";(f=i.firstChild).value=value;(f=f.nextSibling).value=tag;(f=f.nextSibling).value=id?id:0;(f=f.nextSibling).value=mt;f.nextSibling.value=parentId?parentId:0;setTimeout(function(){i.firstChild.select()},0)}var HideInput=window.HideArticleCategoryInputs=function(){var i=_("edit_category"),n=i.previousSibling,o;o=_("article-groups");o.parentNode.insertBefore(i,o.nextSibling);i.style.display="none";if(n.nodeName=="SPAN"&&n.style.display){if(n.firstChild.id){n.style.display=""}else{n=n.parentNode;n.parentNode.removeChild(n)}}};window.AddArticleCategory=function(mt,link,url){HideInput();var list,li=C("li"),parentId=0,s,c;if(link){parentId=link.parentNode.firstChild.id.substr(9)}else{link=_("category_mt"+mt);parentId=-1}if(!link.nodeName){link=this}list=(link.parentNode.parentNode.getElementsByTagName("ul"))[0];if(!list){list=C("ul");link.parentNode.parentNode.appendChild(list)}list.appendChild(li);li.appendChild(s=C("span"));c=C("strong");c.appendChild(document.createTextNode(""));s.appendChild(c);s.appendChild(document.createTextNode(""));if(!parentId){c=C("a");c.href="javascript:void(0)";c.innerHTML='<img src="/i/0.gif" class="add">';c.onclick=function(){window.AddArticleCategory(mt,null,url)};s.appendChild(c)}c=C("a");c.href="javascript:void(0)";c.innerHTML='<img src="/i/0.gif" class="edit">';c.onclick=window.EditArticleCategory;s.appendChild(c);c=C("a");c.href="javascript:void(0)";c.innerHTML='<img src="/i/0.gif" class="delete">';c.onclick=function(){window.DeleteArticleCategory(mt,this,url)};s.appendChild(c);AddCategoryInput(li,"","",0,parentId,mt)};window.EditArticleCategory=function(mt,link){if(!link||!link.nodeName){link=this}HideInput();var group=link.parentNode.firstChild,id,value,tag;if(!group){return(false)}id=group.id.substr(9);value=group.firstChild.nodeValue;tag=group.nextSibling.nodeValue;if(tag){tag=tag.substr(2,tag.length-3)}AddCategoryInput(group.parentNode.parentNode,value,tag,id,mt);return(false)};function HideControls(group,hide){var o=group.nextSibling;while(o){if(o.nodeName=="A"){o.style.display=hide?"none":""}else{if(o.nodeName=="IMG"){o.style.display=hide?"":"none"}}o=o.nextSibling}}function GroupDeleted(){var g=_(["category",this.id].join("_")).parentNode.parentNode,p=g.parentNode;p.removeChild(g)}window.DeleteArticleCategory=function(mt,link,url){if(!link||!link.nodeName){link=this}HideInput();var group=link.parentNode.firstChild,id;if(!group){return false}if(!group.id){group=group.parentNode.parentNode;group.parentNode.removeChild(group);return false}id=group.id.substr(9);if(confirm([window.deleteConfirm," '",group.firstChild.nodeValue,"'?"].join(""))){HideControls(group,true);Ajax.post([url,id].join(""),null,false,{id:id,onready:GroupDeleted,onerror:function(status,text){HideControls(group,false);alert(text)}})}return(false)};function DisableInputs(form,disable){var o=form.firstChild;while(o){if(o.nodeName=="INPUT"){o.disabled=disable}else{if(o.nodeName=="IMG"){o.style.display=disable?"":"none"}}o=o.nextSibling}}window.UpdateArticleCategory=function(){var i=_("edit_category");DisableInputs(i,true);Ajax.form(i,{onready:function(text){DisableInputs(i,false);var id=parseInt(text);if(text=id){i.parentNode.firstChild.firstChild.id=["category",id].join("_");i.parentNode.firstChild.firstChild.nextSibling.nodeValue=[" (",i.firstChild.nextSibling.value,")"].join("");HideInput()}},onerror:function(status,text){DisableInputs(i,false);alert(text);i.firstChild.focus()}})};var editorHeight;window.ArtFileSelected=function(){var f=document.getElementById("image-upload-form"),l=document.getElementById("loading");if(!f){return}l.style.display="block";Ajax.form(f,{onready:function(text){var s=(text.split("\n"))[0],i,cw,ch,t=30,l=30;s=s.split(";");i=document.getElementById("article-icon");i.src=s[2];i.realWidth=s[0];i.realHeight=s[1];if(s[0]<s[1]){cw=180;ch=Math.round((s[1]/s[0])*180);t=30-Math.round((ch-180)/2)}else{ch=180;cw=Math.round((s[0]/s[1])*180);l=30-Math.round((cw-180)/2)}i.width=cw;i.height=ch;i.style.left=[l,"px"].join("");i.style.top=[t,"px"].join("");i=document.getElementById("icon-save-button");i.disabled=false;document.getElementById("loading").style.display=""}})};window.StartImageDrag=function(event){if(!event){event=window.event}var i=document.getElementById("article-icon"),top=parseInt(i.style.top),left=parseInt(i.style.left);if(isNaN(top)){top=0}if(isNaN(left)){left=0}i.mouseLeftOffset=event.clientX-left;i.mouseTopOffset=event.clientY-top;document.documentElement.onmousemove=MouseMove;document.documentElement.onmouseup=MouseUp};window.MouseMove=function(event){if(!event){event=window.event}var i=document.getElementById("article-icon");i.style.top=[event.clientY-i.mouseTopOffset,"px"].join("");i.style.left=[event.clientX-i.mouseLeftOffset,"px"].join("")};window.MouseUp=function(event){document.documentElement.onmousemove=null;document.documentElement.onmouseup=null};window.ArticlesZoomIn=function(){var d=document.getElementById("article-icon"),cw=d.clientWidth,ch=d.clientHeight,sp=cw/ch;cw+=60;ch=Math.round(cw/sp);d.width=cw;d.height=ch;d.style.left=parseInt(d.style.left)-30+"px";d.style.top=parseInt(d.style.top)-30+"px"};window.ArticlesZoomOut=function(){var d=document.getElementById("article-icon");var cw=d.clientWidth,ocw=cw,ch=d.clientHeight,sp=cw/ch;cw-=60;if(cw<180){cw=180}ch=Math.round(cw/sp);if(ch<180){ch=180;cw=Math.round(ch*sp)}if(ocw!=cw){d.width=cw;d.height=ch;d.style.left=parseInt(d.style.left)+30+"px";d.style.top=parseInt(d.style.top)+30+"px"}};window.CloseDialog=function(){var d=document.getElementById("article-icon");d.src="/i/0.gif";Dialog.hide()};window.SetIcon=function(url,token){var d=document.getElementById("article-icon"),x=parseInt(d.style.left)-30,y=parseInt(d.style.top)-30;Ajax.post(url,{img:d.src,left:x=Math.ceil(-x*d.realWidth/d.clientWidth),top:y=Math.ceil(-y*d.realHeight/d.clientHeight),right:x+Math.ceil(180*d.realWidth/d.clientWidth),bottom:y+Math.ceil(180*d.realHeight/d.clientHeight),__signature:token},false,{onready:function(text){if(text){var d=document.getElementById("current-icon");d.src=text;d=document.getElementById("icon");d.value=text;Dialog.hide()}},onerror:function(){}})};window.AddTranslation=function(module,language,id,content,container,path,successText,token){Ajax.post(["/en",module,"translation",id,content,language].join("/"),{__signature:token},false,{onready:function(text){if(text!="ERROR"&&parseInt(text)&&container&&path&&successText){window.location.href=path+text}}})};window.TrackRating=function(obj,event){if(!event){event=window.event}var x=obj.offsetLeft,p=obj;while(p=p.offsetParent){x+=p.offsetLeft}x=Math.floor((event.clientX-x)/16)+1;obj.firstChild.className=["v",x,"0"].join("")};window.TrackRatingOut=function(obj,event){if(!event){event=window.event}if((event.target||event.srcElement)==obj.firstChild){obj.firstChild.className=""}};window.Vote=function(item,url,tooFrequentMessage,token){var s=item.firstChild.className,n;if(!s){return}n=s.charAt(1);Ajax.post(url,{rating:n,__signature:token},false,{onready:function(text){if(text=="ERROR"){}else{if(text=="NOVOTE"){}else{if(text=="NOMARK"){}else{if(text=="LIMIT"){if(tooFrequentMessage){alert(tooFrequentMessage)}else{alert("Votes limit reached")}}else{try{var e;eval("e="+text);item.onmousemove=null;item.onmouseout=null;item.onclick=null;item.firstChild.className=s;document.getElementById("current_rating").className=e.rating;document.getElementById("current_votes").innerHTML=e.votes}catch(e){alert(e.message)}}}}}},onerror:function(status,text){}})};window.Code=function(url,fileName){var w=window.screen.availWidth-100,h=window.screen.availHeight-140;window.open([url,fileName].join("/"),"view_code_"+Math.round(Math.random()*1000000),["left=50,top=70,width=",w,",height=",h,",menubar=0,toolbar=0,location=0,directories=0,personalbar=0,status=0,resizable=1,scrollbars=0"].join(""))};window.ArticlesShowCategoriesList=function(){var list=document.getElementById("articles-categories-edit"),input=document.getElementById("categories"),inputs=list.getElementsByTagName("input"),values,selected_values={},i,len,items;if(list.style.display){list.style.display="";return}if(!window.clickedItems){items=window.clickedItems=[]}if(input.value){values=input.value.split(",");for(i=0,len=values.length;i<len;++i){selected_values[values[i]]=true}}for(i=0,len=inputs.length;i<len;++i){if(selected_values[inputs[i].value]){inputs[i].checked=true;if(items){items.push(inputs[i].value)}}else{inputs[i].checked=false}if(items){inputs[i].onclick=CheckboxClicked}}list.style.display="block";var addLink=document.getElementById("articles-categories-add");if(addLink&&addLink.offsetLeft){list.style.marginLeft=addLink.offsetLeft-4+"px";list.style.marginTop="18px"}};window.ArticlesApplyCategories=function(){var list=document.getElementById("articles-categories-edit"),input=document.getElementById("categories"),inputs=list.getElementsByTagName("input"),count,result=[],names=[],i,len;for(i=0,len=inputs.length;i<len;++i){if(inputs[i].checked){names.push(inputs[i].parentNode.getElementsByTagName("span")[0].firstChild.nodeValue);result.push(inputs[i].value)}}if(result.length){input.value=result.join(",");(i=input.previousSibling).innerHTML="";i.appendChild(document.createTextNode(names.join(", ")));list.style.display=""}};function CheckboxClicked(){var input=this;setTimeout(function(){var items=window.clickedItems,i,len,inputs,value;if(!input.checked){for(i=0,len=items.length;i<len;++i){if(items[i]==input.value){items.splice(i,1);break}}return}if(items.length<4){items.push(input.value)}else{value=items.shift();items.push(input.value);inputs=document.getElementById("articles-categories-edit").getElementsByTagName("input");for(i=0,len=inputs.length;i<len;++i){if(inputs[i].value==value){inputs[i].checked=false}}}},0)}window.PubNewPlanDelete=function(link){var li=link.parentNode.parentNode.parentNode;li.parentNode.removeChild(li)};window.PubNewPlanMoveUp=function(link){var li=link.parentNode.parentNode.parentNode;if(li.previousSibling&&li.previousSibling.className!="stub"){li.parentNode.insertBefore(li,li.previousSibling);li.className="show";setTimeout(function(){li.className=""},500);return}li.className="show";setTimeout(function(){li.className="";setTimeout(function(){li.className="show";setTimeout(function(){li.className=""},200)},200)},200)};window.PubNewPlanMoveDown=function(link){var li=link.parentNode.parentNode.parentNode;if(li.nextSibling&&li.nextSibling.className!="stub"&&li.nextSibling.className!="add"){li.parentNode.insertBefore(li,li.nextSibling.nextSibling);li.className="show";setTimeout(function(){li.className=""},500);return}li.className="show";setTimeout(function(){li.className="";setTimeout(function(){li.className="show";setTimeout(function(){li.className=""},200)},200)},200)};window.PubNewPlanAdd=function(input){var li=input.parentNode.parentNode;if(input.value.length>0){var ul=li.parentNode;var newLi=document.createElement("li");newLi.innerHTML=planItemTemplate;var newInput=newLi.childNodes[0].childNodes[0];newInput.value=input.value;input.value="";ul.insertBefore(newLi,li);setTimeout(function(){input.focus()},0);li.className="add show";setTimeout(function(){li.className="add"},500);return}li.className="add show";setTimeout(function(){li.className="add";setTimeout(function(){li.className="add show";setTimeout(function(){li.className="add"},200)},200)},200)};window.PubNewPlanHandle=function(input,event){if(event.keyCode==13){if(event.ctrlKey){return true}PubNewPlanAdd(input);return false}if(event.keyCode==9){if(input.value.length==0){return true}PubNewPlanAdd(input);return false}return true};window.PubNewCatCheck=function(input,maxChecked){setTimeout(function(){if(maxChecked==1){document.getElementById("categories").value=input.value;inputs=document.getElementById("pub-new-cats").getElementsByTagName("input");for(i=0,len=inputs.length;i<len;++i){inputs[i].checked=false}input.checked=true;return}if(!window.clickedItems){window.clickedItems=[];var inputCats=document.getElementById("categories");var values=inputCats.value.split(",");for(i=0,len=values.length;i<len;++i){window.clickedItems.push(values[i])}}var items=window.clickedItems,i,len,inputs,value;if(!input.checked){for(i=0,len=items.length;i<len;++i){if(items[i]==input.value){items.splice(i,1);break}}}else{if(items.length<maxChecked){items.push(input.value)}else{value=items.shift();items.push(input.value);inputs=document.getElementById("pub-new-cats").getElementsByTagName("input");for(i=0,len=inputs.length;i<len;++i){if(inputs[i].value==value){inputs[i].checked=false}}}}document.getElementById("categories").value=items.join(",")},0)};var footerElement=null;window.GetFooterElement=function(){if(footerElement){return footerElement}footerElement=_("pub-edit-content").parentNode.nextSibling;while(footerElement!=null&&footerElement.nodeType==3){footerElement=footerElement.nextSibling}return footerElement};window.PubEditEditorToggle=function(){var expander=document.getElementById("expander");var collapsable1=document.getElementById("collapsable-top");var collapsable2=document.getElementById("collapsable-bottom");if(!expander||!collapsable1||!collapsable2){return}if(expander.className=="pub-edit-expander on"){expander.className="pub-edit-expander";collapsable1.style.height="auto";collapsable2.style.height="auto";GetFooterElement().style.display="block";window.hashParams.Remove("mode")}else{expander.className="pub-edit-expander on";collapsable1.style.height="0";collapsable2.style.height="0";GetFooterElement().style.display="none";window.hashParams.Set("mode","expanded")}PubEditEditorFit()};window.PubEditEditorToggleTo=function(expand){var expander=document.getElementById("expander");var collapsable1=document.getElementById("collapsable-top");var collapsable2=document.getElementById("collapsable-bottom");if(!expander||!collapsable1||!collapsable2){return}if(expand){expander.className="pub-edit-expander on";collapsable1.style.height="0";collapsable2.style.height="0";GetFooterElement().style.display="none";window.hashParams.Set("mode","expanded")}else{expander.className="pub-edit-expander";collapsable1.style.height="auto";collapsable2.style.height="auto";GetFooterElement().style.display="block";window.hashParams.Remove("mode")}PubEditEditorFit()};window.PubEditEditorFit=function(){if(!_("pub-editor")){return}var footerHeight=GetFooterElement().offsetHeight;var buttonsHeight=52;var collapsable1=document.getElementById("collapsable-top");var collapsable2=document.getElementById("collapsable-bottom");var headerOffset=collapsable1.offsetTop;var headerHeight=collapsable1.offsetHeight+collapsable2.offsetHeight;if(headerHeight>0){headerHeight+=2}editorHeight=window.innerHeight||document.documentElement.clientHeight;if(editorHeight){editorHeight-=footerHeight+buttonsHeight+headerOffset+headerHeight+2}_("pub-editor").style.height=[Math.max(editorHeight,340),"px"].join("")};window.PubEditRevisionsToggle=function(link){var revs=document.getElementById("pub-edit-list-revisions-over10");if(!revs){return}if(link.className=="on"){link.className="";revs.style.display="none"}else{link.className="on";revs.style.display="block"}};window.PubEditLoadStats=function(lang,module,id,content){if(window.pubEditStatsDone){return}Ajax.get("/"+[lang,module,id,content,"stats"].join("/"),null,{onready:function(text){var container=document.getElementById("content_stats");if(container){container.innerHTML=text;window.pubEditStatsDone=true}}})}})();var x,y,inDock=false;var interval,f_delta="";document.onmouseup=function(){stopDock()};function submitAvatarFile(){var a=$("avatar_load");a.style.visibility="visible";a.style.display="block";document.avatar_upload.submit()}function moveEvent(f){if(!inDock){return}if(!f){f=window.event}var g=document.getElementById("image");var b=f.clientX-x,a=f.clientY-y,c=g.style;c.left=b+"px";c.top=a+"px";if(f.preventDefault){f.preventDefault()}}function startDock(a){if(!a){a=window.event}var b=document.getElementById("image");if(b){x=a.clientX-parseInt(b.style.left);y=a.clientY-parseInt(b.style.top);inDock=true}if(a.preventDefault){a.preventDefault()}}function stopDock(){inDock=false}function zoomIn(){var e,f=document.getElementById("image");if(!f){return}var a=f.clientWidth,b=f.clientHeight,c=a/b;a+=60;b=Math.round(a/c);f.style.width=a+"px";f.style.height=b+"px";f.style.left=parseInt(f.style.left)-30+"px";f.style.top=parseInt(f.style.top)-30+"px"}function zoomOut(){var e,f=document.getElementById("image");if(!f){return}var a=f.clientWidth,b=f.clientHeight,c=a/b;a-=60;b=Math.round(a/c);if(a>=200&&b>=200){f.style.width=a+"px";f.style.height=b+"px";f.style.left=parseInt(f.style.left)+30+"px";f.style.top=parseInt(f.style.top)+30+"px"}}function moveImage(a,b){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}f_delta=b;interval=setInterval(moveInterval,50)}function moveInterval(){var a=document.getElementById("image"),b=10;if(a){switch(f_delta){case"bottom":b=-b;case"top":a.style.top=parseInt(a.style.top)+b+"px";break;case"right":b=-b;case"left":a.style.left=parseInt(a.style.left)+b+"px";break}}a=null}function stopMoving(a){if(interval){clearInterval(interval);interval=null}}function saveImage(b,c){var e=document.getElementById("image");var a=parseInt(e.style.left)-40,f=parseInt(e.style.top)-40;document.forms.coords.left.value=a=Math.ceil(-a*b/e.clientWidth);document.forms.coords.top.value=f=Math.ceil(-f*c/e.clientHeight);document.forms.coords.right.value=a+Math.ceil(200*b/e.clientWidth);document.forms.coords.bottom.value=f+Math.ceil(200*c/e.clientHeight);document.forms.coords.submit()}function resizeAvatarIframe(a){a.style.height=a.contentWindow.document.body.scrollHeight+"px"};var globContainersCounter=1;var globInputSize=63;var globInputName="attachedFile";var globClassName="attachInput";function editComment(b){Attach.clearAttaches();var d=$("newmessage");if(d){d.style.display="block"}var o=parseInt(b);var c=$("id_message");var a=$("content"+o);var m=$("edit_id");var h=$("edit_parent_id");var e=$("edit_cnew_cmd");var g=$("edit_csave_cmd");var k=$("admin_date_create");var f=document.getElementById("admin_not_modify");var l=$("date_create_"+o);var j=$("author_info_"+b);var n=$("admin_author");if(m){m.value=o}if(a){set_content(a.innerHTML,false,true)}if(e&&g){e.style.display="none";g.style.display="block"}if(k){k.value=l!=null?trim(l.innerHTML):""}if(f){f.checked=true}if(n&&j){n.value=j.title}Attach.setReadOnlyAttaches(Attach.getAttachesFromComment(b));if($("extractorContainer")){$("extractorContainer").innerHTML="";$("extractorContainer").className=$("extractor"+b)?"disabled":""}}function editCommentCancel(){var d=$("id_message");var a=$("edit_id");var g=$("edit_cnew_cmd");var f=$("edit_csave_cmd");var e=$("admin_date_create");var c=document.getElementById("admin_not_modify");var b=$("admin_author");if(a){a.value=0}if(window.MQRTE){set_content((Dalet.isGecko?"<br>":""),false,true)}if(g&&f){g.style.display="block";f.style.display="none"}if(e){e.value=""}if(b){b.value=""}if(c){c.checked=false}Attach.clearAttaches()}function Attach(){}Attach.getAttachesFromComment=function(h){var e=[];var c=0;var g=$("cb_"+h);if(!g){return e}var a=g.getElementsByTagName("DIV");for(var d=0;d<a.length;d++){var f=a[d].cloneNode(true);var b=f.getElementsByTagName("A");if(b.length>0){e[c]={obj:f,url:window.location.hostname==b[0].host?b[0].pathname:b[0].href};c++}}return e};Attach.setReadOnlyAttaches=function(b){if(!b||b.length==0){return}var a=$("readOnlyAttaches");if(!a){a=document.createElement("DIV");a.setAttribute("id","readOnlyAttaches");var c=$("multiattaches");c.insertBefore(a,c.firstChild)}a.innerHTML="";for(i in b){Attach.addHiddenValues(b[i].obj,b[i].url);Attach.addDeleteOption(b[i].obj);a.appendChild(b[i].obj)}};Attach.addHiddenValues=function(a,c){var b=document.createElement("INPUT");b.type="hidden";b.name=globInputName;b.value=c;a.appendChild(b)};Attach.createNewContainer=function(b){if(!b){b=1}var a=$("newAttaches");var c=document.createElement("DIV");c.id="at_"+b;var d=document.createElement("INPUT");d.type="file";d.name=globInputName;d.id="_"+b;d.onchange=function(){Attach.onChangeFile(c.id)};d.className=globClassName;d.size=globInputSize;if(Attach.globAcceptFilter){d.accept=Attach.globAcceptFilter}c.appendChild(d);a.appendChild(c);return c};Attach.onChangeFile=function(b){var a=$(b);if(!a.containsYet){Attach.addDeleteOption(a);globContainersCounter++;Attach.createNewContainer(globContainersCounter);a.containsYet=true}};Attach.addDeleteOption=function(a){var b=document.createElement("A");b.appendChild(document.createTextNode(window.deleteLabel?window.deleteLabel:"delete"));b.href="#";b.className="deleteAttachLink";a.appendChild(b);b.onclick=function(){return Attach.deleteContainer(a)}};Attach.deleteContainer=function(c){var b=c.parentNode.getElementsByTagName("DIV").length;var a=c.parentNode;c.parentNode.removeChild(c);if(b==1){a.parentNode.removeChild(a)}return false};Attach.clearAttaches=function(){var a=$("readOnlyAttaches");if(a){a.parentNode.removeChild(a)}var b=$("newAttaches");if(b){b.innerHTML=""}globContainersCounter=1;Attach.createNewContainer(1)};Attach.setAcceptFilter=function(a){Attach.globAcceptFilter=a};function ShortComments(){var defaultLang=location.pathname.split("/")[1];var maxApearTime=500;function checkSubmitHotKey(e){e=e||window.event;if(e.keyCode===13&&e.ctrlKey){return true}return false}function autogrow(f,minHeight){if(minHeight){f.style.height=minHeight+"px"}if(f.clientHeight<f.scrollHeight){f.style.minHeight=f.scrollHeight+"px"}}this.CheckSubmitHotKey=function(e){return checkSubmitHotKey(e)};this.AutoGrowTextarea=function(textarea,minHeight){return autogrow(textarea,minHeight)};function EditCommentData(moduleId,parentType,parentId,avatar,container,insertAfterElement,token){this.moduleId=moduleId;this.parentType=parentType;this.parentId=parentId;this.avatar=avatar;this.container=container;this.insertAfterElement=insertAfterElement;this.token=token}function ViewCommentData(html,container,insertAfterElement){this.html=html;this.container=container;this.insertAfterElement=insertAfterElement}function getFormId(data){return"shortCommentForm_"+data.moduleId+"_"+data.parentType+"_"+data.parentId}function getTextAreaId(data){return"shortCommentContent_"+data.moduleId+"_"+data.parentType+"_"+data.parentId}function startComment(moduleId,parentType,parentId,avatar,container,insertAfterElement,token){var data=new EditCommentData(moduleId,parentType,parentId,avatar,container,insertAfterElement,token);showEditor(data)}function showEditor(data){var action="/"+defaultLang+"/short_comments/"+data.moduleId+"/"+data.parentId;if($(getFormId(data))){return}var editFormContainer=createElement(null,"DIV",{className:"shortComment wallComment",id:getFormId(data)+"_cnt"});var avatarSpan=createElement(editFormContainer,"SPAN",{className:"shortCommentAvatar"});var editFormContent=createElement(editFormContainer,"DIV",{className:"editShortCommentContent"});var editForm=createElement(editFormContent,"FORM",{className:"editShortComment addAction",id:getFormId(data),action:action,method:"POST"});createElement(editForm,"input",{type:"hidden",value:data.token,name:"__signature"});createElement(avatarSpan,"IMG",{src:data.avatar,width:24,height:24});editForm.onsubmit=function(){return commentFormSubmit(data)};var editWrapper=createElement(editForm,"DIV",{className:"inputWrapper"});var textArea=createElement(editWrapper,"textarea",{name:"content",id:getTextAreaId(data)});var minTextareaHeight=16;textArea.onblur=function(){if(this.value.length==0){closeEditor(data)}};textArea.onkeydown=function(e){if(checkSubmitHotKey(e)){editForm.onsubmit()}};textArea.onkeyup=function(e){autogrow(this,minTextareaHeight)};textArea.style.height=minTextareaHeight+"px";if(shortCommentsManager.toPostStatusLabel){createElement(editFormContent,"span",{innerHTML:shortCommentsManager.toPostStatusLabel,className:"textareaHelp"})}createElement(editForm,"input",{type:"hidden",name:"moduleId",value:data.moduleId});createElement(editForm,"input",{type:"hidden",name:"parentType",value:data.parentType});createElement(editForm,"input",{type:"hidden",name:"parentId",value:data.parentId});createElement(editForm,"input",{type:"submit",className:"buttonSimple postStatus",value:""});var prepend=null;if(data.insertAfterElement){prepend=data.insertAfterElement.nextSibling}apearBlockVertical(editFormContainer,data.container,prepend,200);autogrow(textArea,minTextareaHeight);setTimeout(function(){$(getTextAreaId(data)).focus()},220)}function closeEditor(data){var editFormContainer=$(getFormId(data)+"_cnt");if(editFormContainer){editFormContainer.parentNode.removeChild(editFormContainer)}}function commentSuccess(data){renderComments(new ViewCommentData(data,this.editData.container,this.insertAfterElement));closeEditor(this.editData);submitInProcess=false}function loadCommentsSuccess(data){var rendered=renderComments(new ViewCommentData(data,this.container,this.insertAfterElement),false);if(this.callback){this.callback(rendered)}}function commentError(data){submitInProcess=false;alert("Error")}var submitInProcess=false;function commentFormSubmit(data){if(submitInProcess){return false}submitInProcess=true;var form=$(getFormId(data));if(!form){return false}Ajax.form(form,{onready:commentSuccess,onerror:commentError,editData:data});return false}function renderComments(viewData,withAnimation){var docFragment=document.createElement("DIV");docFragment.innerHTML=viewData.html;var prepend=null;if(viewData.insertAfterElement){prepend=viewData.insertAfterElement.nextSibling}var elementsCount=0;if(docFragment.children){for(var i=0;i<docFragment.children.length;i++){var newAction=docFragment.children[i].cloneNode(true);if(!withAnimation){if(!viewData.insertAfterElement){viewData.container.appendChild(newAction)}else{viewData.container.insertBefore(newAction,viewData.insertAfterElement)}}else{var duration=Math.min(maxApearTime,50*(i+1));apearBlockVertical(newAction,viewData.container,prepend,duration,5)}elementsCount++}}return elementsCount}function deleteSuccess(data){if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}}function deleteByAuthorSuccess(data){var ids=[];if(typeof JSON=="undefined"){eval("ids="+data)}else{ids=JSON.parse(data)}if(!ids||!ids.length){return}elementPrefix=this.elementPrefix||"sc_";for(var i=0;i<ids.length;i++){var cmt=$(elementPrefix+ids[i]);if(cmt){cmt.parentNode.removeChild(cmt)}}}function loadComments(moduleId,parentType,parentId,from,count,container,insertAfterElement,callback){Ajax.get("/"+defaultLang+"/get_short_comments/"+moduleId+"/"+parentType+"/"+parentId+"/"+from+"/"+count,null,{onready:loadCommentsSuccess,onerror:commentError,container:container,insertAfterElement:insertAfterElement,callback:callback})}this.NewComment=function(moduleId,parentType,parentId,avatar,container,insertAfterElement,token){startComment(moduleId,parentType,parentId,avatar,container,insertAfterElement,token)};this.LoadComments=function(moduleId,parentType,parentId,from,count,container,insertAfterElement,callback){loadComments(moduleId,parentType,parentId,from,count,container,insertAfterElement,callback)};this.Delete=function(moduleId,id,elementPrefix){if(!elementPrefix){elementPrefix="sc_"}Ajax.post("/"+defaultLang+"/delete_short_comment/"+moduleId+"/"+id,null,false,{onready:deleteSuccess,onerror:commentError,element:$(elementPrefix+id)})};this.DeleteByAuthor=function(moduleId,id,elementPrefix){if(!elementPrefix){elementPrefix="sc_"}Ajax.post("/"+defaultLang+"/delete_short_comment_by_author/"+moduleId+"/"+id,null,false,{onready:deleteByAuthorSuccess,onerror:commentError,elementPrefix:elementPrefix})};this.OnLoadCommentsClick=function(actionId,moduleId,typeId,from,count){if($("hiddenComments_"+actionId)){return showComments(actionId)}var wrapper=$("commentsCountWrapper_"+actionId);shortCommentsManager.LoadComments(moduleId,typeId,actionId,from,count,$("comments_"+actionId),wrapper.nextSibling,function(){onCommentsLoaded(arguments[0],actionId)});var link=$("commentsLoad_"+actionId);link.style.display="none";Class(wrapper,"loading")};function onCommentsLoaded(loadedCount,actionId){var link=$("commentsLoad_"+actionId);var wrapper=$("commentsCountWrapper_"+actionId);Class(wrapper,"loading",true);if(loadedCount<=0){link.style.visibility="visible"}else{var delay=Math.min(maxApearTime+200,60*(loadedCount));$("commentsLoad_"+actionId).style.display="none";$("commentsHide_"+actionId).style.display="inline"}}this.HideComments=function(actionId,commentsToShowCount){$("commentsHide_"+actionId).style.display="none";var hidden=$("hiddenComments_"+actionId);var divFix;if(!hidden){var cont=$("comments_"+actionId);hidden=createElement(null,"div",{id:"hiddenComments_"+actionId});var comments=getElementsByClass("shortComment",$("comments_"+actionId));cont.insertBefore(hidden,comments[0]);for(var i=0;i<(comments.length-commentsToShowCount);i++){var cm=comments[i];hidden.appendChild(cm)}}hidden.style.display="none";$("commentsLoad_"+actionId).style.display="inline"};function showComments(actionId){$("commentsLoad_"+actionId).style.display="none";var hidden=$("hiddenComments_"+actionId);if(!hidden){return}var first_comment=hidden.nextSibling;var parent=first_comment.parentNode;var i=0;while(hidden.children.length>0){parent.insertBefore(hidden.children[0],first_comment);i++}hidden.parentNode.removeChild(hidden);$("commentsHide_"+actionId).style.display="inline"}}var shortCommentsManager=new ShortComments();(function(){var p=window.Dialog={},g,j,n,k,f=false,e,l,a,h,o;function d(){var t=document.body.getElementsByTagName("div")[0];g=createElement(t,"IFRAME",{className:"window-lock"});j=createElement(t,"DIV",{className:"window-lock"});g.style.height=j.style.height="100%";g.frameBorder=0;g.style.width=j.style.width="100%";n=createElement(document.body,"DIV",{className:"window"});var s=createElement(n,"DIV",{className:"window-title"});s.appendChild(document.createElement("SPAN"));s.onmousedown=q;if(o){var r=createElement(s,"SPAN",{className:"window-close"});r.onclick=function(){o()};if(document.location.protocol.indexOf("https")==0){Class(r,"httpsClose")}}k=createElement(n,"DIV",{className:"window-movelocker"});createElement(n,"DIV",{className:"window-content"})}function q(r){if(!r){r=window.event}f=true;document.onmousemove=i;document.onmouseup=m;e=parseInt(n.style.left)-r.clientX;l=parseInt(n.style.top)-r.clientY;k.style.display="block"}function i(s){if(!f){return}if(!s){s=window.event}var r=s.clientX+e;var v=s.clientY+l;var u;if((u=(n.offsetWidth+r)-j.offsetWidth)>0){r-=u}if((u=(n.offsetHeight+v)-j.offsetHeight)>0){v-=u}if(r<0){r=0}if(v<0){v=0}n.style.left=r+"px";n.style.top=v+"px";try{if(window.getSelection&&(s=window.getSelection())){s.removeAllRanges()}else{if(document.selection){document.selection.empty()}}}catch(t){}}function m(){if(f){f=false;k.style.display=""}}function c(){var r=n.lastChild.firstChild;if(r){if(a){a.insertBefore(r,h)}else{n.lastChild.removeChild(r)}}}function b(r){var s=r;while(s){if(s.tagName&&(s.tagName.toLowerCase()=="body")){return true}s=s.parentNode}return false}p.show=function(C,v,r,E,w,A,t,s){o=w;var u=b(v);if(!n){d()}n.style.visibility="hidden";g.style.display=j.style.display=n.style.display="";n.lastChild.style.minWidth=r+"px";k.style.height=(E+20)+"px";if(!t){if(A){var D;var B=A.left;var z=A.top;if((D=(n.offsetWidth+B)-j.offsetWidth)>0){B-=(D+(D>0?1:-1)*10)}if((D=(n.offsetHeight+z)-j.offsetHeight)>0){z-=(D+(D>0?1:-1)*10)}n.style.top=z+"px";n.style.left=B+"px"}else{n.style.top=(document.body.scrollTop||document.documentElement.scrollTop)+Math.round(((window.innerHeight||document.documentElement.clientHeight)-E-24)/2)+"px";n.style.left=Math.round((document.body.scrollWidth-r-4)/2)+"px"}}n.firstChild.firstChild.innerHTML=C;c();if(u){a=v.parentNode}h=v.nextSibling;n.lastChild.appendChild(v);if(s){n.className="window "+s}else{n.className="window"}n.style.visibility="visible"};p.hide=function(){try{c()}catch(r){}g.style.display=j.style.display=n.style.display="none"}})();function edit(q){var B=document.getElementById("newmessage");if(B){B.style.display="block"}window.type=((""+q).substr(0,1)=="_"?0:1);if(window.type==0){real_id=parseInt(q.substr(1,q.length))}else{real_id=parseInt(q)}var l=document.getElementById("id_message");var a=document.getElementById("subject_message");var m=document.getElementById("content"+real_id);var A=document.getElementById("simple_message");var y=document.getElementById("edit_id");var r=document.getElementById("edit_parent_id");var f=document.getElementById("edit_subject");var n=document.getElementById("edit_simple");var j=document.getElementById("subject");var z=document.getElementById("edit_file");var t=document.getElementById("subject");var i=document.getElementById("simple");var u=document.getElementById("edit_cnew_cmd");var d=document.getElementById("edit_csave_cmd");var h=document.getElementById("admin_date_create");var v=document.getElementById("admin_date_modify");var s=document.getElementById("admin_label_date_modify");var g=document.getElementById("admin_not_modify");var w=document.getElementById("admin_label_not_modify");var p=document.getElementById("date_create_"+real_id);var b=document.getElementById("date_modify_"+real_id);var o=document.getElementById("author_info_"+q);var c=document.getElementById("admin_author");if(y){y.value=real_id}if(a&&f&&j){if(window.type==0){j.value=a.value;f.style.display="block"}else{j.value="";f.style.display="none"}}if(m&&window.MQRTE){set_content(m.innerHTML,false,true)}if(z){try{z.value=""}catch(x){}}if(A&&n&&i){if(window.type==0){i.checked=(A.value==0);n.style.display="block"}else{i.checked=false;n.style.display="none"}}if(u&&d){u.style.display="none";d.style.display="block"}if(h){h.value=p!=null?trim(p.innerHTML):""}if(v){v.style.display=(window.type==0?"block":"none");v.value=(window.type==0&&b!=null?trim(b.innerHTML):"")}if(s){s.style.display=(window.type==0?"block":"none")}if(g){g.style.display="none";g.checked=false}if(w){w.style.display="none"}if(c&&o){c.value=o.title}}function edit_cancel(){var f=document.getElementById("id_message");var r=document.getElementById("edit_id");var n=document.getElementById("edit_subject");var m=document.getElementById("edit_simple");var d=document.getElementById("subject");var g=document.getElementById("edit_file");var p=document.getElementById("subject");var c=document.getElementById("simple");var h=document.getElementById("edit_cnew_cmd");var l=document.getElementById("edit_csave_cmd");var o=document.getElementById("admin_date_create");var a=document.getElementById("admin_date_modify");var q=document.getElementById("admin_label_date_modify");var j=document.getElementById("admin_not_modify");var b=document.getElementById("admin_label_not_modify");var s=document.getElementById("admin_author");if(r){r.value=0}if(n&&d){d.value="";n.style.display="none"}if(window.MQRTE){set_content((Dalet.isGecko?"<br>":""),false,true)}if(g){try{g.value=""}catch(i){}}if(m&&c){c.checked=false;m.style.display="none"}if(h&&l){h.style.display="block";l.style.display="none"}if(o){o.value=""}if(a){a.style.display="none";a.value=""}if(q){q.style.display="none"}if(j){j.style.display="inline";j.checked=false}if(b){b.style.display="inline"}if(s){s.value=""}}function quote_forum(h){var c=document.getElementById("newmessage");if(c){c.style.display="block"}var f=document.getElementById("content"+h);var b=document.getElementById("author_info_"+h);if(!f||!b){return}var g=f.cloneNode(true);var a=b.cloneNode(true);var e=a.getElementsByTagName("a");for(k=e.length-1;k>=0;--k){if(e[k].className=="fast_msg"){e[k].parentNode.removeChild(e[k])}}var e=g.getElementsByTagName("DIV");for(k=e.length-1;k>=0;--k){if(e[k].className=="fquote"||e[k].className=="pocket"){e[k].parentNode.removeChild(e[k])}}e=g.getElementsByTagName("IMG");for(k=e.length-1;k>=0;--k){if(e[k].parentNode&&(e[k].parentNode.tagName=="A"||e[k].parentNode.tagName=="a")){e[k].parentNode.parentNode.removeChild(e[k].parentNode)}else{e[k].parentNode.removeChild(e[k])}}e=g.getElementsByTagName("EMBED");for(k=e.length-1;k>=0;--k){e[k].parentNode.removeChild(e[k])}e=g.getElementsByTagName("PRE");for(k=e.length-1;k>=0;--k){e[k].parentNode.removeChild(e[k])}var d='<strong><span style="color:#42639C;"'+(b.title?' title="'+b.title+'"':"")+">"+trim(a.innerText?a.innerText:a.textContent)+"</span>:</strong><br> "+g.innerHTML;g=null;set_content('<div class="fquote">'+d+"</div>",true,false);MQTE.Focus("body")}function toggleNewMessage(b){var a=document.getElementById("newmessage");if((b)||(a.style.display=="none")){a.style.display="block";set_content("",true,false);MQTE.Focus("body");if($("extractorContainer")){$("extractorContainer").className=""}return true}else{editCommentCancel();a.style.display="none";if($("extractorContainer")){$("extractorContainer").innerHTML=""}return false}}function win_ban_show(g,f,b,e,c,a){var h=document.createElement("form");h.name="banForm";h.action="/";h.method="get";var d=document.getElementById(b);h.innerHTML=d.innerHTML.replace(/HIDDEN/g,"").replace(/{IP}/,e).replace(/{COOKIE}/,c).replace(/{USER_LOGIN}/,a).replace(/{USER_LOGIN}/,a);Dialog.show(g,h,500,162,function(){Dialog.hide()})}function win_edit_image_show(d,a,c){var b=document.createElement("iframe");b.id="iframe_avatar";b.name="iframe_avatar";b.frameBorder=0;b.scrolling="no";b.src="/"+d+"/users/"+a+"/avatar";b.onload=function(){resizeAvatarIframe(b)};b.style.width="100%";b.style.height="430px";b.style.overflow="hidden";Dialog.show(c,b,320,430)}function ban_submit(g,e){var h=document.getElementById("period").value;var j=document.getElementById("ip_address").value;var a=encodeURIComponent(document.getElementById("cookie").value);var d=document.getElementById("comment").value;if(d==""){alert(e);return}var f=encodeURIComponent(d);var i=document.getElementById("login").value;if(j.match("^(([0-9*]{1,3}.){3}([0-9*]{1,3}){1})?$")==null){alert("IP mask is not valid");return}var b=document.createElement("SCRIPT");b.setAttribute("type","text/javascript");b.setAttribute("onload","window.location.reload();");document.getElementsByTagName("head")[0].appendChild(b);var c="?period="+h+"&ip="+encodeURIComponent(j)+"&cookie="+encodeURIComponent(a)+"&comment="+encodeURIComponent(f)+"&login="+encodeURIComponent(i);b.setAttribute("src",g+c)}function set_content(f,g,e){var d=0;var c=0;var a=0;var b="";if(e){MQTE.SetContent("body",f)}else{MQTE.InsertContent("body",f)}}function trim(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function processAjaxSubscribe(url,sender,locData){var subscribeLink=sender;if(subscribeLink.className!="inFavorite star"&&subscribeLink.className!="notInFavorite star"){return false}var action=subscribeLink.className=="inFavorite star"?"remove":"add";var antiAction=subscribeLink.className=="inFavorite star"?"add":"remove";var postLink=url+(url.charAt(url.length-1)=="/"?"":"/")+action;subscribeLink.className="loading star";bindStarSrc(subscribeLink,locData);Ajax.post(postLink,null,false,{onready:function(e){if(eval(e)=="success"){subscribeLink.className=antiAction=="add"?"notInFavorite star":"inFavorite star";bindStarSrc(subscribeLink,locData)}else{alert(eval(e));subscribeLink.className=action=="add"?"notInFavorite star":"inFavorite star";bindStarSrc(subscribeLink,locData)}},onerror:function(s,e){alert(locData.error);subscribeLink.className=action=="add"?"notInFavorite star":"inFavorite star";bindStarSrc(subscribeLink,locData)}});return false}function processAjaxSubscribeToModule(a,b){Ajax.post(a,null,false,{onready:function(c){b.style.display="none"},onerror:function(c,d){b.style.display="none"}});return false}function bindStarSrc(b,a){if(b.className=="inFavorite star"){b.title=a.remove}if(b.className=="notInFavorite star"){b.title=a.add}if(b.className=="loading star"){b.title=""}}function openAttachments(b,c){$(c).style.display="block";$(c+"_link").style.display="none";$(c+"_info").style.display="block";var a=$(b);a.className=a.className.replace("floatedAttaches","noFloatedAttaches");return false}function MenuUpdater(){}MenuUpdater.startUpdating=function(a,c,b){Ajax.get(c,null,{onready:function(){var e=document.createElement("span");e.innerHTML=b;var d=$(a);d.parentNode.appendChild(e);d.parentNode.removeChild(d)}})};function Accounting(){}Accounting.payForDisplay=function(b,a){Dialog.show(a,$(b),400,137);return false};Accounting.payForSubmit=function(a){window.Ajax.form($(a),{onready:function(){window.Dialog.hide()},onerror:function(){alert("error occured")}})};Accounting.SetTypeCard=function(a,b){var c=$(b);if(!c){return}if(a.value.startsWith("4")){c.className="visa"}else{c.className="mastercard"}};function Jobs(){}Jobs.categoriesShow=function(){toggle("tree");return false};Jobs.categoriesApply=function(e){toggle("tree");var a=$("selCats");var d="";var c=$("tree").getElementsByTagName("INPUT");var b=0;for(var f=0;f<c.length;f++){if(c[f].checked){if(b<2){d+=c[f].nextSibling.innerHTML+", "}else{c[f].checked=false}b++}}if(d.length!=0){d=d.substr(0,d.length-2)}else{d=e}a.innerHTML=d;return false};function ShowArbitrageForm(){var a=$("arbitrage_window");a.style.display="block";if(a){Dialog.show(a.title,a,500,160);CalculateFieldLength($("arbitrage_reason"),"arbitrage_char_counter",3,150,true)}}function CloseArbitrageForm(){var a=$("arbitrage_window");var b=$("arbitrage_reason");if(b){b.value=""}if(a){a.style.display="none"}Dialog.hide()}function ShowFeedbackForm(a){var b=$("feedback_window");b.style.display="block";if(a){$("Rating").value=a.rating;$("Content").value=a.content;$("FeedbackID").value=a.id;$("JobRequestID").value=a.job_request_id;$("selectedStars").className="v"+a.rating+"0"}if(b){Dialog.show(b.title,b,700,300)}}function CloseFeedbackForm(){var a=$("feedback_window");var e=$("Content");if(e){e.value=""}var d=$("Rating");if(d){d.value=3}var b=$("FeedbackID");if(b){b.value=-1}$("rating_container").firstChild.className="v"+$("Rating").value+"0";if(a){a.style.display="none"}Dialog.hide()}function SubmitFeedbackForm(c,a,b,e,d){window.Ajax.post(d,{content:c,jobRequestID:a,rating:b,feedbackID:e},false,{onready:OnfeedbackSucceed,onerror:OnFeedbackError})}function OnFeedbackError(a,b){location.reload(true)}function OnfeedbackSucceed(s,e){if(eval(s)==true||eval(s)==false){location.reload(true)}else{alert(eval(s))}}function MQAutoComplete(){this.id=null;this.placeholder=null;this.multiple=false;this.items=[];this.defaultKey=null;this.domContainer=null;this.ajaxQueryUrl=null;this.buildAjaxQueryUrl=function(){return this.ajaxQueryUrl};this.onPopup=function(field,dropdown){return};this.onTyping=function(field){return};this.onChange=function(id,key,value){return};this.bindResult=function(link,item){link.innerHtml=item;link.item=item};this.loadItemValue=function(link){return link.item};this.loadResultValue=function(item){return item};this.init=function(){this.initTo(document.getElementById(this.id))};this.initTo=function(field,width){if(!this.id||!field){return}this._dom_field=field;if(this._dom_field.addEventListener){this._dom_field.addEventListener("keypress",this._bind(this._suppressSubmit,this),false);this._dom_field.addEventListener("keydown",this._bind(this._trackArrow,this),false);this._dom_field.addEventListener("keyup",this._bind(this._trackKeywordChange,this),false)}else{this._dom_field.attachEvent("onkeypress",this._bind(this._suppressSubmit,this));this._dom_field.attachEvent("onkeydown",this._bind(this._trackArrow,this));this._dom_field.attachEvent("onkeyup",this._bind(this._trackKeywordChange,this))}this._dom_dropdown=document.createElement("DIV");this._dom_dropdown.className="select-edit-list";this._dom_dropdown.style.width=(width||this._dom_field.parentNode.clientWidth)+"px";this._dom_field.parentNode.parentNode.appendChild(this._dom_dropdown);this.domContainer=this._dom_field.parentNode.parentNode;this._dom_list=document.createElement("TABLE");this._dom_dropdown.appendChild(this._dom_list);if(this.placeholder&&this.placeholder.length>0){this._dom_placeholder=document.createElement("SPAN");this._dom_placeholder.style.display="none";this._dom_placeholder.style.position="absolute";this._dom_placeholder.style.marginTop="-22px";this._dom_placeholder.style.padding="1px 2px";this._dom_placeholder.style.color="#999";this._dom_placeholder.style.cursor="text";this._dom_placeholder.style.cursor="text";if(this._dom_field.addEventListener){this._dom_field.addEventListener("focus",this._bind(this._gotFocus,this),false);this._dom_field.addEventListener("blur",this._bind(this._lostFocus,this),false);this._dom_placeholder.addEventListener("click",this._bind(this._lostFocus,this),false)}else{this._dom_field.attachEvent("onfocus",this._bind(this._gotFocus,this),false);this._dom_field.attachEvent("onblur",this._bind(this._lostFocus,this),false);this._dom_placeholder.attachEvent("onclick",this._bind(this._lostFocus,this))}this._dom_field.parentNode.appendChild(this._dom_placeholder);if(this._dom_field.value.length===0){this._dom_placeholder.style.display="block"}}else{if(this._dom_field.addEventListener){this._dom_field.addEventListener("blur",this._bind(this._lostFocus,this),false)}else{this._dom_field.attachEvent("onblur",this._bind(this._lostFocus,this))}}if(this.items.length>0){this._buildDropDown(this,this.items)}};this.toggle=function(context){if(context._dom_dropdown.style.display==="block"){context._hideDropDown()}else{context._showDropDown()}context._dom_field.focus()};this.getVisible=function(){var node=this._dom_field.parentNode.parentNode;return node&&node.style.visibility!=="hidden"};this.setVisible=function(value){this._setVisible(this,value)};this._setVisible=function(context,value){var node=context._dom_field.parentNode.parentNode;if(!node){return false}if(value){node.style.visibility="visible"}else{node.style.visibility="hidden"}return true};this.clone=function(newId,newName){var id=newId||this._getID(this.id);var autocomplete=new MQAutoComplete();autocomplete.id=id;autocomplete.items=this.items;autocomplete.onChange=this.onChange;autocomplete.loadItemValue=function(link){$(id+"Key").value=link.key;if(window[id+"Autocomplete"].onChange){window[id+"Autocomplete"].onChange(id,link.key,link.value)}return link.value};autocomplete.loadResultValue=function(item){return(item.key||item.Key)};autocomplete.bindResult=function(link,item){link.innerHTML=item.value||item.Value;link.key=item.key||item.Key;link.value=item.value||item.Value};autocomplete.onTyping=function(context,field){$(id+"Key").value=context.defaultKey;if(context.onChange){context.onChange(id,context.defaultKey,field.value)}};var cloned=this._dom_field.parentNode.parentNode.cloneNode(false);var div2=this._dom_field.parentNode.cloneNode(false);cloned.appendChild(div2);var valueField=this._dom_field.cloneNode(false);valueField.setAttribute("id",id);if(newName){valueField.setAttribute("name",newName)}valueField.value="";div2.appendChild(valueField);var keyField=this._dom_field.parentNode.getElementsByTagName("input")[1].cloneNode(false);keyField.setAttribute("id",id+"Key");if(newName){keyField.setAttribute("name",newName+"Key")}div2.appendChild(keyField);var dropdownLink=this._dom_field.parentNode.getElementsByTagName("a")[0].cloneNode(true);dropdownLink.setAttribute("onclick",id+"Autocomplete.toggle("+id+"Autocomplete)");div2.appendChild(dropdownLink);autocomplete.initTo(valueField,this._dom_field.parentNode.clientWidth);autocomplete._setVisible(autocomplete,this.getVisible());window[id+"Autocomplete"]=autocomplete;return autocomplete};this._dom_field=null;this._dom_placeholder=null;this._dom_dropdown=null;this._dom_list=null;this._preventLostFocus=false;this._searching=false;this._searchCall=false;this._listItems=[];this._dropDownListIndex=-1;this._getID=function(source){var counter=1;var id=source+counter;while($(id)){counter++;id=source+counter}return id};this._getValue=function(){if(this.multiple&&this._dom_field.value.indexOf("|")>=0){return this._dom_field.value.substring(this._dom_field.value.lastIndexOf("|")+1)}else{if(this.multiple&&this._dom_field.value.indexOf(",")>=0){return this._dom_field.value.substring(this._dom_field.value.lastIndexOf(",")+1)}else{if(this.multiple&&this._dom_field.value.indexOf(";")>=0){return this._dom_field.value.substring(this._dom_field.value.lastIndexOf(";")+1)}else{return this._dom_field.value}}}};this._setValue=function(value){if(this.multiple&&this._dom_field.value.indexOf("|")>=0){this._dom_field.value=this._dom_field.value.substring(0,this._dom_field.value.lastIndexOf("|")+1)+value}else{if(this.multiple&&this._dom_field.value.indexOf(",")>=0){this._dom_field.value=this._dom_field.value.substring(0,this._dom_field.value.lastIndexOf(",")+1)+value}else{if(this.multiple&&this._dom_field.value.indexOf(";")>=0){this._dom_field.value=this._dom_field.value.substring(0,this._dom_field.value.lastIndexOf(";")+1)+value}else{this._dom_field.value=value}}}};this._bind=function(func,context){return function(){if(arguments){return func(this,context,arguments[0])}else{return func(this,context)}}};this._bindIE=function(func,context,value){return function(){return func(value,context)}};this._showDropDown=function(){this.onPopup(this._dom_field,this._dom_dropdown);this._dom_dropdown.style.width=this._dom_field.parentNode.clientWidth+"px";this._dom_dropdown.style.display="block"};this._hideDropDown=function(){this._dom_dropdown.style.display="none";if(this.items.length===0){this._listItems=[]}};this._gotFocus=function(field,context,evt){if(context._dom_placeholder){context._dom_placeholder.style.display="none";context._dom_field.focus()}};this._lostFocus=function(field,context,evt){if(context._dom_field.value.length===0&&context._dom_placeholder){context._dom_placeholder.style.display="block"}var target=evt.explicitOriginalTarget||evt.toElement;if(!context._preventLostFocus&&target&&target.tagName!="A"&&target.tagName!="EM"&&(!target.parentNode||(target.parentNode.tagName!="A"&&target.parentNode.tagName!="EM"))){context._hideDropDown()}context._preventLostFocus=false};this._trackKeywordChange=function(link,context,evt){evt=evt||window.event;var keyCode=evt.keyCode;if(evt.charCode&&keyCode===0){keyCode=evt.charCode}if(keyCode===40||keyCode===38||keyCode===13||keyCode===32||keyCode===0){return}if(!context._searching&&!context._searchCall){setTimeout(function(){context._searchByKeyword(context)},500);context._searchCall=true}};this._searchByKeyword=function(context){context._dropDownListIndex=-1;if(context._searching||context.items.length>0){return}var keyword=context._getValue();if(keyword.length<2){context._searchCall=false;context._hideDropDown();return}var url=context.buildAjaxQueryUrl();if(!url){return}context._searching=true;context._searchCall=false;context._dom_field.className="wait";context._dom_field.style.backgroundPosition=(context._dom_field.clientWidth-18)+"px center";Ajax.get(url,{keyword:keyword},{onready:function(json){context._processCallBack(context,json)}})};this._processCallBack=function(context,json){while(context._dom_list.hasChildNodes()){context._dom_list.removeChild(context._dom_list.firstChild)}if((json!=null)&&(json!="")&&(json!="[]")){var result=eval("("+json+")");context._listItems=[];if(result.length==1&&context._value==context.loadResultValue(result[0])){context._hideDropDown();context._searching=false;context._dom_field.className="";return false}context._buildDropDown(context,result);context._showDropDown()}else{context._hideDropDown()}context._searching=false;context._dom_field.className="";return true};this._buildDropDown=function(context,data){for(var i=0;i<data.length;i++){var lastRow=context._dom_list.rows.length;var row=context._dom_list.insertRow(lastRow);var cellLeft=row.insertCell(0);cellLeft.style.overflow="hidden";var link=document.createElement("A");link.href="javascript:void(false);";context.bindResult(link,data[i]);if(link.addEventListener){link.addEventListener("click",context._bind(context._itemClick,context),false)}else{link.attachEvent("onclick",context._bindIE(context._itemClickIE,context,i))}context._listItems.push(link);cellLeft.appendChild(link)}};this._itemClick=function(link,context){if(link.className&&link.className==="more"){return false}context._setValue(context.loadItemValue(link));context._hideDropDown();return false};this._itemClickIE=function(index,context){var link=context._listItems[index];if(link&&link.className&&link.className==="more"){return false}context._setValue(context.loadItemValue(link));context._hideDropDown();return false};this._suppressSubmit=function(field,context,evt){context.onTyping(field);return true};this._trackArrow=function(field,context,evt){evt=evt||window.event;var keyCode=evt.keyCode;if(evt.charCode&&keyCode===0){keyCode=evt.charCode}if(context._listItems&&context._listItems.length>0){switch(keyCode){case 40:evt.preventDefault&&evt.preventDefault();if(context._dropDownListIndex!==-1&&context._listItems[context._dropDownListIndex]){context._listItems[context._dropDownListIndex].className=""}if(context._dropDownListIndex<context._listItems.length-1){++context._dropDownListIndex}else{context._dropDownListIndex=0}context._setValue(context.loadItemValue(context._listItems[context._dropDownListIndex]));context._listItems[context._dropDownListIndex].className="selected";context._preventLostFocus=true;break;case 38:evt.preventDefault&&evt.preventDefault();if(context._dropDownListIndex!==-1&&context._listItems[context._dropDownListIndex]){context._listItems[context._dropDownListIndex].className=""}if(context._dropDownListIndex===0){context._dropDownListIndex=context._listItems.length-1}else{--context._dropDownListIndex}context._setValue(context.loadItemValue(context._listItems[context._dropDownListIndex]));context._listItems[context._dropDownListIndex].className="selected";break;case 13:case 32:case 0:context._hideDropDown();return false;case 27:context._dom_field.focus();context._hideDropDown();return false;case 8:context._dom_field.focus();context._dom_field.value=context._dom_field.value.substring(0,context._dom_field.value.length);if(!context._searching&&!context._searchCall){setTimeout(function(){context._searchByKeyword(context)},500);context._searchCall=true}return false}}return true}}function Searchbox(){this.multiselect_separator=",";var searchBoxManager=this;this.AjaxEnabled=true;this.OnRenderResults=function(data){return true};this.OnRenderElement=undefined;this.OnSelectResult=function(data){return true};this.ShowHide=function(){var container=$("searchBoxContainer");if(!container){return true}if(container.className=="searchBoxContainer"){container.className="searchBoxContainer open";return false}else{alert("need submit");container.className="searchBoxContainer";return true}};this.Render=function(containerId,inputId,value,multiselect,requestURL,title){oldIEelement=$(inputId);if(oldIEelement){oldIEelement.parentNode.removeChild(oldIEelement)}this.requestURL=requestURL;this.container=$(containerId);var inputWrapper=document.createElement("div");inputWrapper.className="inputWrapper searchbox";this.container.style.position="relative";this.input=document.createElement("input");this.input.type="text";this.input.id=inputId;this.input.name=inputId;this.input.value=value;this.input.title=title;this.input.style.width="100%";this.input.setAttribute("autocomplete","off");this.input.onkeyup=this.OnKeyPress;this.input.onkeydown=this.OnKeyDown;inputWrapper.appendChild(this.input);this.container.appendChild(inputWrapper);this.Multiselect=multiselect;this.input.onblur=function(){this.focused=false;searchBoxManager.ResultsPanel.Hide();if(this.value==""){searchBoxManager.ShowHelpText()}};this.input.onfocus=function(){this.focused=true;searchBoxManager.HideHelpText()};this.HelpText=createElement(null,"div",{className:"searchboxHelpText"});this.HelpText.style.position="absolute";this.HelpText.style.top="1px";this.HelpText.style.color="#626363";this.HelpText.style.padding="2px";this.HelpText.style.lineHeight="15px";this.HelpText.innerHTML=title;this.container.appendChild(this.HelpText);this.HelpText.onclick=this.HideHelpText;this.HelpText.onscreen=true;this.HelpText.style.display="none";if(this.input.value==""){this.HelpText.style.display=""}};this.HideHelpText=function(){if(searchBoxManager.HelpText.onscreen){searchBoxManager.HelpText.style.display="none"}searchBoxManager.HelpText.onscreen=false;searchBoxManager.input.focus()};this.ShowHelpText=function(){if(!searchBoxManager.HelpText.onscreen){searchBoxManager.HelpText.style.display=""}searchBoxManager.HelpText.onscreen=true};this.PressTimeout=null;this.SendAjaxDelay=500;this.OnKeyPress=function(event){if(searchBoxManager.PressTimeout){clearTimeout(searchBoxManager.PressTimeout)}if(!event){event=window.event}if(event.keyCode==13&&searchBoxManager.ResultsPanel.SelectedResult>=0){if(searchBoxManager.ResultsPanel.ResultsInDom()==false){return true}searchBoxManager.ResultsPanel.Hide();if(searchBoxManager.OnSelectResult){searchBoxManager.OnSelectResult(eval(searchBoxManager.JSON)[searchBoxManager.ResultsPanel.SelectedResult])}return false}if(event.keyCode==40||event.keyCode==38){return false}if(searchBoxManager.GetValue().length>1&&searchBoxManager.AjaxEnabled==true){searchBoxManager.PressTimeout=setTimeout(function(){var keyword=escape(searchBoxManager.GetValue());Ajax.get(searchBoxManager.requestURL,{keyword:keyword},{onready:searchBoxManager.SearchCallBack})},searchBoxManager.SendAjaxDelay)}else{searchBoxManager.ResultsPanel.Hide()}return true};searchBoxManager.OnKeyDown=function(event){if(!event){event=window.event}if(event.keyCode==13){if(searchBoxManager.ResultsPanel.ResultsInDom()==false){return true}if(searchBoxManager.OnSelectResult){searchBoxManager.OnSelectResult(eval(searchBoxManager.JSON)[searchBoxManager.ResultsPanel.SelectedResult])}return searchBoxManager.ResultsPanel.Hide()}if(event.keyCode==40){searchBoxManager.ResultsPanel.SelectedResult+=1;searchBoxManager.MoveCursor();return false}else{if(event.keyCode==38){if(searchBoxManager.ResultsPanel.SelectedResult>=0){searchBoxManager.ResultsPanel.SelectedResult-=1;searchBoxManager.MoveCursor();return false}}}return true};this.ResultsPanel=function(){};this.ResultsPanel.ID="searchboxResultsPanel";this.ResultsPanel.ResultsInDom=function(){return $(searchBoxManager.ResultsPanel.ID)!=null};this.ResultsPanel.SelectedResult=-1;this.ResultsPanel.OnClick=function(event){searchBoxManager.ResultsPanel.Hide();if(searchBoxManager.OnSelectResult){searchBoxManager.OnSelectResult(eval(searchBoxManager.JSON)[searchBoxManager.ResultsPanel.SelectedResult])}};this.ResultsPanel.RenderResults=function(){var elements=eval(searchBoxManager.JSON);searchBoxManager.ResultsPanel.SelectedResult=-1;if(!elements||elements.length==0||!searchBoxManager.input.focused){searchBoxManager.ResultsPanel.Hide();return}if(searchBoxManager.ResultsPanel.ResultsInDom()==false){searchBoxManager.ResultsPanel.panel=document.createElement("div");searchBoxManager.ResultsPanel.panel.style.backgroundColor="#FFFFFF";searchBoxManager.ResultsPanel.panel.id=searchBoxManager.ResultsPanel.ID;searchBoxManager.ResultsPanel.panel.style.position="absolute";var containerOffset=getOffsetRect(searchBoxManager.container);searchBoxManager.ResultsPanel.panel.style.top=containerOffset.top+(searchBoxManager.container.clientHeight||20)-3+"px";searchBoxManager.ResultsPanel.panel.style.left=containerOffset.left+"px";searchBoxManager.ResultsPanel.panel.style.minWidth=searchBoxManager.container.offsetWidth+"px";searchBoxManager.ResultsPanel.panel.style.zIndex=3001;searchBoxManager.ResultsPanel.panel.style.cursor="default";searchBoxManager.ResultsPanel.panelBox=document.createElement("div");searchBoxManager.ResultsPanel.panelBox.style.border="solid 1px #000000";searchBoxManager.ResultsPanel.panelBox.style.color="#000000";searchBoxManager.ResultsPanel.panel.appendChild(searchBoxManager.ResultsPanel.panelBox);document.body.appendChild(searchBoxManager.ResultsPanel.panel)}searchBoxManager.ResultsPanel.panelBox.innerHTML="";if(elements.length==1&&elements[0].Login==searchBoxManager.GetValue()){searchBoxManager.ResultsPanel.SelectedResult=-1;searchBoxManager.SetValue(elements[0].Login);searchBoxManager.ResultsPanel.Hide()}else{for(var i in elements){var el;if(searchBoxManager.OnRenderElement){el=searchBoxManager.OnRenderElement(elements[i])}else{el=document.createElement("div");el.innerHTML=elements[i].Login+((elements[i].Name&&elements[i].Name!="")?(" ("+elements[i].Name+")"):"");el.style.padding="2px";el.login=elements[i].Login;el.number=i;el.style.cursor="default";el.style.zIndex=101;el.onmouseover=searchBoxManager.HoverResult;el.onclick=searchBoxManager.ResultsPanel.OnClick}if(!el){continue}searchBoxManager.ResultsPanel.panelBox.appendChild(el)}}};this.ResultsPanel.Hide=function(){searchBoxManager.OnRenderResults("[]");if(searchBoxManager.ResultsPanel.ResultsInDom()==true){if(searchBoxManager.OnSelectResult&&searchBoxManager.ResultsPanel.SelectedResult>=0){searchBoxManager.OnSelectResult(eval(searchBoxManager.JSON)[searchBoxManager.ResultsPanel.SelectedResult])}searchBoxManager.ResultsPanel.panel.parentNode.removeChild(searchBoxManager.ResultsPanel.panel)}return false};this.HoverResult=function(event){if(!event){event=window.event}var target=event.toElement;if(!target){target=event.currentTarget}searchBoxManager.ResultsPanel.SelectedResult=target.number;searchBoxManager.MoveCursor()};this.SearchCallBack=function(json){searchBoxManager.JSON=json;if(searchBoxManager.OnRenderResults(json)){searchBoxManager.ResultsPanel.RenderResults()}};this.MoveCursor=function(){var results=searchBoxManager.ResultsPanel.panelBox.childNodes;var count=results.length;if(searchBoxManager.ResultsPanel.SelectedResult>=count){searchBoxManager.ResultsPanel.SelectedResult=0}if(searchBoxManager.ResultsPanel.SelectedResult<0&&count>0){searchBoxManager.ResultsPanel.SelectedResult=count-1}if(count==0){searchBoxManager.ResultsPanel.SelectedResult=-1}for(var i in results){if(!results[i].style){continue}results[i].style.backgroundColor="#FFFFFF";results[i].style.color="#000";if(results[i].number==searchBoxManager.ResultsPanel.SelectedResult){results[i].style.backgroundColor="Highlight";results[i].style.color="#FFF";searchBoxManager.SetValue(results[i].login)}}};this.SetValue=function(value){if(value&&value.length>0){this.HideHelpText()}if(searchBoxManager.Multiselect){var staticValue=searchBoxManager.input.value.substring(0,searchBoxManager.input.value.lastIndexOf(searchBoxManager.multiselect_separator));searchBoxManager.input.value=staticValue+(staticValue==""?"":searchBoxManager.multiselect_separator)+value}else{searchBoxManager.input.value=value}};this.GetValue=function(){if(!searchBoxManager.Multiselect){return searchBoxManager.input.value}var oldValue=searchBoxManager.input.value;return oldValue.substring(oldValue.lastIndexOf(searchBoxManager.multiselect_separator)+1)}}function UserLinkMenu(){var c=null,a=null,d=null,b=null;mqGlobal.AddOnReady(function(){UserLinkMenu.Init()});this.Init=function(){c=$("userLinkMenu");if(!c){return}a=$("userLinkContainer");if(!a){return}d=$("userlink");if(!Core.IsTouchDevice()){if(a!=null){a.onmouseover=function(){UserLinkMenu.Show()};a.onmouseout=function(){UserLinkMenu.Hide()}}}else{if($("sidebarToggleButton")==undefined){if(d!=null){d.onclick=function(){UserLinkMenu.Show();return false}}c.onmousedown=function(g){Core.StopProp(g);Core.PreventSelection()};c.onclick=function(g){Core.StopProp(g)};b=document.createElement("input");b.type="checkbox";b.className="blurHandler";b.onblur=function(){UserLinkMenu.Hide()};c.appendChild(b);var f=c.getElementsByTagName("a");for(var e in f){f[e].onmousedown=function(g){g=g||window.event;Core.StopProp(g);g.preventDefault&&g.preventDefault()}}}}};this.Show=function(){c.className="userLinkMenu hovered";if(b!=null){window.setTimeout(function(){b.focus()},10)}};this.Hide=function(){c.className="userLinkMenu"}}var UserLinkMenu=new UserLinkMenu();function SearchBoxContainer(){var b=false,e=false,a,f,d,c;mqGlobal.AddOnReady(function(){SearchBoxContainer.Init()});this.Init=function(){d=$("searchBoxContainer");f=$("keyword");c=$("searchSubmit");a=$("main_search_form");if(d==null||f==null||c==null||a==null){return}if(d.className!=undefined&&d.className.indexOf("open")>=0){b=true;e=true}if(!e){f.onblur=function(){SearchBoxContainer.Hide(null,true)};f.onkeydown=function(g){var h=g||window.event;if(h.keyCode==27){SearchBoxContainer.Hide(null,true);this.blur()}};d.onclick=function(){SearchBoxContainer.Show(null,true)};c.onmouseout=function(g){Core.StopProp(g)};c.onmousedown=function(g){if(b){Core.StopProp(g);g.preventDefault&&g.preventDefault()}}}c.onclick=function(g){if(b){Core.StopProp(g);g.preventDefault&&g.preventDefault();if(a.onsubmit){a.onsubmit()}else{a.submit()}}};if(!Core.IsTouchDevice()&&!e){d.onmouseover=function(){SearchBoxContainer.Show(null,false)};d.onmouseout=function(){SearchBoxContainer.Hide(null,false)}}};this.ShowHide=function(){if(b){this.Hide(d,true)}else{this.Show(d,true)}return false};this.Show=function(i,g){var h=i||d;if(!h){return false}h.className="searchBoxContainer open";if($("privateAreaMessages")){$("privateAreaMessages").style.display="none"}if($("langMenuContainer")){$("langMenuContainer").style.display="none"}if($("profile")){$("profile").style.display="none"}if(g||Core.IsTouchDevice()){b=true;f.focus()}return false};this.Hide=function(i,g){if(!g&&b){return false}var h=i||d;if(!h){return false}h.className="searchBoxContainer";if(g){b=false}if($("privateAreaMessages")){$("privateAreaMessages").style.display="inline-block"}if($("langMenuContainer")){$("langMenuContainer").style.display="inline-block"}if($("profile")){$("profile").style.display="inline-block"}return false};mqGlobal.AddOnReady(function(){HotKeys.Add(112,function(g){SearchBoxContainer.ShowHide()})})}var SearchBoxContainer=new SearchBoxContainer();function MoveComments(){var commentsInfo,currentCommentId,currentLang,isShow=false;this.ShowForm=function(commentId,lang){if(isShow){return false}var win=$("moveComments_window");var newTopicNameTextBox=$("moveComments_newTopicName");if(win){commentsInfo={firstCommentId:commentId,categoryId:0,newTopicTitle:null};currentCommentId=commentId;currentLang=lang;highLightComments(false);newTopicNameTextBox.value=getTopicName();isShow=true;win.style.display="";Dialog.show(window.move_comments_title,win,500,142,MoveComments.CloseForm);newTopicNameTextBox.focus()}return false};this.CloseForm=function(){var w=$("moveComments_window");if(w){highLightComments(true);isShow=false;w.style.display="none";Dialog.hide()}};this.SendForm=function(){var w=$("moveComments_window");if(!w){return false}commentsInfo.newTopicTitle=$("moveComments_newTopicName").value;commentsInfo.categoryId=$("moveComments_categoryId").value;if(commentsInfo.newTopicTitle==""||commentsInfo.categoryId==0){return false}Ajax.post("/"+currentLang+"/forum/movecomments",commentsInfo,false,{onready:function(result){var json=eval("("+result+")");if(json!=null&&json.Url!=undefined&&json.Url!=null){MoveComments.CloseForm();window.location.href=json.Url;window.location.reload();return false}else{alert("error");MoveComments.CloseForm();window.location.reload();return false}},onerror:function(){alert("error");MoveComments.CloseForm();window.location.reload()}});return false};function getTopicName(){var currentContent=$("content"+currentCommentId);if(!currentContent){return null}var texts=currentContent.getElementsByTagName("P");for(var i in texts){if(texts[i].innerHTML!=undefined&&texts[i].innerHTML.length>10&&texts[i].innerHTML.length<64&&texts[i].innerHTML.indexOf(".")<0&&texts[i].innerHTML.indexOf("<")<0&&texts[i].innerHTML.indexOf(">")<0&&texts[i].innerHTML.indexOf("?")>10){return texts[i].innerHTML}}return null}function highLightComments(isClear){var currentContent=$("content"+currentCommentId);if(!currentContent){return}var currentComment=currentContent.parentNode.parentNode;var comments=currentComment.parentNode.childNodes;currentComment.style.borderTop=!isClear?"2px dashed #6982AE":"medium none";currentComment.style.marginTop=!isClear?"-2px":"0px";var started=false;for(var i in comments){if(comments[i]==currentComment){started=true}if(!started||comments[i].className==undefined||comments[i].className.indexOf("comment")<0){continue}comments[i].style.backgroundColor=!isClear?"#F6F8FD":""}if(!isClear){var label=document.createElement("div");label.id="followingCommentsLabel";if(window.move_comments_show_following_label){label.innerHTML=window.move_comments_following_label_title;label.style.backgroundColor="#F6F8FD";label.style.position="relative";label.style.fontSize="16px";label.style.textAlign="center";label.style.padding="10px";label.style.borderBottom="1px dashed #6982AE";label.style.borderTop="1px dashed #6982AE";label.style.marginTop="-1px";label.style.color="#6982AE"}else{label.style.backgroundColor="#FFF";label.style.position="relative";label.style.borderTop="2px dashed #6982AE";label.style.marginTop="-2px";label.style.height="0px"}currentComment.parentNode.appendChild(label)}else{var commentsLabel=$("followingCommentsLabel");currentComment.parentNode.removeChild(commentsLabel)}}}var MoveComments=new MoveComments();function MoveTopic(){var topicInfo,currentTopicId,currentLang,isShow=false;this.ShowForm=function(topicId,lang){if(isShow){return false}var win=$("moveTopic_window");if(win){topicInfo={topicId:topicId,categoryId:0};currentTopicId=topicId;currentLang=lang;isShow=true;win.style.display="";Dialog.show(window.move_topic_title,win,500,142,MoveTopic.CloseForm)}return false};this.CloseForm=function(){var w=$("moveTopic_window");if(w){isShow=false;w.style.display="none";Dialog.hide()}};this.SendForm=function(){var w=$("moveTopic_window");if(!w){return false}topicInfo.categoryId=+$("moveTopic_categoryId").value;if(topicInfo.categoryId<1){return false}Ajax.post("/"+currentLang+"/forum/movetopic",topicInfo,false,{onready:function(result){var json=eval("("+result+")");if(json!=null&&json.Url!=undefined&&json.Url!=null){MoveTopic.CloseForm();window.location=json.Url;return false}else{alert("error");MoveTopic.CloseForm();window.location.reload();return false}},onerror:function(){alert("error");MoveTopic.CloseForm();window.location.reload()}});return false}}var MoveTopic=new MoveTopic();function showComplaintForm(c,g,e,d,b){var f=$("complaint_window");if(f){var a=$("complaint_reason");f.style.display="";f.complaintData={userID:c,moduleID:e,typeID:d,parentModuleID:b,itemID:g};Dialog.show(a?a.title:null,f,500,160,CloseComplaintForm);CalculateFieldLength($("complaint_reason"),"complaint_char_counter",3,150,$("complaint_reason_select").value==500)}}function CloseComplaintForm(){RefreshComplaintForm();var a=$("complaint_window");var b=$("complaint_reason");if(b){b.value=""}if(a){a.style.display="none"}Dialog.hide()}function ComplainCallback(e){if(eval(e)=="success"){CloseComplaintForm()}else{$("complaint_error").style.display=""}}function SendComplaint(){RefreshComplaintForm();var c=$("complaint_window");if(!c){return}var e=c.complaintData;var a=document.getElementById("complaint_reason_select");var d=a.value;if(d==500&&!window.Validate($("complaintForm"))){return false}var b=$("complaint_reason");if(!b){return}e.reason=b.value;e.reasonID=d;Ajax.post("/complaint/new",e,false,{onready:ComplainCallback,onerror:ComplainCallback})}function RefreshComplaintForm(){var a=$("complaint_info").childNodes;for(var b in a){if(a[b]&&a[b].className=="field-validation-error"&&a[b].id!="complaint_error"){a[b].innerHTML=""}}$("complaint_reason").className=null;$("complaint_error").style.display="none"}function CalculateFieldLength(d,f,b,c,e){var a=true;if(!e){b=0;c=0}$(f).innerHTML=d.value.length+"/"+c;if(d.value.length>c||d.value.length<b){$(f).parentNode.className="field-validation-error";a=false}else{$(f).parentNode.className=null}return a}var Tabs=function(){this.TabsList=new Array();var c=false;var a=false;var b=false;this.Create=function(m,e,p,h,q){c=h;a=q;b=p;for(var l=0;l<m.length;l++){var n=$(m[l].content_id);var g=$(m[l].tab_id);var j=m[l].selected;if(!n||!g){continue}if(j){Class(n,"selected");Class(g,"selected");if(e){e(g)}}else{Class(n,"selected",true);Class(g,"selected",true)}var o={tab:g,tab_content:n};var r=this;g.onclick=function(){var i=this;if(p){r.SelectVerticalTab(i)}else{r.SelectTab(i)}if(e){setTimeout(function(){e(i)},0)}return false};Class(g.parentNode,"vertical",!p);if(p){var f=createElement(null,"span",{className:"rowBullet"});o.bullet=f;var d=createElement(null,"li",{className:"tab_content"});d.appendChild(n);insertAfter(g.parentNode,d,g);d.style.height="auto";prependElement(g,f)}this.TabsList.push(o)}};this.SelectVerticalTab=function(h){var f=null;for(var g=0;g<this.TabsList.length;g++){if(c&&this.TabsList[g].tab.id!=h.id){continue}var e=this.TabsList[g].tab_content.parentNode;var d=this.TabsList[g].tab.className.indexOf("selected")>=0;Class(this.TabsList[g].tab_content,"selected",false);if(this.TabsList[g].tab.id==h.id&&!d){Class(this.TabsList[g].tab,"selected",false);animate(e,"height","px",0,e.scrollHeight,0,500,50,1.7,0.5);f=e}else{if(d){animate(e,"height","px",e.clientHeight||e.offsetHeight,0,0,500,50,1.7,null);Class(this.TabsList[g].tab,"selected",true)}else{e.style.height="0px"}}}if(a&&f){setTimeout(function(){if(f&&f.style.height==f.scrollHeight+"px"){f.style.height="auto"}},500+100)}};this.SelectTab=function(f){if(b){return this.SelectVerticalTab(f)}if(f.className.indexOf("add_lang")==-1){for(var e=0;e<this.TabsList.length;e++){var d=this.TabsList[e].tab.className.indexOf("add_lang")>-1;if(this.TabsList[e].tab.id==f.id){Class(this.TabsList[e].tab_content,"selected",false)}else{Class(this.TabsList[e].tab_content,"selected",true)}Class(this.TabsList[e].tab,"selected",this.TabsList[e].tab.id!=f.id);if(d==true){Class(this.TabsList[e].tab,"add_lang")}}}};this.FitVerticalTabsHeight=function(){for(var e=0;e<this.TabsList.length;e++){if(this.TabsList[e].tab.className.indexOf("selected")<0){continue}var d=this.TabsList[e].tab_content.parentNode;if(d&&d.style.height!=d.scrollHeight+"px"){d.style.height="auto"}}}};function LinkatorSelectAll(){var c=0;var a=document.getElementsByTagName("INPUT");for(var b=a.length-1;b>=0;b--){if(a[b]==null||a[b]==undefined||a[b].type!="checkbox"||a[b].className!="checkbox"){continue}if(c==0){c=(a[b].checked?2:1)}a[b].checked=c==2?"":"checked"}a=null;c=null}var Signals={};Signals.Init=function(){Signals.signalTabs=["growth","balance","equity","risks","distr","slippage","reviews","news","subscr"];Signals.signalTabsBottom=["trading","history"];Signals.SwitchTab=function(tab,scrollTo){if(!tab.id){tab=$("tab_"+tab)}var tabName=tab.id.substr(4);if(tabName==Signals.LastTabName){return false}Signals.LastTabName=tabName;var columns=$("tradeDataColumns");if(columns){if(["growth","equity","balance"].indexOf(tabName)>=0){columns.style.display="block"}else{columns.style.display="none"}}var tabs=$("tradeDataTabs");if(tabs){if(["growth","equity","balance"].indexOf(tabName)>=0){tabs.style.display="block"}else{tabs.style.display="none"}}switch(tabName){case"growth":Signals.ShowReturnChart(null,null);break;case"balance":Signals.RenderBalanceChart();break;case"equity":Signals.RenderEquityChart();break;case"risks":Signals.RenderRisksChart();break}if(scrollTo){window.scrollTo(0,tab.getBoundingClientRect().top)}return false};Signals.ToggleBlock=function(linkId,blockId){var block=$(blockId);var link=$(linkId);if(!block||!link){return true}if(link.className=="toggle"){block.style.display="block";link.className="toggle on"}else{block.style.display="none";link.className="toggle"}return false};Signals.RenderRisksChartLabeled=function(id,labelProfit,labelTrend,currency){if(this.risksChartLoaded){return false}this.risksChartLoaded=true;document.body.style.cursor="wait";Ajax.get("/signals/charts/risks",{id:id},{onready:function(text){try{var json;if(typeof JSON=="undefined"){eval("json="+text)}else{json=JSON.parse(text)}}catch(e){document.body.style.cursor="default";return}if(!json||json.length==0){document.body.style.cursor="default";$("point_chart_MAE").style.display="none";return}var mfePoints=[];var maePoints=[];var mfeMax=0;var mfeMaxAbs=0;var mfeMaxProfit=-999999999;var mfeMaxIndex=0;var maeMin=0;var maeMinAbs=0;var maeMinProfit=999999999;var maeMinIndex=0;var winLongsMfe=[];var winTopsMfe=[];var lossLongsMfe=[];var lossTopsMfe=[];var winLongsCurMfe=[];var winTopsCurMfe=[];var lossLongsCurMfe=[];var lossTopsCurMfe=[];var winLongsMae=[];var winTopsMae=[];var lossLongsMae=[];var lossTopsMae=[];var winLongsCurMae=[];var winTopsCurMae=[];var lossLongsCurMae=[];var lossTopsCurMae=[];var winTopSum=0;var lossTopSum=0;var winTopSumCur=0;var lossTopSumCur=0;var winLongSum=0;var lossLongSum=0;var winLongSumCur=0;var lossLongSumCur=0;for(var i=0;i<json.length;i+=3){var profit=json[i];var mfe=json[i+1];var mae=json[i+2];var mfePoint='"'+i+","+profit+","+mfe+'"';var maePoint='"'+i+","+profit+","+mae+'"';mfePoints.push(mfePoint);maePoints.push(maePoint);if(profit>mfeMaxProfit){mfeMax=mfe;mfeMaxProfit=profit;mfeMaxIndex=i}if(profit<maeMinProfit){maeMin=mae;maeMinProfit=profit;maeMinIndex=i}if(profit>0){if(lossLongsCurMfe.length>lossLongsMfe.length){lossLongsMfe=lossLongsCurMfe.slice();lossLongsMae=lossLongsCurMae.slice();lossLongSum=lossLongSumCur}if(lossTopSumCur<lossTopSum){lossTopsMfe=lossTopsCurMfe.slice();lossTopsMae=lossTopsCurMae.slice();lossTopSum=lossTopSumCur}lossLongsCurMfe.length=0;lossTopsCurMfe.length=0;lossLongsCurMae.length=0;lossTopsCurMae.length=0;lossTopSumCur=0;lossLongSumCur=0;winTopsCurMfe.push(mfePoint);winLongsCurMfe.push(mfePoint);winTopsCurMae.push(maePoint);winLongsCurMae.push(maePoint);winTopSumCur+=profit;winLongSumCur+=profit}else{if(profit<=0){if(winLongsCurMfe.length>winLongsMfe.length){winLongsMfe=winLongsCurMfe.slice();winLongsMae=winLongsCurMae.slice();winLongSum=winLongSumCur}if(winTopSumCur>winTopSum){winTopsMfe=winTopsCurMfe.slice();winTopsMae=winTopsCurMae.slice();winTopSum=winTopSumCur}winLongsCurMfe.length=0;winTopsCurMfe.length=0;winLongsCurMae.length=0;winTopsCurMae.length=0;winTopSumCur=0;winLongSumCur=0;lossTopsCurMfe.push(mfePoint);lossLongsCurMfe.push(mfePoint);lossTopsCurMae.push(maePoint);lossLongsCurMae.push(maePoint);lossTopSumCur+=profit;lossLongSumCur+=profit}}if(mfe>mfeMaxAbs){mfeMaxAbs=mfe}if(mae<maeMinAbs){maeMinAbs=mae}}if(lossLongsCurMfe.length>lossLongsMfe.length){lossLongsMfe=lossLongsCurMfe;lossLongsMae=lossLongsCurMae;lossLongSum=lossLongSumCur}if(lossTopSumCur<lossTopSum){lossTopsMfe=lossTopsCurMfe;lossTopsMae=lossTopsCurMae;lossTopSum=lossTopSumCur}if(winLongsCurMfe.length>winLongsMfe.length){winLongsMfe=winLongsCurMfe;winLongsMae=winLongsCurMae;winLongSum=winLongSumCur}if(winTopSumCur>winTopSum){winTopsMfe=winTopsCurMfe;winTopsMae=winTopsCurMae;winTopSum=winTopSumCur}var buildChart=function(chart,points,winLongs,winTops,lossLongs,lossTops,extrIndex,extrValue,extrProfit,extrMax,pointColor,extrColor,trendColor,titleColor,trendTitleColor,style){var template='{"title" : "","description" : "","type" : "point","xFractionalValue" : "2","yFractionalValue" : "2","axisXTitle" : "'+labelProfit+", "+currency+'","styleIndex" : "'+style+'","series" :[';if(points&&points.length>0){template+='{"id" : "points","type" : "point","title" : "'+chart+", "+currency+'","titleColor" : "'+titleColor+'","tooltip" : "'+chart+": %VALUE% "+currency+"<BR>"+labelProfit+": %VARIABLE% "+currency+'","pointConnected" : false,"value" : ['+points+'],"pointColor" : "'+pointColor+'","pointTrendLine" : "line","pointTrendLineThickness" : "1.5","pointTrendLineColor" : "'+trendColor+'","pointTrendLineTitle" : "'+labelTrend+'","pointTrendLineTitleColor" : "'+trendTitleColor+'","trendTooltip" : ""},{"type" : "point","title" : "","tooltip" : "'+chart+": %VALUE% "+currency+"<BR>"+labelProfit+": %VARIABLE% "+currency+'","pointColor" : "'+extrColor+'","value" : ["'+extrIndex+","+extrProfit+","+extrValue+'"]}';template+=',{"visible" : false,"type" : "point","title" : "","value" : ["0,0,'+(extrMax/10)+'","0,0,'+(-extrMax/10)+'"]}'}if(winLongs&&winLongs.length>0){template+=',{"id" : "winlongs","visible" : false,"type" : "point","title" : "","pointThickness" : 5,"pointColor" : "'+extrColor+'","value" : ['+winLongs+"]}"}if(winTops&&winTops.length>0){template+=',{"id" : "wintops","visible" : false,"type" : "point","title" : "","pointThickness" : 5,"pointColor" : "'+extrColor+'","value" : ['+winTops+"]}"}if(lossLongs&&lossLongs.length>0){template+=',{"id" : "losslongs","visible" : false,"type" : "point","title" : "","pointThickness" : 5,"pointColor" : "'+extrColor+'","value" : ['+lossLongs+"]}"}if(lossTops&&lossTops.length>0){template+=',{"id" : "losstops","visible" : false,"type" : "point","title" : "","pointThickness" : 5,"pointColor" : "'+extrColor+'","value" : ['+lossTops+"]}"}template+="]}";return MQL5ChartAPI.addChart("point_chart_"+chart,template,MQL5ChartType.POINT,Signals.GetChartRenderType)};Signals.mfeChart=buildChart("MFE",mfePoints.join(","),winLongsMfe.join(","),winTopsMfe.join(","),lossLongsMfe.join(","),lossTopsMfe.join(","),mfeMaxIndex,mfeMax,mfeMaxProfit,mfeMaxAbs,"#7FBF7F","#009900","#5E75AB","#509F50","#53699D",0);Signals.maeChart=buildChart("MAE",maePoints.join(","),winLongsMae.join(","),winTopsMae.join(","),lossLongsMae.join(","),lossTopsMae.join(","),maeMinIndex,maeMin,maeMinProfit,maeMinAbs,"#FF7F7F","#CC0000","#4C9999","#FF3333","#438989",3);Signals.mfeMaxIndex=mfeMaxIndex;Signals.maeMinIndex=maeMinIndex;$("risksFieldBestTrade").innerHTML=Signals.FormatThousands(mfeMaxProfit.toFixed(2));$("risksFieldWorstTrade").innerHTML=Signals.FormatThousands(maeMinProfit.toFixed(2));$("risksFieldWinLongTrades").innerHTML=winLongsMfe.length;$("risksFieldWinLongProfit").innerHTML=Signals.FormatThousands(winLongSum.toFixed(2));$("risksFieldLossLongTrades").innerHTML=lossLongsMfe.length;$("risksFieldLossLongProfit").innerHTML=Signals.FormatThousands(lossLongSum.toFixed(2));$("risksFieldWinTopTrades").innerHTML=winTopsMfe.length;$("risksFieldWinTopProfit").innerHTML=Signals.FormatThousands(winTopSum.toFixed(2));$("risksFieldLossTopTrades").innerHTML=lossTopsMfe.length;$("risksFieldLossTopProfit").innerHTML=Signals.FormatThousands(lossTopSum.toFixed(2));$("risksTradeDataColumns").className="hoverable";Signals.mfeChart.view.onPointMouseOver=function(pointId){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.selectPoint){Signals.maeChart.view.selectPoint(pointId)}},0)};Signals.mfeChart.view.onPointMouseOut=function(pointId){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.unSelectPoint){Signals.maeChart.view.unSelectPoint(pointId)}},0)};Signals.maeChart.view.onPointMouseOver=function(pointId){setTimeout(function(){if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.selectPoint){Signals.mfeChart.view.selectPoint(pointId)}},0)};Signals.maeChart.view.onPointMouseOut=function(pointId){setTimeout(function(){if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.unSelectPoint){Signals.mfeChart.view.unSelectPoint(pointId)}},0)};document.body.style.cursor="default"},onerror:function(){document.body.style.cursor="default"}});return false};Signals.FormatThousands=function(num){return(""+num).replace(/\B(?=(\d{3})+(?!\d))/g," ")};Signals.ShowRisksTrend=function(){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.showSeries){Signals.maeChart.view.showTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.showSeries){Signals.mfeChart.view.showTrendLine("points")}},0)};Signals.HideRisksTrend=function(){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.showSeries){Signals.maeChart.view.hideTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.showSeries){Signals.mfeChart.view.hideTrendLine("points")}},0)};Signals.HighlightRisksRange=function(series){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.showSeries){Signals.maeChart.view.showSeries(series);Signals.maeChart.view.hideTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.showSeries){Signals.mfeChart.view.showSeries(series);Signals.mfeChart.view.hideTrendLine("points")}},0)};Signals.HighlightRisksRangeOff=function(series){setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.hideSeries){Signals.maeChart.view.hideSeries(series);Signals.maeChart.view.showTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.hideSeries){Signals.mfeChart.view.hideSeries(series);Signals.mfeChart.view.showTrendLine("points")}},0)};Signals.HighlightRisksTrade=function(chart){switch(chart){case"MAE":setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.selectPoint){Signals.maeChart.view.selectPoint(Signals.maeMinIndex);Signals.maeChart.view.hideTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.selectPoint){Signals.mfeChart.view.selectPoint(Signals.maeMinIndex);Signals.mfeChart.view.hideTrendLine("points")}},0);break;case"MFE":setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.selectPoint){Signals.maeChart.view.selectPoint(Signals.mfeMaxIndex);Signals.maeChart.view.hideTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.selectPoint){Signals.mfeChart.view.selectPoint(Signals.mfeMaxIndex);Signals.mfeChart.view.hideTrendLine("points")}},0);break}};Signals.HighlightRisksTradeOff=function(chart){switch(chart){case"MAE":setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.unSelectPoint){Signals.maeChart.view.unSelectPoint(Signals.maeMinIndex);Signals.maeChart.view.showTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.unSelectPoint){Signals.mfeChart.view.unSelectPoint(Signals.maeMinIndex);Signals.mfeChart.view.showTrendLine("points")}},0);break;case"MFE":setTimeout(function(){if(Signals.maeChart&&Signals.maeChart.view&&Signals.maeChart.view.unSelectPoint){Signals.maeChart.view.unSelectPoint(Signals.mfeMaxIndex);Signals.maeChart.view.showTrendLine("points")}if(Signals.mfeChart&&Signals.mfeChart.view&&Signals.mfeChart.view.unSelectPoint){Signals.mfeChart.view.unSelectPoint(Signals.mfeMaxIndex);Signals.mfeChart.view.showTrendLine("points")}},0);break}};Signals.RenderBalanceChartLabeled=function(extraSeries,startTrade,labelX,labelY,labelTrend,labelDeposits,labelWithdrawals,labelDepositOf,labelWithdrawalOf,currency){if(Signals.balanceChart){return}var pointsData=[];var extraSeriesData=[];var stop=-1;var stopOn=false;if(Signals.BalanceChartStops.length>0){stop=0}var deals=Signals.BalanceChartData.length/2;var step=Signals.BalanceChartData[Signals.BalanceChartData.length-2]-Signals.BalanceChartData[Signals.BalanceChartData.length-4];for(var i=0;i<deals;i++){var deal=Signals.BalanceChartData[i*2];var balance=Signals.BalanceChartData[i*2+1];var point=('"'+deal+","+deal+","+balance);if(stop>-1&&stop<Signals.BalanceChartStops.length&&i+1<deals){var curStop=Signals.BalanceChartStops[stop];var curDeal=Signals.BalanceChartData[i*2];var nextDeal=Signals.BalanceChartData[i*2+2];if(curStop>=curDeal&&curStop<=nextDeal){var curProfit=Signals.ChartsBalanceProfits[stop];if(curProfit<0){point+=",,#AF0000";stopOn=true}else{if(curProfit>0){point+=",,#3F9F3F";stopOn=true}else{if(stopOn){point+=",,#";stopOn=false}}}stop++}else{if(stopOn){point+=",,#";stopOn=false}}}else{if(stopOn){point+=",,#";stopOn=false}}for(var k=0;k<extraSeries.length;k++){var series=extraSeries[k];if(series[0]==-1||i>series[1]){continue}if(series[0]==i){var record='"'+deal+","+deal+","+balance+'"';if(!extraSeriesData[k]){extraSeriesData[k]=[record]}else{extraSeriesData[k].push(record)}extraSeries[k][0]++}}point+='"';pointsData.push(point)}var depositsData=[];var withdrawalsData=[];var balancesCount=Signals.BalanceChartStops.length;for(var m=0;m<balancesCount;m++){var deal=Signals.BalanceChartStops[m];var profit=Signals.ChartsBalanceProfits[m];var timestamp=Signals.ChartsBalanceTimestamps[m];var value='"'+new Date(timestamp*1000).yyyyMMdd()+","+(deal-1)+","+profit+'"';if(profit>0){depositsData.push(value)}else{withdrawalsData.push(value)}}var chartData='{"title" : "","description" : "","type" : "point","historyBorder" : { "value" : "'+startTrade+'" },"xFractionalValue" : "0","yFractionalValue" : "2","axisXTitle" : "'+labelY+'","styleIndex" : "4","series" :[{"id" : "points","type" : "point","title" : "'+labelX+", "+currency+'","titleColor" : "#0073E6","tooltip" : "%VALUE% '+currency+'","pointConnected" : true,"value" : ['+pointsData.join(",")+'],"pointTrendLine" : "line","pointTrendLineThickness" : "1.5","pointTrendLineTitle" : "'+labelTrend+'","pointTrendLineTitleColor" : "#E60000","pointTrendLineColor" : "#ff0000","trendTooltip" : "'+labelTrend+'"}';if(depositsData.length>0){chartData+=',{"type" : "point","pointColor" : "#398E39","title" : "'+labelDeposits+'","value" : []}'}if(withdrawalsData.length>0){chartData+=',{"type" : "point","pointColor" : "#AF0000","title" : "'+labelWithdrawals+'","value" : []}'}chartData+=',{"type" : "marker","color" : "#005ea3","tooltip" : "'+labelDepositOf+'<BR>%POINT_TITLE%","value" : ['+depositsData.join(",")+']},{"type" : "marker","color" : "#af0000","tooltip" : "%POINT_TITLE%: <BR>'+labelWithdrawalOf+'","value" : ['+withdrawalsData.join(",")+"]}";if(extraSeriesData.length>0){for(var l=0;l<extraSeriesData.length;l++){var data=extraSeriesData[l];if(data){chartData+=',{"id" : "series'+l+'","visible" : false,"type" : "point","title" : "","tooltip" : "%VALUE% '+currency+'","pointConnected" : true,"pointConnectedThickness" : 5,"pointColor" : "#b30","value" : ['+data.join(",")+"]}";chartData+=',{"id" : "seriesBorder'+l+'","visible" : false,"type" : "point","title" : "","tooltip" : "%VALUE% '+currency+'","pointConnected" : false,"pointThickness" : 4,"pointColor" : "#b30","value" : ['+data[0]+","+data[data.length-1]+"]}"}}}chartData+="]}";Signals.balanceChart=MQL5ChartAPI.addChart("balance_chart",chartData,MQL5ChartType.POINT,Signals.GetChartRenderType)};Signals.ShowReturnChartLabeled=function(year,month,extraSeries,startTrade,labelX,labelY,labelTrend,labelDepositOf,labelWithdrawalOf,currency){if(year==null&&month==null){if(Signals.growthChart){return}else{year=month=0}}if(Signals.LastYear==year&&Signals.LastMonth==month){year=month=0}var cell=$("returnCell"+Signals.LastYear+Signals.LastMonth);if(cell){cell.className=cell.className.replace("selected","")}cell=$("returnCell"+year+month);if(cell){cell.className+=" selected"}Signals.LastYear=year;Signals.LastMonth=month;var dateLabel=year==0?"":(" ("+year+(month==0?"":("."+month))+")");var extraSeriesData=[];var pointsData=[];var slice=Signals.ReturnChartIndex[year+"."+month];if(!slice){return}var shift=slice.i==0?0:1;var trade=slice.i==0?0:Signals.ReturnChartData[slice.i*2];var firstTrade=trade;var firstGrowth=slice.i==0?100:Signals.ReturnChartData[slice.i*2+1]+100;pointsData.push('"0,'+trade+',0"');for(var i=slice.i;i<slice.i+slice.l+shift;i++){trade=Signals.ReturnChartData[i*2];var growth=0;if(i==slice.i+slice.l+shift-1){growth=slice.v*100}else{growth=Signals.ReturnChartData[i*2+1];if(firstGrowth==0){growth=0}else{if(firstGrowth!=100){growth=((growth+100)/firstGrowth)*100-100}}}var point=('"'+trade+","+trade+","+growth);for(var k=0;k<extraSeries.length;k++){var series=extraSeries[k];if(series[0]==-1||i>series[1]){continue}if(series[0]==i){var record='"'+trade+","+trade+","+growth+'"';if(!extraSeriesData[k]){extraSeriesData[k]=[record]}else{extraSeriesData[k].push(record)}extraSeries[k][0]++}}point+='"';pointsData.push(point)}var depositsData=[];var withdrawalsData=[];var tradesCount=Signals.BalanceChartStops.length;for(var m=0;m<tradesCount;m++){var stopTrade=Signals.ReturnChartStops[m];if(stopTrade<firstTrade||stopTrade>trade){continue}var profit=Signals.ChartsBalanceProfits[m];var timestamp=Signals.ChartsBalanceTimestamps[m];var value='"'+new Date(timestamp*1000).yyyyMMdd()+","+stopTrade+","+profit+'"';if(profit>0){depositsData.push(value)}else{withdrawalsData.push(value)}}var chartData='{"title" : "","description" : "","type" : "point","historyBorder" : { "value" : "'+startTrade+'" },"xFractionalValue" : "0","yFractionalValue" : "2","axisXTitle" : "'+labelY+dateLabel+'","styleIndex" : "4","series" :[{"id" : "points","type" : "point","title" : "'+labelX+', %","titleColor" : "#0073E6","tooltip" : "%VALUE%%","pointConnected" : true,"value" : ['+pointsData.join(",")+'],"pointTrendLine" : "line","pointTrendLineThickness" : "1.5","pointTrendLineTitle" : "'+labelTrend+'","pointTrendLineTitleColor" : "#E60000","pointTrendLineColor" : "#ff0000","trendTooltip" : "'+labelTrend+'"},{"type" : "marker","color" : "#005ea3","tooltip" : "'+labelDepositOf+'<BR>%POINT_TITLE%","value" : ['+depositsData.join(",")+']},{"type" : "marker","color" : "#af0000","tooltip" : "%POINT_TITLE%<BR>'+labelWithdrawalOf+'","value" : ['+withdrawalsData.join(",")+"]}";if(extraSeriesData.length>0){for(var l=0;l<extraSeriesData.length;l++){var data=extraSeriesData[l];if(data){chartData+=',{"id" : "series'+l+'","visible" : false,"type" : "point","title" : "","tooltip" : "%VALUE%%","pointConnected" : true,"pointConnectedThickness" : 5,"pointColor" : "#b30","value" : ['+data.join(",")+"]}";chartData+=',{"id" : "seriesBorder'+l+'","visible" : false,"type" : "point","title" : "","tooltip" : "%VALUE%%","pointConnected" : false,"pointThickness" : 4,"pointColor" : "#b30","value" : ['+data[0]+","+data[data.length-1]+"]}"}}}chartData+="]}";Signals.growthChart=MQL5ChartAPI.addChart("growth_chart",chartData,MQL5ChartType.POINT,Signals.GetChartRenderType)};Date.prototype.yyyyMMdd=function(){return[this.getFullYear(),(this.getMonth()>8?"":"0")+(this.getMonth()+1),(this.getDate()>9?"":"0")+this.getDate()].join(".")};Signals.HighlightGrowthRange=function(series){setTimeout(function(){if(Signals.growthChart&&Signals.growthChart.view&&Signals.growthChart.view.showSeries){Signals.growthChart.view.showSeries("series"+series);Signals.growthChart.view.showSeries("seriesBorder"+series);Signals.growthChart.view.hideTrendLine("points")}if(Signals.balanceChart&&Signals.balanceChart.view&&Signals.balanceChart.view.showSeries){Signals.balanceChart.view.showSeries("series"+series);Signals.balanceChart.view.showSeries("seriesBorder"+series);Signals.balanceChart.view.hideTrendLine("points")}},0)};Signals.HighlightGrowthRangeOff=function(series){setTimeout(function(){if(Signals.growthChart&&Signals.growthChart.view&&Signals.growthChart.view.hideSeries){Signals.growthChart.view.hideSeries("series"+series);Signals.growthChart.view.hideSeries("seriesBorder"+series);Signals.growthChart.view.showTrendLine("points")}if(Signals.balanceChart&&Signals.balanceChart.view&&Signals.balanceChart.view.hideSeries){Signals.balanceChart.view.hideSeries("series"+series);Signals.balanceChart.view.hideSeries("seriesBorder"+series);Signals.balanceChart.view.showTrendLine("points")}},0)};Signals.HighlightTrade=function(trade,deal){setTimeout(function(){if(Signals.growthChart&&Signals.growthChart.view&&Signals.growthChart.view.selectPoint){Signals.growthChart.view.selectPoint(trade);Signals.growthChart.view.hideTrendLine("points")}if(Signals.balanceChart&&Signals.balanceChart.view&&Signals.balanceChart.view.selectPoint){Signals.balanceChart.view.selectPoint(deal);Signals.balanceChart.view.hideTrendLine("points")}},0)};Signals.HighlightTradeOff=function(trade,deal){setTimeout(function(){if(Signals.growthChart&&Signals.growthChart.view&&Signals.growthChart.view.unSelectPoint){Signals.growthChart.view.unSelectPoint(trade);Signals.growthChart.view.showTrendLine("points")}if(Signals.balanceChart&&Signals.balanceChart.view&&Signals.balanceChart.view.unSelectPoint){Signals.balanceChart.view.unSelectPoint(deal);Signals.balanceChart.view.showTrendLine("points")}},0)};Signals.RenderEquityChartLabeled=function(labelX,labelBalance,labelEquity,labelDepositOf,labelWithdrawalOf,currency){if(Signals.equityChart){return}var balancePointsData=[];var equityPointsData=[];var deals=Signals.EquityChartData.length/3;for(var i=0;i<deals;i++){var timestamp=Signals.EquityChartData[i*3]*1000;var balance=Signals.EquityChartData[i*3+1];var equity=Signals.EquityChartData[i*3+2];balancePointsData.push('"'+i+","+timestamp+","+balance+'"');equityPointsData.push('"'+i+","+timestamp+","+equity+'"')}var equityDepositsData=[];var equityWithdrawalsData=[];var balances=Signals.EquityChartBalances.length/2;for(var i=0;i<balances;i++){var timestamp=Signals.EquityChartBalances[i*2]*1000;var profit=Signals.EquityChartBalances[i*2+1];var value='"'+i+","+timestamp+","+profit+'"';if(profit>0){equityDepositsData.push(value)}else{equityWithdrawalsData.push(value)}}var historyBorder=deals==0?0:Signals.EquityChartData[0]*1000;var chartData='{"title" : "","description" : "","type" : "point","historyBorder" : { "value" : "'+historyBorder+'" },"xFractionalValue" : "0","yFractionalValue" : "2","axisXTitle" : "'+labelX+'","styleIndex" : "4","xType":"date","series" :[{"type" : "point","title" : "'+labelBalance+", "+currency+'","titleColor" : "#0073E6","tooltip" : "'+labelBalance+": %VALUE% "+currency+'","pointConnected" : true,"value" : ['+balancePointsData.join(",")+']},{"type" : "point","title" : "'+labelEquity+'","titleColor" : "#509F50","tooltip" : "'+labelEquity+": %VALUE% "+currency+'","pointConnected" : true,"pointConnectedThickness" : 2,"value" : ['+equityPointsData.join(",")+']},{"type" : "marker","color" : "#005ea3","tooltip" : "'+labelDepositOf+'","value" : ['+equityDepositsData.join(",")+']},{"type" : "marker","color" : "#af0000","tooltip" : "'+labelWithdrawalOf+'","value" : ['+equityWithdrawalsData.join(",")+"]}]}";Signals.equityChart=MQL5ChartAPI.addChart("equity_chart",chartData,MQL5ChartType.POINT,Signals.GetChartRenderType)};Signals.GetChartRenderType=function(){if(MQL5ChartAPI.hasSVG()){return MQL5ChartRenderType.SVG}if(MQL5ChartAPI.hasFlash()){return MQL5ChartRenderType.FLASH}return MQL5ChartRenderType.SVG};Signals.BottomTabClick=function(tab,page,lang,mtAccountId){if(window.signalsTabLoading){return false}var url="/"+lang+"/signals/"+mtAccountId+"/"+tab;if(page&&page>1){url+="/page"+page}document.body.style.cursor="wait";Ajax.get(url,null,{onready:function(text){try{var placeholder=$("signal_tab_content");if(placeholder){placeholder.innerHTML=text;Signals.TablActivate(tab,page)}}catch(e){}window.signalsTabLoading=false;document.body.style.cursor="default"},onerror:function(){window.signalsTabLoading=false;document.body.style.cursor="default"}});return false};Signals.TablActivate=function(tab,page){window.hashParams.Set("tab",tab);if(page&&page>1){window.hashParams.Set("page",page)}else{window.hashParams.Remove("page")}if(window.signalTabs){for(var i=0;i<window.signalTabs.length;i++){var el=$("signal_tab_"+window.signalTabs[i]);if(el){if(window.signalTabs[i]==tab){el.className="tab_item selected"}else{el.className="tab_item"}}}}}};Signals.RenderAvatarsOld=function(){var h,e,m,j,b=0,f=0;var l=window.getElementsByClass("signalAvatar");if(l==undefined){return}for(var c in l){if(l[c]==undefined||l[c]==null||l[c].className==undefined){continue}h=[];b=2;l[c].parentNode.className="signalAvatarW obsolete";e=l[c].getElementsByTagName("INPUT");if(e==undefined||e.length!=1||e[0]==undefined){continue}j=(e[0].value).split(", ");var a=parseInt(j[0])+2;j.shift();for(var d in j){if(++f>19){break}m=parseInt(j[d]);if(isNaN(m)||isNaN(a)){continue}if(m>0){h.push("<div class='u' style='left: "+b+"px; height: "+m+"px; bottom: "+a+"px;'></div>")}else{m=m*-1;h.push("<div class='d' style='left: "+b+"px; height: "+m+"px; bottom: "+(a-m)+"px;'></div>")}b=b+3}l[c].innerHTML=h.join("");f=0}};Signals.RenderAvatars=function(){if(!document.createElement("canvas").getContext){Signals.RenderAvatarsOld();return}RenderCharts("signalAvatar",58,58)};Signals.ViewFilter=function(c,b){var a=document.getElementById(c);if(a){if(a.style.display=="none"){a.style.display="block";if(b){b.className+=" selected"}}else{a.style.display="none";if(b){b.className="filter"}}}};var SliderBar=function(l){if(typeof filters=="undefined"){return}var e=315,v=12;var n=0;var m=0;var i=false;var z,s,x,d,C,b,y,D,c,t,w,E,o,g;A();function B(M){if(!i){return}h();var J=window.event?window.event:M;var N=J.clientX-z.offsetLeft-n;if(N<-6){N=-6}else{if(N>e+6){N=e+6}}var H=parseInt(s.style.left,0);var F=H+parseInt(s.style.width,0);var K=(H+(F-H)/2);if(H>F){H=F}if(C<0){C=N<K?1:0}if(C==1){if((F-N)>v+1){s.style.left=N+"px";s.style.width=(F-N)+"px";x.style.left=(N-v/2)+"px"}var G=Math.round((N+6)*o/e)+t;if(E>1){G=u(G,E)}if(G<t){G=t}if(G>y.value){G=y.value}b.value=G}else{if((N-H)>v+1){s.style.width=(N-H)+"px";d.style.left=(N-v/2)+"px"}var I=Math.round((N-6)*o/e)+t;if(E>1){I=u(I,E)}if(I>w){I=w}if(I<b.value){I=b.value}y.value=I}}function q(F){i=false}function a(F){if(F&&F.stopPropagation){F.stopPropagation()}else{if(window.event&&window.event.cancelBubble){window.event.cancelBubble=true}}}function j(F,H,G){if(F.attachEvent){F.attachEvent("on"+H,G)}else{if(F.addEventListener){F.addEventListener(H,G,false)}}}function h(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection&&document.selection.clear){document.selection.clear()}}}function u(G,F){return Math.round(G/F)*F}function f(H,G){z=document.getElementById(G+"Bar");s=document.getElementById(G+"BarRange");x=document.getElementById(G+"HandleLeft");d=document.getElementById(G+"HandleRight");D=document.getElementById(G+"Label");c=document.getElementById(G+"Input");C=-1;b=document.getElementById(G+"From");y=document.getElementById(G+"To");t=filters[G][2];w=filters[G][3];E=filters[G][4];o=w-t;if(g){var F=p(g);if(F){if(F[0]>0){n=F[0]}if(F[1]>0){m=F[1]}}}i=true;B(H)}function p(G){var H=G;var F=0,I=0;do{F+=H.offsetLeft;I+=H.offsetTop;if(H.scrollTop&&G!=H){I-=H.scrollTop}}while(H=H.offsetParent);return[F,I]}function r(M,R){var K=filters[M][2],Q=filters[M][3],P=filters[M][4];var I=$(M+"BarRange");var O=$(M+"HandleLeft");var S=$(M+"HandleRight");var H=+$(M+"From").value,F=+$(M+"To").value;if(H<K){H=K}if(H>Q){H=Q}if(F<K){F=K}if(F>Q){F=Q}if(H>F){F=H}if(R){$(M+"From").value=H;$(M+"To").value=F}var N=Q-K;var T=Math.round(e*(H-K)/N);var J=Math.round(e*(F-K)/N);if(T==J){J+=1}var G=Math.round(e*(F-H)/N);I.style.left=T-6+"px";I.style.width=G+12+"px";O.style.left=T-v+"px";S.style.left=J+"px"}function A(){j(window.document,"mousemove",function(S){B(S)});j(window.document,"mouseup",function(){q()});g=document.getElementById(l);for(var J in filters){var H=filters[J][0],F=filters[J][1];var G=$(J),P=$(J+"Label");var K=document.createElement("INPUT");K.id=J+"From";K.name=J+"From";K.type="text";K.value=H;(function(S){K.onkeypress=function(){window.setTimeout(function(){r(S,false)},0)};K.onchange=function(){r(S,true)}})(J);P.appendChild(K);var O=document.createElement("TEXT");O.innerHTML="-";P.appendChild(O);var R=document.createElement("INPUT");R.id=J+"To";R.name=J+"To";R.type="text";R.value=F;(function(S){R.onkeypress=function(){window.setTimeout(function(){r(S,false)},0)};R.onchange=function(){r(S,true)}})(J);P.appendChild(R);var N=document.createElement("DIV");N.className="bar";N.id=J+"Bar";(function(S){N.onmousedown=function(T){f(T,S)}})(J);G.appendChild(N);var I=document.createElement("DIV");I.className="barRange";I.id=J+"BarRange";N.appendChild(I);var M=document.createElement("DIV");M.className="handle left";M.id=J+"HandleLeft";N.appendChild(M);var Q=document.createElement("DIV");Q.className="handle right";Q.id=J+"HandleRight";N.appendChild(Q);r(J,false)}}this.SerializeFilter=function(){var J=0;var F=2;var K=3;var H={};for(var O in filters){var N=filters[O];var I=$(O+"From");var M=$(O+"To");var G=false;if(!I||!M){continue}var P=parseInt(I.value);if(P>N[F]){G=true;H[O+"From"]=P}P=parseInt(M.value);if(P<N[K]){G=true;H[O+"To"]=P}if(G){J++}}return{fields:J,json:(J==0?null:JSON.stringify(H))}};this.ResetFilter=function(){var G=2;var M=3;var O="-12px";var S="315px";var J="-6px";var Q="327px";for(var R in filters){var P=filters[R];var F=$(R+"HandleLeft");if(F){F.style.left=O}var K=$(R+"HandleRight");if(K){K.style.left=S}var I=$(R+"BarRange");if(I){I.style.left=J;I.style.width=Q}var H=$(R+"From");if(H){H.value=P[G]}var N=$(R+"To");if(N){N.value=P[M]}}};return this};function Gallery(a,z,E,s,q){if(!z){z="_switcher"}var h=[0];this.Slider=document.getElementById(a);var t=this.Slider;if(!t){return}var n=t.parentNode;if(!n){return}if(q&&(document.body.clientWidth||document.body.offsetWidth)<700){var b=n.parentNode;var y=b.parentNode;var A=((y.clientWidth||y.offsetWidth)-40)|0;var e=(A*2/3)|0;n.style.height=(e)+"px";n.style.width=(A)+"px";b.style.width=(A+20)+"px";var l=t.getElementsByTagName("img");if(l){for(var o=0;o<l.length;o++){l[o].width=A;l[o].height=e}}}this.Current=0;var x=0;var D=null;var c=null;if(!this.Slider){return null}var c=this.Slider.children||this.Slider.childNodes;var d=0;var f=function(G){var F=0;for(var H=0;H<=G;H++){F+=h[H]}return F};for(var w=0;w<c.length;w++){if(c[w].nodeName.indexOf("#")==0){c.splice(w,1);w--;continue}x++;var u=h.length-1;h[h.length]=c[w].offsetWidth;var C=document.getElementById(c[w].id+z);if(!C){continue}C.shiftIndex=u;if(u==0){D=C}var B=function(){D=g(D.shiftIndex,this.shiftIndex)};if(!E){E="onclick"}C[E]=B}if(s){var j=createElement(n,"div",{className:"carousel-arrow"});var m=createElement(n,"div",{className:"carousel-arrow"});Class(j,"left");Class(m,"right");var v=function(i){if(i.isHiddenArrow==true){return}fade(i,"in",200,20);i.style.cursor="default";i.isHiddenArrow=true};var r=0;var p=function(i){if(i.isHiddenArrow==false){return}fade(i,"out",200,20);i.style.cursor="pointer";i.isHiddenArrow=false};v(j);v(m);j.onclick=function(){D=g(D.shiftIndex,D.shiftIndex-1);if(D.shiftIndex<=0){v(j)}if(D.shiftIndex<x-1){p(m)}};m.onclick=function(){D=g(D.shiftIndex,D.shiftIndex+1);if(D.shiftIndex>=x-1){v(m)}if(D.shiftIndex>0){p(j)}};n.onmouseover=function(){if(!D){return}clearTimeout(r);r=setTimeout(function(){if(D.shiftIndex>0){p(j)}if(D.shiftIndex<x-1){p(m)}},100)};n.onmouseout=function(){if(!D){return}clearTimeout(r);r=setTimeout(function(){if(D.shiftIndex>0){v(j)}if(D.shiftIndex<x-1){v(m)}},100)}}var g=function(M,K){var H=K;var I=M;var G=document.getElementById(c[M].id+z);if(H==I){return G}if(M<0||K<0||M>(x-1)||K>(x-1)){return G}var i=document.getElementById(c[K].id+z);if(!t.style.left||t.style.left==""){t.style.left="0px"}var J=-(f(I));var F=-(f(H));animate(t,"left","px",J,F,d,300,60,0.7,0);d+=500;setTimeout(function(){d-=500},500+0);G.className="";i.className="current";I=H;G=i;return G}}var Mql5Cookie=function(){};Mql5Cookie.defaultValue="";Mql5Cookie.domain="";Mql5Cookie.onSyncCallback=undefined;Mql5Cookie.init=function(e,b,h,a){Mql5Cookie.defaultValue=b;Mql5Cookie.domain=e;Mql5Cookie.onSyncCallback=h;var g=window.location.hostname.lastIndexOf(".");if(g<0){return}var d="https://www.mql5"+window.location.hostname.substring(g);if(a==0){if(hasFlash()){if(window.navigator.userAgent.indexOf("MSIE")!=-1){var c=document.createElement("DIV");c.className="fl_trc";c.innerHTML="<object id='flash_permanent' classid='clsid:d27cdb6e-ae6d-11cf-96b8-444553540000' codebase='https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0' width='1' height='1'><param name='allowScriptAccess' value='always' /><param name='flashvars' value='callback=Mql5Cookie.onFlashLoad' /><param name='movie' value='"+d+"/swf/permanent.swf?v=1'></object>";document.body.appendChild(c)}else{var f=document.createElement("DIV");f.className="fl_trc";f.innerHTML="<EMBED type='application/x-shockwave-flash' src='"+d+"/swf/permanent.swf?v=1' id='flash_permanent' name='flash_permanent' allowscriptaccess='always' allowfullscreen='false' flashvars='callback=Mql5Cookie.onFlashLoad' bgcolor='#fff' width='1' height='1'></EMBED>";document.body.appendChild(f)}}else{Mql5Cookie.checkStorages()}}else{Mql5Cookie.checkStorages()}};Mql5Cookie.onFlashLoad=function(){setTimeout(Mql5Cookie.checkStorages,0)};Mql5Cookie.checkStorages=function(){var f="uniq";var a=undefined;var b=Mql5Cookie.flashStorage(f);if((b!="undefined")){a=b}var c=Mql5Cookie.localStorage(f);if(!a&&(c!="undefined")){a=c}var e=Mql5Cookie.sessionStorage(f);if(!a&&(e!="undefined")){a=e}var d=Mql5Cookie.httpStorage(f);if(!a&&(d!="undefined")){a=d}if(!a){a=Mql5Cookie.defaultValue}Mql5Cookie.flashStorage(f,a);Mql5Cookie.localStorage(f,a);Mql5Cookie.sessionStorage(f,a);Mql5Cookie.httpStorage(f,a,{expires:new Date(2050,1,1),Domain:"."+Mql5Cookie.domain,Path:"/"});if(Mql5Cookie.onSyncCallback){Mql5Cookie.onSyncCallback()}};Mql5Cookie.httpStorage=function(a,j,i){if(typeof(j)!="undefined"){i=i||{};var e=i.expires;if(typeof e=="number"&&e){var h=new Date();h.setTime(h.getTime()+e*1000);e=i.expires=h}if(e&&e.toUTCString){i.expires=e.toUTCString()}j=encodeURIComponent(j);var b=a+"="+j;for(var g in i){b+="; "+g;var c=i[g];if(c!==true){b+="="+c}}document.cookie=b}else{var f=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return f?decodeURIComponent(f[1]):undefined}};Mql5Cookie.flashStorage=function(c,d){var b=document.getElementById("flash_permanent")||document.embeds.flash_permanent;if(!b){return}try{if(typeof(d)!="undefined"){b.setItem(c,d)}else{var a=b.getItem(c);return a}}catch(f){}};Mql5Cookie.localStorage=function(a,b){try{if(window.localStorage){if(typeof(b)!="undefined"){localStorage.setItem(a,b)}else{return localStorage.getItem(a)}}}catch(c){}};Mql5Cookie.sessionStorage=function(a,b){try{if(window.sessionStorage){if(typeof(b)!="undefined"){sessionStorage.setItem(a,b)}else{return sessionStorage.getItem(a)}}}catch(c){}};function ImageAttach(){}ImageAttach.Init=function(c,a,b,e,d){if(!a){a=80}if(!c){c=60}ImageAttach.previewHeight=a;ImageAttach.previewWidth=c;ImageAttach.deleteLabel=b;ImageAttach.defaultError=e;ImageAttach.maxCount=d;Class($("customFileInputContainer"),"customFileInputContainer",false);$("customFileInputLink").style.display="";if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){$("customFileInputLink").onclick=function(){Class($("customFileInputContainer"),"customFileInputContainer",true);$("customFileInputLink").style.display="none";return false}}else{$("customFileInputLink").onclick=function(){$("attachedFile_imagesLoader").click();return false}}if(!ImageAttach.CheckImagesCount()){$("imageUploaderContainer").style.display="none"}else{$("imageUploaderContainer").style.display="block"}};ImageAttach.previewCounter=0;ImageAttach.CheckImagesCount=function(){return ImageAttach.previewCounter<ImageAttach.maxCount};ImageAttach.SelectFile=function(){$("attachedFile_imagesLoader").click()};ImageAttach.createPreview=function(c){if(!ImageAttach.previewCounter){ImageAttach.previewCounter=0}var a=$("newImageAttaches");var e=document.createElement("SPAN");e.id="iat_"+ImageAttach.previewCounter;Class(e,"attachItem");Class(e,"imagePreview");var f=createElement(e,"A",{title:ImageAttach.getClearFilename(c),target:"_blank",href:c,className:"imageHolder"});var d=createElement(f,"IMG",{src:c});d.style.maxHeight=ImageAttach.previewHeight+"px";d.style.maxWidth=ImageAttach.previewWidth+"px";createElement(e,"BR");var b=createElement(e,"DIV",{className:"previewLabel"});createElement(b,"INPUT",{type:"hidden",name:("attachedImage_"+ImageAttach.previewCounter),value:c});createElement(b,"A",{href:"#",onclick:function(){return ImageAttach.deletePreview(e)},className:"deleteAttachLink",innerHTML:ImageAttach.deleteLabel});prependElement(a,e);ImageAttach.previewCounter++;a.style.display="";return e};ImageAttach.deletePreview=function(a){a.parentNode.removeChild(a);ImageAttach.onDeletePreview();return false};ImageAttach.onDeletePreview=function(){ImageAttach.previewCounter--;if(!ImageAttach.CheckImagesCount()){$("imageUploaderContainer").style.display="none"}else{$("imageUploaderContainer").style.display="block"}if(ImageAttach.previewCounter<=0){$("newImageAttaches").style.display="none"}};ImageAttach.OnChangeFile=function(text,xml){var e=text||(xml&&xml.body?xml.body.innerHTML:null);ImageAttach.ClearError();var raw=stripHtml(e);if(!raw){return}var result=eval("("+raw+")");if(result.Url.length>0){ImageAttach.createPreview(result.Url)}else{if(result.ErrorMessage.length>0){ImageAttach.ShowError(result.ErrorMessage)}else{ImageAttach.ShowError()}}if(!ImageAttach.CheckImagesCount()){$("imageUploaderContainer").style.display="none"}else{$("imageUploaderContainer").style.display="block"}};ImageAttach.OnChangeFileError=function(a){ImageAttach.ShowError()};ImageAttach.ShowError=function(a){$("imageValidationError").innerHTML=a||ImageAttach.defaultError};ImageAttach.ClearError=function(){$("imageValidationError").innerHTML=""};ImageAttach.getClearFilename=function(c){var b=c.split("/");var d=b[b.length-1];var a=d.indexOf("_");return d.substring(a+1)};ImageAttach.Clear=function(){while(ImageAttach.previewCounter>0){ImageAttach.deletePreview($("iat_"+(ImageAttach.previewCounter-1)))}};function Affiliation(m,h,o,g,i,b,c){var n=m;var l=h;var e=o;var f=g;var j=i;var a=b;var d=c;this.getLink=function(){Ajax.get(n+"/"+l+"/generatelink/"+e+"/"+f+"/"+j,null,{onready:this.onSuccess,onerror:this.onError})};this.onSuccess=function(p){a.href=p;a.innerHTML=p;d.style.display="none";if($("affiliationLinkBlock")!=undefined&&$("affiliationTextBlock")!=undefined){$("affiliationLinkBlock").style.display="inline";$("affiliationTextBlock").style.display="none"}};this.onError=function(){}}function customSelect(e){var b=document.getElementById(e);if(!b){return}var f=document.createElement("span");f.style.width=b.style.width;f.className="selectWrapper";var d=document.createElement("button");d.innerHTML="&#9660;";b.parentNode.insertBefore(f,b);Class(b,"customSelect");f.appendChild(b);f.appendChild(d);d.onclick=function(){c(e);return false};b.onmousedown=function(){return false};function c(j){var g=document.getElementById(j);var i=g.cloneNode(true);i.id=j+"_clone";i.selectedIndex=g.selectedIndex;g.parentNode.insertBefore(i,g);g.size=Math.min(g.options.length,20);Class(g,"opened");var h=getOffsetSum(g);g.style.top=h.top+"px";g.style.left=h.left+"px";document.body.appendChild(g);g.focus();g.onblur=a;g.onclick=a}function a(){var h=document.getElementById(this.id+"_clone");if(!h){return}var g=this.id;h.selectedIndex=this.selectedIndex;this.parentNode.removeChild(this);h.id=g;return false}}function Likes(){this.SuccessMessageText=undefined;this.SuccessMessageTitle=undefined;this.ErrorMessageText=undefined;this.ErrorMessageTitle=undefined;this.IsMobile=false;function onsuccess(data){if(!data||data.length==0){return onerror()}var resObj;try{resObj=window.JSON?window.JSON.parse(data):eval("("+data+")")}catch(ex){return onerror()}var link=$(this.linkId);Class(link,"loading",true);var counts=$("likes_"+resObj.moduleId+"_"+resObj.parentType+"_"+resObj.parentId);link.innerHTML=resObj.linkText;link.onclick=function(){resObj.liked?unlike(resObj.lang,resObj.moduleId,resObj.parentType,resObj.parentId):like(resObj.lang,resObj.moduleId,resObj.parentType,resObj.parentId)};counts.innerHTML=(resObj.count>0)?(resObj.count):"";Class(counts,"likesCount",false);if(likes.IsMobile&&resObj.liked&&likes.SuccessMessageTitle&&likes.SuccessMessageText){var dialogWidth=likes.IsMobile?300:300;var div=createElement(null,"DIV",{innerHTML:likes.SuccessMessageText,className:"likeSuccessText"});Dialog.show(likes.SuccessMessageTitle,div,dialogWidth,80,function(){Dialog.hide()})}return true}function onerror(){var link=$(this.linkId);Class(link,"loading",true);if(likes.ErrorMessageTitle&&likes.ErrorMessageText){var dialogWidth=likes.IsMobile?300:300;var div=createElement(null,"DIV",{innerHTML:likes.ErrorMessageText,className:"likeErrorText"});Dialog.show(likes.ErrorMessageTitle,div,dialogWidth,120,function(){Dialog.hide()})}}function like(lang,moduleId,typeId,entityId){var linkId="like_"+moduleId+"_"+typeId+"_"+entityId;var link=$(linkId);link.onclick=function(){};Class(link,"loading");Ajax.post("/"+lang+"/like/"+moduleId+"/"+typeId+"/"+entityId,null,false,{onready:onsuccess,onerror:onerror,linkId:linkId})}this.Like=function(lang,moduleId,typeId,entityId){return like(lang,moduleId,typeId,entityId)};function unlike(lang,moduleId,typeId,entityId){var linkId="like_"+moduleId+"_"+typeId+"_"+entityId;var link=$(linkId);link.onclick=function(){};Class(link,"loading");Ajax.post("/"+lang+"/unlike/"+moduleId+"/"+typeId+"/"+entityId,null,false,{onready:onsuccess,onerror:onerror,linkId:linkId})}this.Unlike=function(lang,moduleId,typeId,entityId){unlike(lang,moduleId,typeId,entityId)};function tooltipSuccess(data){var cnt=$(this.cid);if(!cnt){return}if(!data||data.length==0){cnt.parentNode.removeChild(cnt);return}cnt.innerHTML=data}this.Tooltip=function(element,m,t,id,lang){var cid=tooltip(element,'<div class="likesTooltipLoader"></div>');Ajax.get("/"+lang+"/like_users/tooltip/"+m+"/"+t+"/"+id,null,{onready:tooltipSuccess,onerror:onerror,cid:cid})};function listSuccess(data){if(!this.cnt||!this.cnt.parentNode){return}if(!data||data.length==0){this.cnt.parentNode.removeChild(this.cnt);return}this.cnt.innerHTML=data}this.UsersLikes=function(m,t,id,lang,title){var cnt=createElement(null,"DIV",{className:"likeUsersContainer"});var loader=createElement(cnt,"DIV",{className:"likesListLoader"});Dialog.show(title,cnt,250,300,this.CloseUsers);Ajax.get("/"+lang+"/like_users/full/"+m+"/"+t+"/"+id,null,{onready:listSuccess,onerror:onerror,cnt:cnt})};this.CloseUsers=function(){var containers=getElementsByClass("likeUsersContainer",document);if(containers){for(var i=0;i<containers.length;i++){if(containers[i]&&containers[i].parentNode){containers[i].parentNode.removeChild(containers[i])}}}Dialog.hide()}}var likes=new Likes();var Charts={};Charts.list=[];Charts.chartsByColumn=[];Charts.columnsHeight=[];Charts.chartsHeight=[];Charts.chartsInLine=1;Charts.chartWidth=200;Charts.leftPanelWidth=168;Charts.chartMargin=10;Charts.isMobile=false;Charts.SetMosaic=function(c,a){this.isMobile=a;if(this.isMobile){this.leftPanelWidth=0}var b=Math.floor((document.body.clientWidth-this.leftPanelWidth)/(this.chartWidth+this.chartMargin),10);if(b!=this.chartsInLine){this.chartsInLine=b;this.SetMosaicPositions(b,c)}};Charts.SetMosaicPositions=function(e,g){var f=0,a=0;var h=$("chartsBlock");if(h==undefined){return}this.list=h.getElementsByTagName("DIV");if(this.list==undefined||this.list==null){return}h.className="mosaic";for(var d=0;d<=e;d++){this.columnsHeight[d]=0;this.chartsByColumn[d]=[]}for(var d=0;d<this.list.length;d++){if(this.list[d].className!="chartsListItem"){continue}var c=parseInt(this.list[d].style.height,10);if(this.chartsHeight[d]==undefined){var c=parseInt(this.list[d].style.height,10);this.chartsHeight[d]=c}else{var c=this.chartsHeight[d]}a=this.GetShortestColumn();this.list[d].style.top=this.columnsHeight[a]+"px";this.list[d].style.left=(this.chartWidth+this.chartMargin)*a+"px";this.columnsHeight[a]+=(c+this.chartMargin);this.chartsByColumn[a].push(d)}if(g>1||this.list.length>this.chartsInLine){this.FixedColumnsHeight()}var b=this.GetLongestColumn();h.style.height=this.columnsHeight[b]+"px";h=null};Charts.FixedColumnsHeight=function(){var a=this.GetShortestColumn();for(var d=0;d<this.chartsInLine;d++){var f=(this.columnsHeight[d]-this.columnsHeight[a])/this.chartsByColumn[d].length;var c=0;for(ii=0;ii<this.chartsByColumn[d].length;ii++){var g=this.chartsByColumn[d][ii];var b=this.chartsHeight[g];var e=parseInt(this.list[g].style.top,10);this.list[g].style.height=(b-f)+"px";this.list[g].style.top=(e-c)+"px";this.columnsHeight[d]=this.columnsHeight[d]-f;c+=f}}};Charts.GetShortestColumn=function(){var a=0;for(var b=1;b<this.chartsInLine;b++){if(this.columnsHeight[b]<this.columnsHeight[a]){a=b}}return a};Charts.GetLongestColumn=function(){var b=0;for(var a=1;a<this.chartsInLine;a++){if(this.columnsHeight[a]>this.columnsHeight[b]){b=a}}return b};function PocketManager(){this.lastElement=null;this.Add=function(a,c,b,e,d){a.className="pocket added";if(this.lastElement!=null&&this.lastElement!=a){this.lastElement.className="pocket"}this.lastElement=a;Ajax.get("/"+c+"/pocket/add/"+b+"/"+e+"/"+d,null,{onready:function(){},onerror:function(){}});return false}}var Pocket=new PocketManager();function Translate(){var currentContentId,currentSourceLang,currentTargetLang,currentModuleId,currentTypeId,currentEntityId,lastContentId=null,lastContent=null,translates={},langsCodes={ar:["AR","Arabic"],zh:["CN","Chinese"],en:["EN","English"],fr:["FR","French"],de:["DE","German"],id:["ID","Indonesian"],it:["IT","Italian"],ja:["JP","Japanese"],ko:["KO","Korean"],fa:["FA","Persian"],pt:["PT","Portuguese"],ru:["RU","Russian"],es:["ES","Spanish"],tr:["TR","Turkish"],vi:["VI","Vietnamese"]};function getLink(targetLang,isSelected){var ancer=document.createElement("A");ancer.innerHTML="<i>"+langsCodes[targetLang][0]+"</i> "+langsCodes[targetLang][1];ancer.href="#"+targetLang;if(isSelected){ancer.className="selected"}ancer.onclick=function(){window.translateManager.Translate(currentContentId,currentSourceLang,targetLang,currentModuleId,currentTypeId,currentEntityId);translates[currentContentId]["currentTargetLang"]=targetLang;var link=this.parentNode.parentNode.parentNode.firstChild;link.className="pressed";link.innerHTML=langsCodes[targetLang][0];var t=this.parentNode.parentNode.parentNode;translateManager.HideMenu(t,currentContentId);return false};return ancer}function untranslate(){var currentContentObj=document.getElementById(currentContentId);if(currentContentObj){currentContentObj.style.direction="ltr";currentContentObj.innerHTML=translates[currentContentId]["originalTranslation"];if($("forumTitle")){$("forumTitle").innerHTML=translates[currentContentId]["originalTitle"]}translates[currentContentId]["isTranslated"]=false}return false}function setContent(targetId,targetLang,contentId,translatedContentArray){var targetObj=document.getElementById(targetId);if(!targetObj){return false}targetObj.style.direction=(targetLang=="ar"||targetLang=="fa")?"rtl":"ltr";var title=null;if(targetId=="pollAnswers"){title=translatedContentArray[0];var labels=targetObj.getElementsByTagName("label");for(var i=0;i<labels.length;i++){labels[i].innerHTML=translatedContentArray[(i+1)]}}else{if(targetId.indexOf("contenttopic")>=0){title=translatedContentArray[0];targetObj.innerHTML=translatedContentArray[1]}else{targetObj.innerHTML=translatedContentArray[0]}}if(title!=null&&$("forumTitle")){$("forumTitle").innerHTML=title}return false}this.Translate=function(targetId,sourceLang,targetLang,moduleId,typeId,entityId){if(translates[currentContentId]["translations"][targetLang]){setContent(targetId,targetLang,currentContentId,translates[currentContentId]["translations"][targetLang])}else{Ajax.get("/"+sourceLang+"/translate/"+targetLang+"/"+moduleId+"/"+typeId+"/"+entityId,null,{onready:function(translatedContent){var translatedContentArray=eval("("+translatedContent+")");translates[currentContentId]["translations"][targetLang]=translatedContentArray;setContent(targetId,targetLang,currentContentId,translatedContentArray)},onerror:function(){}})}translates[currentContentId]["isTranslated"]=true;return false};this.SetMenu=function(t,contentId,sourceLang,targetLang,moduleId,typeId,entityId){currentContentId=contentId;currentSourceLang=sourceLang;currentTargetLang=targetLang;currentModuleId=moduleId;currentTypeId=typeId;currentEntityId=entityId;t.className="translateLink pressed";if(!translates[contentId]){translates[contentId]={currentTargetLang:currentTargetLang,showMenu:false,isTranslated:false,originalTranslation:$(contentId)?$(contentId).innerHTML:null,originalTitle:$("forumTitle")?$("forumTitle").innerHTML:null,translations:{}};t.onmouseout=function(){if(!translates[currentContentId]["showMenu"]){t.className="translateLink"}};t.firstChild.onclick=function(){if(translates[currentContentId]["isTranslated"]){t.firstChild.className="";return untranslate()}else{t.firstChild.className="pressed";return window.translateManager.Translate(currentContentId,currentSourceLang,currentTargetLang,currentModuleId,currentTypeId,currentEntityId)}};t.firstChild.onmousedown=function(event){if(!event){event=window.event}if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}};if(document.getElementById(currentContentId)){var tempContentId=currentContentId;$(currentContentId).parentNode.onmousedown=function(){window.translateManager.HideMenu(t,tempContentId)}}var menuButton=document.createElement("SPAN");menuButton.className="translateMenuButton";menuButton.onmousedown=function(event){if(!event){event=window.event}if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}showMenu(this)};var menuButtonIcon=document.createElement("SPAN");menuButton.appendChild(menuButtonIcon);t.appendChild(menuButton)}else{currentTargetLang=translates[contentId]["currentTargetLang"]}};function showMenu(t){if(lastContentId!=null&&lastContentId!=currentContentId&&translates[lastContentId]["showMenu"]){var lastx=lastContent.parentNode.childNodes[2];lastContent.parentNode.removeChild(lastx);translates[lastContentId]["showMenu"]=false;lastContent.parentNode.className="translateLink";lastContentId=null;lastContent=null}if(translates[currentContentId]["showMenu"]){var x=t.parentNode.childNodes[2];t.parentNode.removeChild(x);translates[currentContentId]["showMenu"]=false;return false}var menu=document.createElement("DIV");menu.className="translateMenu";menu.onmousedown=function(event){if(!event){event=window.event}if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}};var div=document.createElement("DIV");var counter=0;var isTranslated=translates[currentContentId]["isTranslated"];for(var lang in langsCodes){div.appendChild(getLink(lang,isTranslated&&lang==currentTargetLang));if(++counter==3){counter=0;menu.appendChild(div);div=document.createElement("DIV")}}if(counter>0){menu.appendChild(div)}t.parentNode.appendChild(menu);translates[currentContentId]["showMenu"]=true;lastContentId=currentContentId;lastContent=t;return false}this.HideMenu=function(t,contentId){if(lastContentId!=null&&lastContentId!=contentId){return false}t.className="translateLink";var x=t.childNodes[2];if(x){t.removeChild(x)}translates[contentId]["showMenu"]=false;return false}}var translateManager=new Translate();function MakeTextboxAutogrow(c,d,b){if(!c){return}b=b||(("oninput" in c)?"oninput":"onkeyup");var a=c[b];c[b]=e;function e(){if(d){c.style.height=d+"px"}if(c.clientHeight<c.scrollHeight){c.style.minHeight=c.scrollHeight+"px"}if(a){a()}}e()}function AddElementHotkeyEvent(b,d,c){if(!b){return}if(typeof d!="function"){return}var a=b.onkeyup;b.onkeyup=function(g){var f=true;if(a){f=a(g)}if(f==false){return f}if(d(g)){c()}}}function SiteUpdates(url,tickLength,lang,modules,ts,lastSiteUpdateTime){var url=url;var tick=tickLength;var last=ts;var modules=modules;var updateCallbacks={};var additionalData={};var currentTimeout;var lastUpdate=lastSiteUpdateTime||0;this.SetLastUpdate=function(lastUpdateTime){if(!lastUpdate||lastUpdate<lastSiteUpdateTime){lastUpdate=lastUpdateTime}};this.RegisterRenderCallback=function(moduleId,typeId,callback,additional){var callbacks=updateCallbacks["cl_"+moduleId]||{};callbacks["t"+typeId]=callback;updateCallbacks["cl_"+moduleId]=callbacks;if(additionalData){for(var i in additional){if(additional.hasOwnProperty(i)){additionalData[i]=additional[i]}}}};this.UnregisterRenderCallback=function(moduleId,typeId,additional){if(additionalData){for(var i in additional){if(additional.hasOwnProperty(i)&&additionalData.hasOwnProperty(i)&&additionalData[i]==additional[i]){additionalData[i]=undefined}}}};this.RegisterOnBegin=function(moduleId,callback){updateCallbacks["begc_"+moduleId]=callback};this.RegisterOnEnd=function(moduleId,callback){updateCallbacks["endc_"+moduleId]=callback};this.GetUpdates=function(){if(currentTimeout){clearTimeout(currentTimeout)}getUpdates()};if(modules&&modules.length&&modules.length>0){for(var i=0;i<modules.length;i++){url+=((i==0&&url.indexOf("?")==-1)?"?":"&")+"m="+modules[i]}}function renderUpdates(parsedData){if(!parsedData.updates||parsedData.updates.length==0){return}for(var i=0;i<parsedData.updates.length;i++){var update=parsedData.updates[i];if(update.module_id&&updateCallbacks["cl_"+update.module_id]){var callbacks=updateCallbacks["cl_"+update.module_id];if(callbacks){for(var t in callbacks){if(callbacks.hasOwnProperty(t)){callbacks[t](update,parsedData.ts)}}}}var elementId="notify_"+update.name;var element=$(elementId);renderUpdateNotifyItem(update,element)}}function renderUpdateNotifyItem(update,existingElement){if(!update||!update.title||!update.url){if(existingElement&&update.module_id!=13){existingElement.parentNode.removeChild(existingElement)}return}var container=$("privateAreaMessages");if(!container){return}var a=createElement(null,"a",{className:"linkNotify",href:update.url,id:"notify_"+update.name,title:update.title});if(urlsAreEqual(update.url,location.href)){a.onclick=function(){location.reload()}}var s=createElement(a,"span",{className:update.name});if(update.count){Class(s,"active");createElement(s,"i",{className:"count",innerHTML:update.count})}if(existingElement&&existingElement.parentNode){var parent=existingElement.parentNode;parent.insertBefore(a,existingElement);if(existingElement.onclick){a.onclick=existingElement.onclick}if(existingElement.className&&existingElement.className.length){var classes=existingElement.className.split(" ");var classesToCheck=" "+a.className+" ";var classesToAdd=[];for(var i=0;i<classes.length;i++){if(classesToCheck.indexOf(" "+classes[i]+" ")<0){classesToAdd[classesToAdd.length]=classes[i]}}if(classesToAdd.length){a.className+=(a.className?" ":"")+classesToAdd.join(" ")}}parent.removeChild(existingElement)}else{var li=createElement(container,"li");li.appendChild(a)}}function urlsAreEqual(url1,url2){var url1Hash=url1.indexOf("#");if(url1Hash>=0){url1=url1.substr(0,url1Hash)}var url2Hash=url2.indexOf("#");if(url2Hash>=0){url2=url2.substr(0,url1Hash)}return url1.toUpperCase()===url2.toUpperCase()}var errorsCounter=0;function onError(){if(errorsCounter<5){setTimeout(function(){getUpdates()},getNextPeriod())}else{if(window.console&&window.console.log){window.console.log("get updates stopped due to errors.")}}errorsCounter++;for(var ekey in updateCallbacks){if(ekey.startsWith("endc_")){updateCallbacks[ekey]("error")}}}function onGetUpdatesSuccess(data){for(var ekey in updateCallbacks){if(ekey.startsWith("endc_")){updateCallbacks[ekey]("success")}}if(!data||data.length==0){return}var resObj=undefined;try{resObj=window.JSON?window.JSON.parse(data):eval("("+data+")")}catch(ex){return onError()}if(!resObj||resObj==undefined||!resObj.l||!resObj.ts||!resObj.updates){return}if(resObj.ld&&(!lastUpdate||lastUpdate<resObj.ld)){lastUpdate=resObj.ld}renderUpdates(resObj);last=resObj.ts;currentTimeout=setTimeout(function(){getUpdates()},getNextPeriod());errorsCounter=0}function getNextPeriod(){var now=new Date().getTime()/1000;var per1=15;var per2=per1+30;var per3=per2+120;var timings=window.isWindowActive?[3000,5000,10000,60000]:[10000,15000,30000,200000];var result;if((now-lastUpdate)<per1){result=timings[0]}else{if((now-lastUpdate)<(per2)){result=timings[1]}else{if((now-lastUpdate)<(per3)){result=timings[2]}else{result=timings[3]}}}if(window.console&&window.console.log){window.console.log("last        = "+new Date(lastUpdate*1000));window.console.log("now         = "+new Date(now*1000));window.console.log("next period = "+result)}return result}function getUpdates(){if(window.isWindowActive!=true&&!window.isLastActiveWindow()){currentTimeout=setTimeout(function(){getUpdates()},getNextPeriod());return}var resultUrl=url+(url.indexOf("?")<0?"?":"&")+"dt="+last;if(additionalData){for(var i in additionalData){if(additionalData.hasOwnProperty(i)&&additionalData[i]!=undefined){resultUrl+="&"+i+"="+additionalData[i]}}}Ajax.get(resultUrl,null,{onready:onGetUpdatesSuccess,onerror:onError});for(var ekey in updateCallbacks){if(ekey.startsWith("begc_")){updateCallbacks[ekey]()}}}currentTimeout=setTimeout(function(){getUpdates()},getNextPeriod());mqGlobal.AddOnActiveWindowChange(function(isActive){if(isActive){if(currentTimeout){clearTimeout(currentTimeout)}getUpdates()}})}function DateToText(f,b){if(!window.dateToTextLocalization){return GetDate(f)}var g=new Date(1000*b);var d=new Date(1000*f);var a=parseInt(g.getTime()/(60*1000))-parseInt(d.getTime()/(60*1000));var c;var e;if(a<1){c="m";e=1}else{if(a<(60)){c="m";e=Math.floor(a)}else{if(a<(60*12)){c="h";e=Math.floor(a/60)}else{return GetDate(f)}}}return e+" "+window.dateToTextLocalization[c+GetCounterSuffix(e)]}function DateToStringForToday(b){var c=new Date();var a=new Date(1000*b);if(c.getFullYear()==a.getFullYear()&&c.getMonth()==a.getUTCMonth()&&c.getDate()==a.getUTCDate()){return(a.getUTCHours()>9?a.getUTCHours():"0"+a.getUTCHours())+":"+(a.getUTCMinutes()>9?a.getUTCMinutes():"0"+a.getUTCMinutes())}return GetDate(b)}function GetCounterSuffix(c){var a=(c%100);if(a>10&&a<20){return 3}var b=(c%10);if(b==1){return 1}if(b>1&&b<5){return 2}return 3}function ProductButtonClick(c,e,d){var b=$(d);if(b){var a=function(){Dialog.show(b.title,b,500,500,b.hasMt5DialogHide);b.style.display="block";var f=b.clientHeight;var g=b.clientWidth;Dialog.show(b.title,b,g,f,b.hasMt5DialogHide)};b.hasMt5DialogHide=function(){HasMt5DialogHide(b)};a(b)}}function HasMt5DialogHide(a){Dialog.hide();a.style.display="none"}function ToggleAddProduct(a){var c=$("addProductPopup");if(!c){return}if(!c.style.display){return}if(c.style.display=="none"){c.skipNextBlur=false}c.style.display="";var b=$("addProductInputTrigger")||createElement(c,"input",{type:"text",id:"addProductInputTrigger"});b.focus();b.onblur=function(){if(c.skipNextBlur){c.skipNextBlur=false;b.focus();return}c.style.display="none"};if(!c.onmousedown){c.onmousedown=function(){c.skipNextBlur=true}}if(!a.onmousedown){a.onmousedown=function(){c.skipNextBlur=true}}}function traceClickAsync(c,d,a,b,e){if(c!=undefined&&c.getAttribute("href")!=null&&c.href!=null&&c.href.indexOf(".exe")<0&&c.className!=undefined&&c.className!="buttonNew"){c.setAttribute("target","_blank")}a+=("_"+e);Ajax.get("/track/"+d+"?dst="+a+"&link="+b);if(window.ga){window.ga("send","pageview","https://www.mql5.com/track/"+d+"?dst="+a);window.ga("send","event","track",d,a.replace(d+"_",""))}}function traceClick(a){if(window.ga){window.ga("send","event","track","click",a)}}function trackOutboundLink(a){if(window.ga){window.ga("send","event","outbound","click",a,{hitCallback:function(){document.location=a}})}}function RenderCharts(S,b,d,J){var q="rgb(237,240,244)";var e="rgba(204,204,204,0.3)";var P="rgb(155,155,155)";var w="rgb(81,139,198)";var A="rgb(206,10,10)";var E="rgba(124,204,255,0.25)";var Q="rgba(185,32,36,0.25)";if(J){q=J.COLOR_BG||q;e=J.COLOR_GRID||e;P=J.COLOR_AXIS||P;w=J.COLOR_LINE||w;A=J.COLOR_LINE_MINUS||A;E=J.COLOR_LIGHT_LINE||E;Q=J.COLOR_BG||Q}var f=window.getElementsByClass(S);if(f!=undefined){for(var R in f){var C=f[R];if(C==undefined||C==null||C.className==undefined){continue}var g=C.getElementsByTagName("CANVAS");if(g==undefined||g==null||g.length==0){continue}g=g[0];if(!g.getContext){continue}var t=C.getElementsByTagName("INPUT");if(t==undefined||t.length!=1||t[0]==undefined){continue}var T=(t[0].value).split(", ");var z=parseInt(T[0]);T.shift();var V=g.getContext("2d");V.scale(1,1);var o=V.createLinearGradient(0,0,0,d);o.addColorStop(0,q);o.addColorStop(1,"#fff");V.fillStyle=o;V.fillRect(0,0,b,d);V.beginPath();var D=(d+2)/4;for(var U=D-0.5;U<b;U+=D){V.moveTo(U,0);V.lineTo(U,d)}for(var M=D-0.5;M<d;M+=D){V.moveTo(0,M);V.lineTo(b,M)}V.strokeStyle=e;V.lineWidth=1;V.stroke();V.closePath();V.beginPath();var u=d-z;var I=u-parseInt(T[0]);var H=0.5;V.moveTo(H,u);V.lineTo(H,I-1.5);var s=I>u?-1:1;var j=I;var F=[];var O=0;for(var R=1;R<T.length;R++){I=parseInt(T[R]);if(isNaN(I)){break}F.push(I);if(I==0&&O==0){O=F.length-1}if(I!=0){O=0}}var l=O==0?F.length:O;var B=b*1/l;for(var N=0;N<l;N++){I=u-F[N];H+=B;var G=I-0.5;var h=I>u?-1:1;if(h!=s&&N>1){var n=H-B;var a=j-0.5-u;var m=H;var W=G-u;var K=-a*(m-n)/(W-a)+n;var v=u;V.lineTo(K,v);V.fillStyle=s<0?Q:E;V.fill();V.closePath();V.beginPath();V.moveTo(K,v)}V.lineTo(H,G);j=I;s=h}V.lineTo(H,u);V.fillStyle=s<0?Q:E;V.fill();V.stroke();V.closePath();if(z>0&&z<d){V.beginPath();V.moveTo(0,u-0.5);V.lineTo(b,u-0.5);V.strokeStyle=P;V.stroke();V.closePath()}V.beginPath();u=d-z;I=u-parseInt(T[0]);H=0.5;V.moveTo(H,I-0.5);s=I>u?-1:1;j=I;for(var N=0;N<l;N++){I=u-F[N];H+=B;var G=I-0.5;var h=I>u?-1:1;if(h!=s&&N>1){var n=H-B;var a=j-0.5-u;var m=H;var W=G-u;var K=-a*(m-n)/(W-a)+n;var v=u;V.lineTo(K,v);V.strokeStyle=s<0?A:w;V.stroke();V.closePath();V.beginPath();V.moveTo(K,v)}V.lineTo(H,G);j=I;s=h}V.strokeStyle=s<0?A:w;V.stroke()}}}(function(){var d=function(){var g=(this.tagName=="INPUT")?this.previousSibling:this;var f=(this.tagName=="INPUT")?this:this.nextSibling;g.style.display="none";f.focus();if(window.console&&window.console.log){window.console.log("focus on "+this)}};var e=function(){var g=(this.tagName=="INPUT")?this.previousSibling:this;var f=(this.tagName=="INPUT")?this:this.nextSibling;if(f.value.length==0){g.style.display=""}if(window.console&&window.console.log){window.console.log("blur on "+this)}};var a=getElementsByClass("placeholder");if(!a||a.length==0){return}for(var c=0;c<a.length;c++){if(!a[c].parentNode||a[c].parentNode.className.indexOf("inputWrapper")<0){continue}var b=a[c].nextSibling;a[c].onclick=d;b.onfocus=d;b.onblur=e}})();function SetDateInputValue(a,h){function b(p,o){var m=(p+"").length;var j=p;for(var n=m;n<o;n++){j="0"+j}return j}var f=$(a+"Year");var e=$(a+"Month");var g=$(a+"Day");var d=$(a+"Hour");var c=$(a+"Minute");var i=$(a);if(!i){return}if(f){f.value=h.getFullYear()}if(e){e.value=b(parseInt(h.getMonth())+1,2)}if(g){g.value=h.getDate()}if(d){d.value=b(h.getHours(),2)}if(c){c.value=b(h.getMinutes(),2)}i.value=h.getFullYear()+"."+b(parseInt(h.getMonth())+1,2)+"."+h.getDate()+" "+b(h.getHours(),2)+":"+b(h.getMinutes(),2)}function Share(){var lastShareCounterId,lastShareButton;this.OpenShareEditor=function(linkObj,dialogTitle,shareUrl,isMobile){var tempDiv=createElement(null,"DIV",{className:"shareEditorLoading"});var dialogWidth=isMobile?300:600;var offset=getOffset(linkObj);offset.top+=linkObj.offsetHeight+4;Dialog.show(dialogTitle,tempDiv,dialogWidth,150,function(){lastShareButton=null;Dialog.hide()},offset);Ajax.get(shareUrl,null,{onready:function(data){var content=createElement(null,"DIV");content.innerHTML=data;var images=content.getElementsByTagName("img");for(var i=0;i<images.length;i++){images[i].onload=images[i].onerror=function(e){if(this.passedEvent){return}if(!e){e=window.event}this.passedEvent=true;var height=tempDiv.clientHeight||tempDiv.offsetHeight;Dialog.show(dialogTitle,tempDiv,dialogWidth,height,function(){lastShareButton=null;Dialog.hide()},offset,true)}}Class(tempDiv,"shareEditorLoading",true);tempDiv.appendChild(content);var height=tempDiv.clientHeight||tempDiv.offsetHeight;Dialog.show(dialogTitle,tempDiv,dialogWidth,height,function(){lastShareButton=null;Dialog.hide()},offset,true);Signals.RenderAvatars()},onerror:function(){},ismobile:isMobile})};this.OnShareSuccess=function(data){var dialogWidth=this.ismobile?300:600;var textData=stripHtml(data);var resObj=window.JSON?window.JSON.parse(textData):eval("("+textData+")");if(!resObj){return}var tempDiv;if(resObj.Type&&resObj.Type==="REDIRECT"){return}if(resObj.Type&&resObj.Type==="SUCCESS"){tempDiv=createElement(null,"DIV",{className:"shareEditorSuccess"});tempDiv.innerHTML=resObj.Message;var title=resObj.Title||resObj.Message||"";Dialog.show(title,tempDiv,dialogWidth,100,function(){Dialog.hide()},null,true);tempDiv.onclick=function(){Dialog.hide()}}if(resObj.Type&&resObj.Type==="ERROR"){tempDiv=createElement(null,"DIV",{className:"shareEditorSuccess"});tempDiv.innerHTML=resObj.Message;Dialog.show(resObj.Message,tempDiv,dialogWidth,100,function(){Dialog.hide()},null,true);tempDiv.onclick=function(){Dialog.hide()}}};this.ExternalShare=function(language,moduleId,typeId,entityId){var shareCounterId=$("share_counter_"+moduleId+"_"+typeId+"_"+entityId);if(shareCounterId){var count=+shareCounterId.innerHTML;shareCounterId.innerHTML=++count;lastShareCounterId=shareCounterId}lastShareButton=null;Dialog.hide()};this.ProcessShare=function(t){var shareType=$("shareType").value;if(shareType=="mql5com"){$("formShare").onsubmit();return false}$("formShare").onsubmit();if(lastShareButton==null){if($("socIconVk")&&$("socIconVk").className=="selected"){lastShareButton=$("socIconVk")}else{if($("socIconFb").className=="selected"){lastShareButton=$("socIconFb")}}}t.href=lastShareButton.href;lastShareButton=null;Dialog.hide();return true};this.SetShareType=function(t,shareType){if(lastShareButton==null){if($("socIconVk")&&$("socIconVk").className=="selected"){lastShareButton=$("socIconVk")}else{if($("socIconFb").className=="selected"){lastShareButton=$("socIconFb")}}}if(t==lastShareButton){return false}t.className="selected";$("socButtonIco").className=shareType;$("socButtonText").innerHTML=t.title;$("shareType").value=shareType;if(shareType=="mql5com"){$("shareContentWrapper").style.display="block";$("socCommentContent").focus()}else{$("shareContentWrapper").style.display="none"}if(lastShareButton&&lastShareButton.className){lastShareButton.className=lastShareButton.className=""}lastShareButton=t;return false}}var shareManager=new Share();function Friends(i,u,a,g,q,h){var f=u;var l=a;var d=g;var e=q;var t=h;var s=i;var p=t+"/users/"+s+"/friends/";var b=t+"/users/"+s+"/message/new?loginTo=";this.ShowFriendSettings=function(x,w,z,B,y){var v=$(w);if(!w){return}var A=v.parentNode;tooltip(v,c(x,z,B,y),function(){Class(A,"hovered")},function(){Class(A,"hovered",true)})};this.ShowFriendSettingsAjax=function(y,x){if(!y){return}var w=$(x);if(!x){return}var A=w.parentNode;var z="tt"+S4();Ajax.get(h+"/users/"+s+"/friends/"+y+"/info",null,{onerror:function(){},onready:v,ttId:z});tooltip(w,"<div id='"+z+'\'><span class="loader-icon"></span></div>',function(){Class(A,"hovered")},function(){Class(A,"hovered",true)});function v(C){ttId=this.ttId;var B=$(ttId);if(B){B.innerHTML=C}}};this.ShowPostSettings=function(x,w,y,A){var v=$(w);if(!w){return}var z=v.parentNode;tooltip(v,o(x,y,A),function(){Class(z,"hovered")},function(){Class(z,"hovered",true)})};function o(w,y,A){var z=createElement(null,"ul",{className:"friendsSettingsMenu"});if(A){var v=createElement(z,"li",{className:(y?"":"active")});if(!y){createElement(v,"span",{className:"hidePostsIndicator"})}v.appendChild(n(w,y))}else{var x=createElement(z,"li",{className:(y?"":"active")});createElement(x,"span",{className:"addFriendIco"});x.appendChild(r(w,y))}return z}function c(x,D,z,w){var v=createElement(null,"ul",{className:"friendsSettingsMenu"});if(z){var B=createElement(v,"li",{className:(D?"":"active")});if(!D){createElement(B,"span",{className:"hidePostsIndicator"})}B.appendChild(n(x,D))}else{var A=createElement(v,"li",{className:(D?"":"active")});A.appendChild(r(x,D))}var C=createElement(v,"li",{className:""});C.appendChild(j(x));if(z){createElement(v,"li",{className:"separator"});var y=createElement(v,"li",{className:""});y.appendChild(m(x,w))}return v}function n(v,w){return createElement(null,"a",{className:"friendsSettingsLink",innerHTML:f+"&nbsp;&nbsp;",href:p+v+"/"+(w?"show_posts":"hide_posts"),onclick:function(x){doPost(x,this.href);return false}})}function j(v){return createElement(null,"a",{className:"friendsSettingsLink",innerHTML:l,href:b+v,target:"_blank"})}function m(v,w){return createElement(null,"a",{className:"friendsSettingsLink",innerHTML:d,href:p+v+"/remove",onclick:function(x){if(!confirm(w)){return false}doPost(x,this.href);return true}})}function r(v){return createElement(null,"a",{className:"friendsSettingsLink",innerHTML:e,href:p+v+"/add",onclick:function(w){doPost(w,this.href);return false}})}}function Extractor(){var containerId="extractorContainer",badLinks=[],currentUrl=null,lastHtmlContent=null,contentPadding=10,matchLinkRegex=/http[s]*\:\/\/[a-z0-9\-\.]{1,120}\.[a-z]{2,5}[^\s\"\'<>\(\),]{0,500}/i,isLinkFound=false,isProcessing=false;this.CanFindLink=function(){return !isLinkFound&&!isProcessing};this.FindLink=function(frame){if(isLinkFound||isProcessing){return}var container=document.getElementById(containerId);if(container&&container.className=="disabled"){return}var editIdInput=document.getElementById("edit_id");if(editIdInput!=undefined&&editIdInput.value>0&&document.getElementById("extractor"+editIdInput.value)){return}var htmlContent=Dalet.Engine.GetHtml(frame);if(htmlContent==null||htmlContent==lastHtmlContent){return}lastHtmlContent=htmlContent;htmlContent=removeQuotes(htmlContent);var matchResult=htmlContent.match(matchLinkRegex);if(matchResult==null||matchResult[0]==null||matchResult[0]==""||isBadLink(matchResult[0])){return}currentUrl=matchResult[0];isProcessing=true;window.Ajax.post("/extractor",{url:currentUrl},false,{onready:function(text){if(text==null||text==""){badLinks.push(currentUrl);isProcessing=false;return}createContentBox(text);isLinkFound=true;isProcessing=false},onerror:function(){badLinks.push(currentUrl);isProcessing=false}})};this.HideContentBox=function(){badLinks.push(currentUrl);isLinkFound=isProcessing=false;var container=$(containerId);if(container){container.className="";container.innerHTML=""}};this.Remove=function(moduleId,typeId,entityId){window.Ajax.post("/extractor/remove",{moduleId:moduleId,typeId:typeId,entityId:entityId},false,{onready:function(text){if(text==null||text==""){return}var isRemoved=eval("("+text+")");if(isRemoved){var extractedContentBlock=$("extractor"+entityId);if(extractedContentBlock!=undefined){extractedContentBlock.parentNode.removeChild(extractedContentBlock)}}},onerror:function(){}})};this.ReadMore=function(id,commentId){window.Ajax.post("/extractor/readmore",{id:id},false,{onready:function(text){if(text==null||text==""){return}var result=eval("("+text+")");$("extractorDescription"+commentId).style.display="none";if($("extractorReadMore"+commentId)){$("extractorReadMore"+commentId).style.display="block"}else{var readMoreBox=document.createElement("DIV");readMoreBox.id="extractorReadMore"+commentId;var linkToHideBox=document.createElement("DIV");linkToHideBox.className="readMore";var linkToHide=document.createElement("A");linkToHide.href="#";linkToHide.innerHTML=result.translate.hideMore;linkToHide.onclick=function(){$("extractorReadMore"+commentId).style.display="none";$("extractorDescription"+commentId).style.display="block";return false};linkToHideBox.appendChild(linkToHide);readMoreBox.innerHTML=result.content;readMoreBox.appendChild(linkToHideBox);var parentGuest=$("extractorDescription"+commentId);if(parentGuest.nextSibling){parentGuest.parentNode.insertBefore(readMoreBox,parentGuest.nextSibling)}else{parentGuest.parentNode.appendChild(readMoreBox)}}},onerror:function(){}})};function removeQuotes(htmlContent){var tempDiv=document.createElement("DIV");tempDiv.innerHTML=htmlContent;var element=tempDiv.getElementsByTagName("DIV");for(var i=element.length-1;i>=0;--i){if(element[i].className=="fquote"||element[i].className=="code"||element[i].className=="pocket"){element[i].parentNode.removeChild(element[i])}}element=tempDiv.getElementsByTagName("EMBED");for(i=element.length-1;i>=0;--i){element[i].parentNode.removeChild(element[i])}element=tempDiv.getElementsByTagName("PRE");for(i=element.length-1;i>=0;--i){element[i].parentNode.removeChild(element[i])}return tempDiv.innerHTML}function isBadLink(url){for(var i=0;i<badLinks.length;i++){if(badLinks[i]===url){return true}}return false}function createContentBox(text){var container=document.getElementById(containerId);if(container&&container.className=="disabled"){return}var result=eval("("+text+")");var mainBox=document.createElement("DIV");mainBox.setAttribute("id","extractorContent");mainBox.className="extractorContent";if(result.ImageUrl!=null&&result.ImageUrl!=""){var imgBox=document.createElement("DIV");imgBox.className="image";var img=document.createElement("IMG");img.src=result.ImageUrl;imgBox.appendChild(img)}var contentBox=document.createElement("DIV");contentBox.className="content";contentBox.style.marginLeft=result.ImageWidth<1?0:result.ImageWidth+contentPadding+"px";var clearBox=document.createElement("DIV");clearBox.style.clear="both";var titleLink=document.createElement("A");titleLink.id="extractorTitleLink";titleLink.href=result.PageUrl;titleLink.target="_blank";titleLink.innerHTML=result.Title;if(!result.DisabledEdit){titleLink.className="editable";titleLink.title=result.Translate.clickToEdit;titleLink.onclick=function(){this.style.display="none";titleInput.style.display="inline";titleInput.focus();titleInput.select();return false}}var titleInput=document.createElement("INPUT");titleInput.id=titleInput.name="extractorTitle";titleInput.value=result.Title;titleInput.maxLength=250;titleInput.setAttribute("autocomplete","off");titleInput.onblur=function(){titleLink.innerHTML=this.value;titleLink.style.display="inline";this.style.display="none"};titleInput.onkeydown=function(e){e=(e||window.event);if(e==undefined||e.keyCode==undefined||e.keyCode!=13){return}this.blur()};titleInput.onkeypress=function(e){var evt=e||window.event;return evt.keyCode!=13};if(result.Rating>0){var ratingBox=document.createElement("DIV");ratingBox.className="rating small";var ratingBoxResult=document.createElement("DIV");ratingBoxResult.className="v"+result.Rating*10;ratingBox.appendChild(ratingBoxResult)}var infoTextArray=[];if(result.Rating>0){if(result.RatingVotesString!=null){infoTextArray.push(result.RatingVotesString)}if(result.RatingReviewsString!=null){infoTextArray.push(result.RatingReviewsString)}}if(result.PriceString!=null){infoTextArray.push(result.PriceString)}if(result.CategoryString!=null&&result.CategoryString!=""){infoTextArray.push(result.CategoryString)}if(result.DatePublished!=null&&result.DatePublished!=""){infoTextArray.push(result.DatePublished)}if(result.Author!=null&&result.Author!=""){infoTextArray.push(result.Author)}if(result.HostName){infoTextArray.push(result.HostName)}var infoBox=document.createElement("DIV");infoBox.className="info";if(ratingBox){infoBox.appendChild(ratingBox)}infoBox.innerHTML+=infoTextArray.join(" | ");var descriptionBox=document.createElement("P");if(result.Description!=null){descriptionBox.innerHTML=result.Description}if(!result.DisabledEdit){descriptionBox.className="editable";descriptionBox.title=result.Translate.clickToEdit;descriptionBox.onclick=function(){this.style.display="none";descriptionTextArea.style.display="block";descriptionTextArea.focus();descriptionTextArea.select();return false}}var descriptionTextArea=document.createElement("TEXTAREA");descriptionTextArea.id=descriptionTextArea.name="extractorDescription";descriptionTextArea.value=result.Description;descriptionTextArea.maxLength=450;descriptionTextArea.onblur=function(){descriptionBox.innerHTML=this.value;descriptionBox.style.display="block";this.style.display="none"};var keyInput=document.createElement("INPUT");keyInput.name="extractorKey";keyInput.type="hidden";keyInput.value=result.Key;var urlInput=document.createElement("INPUT");urlInput.name="extractorUrl";urlInput.type="hidden";urlInput.value=result.PageUrl;var buttonDelete=document.createElement("DIV");buttonDelete.className="delete";buttonDelete.title=result.Translate["delete"];buttonDelete.onclick=function(){Extractor.HideContentBox()};contentBox.appendChild(titleLink);contentBox.appendChild(titleInput);contentBox.appendChild(infoBox);contentBox.appendChild(descriptionBox);contentBox.appendChild(descriptionTextArea);contentBox.appendChild(keyInput);contentBox.appendChild(urlInput);if(imgBox){mainBox.appendChild(imgBox)}mainBox.appendChild(contentBox);mainBox.appendChild(clearBox);container.className="extractor";container.innerHTML="";container.appendChild(mainBox);container.appendChild(buttonDelete)}function stopProp(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}}var Extractor=new Extractor();function QuickRegistration(){var isFirstFocus=true;var actionDst=null;var currentLang;this.OnSubmit=function(form,lang){if(actionDst==null){return}currentLang=lang==""?"en":lang};this.OnError=function(){$("quickRegisterErrorMessage").style.display="block"};this.OnSuccess=function(data){QuickRegistration.Track("submit",{dst:"submit_"+actionDst});var result=((typeof data)=="string")?eval("("+data+")"):data;$("quickRegisterErrorMessage").style.display="none";if(!result){$("quickRegisterErrorMessage").style.display="block";return}if(isEmpty(result)){QuickRegistration.Track("action",{dst:"action_"+actionDst,email:$("email").value});Validate.SetValid($("quickRegisterForm"),result);var quickRegistrationFormLogin=$("quickRegistrationFormLogin");if(quickRegistrationFormLogin){quickRegistrationFormLogin.style.display="block";Dialog.show("",$("quickRegistrationFormLogin"),400,175,function(){Dialog.hide();$("quickRegistrationFormLogin").style.display="none"});$("Login").value=$("username").value;$("username").value="";$("email").value="";$("Password").focus()}}if(result.common!=undefined){$("quickRegisterErrorMessage").style.display="block"}Validate.SetValid($("quickRegisterForm"),result)};this.OnSuccessGeneral=function(data){QuickRegistration.Track("submit",{dst:"submit_"+actionDst});var result=eval("("+data+")");$("quickRegisterErrorMessage").style.display="none";if(!result){$("quickRegisterErrorMessage").style.display="block";return}if(isEmpty(result)){QuickRegistration.Track("action",{dst:"action_"+actionDst,email:$("email").value});Validate.SetValid($("quickRegisterForm"),result);window.setTimeout(function(){var username=$("username")!=undefined?$("username").value:"";window.location=actionDst=="register_cloud"?"https://www.mql5.com/"+currentLang+"/auth_login?reg=1&return=cloud&login="+username:"https://www.mql5.com/"+currentLang+"/auth_login?reg=1&login="+username},100)}if(result.common!=undefined){$("quickRegisterErrorMessage").style.display="block"}Validate.SetValid($("quickRegisterForm"),result)};function isEmpty(obj){for(var prop in obj){if(prop.toString()!="empty"&&obj.hasOwnProperty(prop)){return false}}return true}this.OnBlur=function(t){if(t.value==""&&t.nextSibling){(t.nextSibling).style.display="block"}};this.OnFocus=function(t,dst){if(isFirstFocus){isFirstFocus=false;actionDst=dst;this.Track("focus",{dst:"focus_"+actionDst})}if(t.nextSibling){(t.nextSibling).style.display="none"}};this.DisableInputs=function(){$("username").disabled="disabled";$("email").disabled="disabled";if($("quickRegisterSubmit")){$("quickRegisterSubmit").className="submit loading"}if($("quickRegisterButton")){$("quickRegisterButton").disabled="disabled"}};this.EnableInputs=function(){$("username").disabled=false;$("email").disabled=false;if($("quickRegisterSubmit")){$("quickRegisterSubmit").className="submit"}if($("quickRegisterButton")){$("quickRegisterButton").disabled=false}};this.Track=function(action,params){window.Ajax.get("/track/"+action,params);if(window.ga&&params&&params.dst){window.ga("send","pageview","https://www.mql5.com/track/"+action+"?dst="+params.dst.replace(action+"_",""));window.ga("send","event","track",action,params.dst.replace(action+"_",""))}}}var QuickRegistration=new QuickRegistration();function Blogs(){var currentAvatarUrl,isProcessingMouseMove=false,isMouseDownOnSplash=false,isMouseDownOnResizer=false,splashBackgroundHeight=0,splashBackgroundMinHeight=0,splashFrameMinHeight=200,splashFrameMaxHeight=0,splashFrameCurrentHeight=0,splashBackgroundCurrentTopPosition=0,currentMousePosition=0,currentCategoryIconId=null;this.StartProcessMouseMove=function(){addHandler(window.document,"mousemove",function(e){processMouseMove(e)});addHandler(window.document,"mouseup",function(){processMouseUp()});if($("dalet_Content")){var doc=$("dalet_Content").contentDocument||$("dalet_Content").contentWindow.document;addHandler(doc,"mouseup",function(){processMouseUp()})}isProcessingMouseMove=true};this.ProcessAvatarEditForm=function(){Ajax.form($("blogPostAvatarEditForm"),{onready:processAvatarEditFormCallBack,onerror:function(){alert("error occured")}})};function processAvatarEditFormCallBack(data){data=data.replace(/<pre[^<>]*>/,"");data=data.replace(/<\/pre>/,"");var json=eval("("+data+")");if(json!=null&&json.Url!=undefined&&json.Url!=null){currentAvatarUrl=json.Url;$("postAvatarImage").src=json.Url;$("AvatarFileName").value=json.Url}}this.ProcessSplashEditForm=function(){Ajax.form($("blogPostSplashEditForm"),{onready:processSplashEditFormCallBack,onerror:function(){alert("error occured")}})};function processSplashEditFormCallBack(data){if(!data){return}data=data.replace(/<pre[^<>]*>/,"");data=data.replace(/<\/pre>/,"");var validator=$("splashValidator");validator.style.display="none";var json=eval("("+data+")");if(json!=null&&json!=false&&json.Url!=undefined&&json.Url!=null){$("splashFileName").value=json.Url;$("blogPostSplashFrame").style.backgroundImage="url("+json.Url+")";$("blogPostSplashFrame").style.backgroundPosition="top center";$("blogPostSplashFrame").style.backgroundSize="";$("blogPostSplashFrame").style.height=json.FrameHeight+"px";$("blogPostSplashFrame").style.cursor="move";$("postSplashEdit").style.display="inline";$("blogPostSplashTools").style.display="block";splashBackgroundHeight=json.ImageHeight;splashBackgroundMinHeight=json.ImageMinHeight;splashFrameMaxHeight=json.FrameHeight;splashFrameCurrentHeight=json.FrameHeight;splashBackgroundCurrentTopPosition=0}else{if(json!=null&&json.Error){validator.style.display="block";validator.innerHTML=json.Error;$("blogPostSplashFrame").style.backgroundImage="";$("blogPostSplashFrame").style.height=splashFrameMinHeight+"px";$("blogPostSplashFrame").style.backgroundSize="";splashBackgroundCurrentTopPosition=0}}}this.ShowDatePublishBox=function(t){var boxWidth=385;var datePublishBox=$("datePublishBox");if(datePublishBox.style.display=="block"){datePublishBox.style.display="none"}else{datePublishBox.style.display="block";datePublishBox.style.left=t.offsetLeft+(t.offsetWidth/2)-(boxWidth/2)+"px"}return false};this.ApplyDatePublishBox=function(){var hours=(+$("datePublishedHour").value);if(hours==""||isNaN(hours)||hours<0||hours>23){$("datePublishedHour").value="00"}var minutes=(+$("datePublishedMinute").value);if(minutes==""||isNaN(minutes)||minutes<0||minutes>59){$("datePublishedMinute").value="00"}$("datePublishSelectorLink").innerHTML=$("datePublishedDay").value+" "+$("datePublishedMonth")[+$("datePublishedMonth").value-1].innerHTML+" "+$("datePublishedYear").value+", "+$("datePublishedHour").value+":"+$("datePublishedMinute").value;if($("IsChangedDatePublished")){$("IsChangedDatePublished").value="true"}$("IsPublished").checked=true;$("datePublishBox").style.display="none"};this.ApplyDatePublishBoxByKeyDown=function(e){var event=!e?window.event:e;if(event.keyCode==13){this.ApplyDatePublishBox();if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}event.preventDefault&&event.preventDefault()}};this.ProcessPrevent=function(e){removeSelection();stopProp(e);e.preventDefault&&e.preventDefault();return false};this.ProcessSplashZoom=function(e,zoomIn){removeSelection();stopProp(e);var size=100*(zoomIn?1:-1);if((splashBackgroundHeight+size)<splashFrameMinHeight||(splashBackgroundHeight+size)<splashBackgroundMinHeight){return}splashBackgroundHeight+=size;if(splashBackgroundHeight>=splashFrameMinHeight&&splashBackgroundHeight<splashFrameCurrentHeight){splashFrameCurrentHeight=splashBackgroundHeight;$("blogPostSplashFrame").style.height=splashFrameCurrentHeight+"px"}$("blogPostSplashFrame").style.backgroundSize="auto "+splashBackgroundHeight+"px";$("splashFileHeight").value=splashBackgroundHeight};this.ProcessSplashMouseDown=function(){if(splashFrameCurrentHeight==0||isMouseDownOnResizer){return}if(!isProcessingMouseMove){this.StartProcessMouseMove()}isMouseDownOnSplash=true};this.ProcessSplashResizeMouseDown=function(){if(isMouseDownOnSplash){return}if(!isProcessingMouseMove){this.StartProcessMouseMove()}isMouseDownOnResizer=true};this.SetCategoryIconsBox=function(currentIconPos,iconsPath){currentCategoryIconId=currentIconPos;var img=new Image;img.src=iconsPath;img.onload=function(){var height=img.height;if(height<16){height=512}var stringBuilder=[];for(var i=0;i>(height*-1);i-=16){stringBuilder.push('<div class="item"><input type="radio" name="iconPos" value="'+i+'" id="icon'+i+'" onclick="Blogs.SetCategoryIcon('+i+')"><label for="icon'+i+'" id="iconLabel'+i+'"><div style="background: url('+iconsPath+") no-repeat 0 "+i+'px"></div></label></div>')}$("blogsIconsBox").innerHTML=stringBuilder.join("\r\n");if($("icon"+currentCategoryIconId)){$("icon"+currentCategoryIconId).checked=true;if($("iconLabel"+currentCategoryIconId)){$("iconLabel"+currentCategoryIconId).className="selected"}}}};this.SetCategoryIcon=function(id){if($("iconLabel"+currentCategoryIconId)){$("iconLabel"+currentCategoryIconId).className=""}$("iconLabel"+id).className="selected";currentCategoryIconId=id};function processMouseMove(e){if(!isMouseDownOnSplash&&!isMouseDownOnResizer){return}removeSelection();var event=window.event?window.event:e;var posY=event.clientY;if(currentMousePosition==0){currentMousePosition=posY}if(isMouseDownOnResizer){splashFrameCurrentHeight+=(posY-currentMousePosition);if(splashFrameCurrentHeight<splashFrameMinHeight){splashFrameCurrentHeight=splashFrameMinHeight}else{if(splashFrameCurrentHeight>splashFrameMaxHeight){splashFrameCurrentHeight=splashFrameMaxHeight}else{if(splashFrameCurrentHeight>splashBackgroundHeight){splashFrameCurrentHeight=splashBackgroundHeight}}}$("blogPostSplashFrame").style.height=splashFrameCurrentHeight+"px"}if(isMouseDownOnSplash){splashBackgroundCurrentTopPosition+=(posY-currentMousePosition);$("blogPostSplashFrame").style.backgroundPosition="center "+splashBackgroundCurrentTopPosition+"px"}currentMousePosition=posY}function processMouseUp(){if(!isProcessingMouseMove){return}isMouseDownOnSplash=false;isMouseDownOnResizer=false;if(splashBackgroundCurrentTopPosition<(splashBackgroundHeight-splashFrameCurrentHeight)*-1){splashBackgroundCurrentTopPosition=(splashBackgroundHeight-splashFrameCurrentHeight)*-1}if(splashBackgroundCurrentTopPosition>0){splashBackgroundCurrentTopPosition=0}$("blogPostSplashFrame").style.backgroundPosition="center "+splashBackgroundCurrentTopPosition+"px";$("splashFileTopPosition").value=splashBackgroundCurrentTopPosition;if(splashFrameCurrentHeight<splashFrameMinHeight){splashFrameCurrentHeight=splashFrameMinHeight}else{if(splashFrameCurrentHeight>splashFrameMaxHeight){splashFrameCurrentHeight=splashFrameMaxHeight}}$("blogPostSplashFrame").style.height=splashFrameCurrentHeight+"px";$("splashFileFrameHeight").value=splashFrameCurrentHeight;currentMousePosition=0}function stopProp(e){if(!e){e=window.event}if(e&&e.stopPropagation){e.stopPropagation()}else{if(window.event&&window.event.cancelBubble){window.event.cancelBubble=true}}}function removeSelection(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection&&document.selection.clear){document.selection.clear()}}}function addHandler(element,event,handler){if(element.attachEvent){element.attachEvent("on"+event,handler)}else{if(element.addEventListener){element.addEventListener(event,handler,false)}}}this.CrawlerCheckBox=function(formName){var button=$("buttonAction");if(!button){return}var form=document.forms[formName];if(form){var elems=form.elements;for(var i=0,l=elems.length;i<l;++i){var elem=elems[i];if(elem.type.toLowerCase()=="checkbox"&&elem.name.startsWith("boxes[")){if(elem.checked){button.disabled=false;return}}}}button.disabled="disabled";if(window.console&&window.console.debug){window.console.debug(button.disabled)}};this.CheckingkNewPost=function(categoryId,dateFromSecondsLong,lang){var noticeBox=document.getElementById("newPostNotice");if(noticeBox==undefined){return}var url="/"+lang+"/blogs/checknewpost";var interval=window.setInterval(function(){Ajax.get(url,{categoryId:categoryId,dateFrom:dateFromSecondsLong},{onready:function(json){if(json==null||json==""){return}var result=eval("("+json+")");noticeBox.innerHTML=result.Content;noticeBox.style.display="block";window.clearInterval(interval)}})},10*60*1000)}}var Blogs=new Blogs();function MobileMenu(){var g=false;var a=false;var f;var c=$("mobileMenuNavicon");var b=$("left-panel");if(!b||!c){return}f=document.createElement("input");f.type="checkbox";f.style.position="absolute";f.style.left="-5000px";c.appendChild(f);$("bodyContent").style.position="relative";d(c,"mousedown",function(h){MobileMenu.ShowHide(h,true);e(h,true)});d(b,"mousedown",function(h){e(h,true)});d(f,"blur",function(h){MobileMenu.ShowHide(h,false)});this.ShowHide=function(i,h){if(!b||!c||!(g||h)){return}if(!g&&h){g=true;b.style.left=0;c.className="selected";f.focus();e(i,true)}else{if(g){g=false;b.style.left="-1000px";c.className=""}}};function d(h,j,i){if(h.addEventListener){h.addEventListener(j,i,false)}else{if(h.attachEvent){h.attachEvent("on"+j,i)}}}function e(i,h){if(i&&i.stopPropagation){i.stopPropagation()}else{if(i&&i.cancelBubble){i.cancelBubble=true}}if(h){i.preventDefault&&i.preventDefault()}}}var MobileMenu=new MobileMenu();function LangMenu(){var e,c,b,d,a=false;mqGlobal.AddOnReady(function(){LangMenu.Init()});this.Init=function(){if(e!=null){return}e=$("langmenu");c=$("langMenuSelected");b=$("langMenuContainer");if(e==null||c==null||b==null){return}c.onmousedown=function(h){a=Core.IsTouchDevice();Core.PreventSelection();h=h||window.event;if(e.className==="langmenu dropped"){LangMenu.Hide()}else{LangMenu.Show(h)}};c.onselectstart=function(){return false};var g=e.getElementsByTagName("a");for(var f in g){g[f].onmousedown=function(h){h=h||window.event;Core.StopProp(h);h.preventDefault&&h.preventDefault()};g[f].onselectstart=function(){return false}}e.onmousedown=function(h){h=h||window.event;Core.StopProp(h);h.preventDefault&&h.preventDefault();return false};e.onselectstart=function(){return false};if(!Core.IsTouchDevice()){b.onmouseover=function(h){LangMenu.Show(h)};b.onmouseout=function(){LangMenu.Hide()}}else{d=document.createElement("input");d.type="checkbox";d.className="blurHandler";d.onblur=function(){LangMenu.Hide()};e.appendChild(d)}};this.Show=function(f){f=f||window.event;f.preventDefault&&f.preventDefault();if(e.className==="langmenu"){e.className="langmenu dropped";if(a){d.focus()}}};this.Hide=function(){e.className="langmenu"}}var LangMenu=new LangMenu();function MainMenu(){var c,a,b;mqGlobal.AddOnReady(function(){MainMenu.Init()});this.Init=function(){if(c!=null){return}c=$("mainmenu");a=$("mainMenuSelected");if(!c){return}a.onmousedown=function(f){f=f||window.event;if(c.className=="menu dropdown dropped"){MainMenu.Hide()}else{MainMenu.Show(f)}};var e=c.getElementsByTagName("a");for(var d in e){if(e[d]!=a){e[d].onmousedown=function(f){f=f||window.event;Core.StopProp(f);f.preventDefault&&f.preventDefault()}}}b=document.createElement("input");b.type="checkbox";b.className="blurHandler";b.onblur=function(){MainMenu.Hide()};c.appendChild(b)};this.Show=function(d){d=d||window.event;d.preventDefault&&d.preventDefault();if(c.className=="menu dropdown"){c.className="menu dropdown dropped";b.focus()}};this.Hide=function(){c.className="menu dropdown"}}var MainMenu=new MainMenu();function HeadSideBarMenu(){var c,a,b,d;mqGlobal.AddOnReady(function(){HeadSideBarMenu.Init()});this.Init=function(){c=$("groupMenu");a=$("sidebarToggleButton");b=$("cover");if(c==null||a==null||b==null){return}d=document.createElement("div");d.className="layer";b.appendChild(d);a.onclick=function(){HeadSideBarMenu.Show()};d.onclick=function(){HeadSideBarMenu.Hide()}};this.Show=function(){var g=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var f=document.body.scrollHeight;var e=Math.max(g,f);b.className="cover sidebar_open";c.style.height=e+"px";d.style.height=e+"px"};this.Hide=function(){b.className="cover"}}var HeadSideBarMenu=new HeadSideBarMenu();function Focuser(){var a;var b;this.Init=function(c,e){var d=$(c);if(!d){return}var f=$(e);d.setAttribute("tabindex",-1);d.onclick=function(){if(a){return}f.style.display="block";a=true;d.focus()};d.onblur=function(){if(!a){return}if(b){b=false;d.focus();return}f.style.display="none";a=false};f.onmousedown=function(){if(a){b=true}else{b=false}}}}function ClickPopup(){this.Init=function(e,a,h,b){var d=$(e);if(!d){return}var g=$(a);var i=$(h);var c=function(){d.className+=" on";g.style.display="block"};var f=function(){d.className=d.className.replace(" on","");g.style.display="none"};i.onfocus=function(){setTimeout(c,0)};i.onblur=function(){setTimeout(f,100)};d.onclick=function(){if(g.style.display=="block"){i.blur()}else{g.style.display="block";i.focus();i.select()}};if(b){g.style.left="-"+((b-d.offsetWidth)/2)+"px"}}}function Layer(h,c,a,d){this.elementId=d;var b=$(d);var g=c;var f=a;b.style.top=a+"px";b.style.left=c+"px";this.calcCoordsDelta=function(l,j,i,n){if(!h){return{}}var m=h(l,j,i,n);e=m;return m};var e=null;this.move=function(){if(!e){return}for(var i in e){b.style[i]=e[i]}e=null};this.getElement=function(){return b};this.getInitPosition=function(){return{left:g,top:f}};this.getDeltaProps=function(){return e||{}}}function Parallax(){var e=document.body;var j=[];var b=supportsCssProp("transition");this.addLayer=function(o,m,l,n){j[j.length]=new Layer(o,m,l,n)};this.getLayer=function(l){for(var m=0;m<j.length;m++){if(j[m].elementId==l){return j[m]}}return null};var c=new Date();function h(){return(!b)||(((new Date())-c)>50)}var f=-1;var d=-1;function i(l,n){for(var m=0;m<j.length;m++){j[m].calcCoordsDelta(l-f,n-d,l,n)}if(h()){for(var m=0;m<j.length;m++){setTimeout(j[m].move,100)}c=new Date()}}e.onmousemove=function(m){var l=-1;var n=-1;if(document.all){l=event.x+document.body.scrollLeft;n=event.y+document.body.scrollTop}else{l=m.pageX;n=m.pageY}if(f<0||d<0){f=l;d=n;return}i(l,n);f=l;d=n};e.onmouseout=function(){f=-1;d=-1};var a=getWindowSize();this.getWindowSize=function(){return a};var g=window.onresize;window.onresize=function(){a=getWindowSize();i(f,d);if(g){g()}}}function addCustomScroll(d,x,l,j,e,w){var t=d.style.width;var n=window.getComputedStyle?window.getComputedStyle(d,null).getPropertyValue("padding-right")||0:0;var o=parseInt(n);var f=createElement(null,"div",{className:"customScrollWrapper"});if(!d.parentNode){return}d.parentNode.insertBefore(f,d);d.style.width="100%";f.appendChild(d);var g=createElement(f,"div",{className:"customScrollBar"});g.style.backgroundColor=x||"#F0F0F0";g.style.width=((j||1)+((e||0)*2))+"px";f.style.zIndex=d.style.zIndex;var i=createElement(g,"div",{className:"customScrollBarSpace"});var m=createElement(g,"div",{className:"customScrollBarTrack"});m.style.backgroundColor=l||"#F0F0F0";m.style.width=(j||1)+"px";m.style.border="solid "+(e||0)+"px "+(x||"#F0F0F0");i.style.width=m.style.width;i.style.border="solid "+(e||0)+"px transparent";s();d.style.paddingRight=(o+(17-j-(e*2)))+"px";p(d);g.onmousedown=function(y){if(y.currentTarget!==y.target){return}d.scrollTop=Math.min(d.scrollTop+d.clientHeight,d.scrollHeight-d.clientHeight)};i.onmousedown=function(y){if(y.currentTarget!==y.target){return}d.scrollTop=Math.max(d.scrollTop-d.clientHeight,0)};function p(z){var y=q(z);if(y.noscroll){m.style.display="none"}else{m.style.display=""}m.style.height=y.height+"px";m.style.top=y.top+"px";i.style.top="0px";i.style.height=y.top+"px"}var v=d.onscroll;var c=d;c.onscroll=function(){p(c);if(v){v(arguments)}return true};var r=d.onresize;c.onresize=function(){p(c);if(r){r(arguments)}return true};function s(){if(w){for(var y in w){if(w.hasOwnProperty(y)){f.style[y]=w[y]}}}}function a(){if(w){for(var y in w){if(w.hasOwnProperty(y)){f.style[y]=""}}}}function q(D){var B=false;if(D.scrollHeight<=D.clientHeight){B=true}var z=50;var y=Math.max(z,((D.clientHeight/D.scrollHeight)*g.clientHeight)|0)-e-e;var C=g.clientHeight-y-e-e;var A=((D.scrollTop/(D.scrollHeight-D.clientHeight))*C)|0;return{height:y,top:A,noscroll:B}}function u(A){A=A||window.event;if(A.pageX==null&&A.clientX!=null){var z=document.documentElement;var y=document.body;A.pageX=A.clientX+(z&&z.scrollLeft||y&&y.scrollLeft||0)-(z.clientLeft||0);A.pageY=A.clientY+(z&&z.scrollTop||y&&y.scrollTop||0)-(z.clientTop||0)}if(!A.which&&A.button){A.which=A.button&1?1:(A.button&2?3:(A.button&4?2:0))}return A}function h(y){var G=parseInt(y.style.top);var D=0;var C=y;function E(H){H=u(H);if(!C){return}C.style.top=B(H.pageY)+"px";D=H.pageY;G=parseInt(C.style.top);d.scrollTop=z()}function B(I){var K=0;var J=C.parentNode.clientHeight-C.clientHeight-e-e;var H=G+(I-D);return Math.min(Math.max(H,K),J)}function z(){var M=parseInt(C.style.top);var I=C.clientHeight;var J=C.parentNode.clientHeight;var K=d.scrollHeight;var H=(K/J)*M;return H}var A=null;var F=C.onmousedown;C.onmousedown=function(H){H=u(H);D=H.pageY;G=parseInt(C.style.top);A=window.onmousemove;Class(C,"dragged");window.onmousemove=function(I){E(I)};window.onmouseup=function(){Class(C,"dragged",true);window.onmousemove=A;A=null};if(F){F(H)}return false}}var b=new h(m)}function FeedbackForm(){var b=null;this.ProcessSubjectSelect=function(f){var g=$("subjectType");if(g==undefined){return}if(f==null||f==""){g.style.display="none";return}if(b==null){a(g)}var c="subjectType_"+f+"_";while(g.hasChildNodes()){g.removeChild(g.lastChild)}for(var e in b){if(b[e].id==undefined||b[e].id.indexOf(c)!=0){continue}g.appendChild(b[e])}g.style.display="inline";if(g.childNodes!=null&&g.childNodes[0].selected!=undefined){g.childNodes[0].selected=true}var d=$("customSubjectBox");if(d!=undefined){d.style.display="none"}};this.ProcessSubjectTypeSelect=function(j){var d=$("subjectType");if(d==undefined){return}var g=$("customSubjectBox");if(g==undefined){return}var f=$("customSubject");if(f==undefined){return}var e=d.getElementsByTagName("option");var c=false;for(var h in e){if(e[h].value!=j||e[h].id==undefined||e[h].id.indexOf("_other")<0){continue}c=true;break}if(c){g.style.display="block";f.focus()}else{g.style.display="none"}};function a(c){b=[];var d=c.getElementsByTagName("option");for(var e in d){b.push(d[e])}}}var FeedbackForm=new FeedbackForm();function HotKeysClass(){var a=[];function c(e,f,d,h,m){var n=e;var g=f?true:false;var i=d?true:false;var j=h?true:false;var l=m;this.IsPressed=function(r){r=r||window.event;var q,p=false,s=false,o=false;if(r){q=r.keyCode}else{q=r.which}p=r.shiftKey?true:false;s=r.ctrlKey?true:false;o=r.altKey?true:false;return q==n&&g==p&&i==s&&j==o};this.ExecCallback=function(o){if(l){return l(o)}return true}}var b=window.document.onkeydown;window.document.onkeydown=function(g){for(var f=0;f<a.length;f++){if(a[f].IsPressed(g)){var d=a[f].ExecCallback(g);if(d==false){return false}}}if(b){b(arguments)}};this.Add=function(e,h,d,f,g){a.push(new c(e,d,f,g,h))}}var HotKeys=new HotKeysClass();var paletteRegular=["#3366CC","#DC3912","#FF9900","#109618","#990099","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707"];var paletteHover=["#45AFE2","#FF3300","#FFD324","#14C21D","#DF51FD","#15CBFF","#FF97D2","#97FB00","#DB6651","#518BC6","#BD6CBD","#35D7C2","#E9E91F","#9877DD","#FF8F20","#D20B0B"];function BuildMonitoringChart(b,g,a,f,e){var d=[];d.push(["{",'   "title":"",','   "description":"",','   "fractionalValue":"0",','   "type":"graph",','   "subType":"simple",','   "showFractionalValue":true,','   "axisXTitle" : "Date",','   "axisYTitle" : "'+g+(a==""?"":(", "+a))+'",','   "margin" : {"left" : 50, "right" : 30},','   "series" : [',"       {",'           "type" : "title",','           "value" : ['+f+"]","       }"].join("\n"));var h=0;for(var c in e){d.push(["       ,","       {",'           "type" : "graph",','           "title" : "",','           "tooltip" : "%VARIABLE% - '+c+" - %VALUE% "+a+'",','           "value" : ['+e[c]+"],",'           "selectColor":"'+paletteHover[h%paletteHover.length]+'",','           "lineColor":"'+paletteRegular[h%paletteHover.length]+'",','           "showBounds":false',"       }"].join("\n"));h++}d.push(["   ]"," }"].join("\n"));if(!window.getRenderType){window.getRenderType=function(){return MQL5ChartAPI.hasSVG()?MQL5ChartRenderType.SVG:MQL5ChartRenderType.FLASH}}if($(b)){MQL5ChartAPI.addChart(b,d.join("\n"),MQL5ChartType.GRAPH,window.getRenderType)}}var MqDownloadLinksProcessor=new function(){return;var a="https://download.mql5.com",i="utm_campaign",e="MQL5.community",c=24;b(d);function b(j){if(window.addEventListener){window.addEventListener("load",j,false)}else{if(window.attachEvent){window.attachEvent("onload",j)}}}function f(l){var j=new Date(new Date().getTime()+c*60*60*1000);document.cookie=i+"="+escape(l)+"; path=/; expires="+j.toUTCString()}function h(){var l=new RegExp("(?:^|; )"+i+"=([^;]*)");var j=document.cookie.match(l);return j?decodeURIComponent(j[1]):null}function g(){var l=null;var p=h();if(p!=null&&p.length>0){return p}if(window.location.search.indexOf(i)){var n=window.location.search.substring(1).split("&");for(var j in n){if(typeof n[j]!=="string"){continue}var o=n[j].split("=");if(o[0]!=i||o[1].length==0){continue}f(o[1]);return o[1]}}if(document.referrer.length>0){var m=document.createElement("A");m.href=document.referrer;if(m.hostname!=null&&m.hostname.length>3&&m.hostname!=window.location.hostname){f(m.hostname);return m.hostname}}return e}function d(){var o=g();var p=i+"="+encodeURIComponent(o);var j=document.getElementsByTagName("A");for(var m in j){if(!j[m].href||j[m].href==null||j[m].href.indexOf(a)!=0){continue}if(j[m].search.length==0){j[m].search+=("?"+p)}else{if(j[m].search.indexOf(i)>=0){var n=new RegExp(i+"=[^&\"']{1,}");var l=j[m].search.match(n);if(l&&l!=null){j[m].search=j[m].search.replace(l,p)}}else{j[m].search+=("&"+p)}}}}};function AnnonsLines(){this.Close=function(a,b){if(a){$("annonsLine"+b).style.display="none"}Ajax.post("/annons/hide/"+b,null,false)}}var AnnonsLines=new AnnonsLines();function TradingAccounts(){this.accounts_base=[];this.childHost="";this.parentHost="";this.syncCompleteCallback=null;this.editableBroker=true;this.editableMt=true;this.presetAccountLine=null;this.syncEnabled=false;this.InitCore=function(b,a){TradingAccounts.childHost=b;TradingAccounts.parentHost=a};this.InitSync=function(b,f,c,e,i,d,h){TradingAccounts.editableMt=b;TradingAccounts.editableBroker=f;TradingAccounts.syncCompleteCallback=c;TradingAccounts.presetAccountLine=e;window.addEventListener("message",TradingAccounts.OnWindowMessage);var g=$("webTerminalHost");if(g){var a=TradingAccounts.childHost+"/trade?callback";if(i){a+="&startup_mode="+i;if(i=="no_ui"){TradingAccounts.syncEnabled=true}}if(d>0){a+="&login="+d+"&trade_server="+h}g.setAttribute("src",a)}};this.OnWindowMessage=function(a){if(a.origin!=TradingAccounts.childHost){return}var b=JSON.parse(a.data);switch(b.command){case"records":TradingAccounts.SyncAccountsData(TradingAccounts.childHost,b.data);break;case"add_line_complete":if(TradingAccounts.syncCompleteCallback&&TradingAccounts.syncCompleteCallback.add_line_complete){TradingAccounts.syncCompleteCallback.add_line_complete()}break}};this.SyncAccountsData=function(a,c){if(TradingAccounts.presetAccountLine){TradingAccounts.AddAccountLine(a,TradingAccounts.presetAccountLine);return}else{if(TradingAccounts.syncCompleteCallback&&TradingAccounts.syncCompleteCallback.onsync&&c&&c.length&&c.length>0){var b=c[0];if(!b.login||!b.server_name){return}TradingAccounts.syncCompleteCallback.onsync();return}}if(TradingAccounts.syncEnabled&&c&&c.length&&c.length>0){TradingAccounts.MapAccountStats(c)}};this.SearchNextNode=function(e,a){var b=e;var d=false;while(true){var c;if(!d&&b.childNodes&&b.childNodes.length>0){c=b.childNodes[0];if(!c.tagName){b=c;continue}if(c.tagName==a){return c}}d=false;c=b.nextSibling;if(!c){if(b.parentNode){b=b.parentNode;d=true;continue}b=c;break}if(!c.tagName){b=c;continue}if(c.tagName==a){return c}b=c}return b};this.MapAccountStats=function(o){var h=TradingAccounts.SearchNextNode;var s=[];var p=[];var c=$("tradeAccountsList");var t=$("accNewTile");var r=$("accTileTemplate");if(!c||!t||!r){return}for(var m=0;m<o.length;m++){var g=o[m];if(!g||!g.login||!g.server_name){continue}g.tile=m;o[m]=g;var n=r.cloneNode(true);n.setAttribute("id","accTile"+m);var a;if(g.server_type){a=g.server_type}else{a=4;g.server_type=4}var f=h(n,"A");if(g.account_name){f.innerHTML=g.login+": "+g.account_name}else{f.innerHTML=g.login}var b=f.getAttribute("href");b+="?login="+g.login+"&trade_server="+g.server_name;f.setAttribute("href",b);var e={};f=h(f,"IMG");f.setAttribute("id","accFieldLogo"+m);e.node_logo=f;f=h(f,"SPAN");f.innerHTML=g.server_name;f=h(f,"SPAN");f.setAttribute("id","accFieldCompany"+m);e.node_company=f;f=h(f,"SPAN");f.className="mt mt"+a;f.setAttribute("title","MetaTrader "+a);f=h(f,"DD");f.innerHTML=TradingAccounts.FormatMoney(g.stat_equity);f=h(f,"DD");f.innerHTML=TradingAccounts.FormatMoney(g.stat_profit);f=h(f,"DD");f.innerHTML=(isNaN(g.stat_load)?0:g.stat_load)+"%";f=h(f,"DD");f.innerHTML=g.stat_currency;f=h(f,"A");f.setAttribute("onclick","TradingAccounts.DropAccount("+m+");");f=h(f,"DIV");f.setAttribute("id","accFieldDelete"+m);f=h(f,"BUTTON");f.setAttribute("onclick","TradingAccounts.DropAccountConfirm("+[m,a,"'"+g.login+"'","'"+g.server_name+"'"].join(",")+");");f=h(f,"BUTTON");f.setAttribute("onclick","TradingAccounts.DropAccountCancel("+m+");");p.push(e);c.insertBefore(n,t);var q=false;for(var l=0;l<s.length;l++){if(s[l]==a+";"+g.server_name){q=true;break}}if(!q){s.push(a+";"+g.server_name)}}TradingAccounts.accounts_base=o;if(s.length==0){return}var d=window.document.forms.tradeAccountsDetailsQuery;if(!d||!d.query){return}d.query.value=JSON.stringify(s);Ajax.form(d,{onready:TradingAccounts.ApplyAccountsDetails})};this.ApplyAccountsDetails=function(e){var d=JSON.parse(e);if(!d||!d.length){return}if(!TradingAccounts.accounts_base||!TradingAccounts.accounts_base.length){return}for(var c=0;c<d.length;c++){var g=d[c];for(var b=0;b<TradingAccounts.accounts_base.length;b++){var f=TradingAccounts.accounts_base[b];if(f.server_type==g.mt&&f.server_name==g.server){var h=$("accFieldLogo"+f.tile);h.setAttribute("src",g.logo);var a=$("accFieldCompany"+f.tile);a.innerHTML=g.company}}}};this.AddAccount=function(){TradingAccounts.AddAccountCancel();var d=$("accNewTile");if(!d){return}var c=$("mtversion");var a=$("accountlogin");var b=$("broker");a.value="";if(TradingAccounts.editableMt){window.mtversionSelectValue("4");c.value="4"}if(TradingAccounts.editableBroker){b.value=""}d.className="tile edit";a.focus()};this.AddAccountCancel=function(){var a=$("accNewTile");if(!a){return}a.className="tile add";window.Validate.ClearMessage($("validate_accountlogin"));$("accountlogin").parentNode.className="inputWrapper";if(TradingAccounts.editableMt){window.Validate.ClearMessage($("validate_mtversion"))}if(TradingAccounts.editableBroker){window.Validate.ClearMessage($("validate_broker"));$("broker").parentNode.className="inputWrapper"}};this.AddAccountConfirm=function(a){if(!a){return}var b=$("accNewTile");if(!b){return}var c={server_type:$("mtversion").value,login:$("accountlogin").value,server_name:$("broker").value};if(TradingAccounts.ValidateForDuplicateAccount($("accountlogin"))){TradingAccounts.accounts_base.push(c);TradingAccounts.AddAccountPlain(TradingAccounts.childHost,c)}};this.ValidateForDuplicateAccount=function(c){if(!TradingAccounts.accounts_base||TradingAccounts.accounts_base.length==0){return true}var b=c.value;c=TradingAccounts.SearchNextNode(c,"INPUT");var a=c.value;c=TradingAccounts.SearchNextNode(c,"INPUT");var f=c.value;for(var d=0;d<TradingAccounts.accounts_base.length;d++){var e=TradingAccounts.accounts_base[d];if(e.server_type==a&&e.login==b&&e.server_name==f){return false}}return true};this.AddAccountLine=function(c,a){var b={command:"add_encrypted_line",data:{line:a}};window.frames.webTerminalHost.postMessage(JSON.stringify(b),c)};this.AddAccountPlain=function(b,c){var a={command:"add_line",data:{login:c.login,server:c.server_name,type:c.server_type}};window.frames.webTerminalHost.postMessage(JSON.stringify(a),b)};this.DropAccount=function(b){var a=$("accFieldDelete"+b);if(a){a.className="deleteOverlay on"}};this.DropAccountConfirm=function(f,b,a,h){var e={command:"remove_line",data:{login:a,server:h,type:b}};window.frames.webTerminalHost.postMessage(JSON.stringify(e),TradingAccounts.childHost);for(var c=0;c<TradingAccounts.accounts_base.length;c++){var g=TradingAccounts.accounts_base[c];if(g.server_type==b&&g.login==a&&g.server_name==h){TradingAccounts.accounts_base.splice(c,1);break}}var d=$("accTile"+f);if(d&&d.parentNode){d.parentNode.removeChild(d)}};this.DropAccountCancel=function(b){var a=$("accFieldDelete"+b);if(a){a.className="deleteOverlay"}};this.FormatMoney=function(b){if(b==0){return"0"}if(b<=995){return b.toFixed(0)}if(b<=1050){return"1K"}var a;if(b<=9950){a=b%1000;return(b/1000).toFixed(a<50||a>950?0:1)+"K"}if(b<=999500){return(b/1000).toFixed(0)+"K"}if(b<=1050*1000){return"1M"}if(b<=9950*1000){a=b%(1000*1000);return(b/(1000*1000)).toFixed(a<50*1000||a>950*1000?0:1)+"M"}return(b/(1000*1000)).toFixed(0)+"M"}}var TradingAccounts=new TradingAccounts();var VirtualHosting=function(){var vpsMap=null,vpsMapTile=null,layers=[],brokerSearchForm,brokerServerName,brokerServerPlatform,brokerSearchMessage;function getTopServers(brokerServerName,mtVersion,callback){window.Ajax.post("/api/vhost/hostservers/top",{brokerServerName:brokerServerName,additional:"geoinfo",mt:mtVersion},false,{onready:function(result){brokerSearchForm.className="";var jsonList=window.JSON?window.JSON.parse(result):eval("("+result+")");if(jsonList!=null){callback(jsonList)}else{brokerSearchMessage.style.display="block";brokerSearchMessage.innerHTML=window.vpsNotFound}},onerror:function(){brokerSearchMessage.style.display="block";brokerSearchMessage.innerHTML=window.vpsNotFound;brokerSearchForm.className=""}})}function getBrokersServers(mtVersion,callback){window.Ajax.post("/en/vps/brokersservers/json",{mt:mtVersion},false,{onready:function(result){brokerSearchForm.className="";var jsonList=eval("("+result+")");if(jsonList!=null){callback(jsonList)}else{brokerSearchMessage.style.display="block";brokerSearchMessage.innerHTML=window.vpsNotFound}},onerror:function(){brokerSearchMessage.style.display="block";brokerSearchMessage.innerHTML=window.vpsNotFound;brokerSearchForm.className=""}})}function initAutocomplete(){var autocomplete=new window.MQAutoComplete();autocomplete.id="brokerServerName";autocomplete.loadItemValue=function(link){if(!link){return null}var mt=link.mt||link.getAttribute("mt");$("brokerServerPlatform").value=mt;var value=link.server||link.Server||link.getAttribute("server")||link.getAttribute("Server");return value};autocomplete.loadResultValue=function(item){return item.server||item.Server};autocomplete.bindResult=function(link,item){if(!(item.broker||item.Broker)||(item.broker||item.Broker)===""){link.innerHTML=window.vpsBrokersListMoreAvailable;link.className="more";return}link.innerHTML="<em>"+(item.broker||item.Broker)+"</em>"+(item.server||item.Server);link.broker=(item.broker||item.Broker);link.server=(item.server||item.Server);link.mt=(item.mt||item.MT);link.setAttribute("server",(item.server||item.Server));link.setAttribute("broker",(item.broker||item.Broker));link.setAttribute("mt",(item.mt||item.MT));link.onclick=function(){VirtualHosting.ShowVps(item.server||item.Server,item.mt||item.MT);return false};if(item.mt){link.innerHTML+="<strong>MT"+item.mt+"</strong>"}};autocomplete.onTyping=function(field){brokerSearchMessage.style.display="none"};autocomplete.onPopup=function(field,dropdown){brokerSearchMessage.style.display="none";var tabsContainer=document.getElementById("control-panel-tabs");var tabsHeader=document.getElementById("control-panel-tab-menu");if(!tabsContainer||!tabsHeader){return}tabsContainer.appendChild(dropdown);dropdown.style.left=field.offsetLeft+field.scrollLeft-1+"px";dropdown.style.top=field.offsetTop+field.scrollTop+tabsHeader.clientHeight+22+"px"};autocomplete.buildAjaxQueryUrl=function(){return"vps/brokers/json"};autocomplete.init()}function showStatisticsOnZoom(jsonList){for(var i in layers){vpsMap.removeLayer(layers[i])}var currentZoomLevel=vpsMap.getZoom();var maxType=0;var radius=0;switch(currentZoomLevel){case 0:case 1:case 2:maxType=0;radius=1000000*1.1;break;case 3:maxType=1;radius=400000;break;default:maxType=2;radius=200000;break}L.Circle.include({_getLngRadius:function(){return this._getLatRadius()}});for(var i in jsonList){var jsonItem=jsonList[i];if(jsonItem.Type>maxType){continue}var brokerServerPointPosition=[jsonItem.X,jsonItem.Y];var circle=L.circle(brokerServerPointPosition,radius,{clickable:false,color:"transparent",fillColor:"#099FE5",fillOpacity:0.3});circle.addTo(vpsMap);layers.push(circle)}}this.Init=function(){var map=$("map");var windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var mapOffsetTop=map.getBoundingClientRect().top-document.body.getBoundingClientRect().top;var mapHeight=windowHeight-mapOffsetTop;if(mapHeight<400){mapHeight=400}map.style.height=mapHeight+"px";if(!window.vpsBrokersStatisticsJson){brokerSearchForm=$("brokerSearchForm"),brokerServerName=$("brokerServerName"),brokerServerPlatform=$("brokerServerPlatform"),brokerSearchMessage=$("brokerSearchMessage");brokerSearchForm.onsubmit=function(){VirtualHosting.ShowVps(brokerServerName.value,brokerServerPlatform.value);return false};initAutocomplete();if(window.vpsBrokerServerRealName!==""){VirtualHosting.ShowVps(window.vpsBrokerServerRealName,4)}else{VirtualHosting.ShowUser()}}};this.ShowMap=function(){vpsMap=window.L.map("map",{center:[50,0],zoom:3,minZoom:2,maxZoom:11,maxBounds:[[-90,-180],[90,200]],zoomControl:!window.vpsIsMobile,closePopupOnClick:false});vpsMapTile=window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(vpsMap)};this.ShowUser=function(){VirtualHosting.ShowMap();if(!window.vpsUserPosIsEmpty){var pointIcon=window.L.divIcon({className:"point user",html:'<div class="tooltip">'+window.vpsUserCity+"</div>"});window.L.marker(window.vpsUserPos,{icon:pointIcon,clickable:false}).addTo(vpsMap);vpsMap.fitBounds([window.vpsUserPos,window.vpsUserPos],{padding:[200,200]})}};this.ShowVps=function(brokerServerName,mtVersion){var userPointPosition=window.L.latLng(window.vpsUserGeoPositionLatitude,window.vpsUserGeoPositionLongitude);brokerSearchMessage.style.display="none";brokerSearchForm.className="processing";getTopServers(brokerServerName,mtVersion,function(jsonList){$("vpsMapContainer").className="mapContainer";if($("vpsAdvantages")){$("vpsAdvantages").style.display="none"}var json=jsonList.host_servers[jsonList.host_servers.length-1];var brokerPointPosition=[json.broker_latitude,json.broker_longitude];var brokerPointName=json.broker_server_name;var vpsPointPosition=[json.host_server_latitude,json.host_server_longitude];var vpsCountry=json.public_name;var vpsPing=(json.best_ping/1000).toFixed(2);if(vpsMap!==null){vpsMap.remove()}VirtualHosting.ShowMap();if(!window.vpsUserPosIsEmpty){var pointIcon=window.L.divIcon({className:"point user",html:'<div class="tooltip">'+window.vpsUserCity+"</div>"});window.L.marker(window.vpsUserPos,{icon:pointIcon,clickable:false}).addTo(vpsMap)}var iconBroker=window.L.divIcon({className:"point broker",html:'<div class="tooltip">'+brokerPointName+"</div>"});window.L.marker(brokerPointPosition,{icon:iconBroker,clickable:false}).addTo(vpsMap);var vpsIsAbove=vpsPointPosition[0]>brokerPointPosition[0];var infoMessageHtml='<div class="baloon '+(vpsIsAbove?"above":"below")+'"><h1>'+window.vpsInfoPing.replace("%d",vpsPing)+", "+vpsCountry+"</h1><p>"+window.vpsInfoDescription.replace("%d",vpsPing)+'</p><a href="/'+window.vpsUserLanguage+'/vps/tutorial" class="button">'+window.vpsInfoButton+"</a></div>";var iconVps=window.L.divIcon({className:"point vps",html:infoMessageHtml});window.L.marker(vpsPointPosition,{icon:iconVps,clickable:false}).addTo(vpsMap);if(!window.vpsUserPosIsEmpty&&userPointPosition!=null){window.L.polyline([userPointPosition,brokerPointPosition],{color:"#9F9F9E",weight:5,clickable:false}).addTo(vpsMap);window.L.polylineDecorator([userPointPosition,brokerPointPosition],{patterns:[{offset:"50%",symbol:window.L.Symbol.arrowHead({pixelSize:12,polygon:false,pathOptions:{fillOpacity:1,stroke:true,color:"#9F9F9E",weight:5,clickable:false}})}]}).addTo(vpsMap)}if(vpsPointPosition!==brokerPointPosition){window.L.polyline([vpsPointPosition,brokerPointPosition],{color:"#3AA93A",weight:5,clickable:false}).addTo(vpsMap);window.L.polylineDecorator([vpsPointPosition,brokerPointPosition],{patterns:[{offset:"50%",symbol:window.L.Symbol.arrowHead({pixelSize:12,polygon:false,pathOptions:{fillOpacity:1,stroke:true,color:"#3AA93A",weight:5,clickable:false}})}]}).addTo(vpsMap)}if(!window.vpsUserPosIsEmpty){vpsMap.fitBounds([vpsPointPosition,brokerPointPosition,userPointPosition],{padding:[200,200]})}else{vpsMap.fitBounds([vpsPointPosition,brokerPointPosition],{padding:[200,200]})}})};this.ShowStatistics=function(jsonList){VirtualHosting.ShowMap();vpsMap.on("zoomend",function(e){showStatisticsOnZoom(jsonList)});vpsMap.setZoom(2)}};var VirtualHosting=new VirtualHosting();window.opener=null;(function(){var a=0;var c;function n(w){var x=w.previousSibling;while(x&&x.nodeType!=1){x=x.previousSibling}return x}function q(w){return w.replace(/(^[ \r\n\t]+|[ \r\n\t]+$)/g,"")}function f(w){return !MQTE.IsEmpty(w.name)}function u(w){var x;if(!(x=w.value)||!(/^[0-9]+(\.|,)?[0-9]*$/.test(x))){return false}return true}function h(w){var x;if((x=w.value)&&(!/^\w+([-+.'']{1,2}\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i.test(x)||x.length>=255)){return false}return true}function g(A,z,y){var x=A.value,w=z.value;if(y){x=x.toLowerCase();w=w.toLowerCase()}return(x==w)}function v(x,z,w){var y=new RegExp(z,w);return y.test(x.value)}function l(w){var y=w.value;function x(C,B,F){var E=0;for(var D=0;D<F;++D){var A=y.charAt(D),z=C[D];(A)&&(A=parseInt(A));E+=A*z}if(E==0){return false}E%=11;if(E>9){E%=10}return(E==B)}if(y.length==10){return x([2,4,10,3,5,9,4,6,8],parseInt(y.charAt(y.length-1)),9)}else{if(y.length==12){if(!x([7,2,4,10,3,5,9,4,6,8],parseInt(y.charAt(y.length-2)),10)){return false}if(!x([3,7,2,4,10,3,5,9,4,6,8],parseInt(y.charAt(y.length-1)),11)){return false}return true}}return false}function p(w){if(!w.value){return true}return/^((http|https):\/\/)?([a-z0-9\-]+\.)+[a-z]+(:\d+)?(\/[\w-_ .\/%]*)?(\/)?(\?[\w=%&]+)?$/i.test(w.value)}function o(w){if(!w.value){return true}return/\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/i.test(w.value)}function e(w){for(i=0,sz=w.length;i<sz;i++){if(w[i].checked){return true}}return false}function t(w){return parseInt(w.value,10)==w.value}function m(w){if(!w.value){return true}var y=false;if(window.XMLHttpRequest){y=new XMLHttpRequest()}else{if(window.ActiveXObject){y=new ActiveXObject("Microsoft.XMLHTTP")}}if(!y){return true}var x=Math.floor((Math.random()*10000)+1);y.open("get","/api/website/status?r="+x,false);if(y.timeout){y.timeout=2000}y.send();return y.readyState==4&&y.status==200&&y.responseText.indexOf("STATUS_OK")>=0}function k(x,z){var A=1;var w=n(x);if(c){c.style.display="block";return true}if(!w||w.className!="field-validation-error"||w.nodeName!="SPAN"){var y=document.createElement("span");y.innerHTML=z;y.className="field-validation-error";x.parentNode.insertBefore(y,x);x.parentNode.insertBefore(document.createTextNode("\n"),y)}else{w.innerHTML=z}}function s(x){var w=n(x);if(w&&w.className=="field-validation-error"){w.innerHTML=""}}function j(x,w){var B=x.parentNode;while(B){if(w){if(B.className=="dalet-editor"){B.className="dalet-editor field-validation-error";break}}else{if(B.className){if(B.className.indexOf("field-validation-error")!=-1){var z=B.className.split(" "),A=[];for(var y in z){if(z[y]!="field-validation-error"){A.push(z[y])}}B.className=A.join(" ");break}}}B=B.parentNode}}function r(x,w){if(!window.SmallRTE){return}var B=SmallRTE.GetEditor(x.id||x.name);if(!B){return}if(w){if(B.className=="smallEditor"){B.className="smallEditor field-validation-error";return}}else{if(B.className){if(B.className.indexOf("field-validation-error")!=-1){var z=B.className.split(" "),A=[];for(var y in z){if(z[y]!="field-validation-error"){A.push(z[y])}}B.className=A.join(" ");return}}}}window.preventDoubleSubmit=function(w){w.onsubmit=function(){return false}};window.Validate=function(w){if(document.getElementById("validate_message")){c=document.getElementById("validate_message");c.style.display="none"}if(!window.V){var D="   ,     ";if(window.console){console.warn(D)}else{alert(D)}return false}var B=true,A,C,x={};++a;for(var J=0,H=V.length;J<H;++J){var E=true;if(C=w.elements[(A=V[J])[0]]){if(C.style&&C.style.display=="none"&&(!window.MQRTE||!MQRTE.Editor(A[0]))&&(!window.SmallRTE)){continue}var z=document.getElementById("validate_"+A[0]);if(C.type=="text"||C.nodeName=="TEXTAREA"){C.value=q(C.value)}switch(A[1]){case 1:E=f(C);break;case 2:var K;if(A[3]!==null){K=parseInt(A[3]);var M;(A[4]&&(M=A[4]));E=C.value.length>=K&&(!M||C.value.length<=M)}break;case 3:E=u(C);break;case 4:E=h(C);break;case 5:E=g(C,w.elements[A[3]],A[4]);if(!E){if(x[A[3]]){var N=document.getElementById("validate_"+A[3]);s(N);x[A[3]]=false}d(null,w.elements[A[3]],null)}break;case 6:E=v(C,A[3],A[4]);break;case 7:E=l(C);break;case 8:E=p(C);break;case 9:E=e(C);break;case 10:try{E=A[3](C)}catch(L){if(window.console){console.error(L.message)}}break;case 12:E=o(C);break;case 13:E=m(C);break;case 14:E=t(C);if(E){var F=parseInt(C.value),G=parseInt(A[3]),I=parseInt(A[4]);E=F<=I&&F>=G}break}if(!E&&C.iteration!=a){d(z,C,A[2]);B=false;x[A[0]]=false;C.iteration=a}else{if(x[A[0]]!==false){x[A[0]]=true}}}}if(!B){for(var O in x){if(x[O]){var z=document.getElementById("validate_"+O);b(z,w.elements[O])}}if(window.form_is_not_valid){form_is_not_valid(w)}}else{if(window.form_is_valid){form_is_valid(w)}}return B};function b(w,x){s(w);MQTE.SetValidationClass(x.name,false)}function d(x,A,z){MQTE.SetValidationClass(A.name,true);if(x){if(typeof(z)=="string"){k(x,z)}else{for(var y=0,w=z.length;y<w;++y){k(x,z[y])}}}}window.Validate.AppendMessage=k;window.Validate.ClearMessage=s;window.Validate.SetValid=function(B,C){var A,w,z,y,x;for(A=0,w=B.elements.length;A<w;++A){x=B.elements[A].name;y=document.getElementById("validate_"+x);if(!y){continue}if(!(z=C[x])){b(y,B.elements[A]);continue}d(y,B.elements[A],z)}}})();var lastCommand=null;function ViewSearchResults(d,b){if(SEARCH_PARAMS.keyword.length<3&&SEARCH_PARAMS.author.length<3){SEARCH_PARAMS.container.innerHTML='<span class="search_none_found">'+SEARCH_DICTIONARY.keyword_length+"</span>";ClearPaginators();return}var a=SEARCH_PARAMS.url+"?callback=RenderSearchResults&hl="+SEARCH_PARAMS.lng+SEARCH_PARAMS.module_params+("&keyword="+(SEARCH_PARAMS.keyword||""))+"&from="+d+"&count="+b+(SEARCH_PARAMS.author?("&author="+SEARCH_PARAMS.author):"")+(SEARCH_PARAMS.method>0?("&method="+SEARCH_PARAMS.method):"")+(SEARCH_PARAMS.dt_from>0?("&dt_from="+SEARCH_PARAMS.dt_from):"");a+="&t="+Math.random();var c=document.createElement("script");c.type="text/javascript";c.src=a;ProcessSearchScript(c,d,b)}function ProcessSearchScript(a,f,c){if(SEARCH_PARAMS.timeout_id==0){var e=SEARCH_PARAMS.container.clientHeight||SEARCH_PARAMS.container.offsetHeight;SEARCH_PARAMS.container.innerHTML="";ClearPaginators();var d=createElement(SEARCH_PARAMS.container,"span",{className:"search_none_found"});var b=createElement(d,"img",{src:"/i/loading.gif"});b.style.marginBottom="-3px";b.style.marginRight="5px";createElement(d,"span",{innerHTML:SEARCH_DICTIONARY.loading_results});SEARCH_PARAMS.results_loaded=false;a.onerror=CheckIfScriptLoaded;SEARCH_PARAMS.container.appendChild(a);SEARCH_PARAMS.next=f+c;SEARCH_PARAMS.current=f;SEARCH_PARAMS.prev=f>=c?f-c:0;SEARCH_PARAMS.isFirst=f==0;clearTimeout(SEARCH_PARAMS.timeout_id);SEARCH_PARAMS.timeout_id=setTimeout(CheckIfScriptLoaded,15000);lastCommand=null}else{lastCommand=[a,f,c]}}function CheckLastCommand(){if(lastCommand){ProcessSearchScript(lastCommand[0],lastCommand[1],lastCommand[2])}}window.RenderSearchResults=function(resObject){clearTimeout(SEARCH_PARAMS.timeout_id);SEARCH_PARAMS.timeout_id=0;SEARCH_PARAMS.results_loaded=true;var resArray=resObject.results;var k=SEARCH_PARAMS.current+1;SEARCH_PARAMS.isLast=(SEARCH_PARAMS.from+SEARCH_PARAMS.count)<=resObject.total;SEARCH_PARAMS.container.innerHTML="";if(resArray.length==0){SEARCH_PARAMS.container.innerHTML='<span class="search_none_found">'+SEARCH_DICTIONARY.found_none+"</span>"}var maxPageNumber=SEARCH_PARAMS.current+resArray.length;var resultsMargin=(maxPageNumber+"").length*12+5;for(var i=0;i<resArray.length&&i<SEARCH_PARAMS.count;i++){var item=resArray[i];if(!item){continue}var user=(item.info.author_login&&item.info.author_login!="[deleted]"&&item.info.author_login!="")?" | <a href='https://www."+SEARCH_PARAMS.target_site+"/"+SEARCH_PARAMS.lng+"/users/"+item.info.author_login.toLowerCase()+"' title='"+item.info.author_login+"'>"+item.info.author_name+"</a>":"";var result_item=createElement(SEARCH_PARAMS.container,"div",{className:"search_result"});var title=createElement(result_item,"span",{className:"title"});createElement(title,"a",{href:item.info.url,innerHTML:encodeHtml(item.info.title),target:resArray[i].module.split(".")[0]!="mql5"?"_blank":"_self"});var date=GetDateTime(item.date);var text=createElement(result_item,"div",{className:"text"});if(item.info.avatar60x60&&item.info.avatar60x60.length){var avatar=createElement(text,"span",{className:"search_result_logo"});var frame=createElement(avatar,"a",{className:"frame",href:item.info.url});var bg=createElement(frame,"span",{className:"bg"});var src=item.info.avatar60x60.indexOf("/")==0?("https://c.mql5.com"+item.info.avatar60x60):item.info.avatar60x60;createElement(bg,"img",{src:src,width:60,height:60,alt:encodeHtml(item.info.title),title:encodeHtml(item.info.title)});avatar.style.cssFloat="left"}if(item.info.avatar110x140&&item.info.avatar110x140.length){var avatar=createElement(text,"span",{className:"search_result_logo"});var src=item.info.avatar110x140.indexOf("/")==0?("https://c.mql5.com"+item.info.avatar110x140):item.info.avatar110x140;var width=60;var height=(140*60/110)|0;createElement(avatar,"img",{src:src,width:width,height:height,alt:encodeHtml(item.info.title),title:encodeHtml(item.info.title)});avatar.style.cssFloat="left"}text.innerHTML+=(encodeHtml(item.text));var info=createElement(result_item,"span",{className:"user_info",innerHTML:(SEARCH_DICTIONARY["module_"+resArray[i].module.split(".")[3]]||SEARCH_DICTIONARY.module_empty)+" | "+date+user});if(item.info.review_rating){info.innerHTML+=" | ";info.innerHTML+='<div class="rating small" style="margin-top:5px;margin-bottom:-1px;"><div class="v'+item.info.review_rating+'0" style="margin:0;"></div><meta content="'+item.info.review_rating+'" itemprop="reviewRating"></div>'}if(item.info.category){info.innerHTML+=" | ";info.innerHTML+=item.info.category}if(item.info.platform&&(item.info.platform!=item.info.category)){info.innerHTML+=" | ";info.innerHTML+=item.info.platform}if(item.info.files_info){var attaches=eval(item.info.files_info);if(attaches&&attaches.length&&attaches.length>0){info.innerHTML+=" | ";var attachesContainer=createElement(info,"span",{className:"attachments searchAttachments",id:"attaches_container_"+item.id});RenderAttaches(attachesContainer,attachesContainer,attaches,item.id)}}if(item.info.price){info.innerHTML+=" | ";info.innerHTML+=item.info.price!="0.00"?(item.info.price+" "+SEARCH_DICTIONARY.of_credits):SEARCH_DICTIONARY.price_free}if(item.info.user_company){info.innerHTML+=" | ";if(item.info.user_company_position){info.innerHTML+=(encodeHtml(item.info.user_company_position))+" "+SEARCH_DICTIONARY.at+" "}info.innerHTML+=(encodeHtml(item.info.user_company))}if(item.info.user_country){info.innerHTML+=" | "+(encodeHtml(item.info.user_country))}if(i==resArray.length-1||i==SEARCH_PARAMS.count-1){result_item.className+=" last"}k++}if(SEARCH_PARAMS.scrollBottom==true){window.scrollTo(0,100500);SEARCH_PARAMS.scrollBottom=null}RenderSearchPaginator(resArray.length,resObject.total,$("paginator_block_top"),false);RenderSearchPaginator(resArray.length,resObject.total,$("paginator_block_bottom"),true);CheckLastCommand()};function RenderAttaches(c,i,e,j){var d={id:"attaches_link_"+j,href:"#",className:"attachesLink poppedUp",onclick:function(){ToggleAttaches(j);return false},innerHTML:SEARCH_DICTIONARY.files+" ("+e.length+")<small>&#x25BC;</small>"};var b=createElement(i,"a",d);var a=createElement(c,"div",{id:("attaches_"+j)});a.style.display="none";for(var h=0;h<e.length;h++){var g=e[h];var f=createElement(a,"div",{className:"attachItem"});createElement(f,"a",{href:g.url,innerHTML:g.name,className:g.ext});createElement(f,"span",{className:"attachSize",innerHTML:("("+g.size_KB+")")})}}function ToggleAttaches(b){var e=$("attaches_"+b);if(!e){return}var d=e.style.display=="none";var c=$("attaches_link_"+b);if(!c){return}var a=$("attaches_container_"+b);if(!a){return}a.className=d?"attachments searchAttachments opened":"attachments searchAttachments";c.className=d?"attachesLink":"poppedUp attachesLink";e.style.display=d?"block":"none"}function CheckIfScriptLoaded(){if(!SEARCH_PARAMS.results_loaded){SEARCH_PARAMS.container.innerHTML='<span class="search_none_found">'+SEARCH_DICTIONARY.error_loading+"</span>"}SEARCH_PARAMS.timeout_id=0;CheckLastCommand()}function ClearPaginators(){$("paginator_block_bottom").innerHTML="";$("paginator_block_top").innerHTML=""}function RenderSearchPaginator(b,j,c,d){if(!c){return}c.innerHTML="";var a=Math.round(j/SEARCH_PARAMS.count);var h=(SEARCH_PARAMS.current/SEARCH_PARAMS.count)+1;var e=(h>(a-7)|h<7)?6:4;if(a<=1){c.style.display="none";return}setHotKeysPaginator("",h>1?("javascript:GoToSearchPage("+(h-1)+","+false+")"):"javascript:void()",h<a?("javascript:GoToSearchPage("+(h+1)+","+false+")"):"javascript:void()");c.style.display="block";var g=createElement(c,"a",{innerHTML:"1",className:"search_paginator_page",href:"javascript:GoToSearchPage(1,"+d+")"});if(SEARCH_PARAMS.isFirst){g.className+=" current"}if(h>=7){hidden_page_num=Math.round((h-e+1)/2);g=createElement(c,"a",{innerHTML:"...",className:"search_paginator_page dots",href:"javascript:GoToSearchPage("+hidden_page_num+","+d+")"})}for(var f=h-e;f<=h+e&&f<=a;f++){if(f<2||f>a){continue}g=createElement(c,"a",{innerHTML:f,className:"search_paginator_page",href:"javascript:GoToSearchPage("+f+","+d+")"});if(f==h){g.className+=" current"}}if(h<=(a-7)){hidden_page_num=Math.round((a+h+e)/2);g=createElement(c,"a",{innerHTML:"...",className:"search_paginator_page dots",href:"javascript:GoToSearchPage("+hidden_page_num+","+d+")"});g=createElement(c,"a",{innerHTML:a,className:"search_paginator_page",href:"javascript:GoToSearchPage("+a+","+d+")"})}}function GoToSearchPage(b,a){elementFrom=(b-1)*SEARCH_PARAMS.count;window.hashParams.Set("page",b);ViewSearchResults(elementFrom,SEARCH_PARAMS.count);SEARCH_PARAMS.scrollBottom=a}function Suggestions(o,q,u,g){var d=q;var p=u;var l=$(o);if(!l||l.isSuggest){return}var c=g;var t=function(){if(c){c()}};if(!window.SuggestionControllers){window.SuggestionControllers=[]}var f=window.SuggestionControllers.length;window.SuggestionControllers[window.SuggestionControllers.length]=this;l.autocomplete="off";var i=l.value;var j;l.isSuggest=true;if(l.addEventListener){l.addEventListener("keypress",h,false);window.addEventListener("keypress",r,false);l.addEventListener("keyup",a,false);l.addEventListener("blur",n,false)}else{l.attachEvent("onkeypress",h);window.attachEvent("onkeypress",r);l.attachEvent("onkeyup",a);l.attachEvent("onblur",n)}function n(v){setTimeout(function(){k()},10)}function r(v){v=v||window.event;if(v.keyCode==27){l.focus();l.select()}}function h(v){v=v||window.event;if(v.keyCode==27){k();return false}return true}function e(){var v=document.createElement("script");v.type="text/javascript";v.src=d+"?keyword="+encodeURIComponent(i)+"&hl="+p+"&callback=window.SuggestionControllers["+f+"].RenderSuggestions";l.parentNode.appendChild(v)}function a(v){v=v||window.event;if(v.keyCode==38||v.keyCode==40||v.keyCode==39){return s(v.keyCode)}if(v.keyCode==13){return}if(i==l.value){return}i=l.value;k();if(!i){return}e()}function s(x){if(!j){if(x==40&&i.length>0){e()}return}var v=j.getElementsByTagName("tr");if(x==40){j.selectedSuggestIndex=(j.selectedSuggestIndex||j.selectedSuggestIndex==0)?(j.selectedSuggestIndex+1):0;if(j.selectedSuggestIndex>=v.length){j.selectedSuggestIndex=0}}if(x==38){j.selectedSuggestIndex=j.selectedSuggestIndex?(j.selectedSuggestIndex-1):(v.length-1);if(j.selectedSuggestIndex<0){j.selectedSuggestIndex=(v.length-1)}}for(var w=0;w<v.length;w++){Class(v[w],"selected",w!=j.selectedSuggestIndex);if(w==j.selectedSuggestIndex){l.value=v[w].firstChild.suggestValue}}}function k(v){if(v){i=v;l.value=v}if(j&&j.parentNode){j.parentNode.removeChild(j)}j=null}function m(x){k();if(!x[1]||!x[1].length){return}j=createElement(null,"table",{className:"suggestionsTable",cellPadding:0,cellSpacing:0});for(var w=0;w<x[1].length;w++){j.appendChild(b(x[1][w][0],i))}var v=getElementSize(l.parentNode);j.style.width=v.width+2+"px";var y=getOffsetSum(l.parentNode);j.style.top=y.top+v.height+1+"px";j.style.left=y.left+"px";document.body.appendChild(j)}function b(A,z){var C=A;z=z?z.fulltrim():null;var D=createElement(null,"tr");var y=C.indexOf(z);var v=y>=0?C.substring(y,z.length):"";var w=y>=0?C.substring(0,y):"";var B=y>=0?C.substring(y+z.length):C;var x=createElement(D,"td",{innerHTML:(w+"<span class='highlighted'>"+v+"</span>"+B),suggestValue:A});if(x.addEventListener){x.addEventListener("mousedown",function(){k(A);t()},false)}else{x.attachEvent("onmousedown",function(){k(A);t()})}return D}this.HideSuggests=function(){k()};this.RenderSuggestions=function(v){return m(v)}};function ChatComments(){var profileOwner="";var textAreaBaseHeight=0;var loaded=0;var attachedFilesHeader="";var totalCount=0;var countOnPage=0;var loadCommentsUrlStart="";var loadMoreLabel="";var deleteCommentLabel="delete";var deleteCommentAtten="Are you sure delete coment?";var deleteCommentUrlStart="";function getNextCount(){var nextCount=Math.min(countOnPage,totalCount-loaded);if(totalCount-loaded<2*countOnPage){nextCount=totalCount-loaded}return nextCount}function setLoaded(value){loaded=value;var nextCount=getNextCount();$("loadCommentsButton").innerHTML=loadMoreLabel+" "+nextCount;if(loaded>=totalCount){$("loadCommentsContainer").style.display="none"}}function showLoader(){var button=$("loadCommentsButton");Class(button,"loading");button.innerHTML=""}function hideLoader(){var button=$("loadCommentsButton");Class(button,"loading",true)}function onCommentsLoadError(data){hideLoader()}function onCommentsLoaded(data){if(!data||data.length==0){return onerror()}var resObj;try{resObj=window.JSON?window.JSON.parse(data):eval("("+data+")")}catch(ex){return onCommentsLoadError()}if((totalCount-this.from)<loaded){return}var docFragment=document.createElement("DIV");for(var i=0;i<resObj.length;i++){var comment=CreateCommentElement(resObj[i],docFragment);docFragment.appendChild(comment)}var container=$("commentsContainer");var oldHeight=container.offsetHeight;var statusContainer=$("loadCommentsContainer");var statusHeight=0;if(statusContainer){statusHeight=statusContainer.offsetHeight}setOpacity(docFragment,0);prependElement(container,docFragment);fade(docFragment,"out",500,20);setLoaded(loaded+docFragment.children.length);var heightDelta=container.offsetHeight-oldHeight;var scroll=getWindowScroll();window.scrollTo(scroll.left,scroll.top+heightDelta-(statusHeight-(statusContainer?statusContainer.offsetHeight:0)))}function loadComments(from,count){Ajax.get(loadCommentsUrlStart+from+"/"+count,null,{onready:onCommentsLoaded,onerror:onCommentsLoadError,from:from,count:count})}this.OnMessageAdded=function(){};this.LoadMore=function(){var from=Math.max(0,totalCount-countOnPage-loaded);if(from<countOnPage){from=0}var count=getNextCount();loadComments(from,count)};this.CheckContentLength=function(){var replyButton=$("replyButton");if(replyButton){if($("content").value.length==0){replyButton.disabled="disabled"}else{replyButton.disabled=null}}};this.OnAddMessageSuccess=function(data){if(!data||data.length==0){return this.onerror()}data=stripHtml(data);var resObj;try{resObj=window.JSON?window.JSON.parse(data):eval("("+data+")")}catch(ex){alert(data.trim());return this.onerror()}var container=$("commentsContainer");for(var i=0;i<resObj.length;i++){var commentElement=CreateCommentElement(resObj[i]);var old=$(commentElement.id);if(old){old.parentNode.insertBefore(commentElement,old);old.parentNode.removeChild(old)}else{container.appendChild(commentElement)}if(chatComments.OnMessageAdded){chatComments.OnMessageAdded(resObj[i])}}Validate.SetValid($("replyMessageForm"),[]);Attach.clearAttaches()};this.OnAddMessageError=function(data){};this.OnBeginRequest=function(sender,callback){var replyButton=$("replyButton");if(replyButton){replyButton.disabled="disabled"}chatComments.ShowAddMessageLoading();setTimeout(function(){MQTE.Clear("content")},10)};this.OnEndRequest=function(callback,text,xml,status,headers){var replyButton=$("replyButton");if(replyButton){replyButton.disabled=null}chatComments.HideAddMessageLoading()};this.ShowAddMessageLoading=function(){Class($("loadingIndicator"),"loading",false)};this.HideAddMessageLoading=function(){Class($("loadingIndicator"),"loading",true)};this.Init=function(loaded_count,attachments_header,total_count,count_on_page,load_comments_url_start,load_more_lebel,profile_owner,delete_comment_label,delete_comment_atten,delete_comment_url){loaded=loaded_count||0;attachedFilesHeader=attachments_header||"";totalCount=total_count;countOnPage=count_on_page;loadCommentsUrlStart=load_comments_url_start;loadMoreLabel=load_more_lebel;profileOwner=profile_owner;deleteCommentLabel=delete_comment_label;deleteCommentAtten=delete_comment_atten;deleteCommentUrlStart=delete_comment_url;if(!$("replyMessageForm")){return}};var extensions=["gif","jpeg","jpg","mq4","mq5","ex4","ex5","png","rar","txt","zip","mqh","mt5"];var CreateCommentAttachmentsElement=function(comment,cont_wrapper){if(!comment.attachments||comment.attachments.length==0){return}var existingAttcs=getElementsByClass("attach",cont_wrapper);var attc;var attc2;if(!existingAttcs||existingAttcs.length==0){attc=createElement(cont_wrapper,"DIV",{className:"attach"});attc.style.clear="both";attc2=createElement(attc,"DIV",{className:"attachBlock",id:"cb_"+comment.id});var att_head=createElement(attc2,"STRONG",{innerHTML:attachedFilesHeader})}else{attc=existingAttcs[0];attc2=getElementsByClass("attachBlock",attc)}for(var i=0;i<comment.attachments.length;i++){var attachment=comment.attachments[i];var att_item=createElement(attc2,"DIV",{className:"attachItem"});var extension=getFileExtension(attachment.name,true);if(extension&&extensions.indexOf(extension)>=0){}else{extension="unk"}createElement(att_item,"A",{className:extension+" ssl_ext",target:"_blank",href:attachment.url,innerHTML:attachment.name});createElement(att_item,"SPAN",{className:"attachSize",innerHTML:" ("+attachment.size_text+")"});if(["jpg","gif","png","jpeg"].indexOf(extension)>=0){var preview=createElement(att_item,"DIV",{className:"attachPreview"});var preview_wrapper=createElement(preview,"A",{target:"_blank",href:attachment.url});var preview_image=createElement(preview_wrapper,"IMG",{src:attachment.url,height:80})}}createElement(cont_wrapper.parentNode,"DIV",{className:"clear-fix"})};var CreateAttachedCommentElement=function(comment,parentElement){var commentsElements=getElementsByClass("chatComment",parentElement);var commentToAttach;var id="comment_"+comment.parent_id+"_"+comment.id;for(var i=0;i<commentsElements.length;i++){if(commentsElements[i].id.length>=id.length&&commentsElements[i].id>id||!commentsElements[i].id){break}commentToAttach=commentsElements[i]}if(!commentToAttach){comment.is_attached=false;return CreateCommentElement(comment)}var textElement=getElementsByClass("chatCommentContent",commentToAttach)[0];var dateElement=getElementsByClass("chatCommentDate",commentToAttach)[0];var wrapper=getElementsByClass("chatCommentContentWrapper",commentToAttach)[0];if(!textElement||!dateElement){return commentToAttach}CreateCommentAttachmentsElement(comment,wrapper);textElement.innerHTML+="<br>"+comment.content;var dateInput=dateElement.getElementsByTagName("input")[0];var dateValue=getElementsByClass("chatCommentDateValue",dateElement)[0];dateValue.innerHTML=comment.date_text;dateValue.title=GetDateTime(comment.date);dateInput.value=comment.date;var elementID=commentToAttach.id;commentToAttach.parentNode.removeChild(commentToAttach);commentToAttach.id=elementID;return commentToAttach};var CreateCommonCommentElement=function(comment){var authorNameLabel=comment.author_login==comment.author_name||comment.author_name.length==0?comment.author_login:(comment.author_name+" ("+comment.author_login+")");var cnt=createElement(null,"DIV",{id:"comment_"+comment.parent_id+"_"+comment.id,className:"chatComment"+(comment.is_system?(" systemComment"):"")});var avatar_cnt=createElement(cnt,"DIV",{className:"user"});var avatar_frame=createElement(avatar_cnt,"DIV",{className:"frame x48"});var avatar_bg=createElement(avatar_frame,"DIV",{className:"bg"});var avatar_link=createElement(avatar_bg,"A",{title:authorNameLabel,href:comment.author_url});var avatar_img=createElement(avatar_link,"IMG",{width:"50",height:"50",title:authorNameLabel,alt:comment.author_login,src:comment.author_avatar});avatar_img.width=48;avatar_img.height=48;var cont_wrapper=createElement(cnt,"DIV",{className:"chatCommentContentWrapper"});var date=createElement(cont_wrapper,"SPAN",{className:"chatCommentDate"});var dateValue=createElement(date,"SPAN",{className:"chatCommentDateValue",title:GetDateTime(comment.date),innerHTML:comment.date_text});createElement(date,"INPUT",{value:comment.date,type:"hidden"});if(comment.can_delete){var delFocus=createElement(date,"INPUT",{className:"deleteCommentFocus",type:"text"});var del=createElement(date,"SPAN",{className:"deleteComment",innerHTML:deleteCommentLabel});del.onclick=function(){deleteComment(comment.id,comment.parent_id)};date.onclick=function(){delFocus.focus();delFocus.skipNextBlur=false;Class(date,"focused",false)};date.onmousedown=function(){delFocus.skipNextBlur=true};delFocus.onblur=function(){if(delFocus.skipNextBlur){delFocus.skipNextBlur=false;delFocus.focus();return}Class(date,"focused",true)}}var contentHTML=comment.content;if(comment.is_system){contentHTML=('<span class="systemTypeIco systemType'+comment.is_system+'"></span>')+contentHTML}var content=createElement(cont_wrapper,"DIV",{className:"chatCommentContent",id:"messageContent_"+comment.id,innerHTML:contentHTML});createElement(cnt,"DIV",{className:"boobleAngle"});CreateCommentAttachmentsElement(comment,cont_wrapper);return cnt};var CreateSystemCommentElement=function(comment){var cnt=createElement(null,"DIV",{id:"comment_"+comment.parent_id+"_"+comment.id,className:"chatComment systemChatComment"});var cont_wrapper=createElement(cnt,"DIV",{className:"chatCommentContentWrapper"});var date=createElement(cont_wrapper,"SPAN",{className:"chatCommentDate",title:GetDateTime(comment.date),innerHTML:comment.date_text});var content=createElement(cont_wrapper,"DIV",{className:"chatCommentContent",id:"messageContent_"+comment.id,innerHTML:comment.content});createElement(date,"INPUT",{value:comment.date,type:"hidden"});return cnt};function CreateCommentElement(comment,parentElement){var cnt;if(comment.is_attached>0){cnt=CreateAttachedCommentElement(comment,parentElement)}else{if(comment.author_id>0){cnt=CreateCommonCommentElement(comment)}else{cnt=CreateSystemCommentElement(comment)}}var owner=comment.author_login==profileOwner;if(owner){Class(cnt,"byOwner")}return cnt}function deleteComment(commentID,chatID){if(!confirm(deleteCommentAtten)){return}Ajax.get(deleteCommentUrlStart+commentID,null,{onready:function(data){if(!data||data.length==0){return this.onerror()}var resObj;try{resObj=window.JSON?window.JSON.parse(data):eval("("+data+")")}catch(ex){alert(stripHtml(data).trim());return this.onerror()}if(resObj.result==undefined||resObj.result!=0){return}var commentContainer=$("comment_"+chatID+"_"+commentID);if(commentContainer){disapearBlockVertical(commentContainer,true,200,20,0.7)}},onerror:function(){}})}this.CreateCommentElement=function(comment){return CreateCommentElement(comment)};this.SetProfileOwner=function(login){profileOwner=login}}var chatComments=new ChatComments();function chatWidget(user_id,user_login,language,localization,play_sounds,isExpanded,showExpiration){var userId=user_id,userLogin=user_login,lang=language;var currentChatListPage=0;var currentChatListPagesCount=0;var mainContainer;var innerContainer;var bottomContainer;var userSelector;var opened=false;var notifyMessagesLink=document.getElementById("notify_messages");var commentsList=null;var containerHeight=Math.max((getWindowSize().height/2)|0,305);var widgetWidth=305;var newChatIco,searchChatIco,returnToChatListIco,expandIco;var messagesUrl=("/"+lang+"/users/"+userLogin.toLowerCase()+"/messages");var singleChatUrlStart=("/"+lang+"/users/"+userLogin.toLowerCase()+"/message/");var extensions=["gif","jpeg","jpg","mq4","mq5","ex4","ex5","png","rar","txt","zip","mqh","mt5"];var playSounds=play_sounds?true:false;var openOnNewMessage=false;var commentHeightToBeFullWidth=80;var supportsStorage=((typeof(Storage)!=="undefined")&&(window.JSON&&window.JSON.stringify))?true:false;var sessionStorageObject={},localStorageObject={};if(supportsStorage){sessionStorageObject=sessionStorage;try{localStorageObject=localStorage}catch(e){localStorageObject=sessionStorage}}prepareNotifyIco();window.siteUpdates.RegisterRenderCallback(13,1,chatUpdatesCallback,{widget:true});addHotKeys();function getChatList(page,container,onLoaded){var url="/"+lang+"/users/"+userLogin+"/messages/page"+page+"?type=widget";Ajax.get(url,null,{onready:function(data){this.container.innerHTML+=data;if(currentChatListPage<2){addCustomScroll(innerContainer,"#4A76B8","#AEC2DD",4,4,{marginRight:"-12px"});this.container.scrollTop=0;initRecentChatsByLoadedChats()}addOnclickListeners();this.container._loading=false;if(this.onChatListLoaded){this.onChatListLoaded()}},onerror:function(){this.container._loading=false},container:container,onChatListLoaded:onLoaded});container._loading=true}function addOnclickListeners(){var wrappers=getElementsByClass("chatContentWrapper",innerContainer);if(!wrappers||!wrappers.length){return}for(var i=0;i<wrappers.length;i++){var wrapper=wrappers[i];if(!wrapper.href||wrapper.onclick){continue}wrapper.onclick=function(){var segments=this.href.split("/");var id=segments[segments.length-1];var loginInput=$("chatCommentsOtherUserLogin_"+id);openSingleChat(loginInput.value);return false}}}function addPaginatorToChatList(){var oldOnScroll=innerContainer.onscroll;innerContainer.onscroll=function(){if(currentChatListPage!=currentChatListPagesCount){if(checkScroll(innerContainer)&&!innerContainer._loading){chatListNextPage()}}if(oldOnScroll){oldOnScroll(arguments)}}}function addHotKeys(){HotKeys.Add(27,function(){if(!closeAllPopups()){closeMainContainer()}});HotKeys.Add(113,function(){toggleMainContainer()})}function checkScroll(container,dirUp){var height=container.clientHeight||container.offsetHeight;var innerHeight=container.scrollHeight;var top=container.scrollTop;if(dirUp){return top<50}if((innerHeight-top-height)<50){return true}return false}function closeAllPopups(force){returnToChatListIco.style.display="none";if(currentChatListPage==0){loadChatList()}return userSelector.Close()|closeSingleChat(force)}function openSingleChat(login){closeAllPopups();if(commentsList){commentsList.Close()}commentsList=new CommentsList(login);if(innerContainer.parentNode.className=="customScrollWrapper"){innerContainer.parentNode.style.visibility="hidden"}returnToChatListIco.style.display=""}function closeSingleChat(removeFromRecent){if(removeFromRecent==true&&commentsList){removeChatFromPanel(commentsList.GetUserToLogin())}if(commentsList){commentsList.Close()}else{return false}if(commentsList&&commentsList.GetChatId()){window.siteUpdates.UnregisterRenderCallback(13,1,{chid:commentsList.GetChatId()})}commentsList=null;unselectAllRecentChats();innerContainer.parentNode.style.visibility="visible";expandIco.href=messagesUrl;return true}function prepareNotifyIco(){var messagesIco=$("notify_messages");if(messagesIco){messagesIco.onclick=function(){toggleMainContainer();return false}}}function prepareContainer(){var messagesIco=$("notify_messages");if(messagesIco){var icoOffset=getOffsetSum(messagesIco);var windowSize=getWindowSize();var sizeByOffset=windowSize.width-icoOffset.left-10;widgetWidth=Math.max(widgetWidth,sizeByOffset)}else{return}mainContainer=createElement(document.body,"div",{className:"chatWidget"});mainContainer.style.width=widgetWidth+"px";var cover=$("cover");if(cover){var head=getElementsByClass("head",cover)[0];if(head){var offset=getOffsetSum(head);if(offset.top>5){mainContainer.style.top=(offset.top+41)+"px"}}}innerContainer=createElement(mainContainer,"div",{className:"chatWidgetContent"});innerContainer.style.height=containerHeight+"px";userSelector=new UserSelector();bottomContainer=createElement(mainContainer,"div",{className:"chatWidgetBottom"});expandIco=createElement(bottomContainer,"a",{className:"bottomButton expandIco",href:messagesUrl,target:"_blank",title:localization.expandWindow,onclick:function(){toggleSize();saveSizeState(expanded);return false}});newChatIco=createElement(bottomContainer,"span",{className:"bottomButton newChatIco",onclick:userSelector.Open,title:localization.newMessageHeader});searchChatIco=createElement(bottomContainer,"span",{className:"bottomButton searchChatIco"});returnToChatListIco=createElement(bottomContainer,"span",{className:"bottomButton returnToChatListIco",onclick:function(){closeAllPopups()},title:localization.returnToList});returnToChatListIco.style.display="none";if(!recentAvatarsContainer.parentNode){bottomContainer.appendChild(recentAvatarsContainer)}if(isExpanded!=expanded){toggleSize()}}var fullChatWidth=1000;var lastChatWidth=0;var expanded=false;var restrictSaveExpandState=false;var expandStateToSave=null;var lastSavedExpandState=null;function toggleSize(){if(!expanded){lastChatWidth=widgetWidth;fullChatWidth=widgetWidth*2;changeSize(fullChatWidth);expandIco.title=localization.minimizeWindow}else{changeSize(lastChatWidth);expandIco.title=localization.expandWindow}expanded=!expanded}function saveSizeState(value){var url="/"+lang+"/users/"+userLogin+"/messages/setwidgetwidth";if(!restrictSaveExpandState){Ajax.post(url,{state:value?"1":"0"},{onready:function(data){},onerror:function(data){}});restrictSaveExpandState=true;setTimeout(function(){restrictSaveExpandState=false;lastSavedExpandState=value;if(expandStateToSave!=lastSavedExpandState&&expandStateToSave!=null){saveSizeState(expandStateToSave)}},2000)}else{expandStateToSave=value}}function changeSize(newWidth){widgetWidth=newWidth;mainContainer.style.width=widgetWidth+"px";if(commentsList){commentsList.SetSize(newWidth)}if(userSelector){userSelector.SetSize(newWidth)}}function loadChatList(){clearInnerContainer();currentChatListPage=1;getChatList(currentChatListPage,innerContainer,onChatListLoaded)}function onChatListLoaded(){var pagesCountInput=$("messagesListLiteTotalPages");currentChatListPagesCount=pagesCountInput?pagesCountInput.value:1;addPaginatorToChatList()}function chatListNextPage(){currentChatListPage++;getChatList(currentChatListPage,innerContainer)}function toggleMainContainer(){if(opened){closeMainContainer()}else{openMainContainer()}}function openMainContainer(doNotLoadChats){if(!mainContainer){prepareContainer()}SearchBoxContainer.Hide(undefined,true);notifyMessagesLink=$(notifyMessagesLink.id);mainContainer.style.display="block";opened=true;if(currentChatListPage==0&&!doNotLoadChats){loadChatList()}Class(notifyMessagesLink,"opened",false)}function closeMainContainer(){closeAllPopups();notifyMessagesLink=$(notifyMessagesLink.id);mainContainer.style.display="none";opened=false;Class(notifyMessagesLink,"opened",true)}function clearInnerContainer(){innerContainer.innerHTML=""}var sndNewMessage=null;if(window.Audio){sndNewMessage=new window.Audio("/i/message/new_message_click2.mp3")}var lastNotified=0;function getLastNotified(){if(supportsStorage){var lastNotifieFromStorageRaw=localStorageObject.getItem("chatWidget_lastNotified")||"0";var lastNotifieFromStorage=parseInt(lastNotifieFromStorageRaw);if(lastNotifieFromStorage>lastNotified){lastNotified=lastNotifieFromStorage}}return lastNotified}function setLastNotified(value){if(supportsStorage){localStorageObject.setItem("chatWidget_lastNotified",value+"")}lastNotified=value}function notifyNewMessage(chat,timestamp){var ln=getLastNotified();if(sndNewMessage&&ln<timestamp&&playSounds){sndNewMessage.play();setLastNotified(timestamp);if(console&&console.log){console.log(GetDateTime(timestamp)+": sound notify."+(!chat?"":(" Chat: #"+chat.id+" with '"+chat.name+"': '"+chat.text+"'")))}}if(!opened&&chat&&chat.login&&openOnNewMessage){setTimeout(function(){openMainContainer(true)},50);setTimeout(function(){openSingleChat(chat.login)},52)}}function chatUpdatesCallback(update,timestam){var hasNew=false;var newChat=null;setDates(timestam);if(commentsList){hasNew=commentsList.UpdatesCallback(update,timestam)}if(update.a&&update.a.length){for(var i=0;i<update.a.length;i++){var a=update.a[i];if(a.key=="expiration_date"&&commentsList){commentsList.ClearExpiredMessages(a.value)}}}var chats=getChatsFromUpdate(update);if(!chats||!chats.length){return}for(var i=0;i<chats.length;i++){var chatLogin=chats[i].login;if(chats[i].unread_count>0){hasNew=true;newChat=chats[i];if(!commentsList||commentsList.GetUserToLogin()!=chatLogin){addChatToPanel(chatLogin,chats[i].avatar_url,chats[i].name,chats[i].date,false);setRecentChatBlink(chatLogin,true)}}else{setRecentChatBlink(chatLogin,false)}if(commentsList&&commentsList.GetUserToLogin()==chatLogin){commentsList.SetExpirationPeriod(chats[i].expiration_period)}if(commentsList&&commentsList.GetUserToLogin()==chatLogin&&chats[i].expiration_date){commentsList.ClearExpiredMessages(chats[i].expiration_date)}if(!mainContainer){continue}var chat=createChat(chats[i]);var existingChat=$(chat.id);if(existingChat&&existingChat.parentNode){existingChat.parentNode.removeChild(existingChat)}else{}if(chat){prependElement(innerContainer,chat)}else{}}if(hasNew){notifyNewMessage(newChat,update.last_date)}}function setDates(baseDate){var dateSpans=getElementsByClass("updatableDateContainer",mainContainer);if(!dateSpans||!dateSpans.length){return}for(var i=0;i<dateSpans.length;i++){var dateValue=dateSpans[i].getElementsByTagName("span")[0];if(!/^\d.*$/.test(dateValue.innerHTML)){continue}var dateInput=dateSpans[i].getElementsByTagName("input")[0];dateValue.innerHTML=DateToStringForToday(dateInput.value,baseDate);dateValue.title=GetDateTime(dateInput.value)}}function getChatsFromUpdate(update){if(!update.a||!update.a.length||update.a.length==0){return[]}for(var i=0;i<update.a.length;i++){if(update.a[i].key=="chats"){return update.a[i].value}}return[]}function createChat(chat){var chatLine=createElement(null,"DIV",{className:"chatLineLite",id:"chatLineLite_"+chat.id});createElement(chatLine,"INPUT",{id:"chatCommentsOtherUserLogin_"+chat.id,type:"hidden",value:chat.login});createElement(chatLine,"INPUT",{id:"chatCommentsOtherUserName_"+chat.id,type:"hidden",value:chat.name});if(chat.unread_count){createElement(chatLine,"SPAN",{className:"chatMessagesCount unread",innerHTML:chat.unread_count})}var user=createElement(chatLine,"DIV",{className:"user"});createElement(user,"IMG",{width:25,height:25,src:chat.avatar_url,title:chat.name});var url="/"+lang+"/users/"+userLogin+"/message/"+chat.id;var wrapper=createElement(chatLine,"A",{className:"chatContentWrapper",href:url,target:"_blank"});var login=chat.login;wrapper.onclick=function(){openSingleChat(login);return false};createElement(wrapper,"DIV",{className:"chatTitle",innerHTML:chat.name});createElement(wrapper,"DIV",{className:"chatTextWrapper",innerHTML:chat.text});var dateDiv=createElement(wrapper,"DIV",{className:"chatDate updatableDateContainer"});createElement(dateDiv,"INPUT",{type:"hidden",value:chat.date});createElement(dateDiv,"SPAN",{innerHTML:chat.date_text});return chatLine}function setUnreadCommentsCount(chatId,unreadCount){var parent=$("chatLineLite_"+chatId);if(!parent){return}var oldCounters=getElementsByClass("chatMessagesCount",parent);var oldCount=0;if(oldCounters&&oldCounters.length){for(var i=0;i<oldCounters.length;i++){if(!oldCount){oldCount=parseInt(oldCounters[i].innerHTML)}parent.removeChild(oldCounters[i])}}if(oldCount!=unreadCount){notifyMessagesLink=$(notifyMessagesLink.id);var counters=getElementsByClass("count",notifyMessagesLink);if(counters&&counters.length){var countValue=parseInt(counters[0].innerHTML);var newValue=(countValue-(oldCount-unreadCount));if(newValue==0){Class(counters[0].parentNode,"active",true);counters[0].parentNode.removeChild(counters[0])}else{counters[0].innerHTML=(countValue-(oldCount-unreadCount))+""}}}if(unreadCount>0){var counter=createElement(null,"SPAN",{className:"chatMessagesCount unread",innerHTML:unreadCount});prependElement(parent,counter)}}var recentChats=[];var recentChatsIds=[];var recentAvatarsContainer=createElement(bottomContainer,"DIV");function getRecentChatsFromStorage(){if(!supportsStorage){return[]}var localStorageVersion=localStorageObject.getItem("recentChatsVersion");if(!localStorageVersion||localStorageVersion!="20150506"){localStorageObject.setItem("recentChatsVersion","20150506");localStorageObject.setItemItem("recentChats","");return[]}var raw=localStorageObject.getItem("recentChats");if(!raw){return[]}return window.JSON?JSON.parse(raw):eval("("+raw+")")}function insertRecentChatsIntoStorage(){if(!supportsStorage){return}var raw=JSON.stringify(recentChats);localStorageObject.setItem("recentChats",raw)}var recentChatsS=[];var isArray=Array.isArray?Array.isArray(recentChats):recentChats.length;if(!isArray){recentChats=[];insertRecentChatsIntoStorage()}if(recentChatsS.length){for(var i=0;i<Math.min(recentChatsS.length,5);i++){if(recentChatsS[i].id){break}recentChatsIds[i]=recentChatsS[i].login;recentChats[i]=recentChatsS[i];recentAvatarsContainer.appendChild(createRecentChatItem(recentChats[i]))}}function initRecentChatsByLoadedChats(){if(recentChats&&recentChats.length){return}if(!innerContainer){return}var chatLines=getElementsByClass("chatLineLite",innerContainer);if(!chatLines||!chatLines.length){return}for(var l=0;l<chatLines.length;l++){if(l>4){break}var id=chatLines[l].id.split("_")[1];var loginInput=$("chatCommentsOtherUserLogin_"+id);var nameInput=$("chatCommentsOtherUserName_"+id);var dateInput=$("chatCommentsChatDate_"+id);var avaImg=chatLines[l].getElementsByTagName("IMG")[0];if(!loginInput||!nameInput||!avaImg||!dateInput){continue}addChatToPanel(loginInput.value,avaImg.src,nameInput.value,dateInput.value,false)}}function gotoNextRecentChat(){if(!recentChatsIds||!recentChatsIds.length||!opened){return true}var currentlogin=!commentsList?null:commentsList.GetUserToLogin();if(currentlogin==null){openSingleChat(recentChatsIds[0])}else{var currentIndex=recentChatsIds.indexOf(currentlogin);if(currentIndex<0||currentIndex==(recentChatsIds.length-1)){openSingleChat(recentChatsIds[0])}else{openSingleChat(recentChatsIds[currentIndex+1])}}return false}function setRecentChatBlink(login,isBlink){login=(login+"").toLowerCase();var index=recentChatsIds.indexOf(login);if(index>=0){Class(recentAvatarsContainer.childNodes[index],"blink",!isBlink);return}}function createRecentChatItem(chat){var user=createElement(null,"DIV",{className:"user"});user._chat_login=chat.login;var userImg=createElement(user,"IMG",{src:chat.icoUrl,title:chat.name,width:25,height:25,name:"chatRec_"+chat.login});if(chat.date){userImg.title+=", "+DateToStringForToday(chat.date)}user.onclick=function(){openSingleChat(this._chat_login)};return user}function unselectAllRecentChats(){if(!recentAvatarsContainer){return}var icos=getElementsByClass("user",recentAvatarsContainer);if(!icos||!icos.length){return}for(var i=0;i<icos.length;i++){Class(icos[i],"selected",true)}}function addChatToPanel(login,icoUrl,name,lastChatDate,select){login=(login+"").toLowerCase();unselectAllRecentChats();login=login+"";var index=recentChatsIds.indexOf(login);if(index>=0){if(select){Class(recentAvatarsContainer.childNodes[index],"selected",false)}return}if(recentChats.length>=5){recentChats.splice(0,(recentChats.length-(5-1)));recentChatsIds.splice(0,(recentChatsIds.length-(5-1)));while(recentAvatarsContainer.childNodes.length>(5-1)){recentAvatarsContainer.removeChild(recentAvatarsContainer.childNodes[0])}}var model={login:login,name:name,icoUrl:icoUrl,date:lastChatDate};var copy=createRecentChatItem(model);recentChats[recentChats.length]=model;recentChatsIds[recentChatsIds.length]=model.login;recentAvatarsContainer.appendChild(copy);if(select){Class(copy,"selected")}copy.onclick=function(){openSingleChat(login)};insertRecentChatsIntoStorage()}function removeChatFromPanel(login){login=(login+"").toLowerCase();var index=recentChatsIds.indexOf(login);if(index<0){return}recentChatsIds.splice(index,1);recentChats.splice(index,1);if(recentAvatarsContainer){recentAvatarsContainer.removeChild(recentAvatarsContainer.childNodes[index])}insertRecentChatsIntoStorage()}this.OpenChatWith=function(login){if(!opened&&login){setTimeout(function(){openMainContainer(true);mainContainer.scrollIntoView(false)},50)}setTimeout(function(){openSingleChat(login)},52)};function CommentsList(chatLogin){var initialized=false;var chatId=0;this.GetChatId=function(){return chatId};var userToLogin=chatLogin;this.GetUserToLogin=function(){return userToLogin};var userToName="";var commentIds=[];var commentsCount=0;var currentPosition=0;var expirationPeriod=0;var expirationSelector;this.SetExpirationPeriod=function(period){if(expirationSelector){expirationSelector.SetPeriod(period)}};this.ClearExpiredMessages=function(expiration_date){if(!commentListScrollContainer){return}var allComments=getElementsByClass("chatWidgetCommentLine",commentListScrollContainer);if(!allComments||!allComments.length){return}var toRemove=[];for(var ac=0;ac<allComments.length;ac++){if(_isCommentLineExired(allComments[ac],expiration_date)){toRemove.push(allComments[ac])}}for(var ar=0;ar<toRemove.length;ar++){if(toRemove[ar]&&toRemove[ar].parentNode){toRemove[ar].parentNode.removeChild(toRemove[ar])}}function _isCommentLineExired(line,expDate){var dateElements=getElementsByClass("chatWidgetCommentDate",line);if(!dateElements||!dateElements.length){return false}var dateInput=dateElements[0].getElementsByTagName("INPUT")[0];if(!dateInput){return false}return dateInput.value<expDate}};var commentListContainer=$("chatWidgetComments");if(commentListContainer){commentListContainer.parentNode.removeChild(commentListContainer)}commentListContainer=createElement(mainContainer,"div",{className:"chatWidgetComments",id:"chatWidgetComments"});commentListContainer.style.width=widgetWidth+"px";var commentListStatusContainerA=createElement(commentListContainer,"div",{className:"chatWidgetCommentsStatus",id:"chatWidgetCommentsStatus"});commentListStatusContainer=createElement(commentListStatusContainerA,"div");commentListStatusContainer.style.paddingLeft=commentListStatusContainer.style.paddingRight="8px";var commentListScrollContainer=createElement(commentListContainer,"div",{className:"chatWidgetCommentsList",id:"chatWidgetCommentsList"});var commentListEditorContainer=createElement(commentListContainer,"div",{className:"chatWidgetCommentsEditor",id:"chatWidgetCommentsEditor"});var isSystem=!userToLogin;if(!isSystem){renderEditor()}else{Class(commentListContainer,"systemChat")}resizeScrollContainer();function fillCommentsStatusBar(){commentListStatusContainer.innerHTML="";createElement(commentListStatusContainer,"span",{className:"chatWidgetCommentsListClose",onclick:function(){closeAllPopups(true)},title:localization.closeChat});if(showExpiration){expirationSelector=new ChatExpirationSelector(chatLogin,userLogin,expirationPeriod,commentListStatusContainer,lang,localization)}if(userToLogin&&userToName){createElement(commentListStatusContainer,"a",{className:"chatWidgetCommentsListUserLink",innerHTML:userToName,href:("/"+lang+"/users/"+userToLogin)})}else{createElement(commentListStatusContainer,"b",{className:"chatWidgetCommentsListUserLink",innerHTML:userToName||localization.newMessageHeader})}}function resizeScrollContainer(){var oldHeight=commentListScrollContainer.clientHeight;commentListScrollContainer.style.height=(containerHeight-commentListStatusContainerA.clientHeight-commentListEditorContainer.clientHeight-(isSystem?8:0))+"px";commentListScrollContainer.scrollTop+=(oldHeight-commentListScrollContainer.clientHeight)}this.SetSize=function(newWidth,newHeight){setSize(newWidth,newHeight)};function setSize(newWidth,newHeight){if(!commentListContainer){return}var oldScrollBottom=commentListScrollContainer.scrollHeight-commentListScrollContainer.scrollTop;commentListContainer.style.width=newWidth+"px";var existingComments=getElementsByClass("chatWidgetCommentWrapper",commentListContainer);if(!existingComments||!existingComments.length){return}for(var j=0;j<existingComments.length;j++){existingComments[j].style.maxWidth=(newWidth-36)+"px"}commentListScrollContainer.scrollTop=(commentListScrollContainer.scrollHeight-oldScrollBottom)}function getComments(from,count){var url="/"+lang+"/users/"+userLogin+"/message/"+("login_"+userToLogin)+"/comments/"+from+"/"+count;commentListScrollContainer._loading=true;if(from+count==commentsCount){Class(commentListScrollContainer,"loading")}Ajax.get(url,null,{onready:function(data){renderComments(this.container,data);commentListScrollContainer._loading=false;Class(commentListScrollContainer,"loading",true)},onerror:function(){alert("get comments error");commentListScrollContainer._loading=false;Class(commentListScrollContainer,"loading",true)},container:commentListScrollContainer})}function renderComments(container,data,appendToEnd){var list=((typeof data)=="string")?(window.JSON?JSON.parse(data):eval("("+data+")")):data;if(!list){return}if(!initialized){commentsCount=list.answers_count;currentPosition=commentsCount;userToName=list.chat_title;chatId=list.chat_id;expirationPeriod=list.expiration_period;fillCommentsStatusBar();addChatToPanel(userToLogin,list.avatar_url,list.chat_title,list.last_chat_date,true);initialized=true;if(chatId){window.siteUpdates.RegisterRenderCallback(13,1,chatUpdatesCallback,{chid:list.chat_id})}expandIco.href=singleChatUrlStart+(list.chat_id||("new?loginTo="+userToLogin))}list=list.comments||[];setUnreadCommentsCount(chatId,0);setRecentChatBlink(userToLogin,false);var count=renderCommentsList(list);if(currentPosition==commentsCount){addCustomScroll(commentListScrollContainer,"#4A76B8","#AEC2DD",4,4,{marginRight:"-12px",paddingTop:"26px"})}if(currentPosition==commentsCount||appendToEnd){commentListScrollContainer.scrollTop=commentListScrollContainer.scrollHeight}currentPosition=currentPosition-count}function renderCommentsList(list){if(!list){return 0}list=((typeof list)=="string")?(window.JSON?JSON.parse(list):eval("("+list+")")):list;var count=0;for(var i=0;i<list.length;i++){if(chatId&&list[i].parent_id!=chatId){continue}if(commentIds.indexOf(list[i].id)>=0){continue}commentIds.push(list[i].id);var oldScroll=commentListScrollContainer.scrollTop;var oldHeight=commentListScrollContainer.scrollHeight;if(list[i].is_attached){if(attachToExisting(list[i])){continue}}appendSingleComment(list[i],commentListScrollContainer);commentListScrollContainer.scrollTop=oldScroll+(commentListScrollContainer.scrollHeight-oldHeight);count++}var images=commentListScrollContainer.getElementsByTagName("IMG");if(images&&images.length){for(var j=0;j<images.length;j++){images[j]._oldheight=(images[j].clientHeight||images[j].offsetHeight);images[j].onload=function(){var heightDelta=(this.clientHeight||this.offsetHeight)-this._oldheight;if(heightDelta>0){commentListScrollContainer.scrollTop=commentListScrollContainer.scrollTop+heightDelta}}}}return count}function createSingleSystemComment(data){var result=createElement(null,"div",{className:"chatWidgetCommentLine systemComment",id:"chatWidgetComment_"+data.parent_id+"_"+data.id});var wrapper=createElement(result,"div",{className:"chatWidgetCommentWrapper"});wrapper.style.maxWidth=(widgetWidth-36)+"px";var text=createElement(wrapper,"div",{className:"chatWidgetCommentText",innerHTML:data.content});return result}function createSingleComment(data){var result=createElement(null,"div",{className:"chatWidgetCommentLine"+((data.author_login==userLogin)?" byOwner":""),id:"chatWidgetComment_"+data.parent_id+"_"+data.id});var wrapper=createElement(result,"div",{className:"chatWidgetCommentWrapper"});wrapper.style.maxWidth=(widgetWidth-36)+"px";var text=createElement(wrapper,"div",{className:"chatWidgetCommentText",innerHTML:data.content});var dateDiv=createElement(text,"div",{className:"chatWidgetCommentDate updatableDateContainer"});createElement(dateDiv,"INPUT",{type:"hidden",value:data.date});createElement(dateDiv,"SPAN",{innerHTML:DateToStringForToday(data.date),title:GetDateTime(data.date)});createElement(wrapper,"div",{className:"boobleAngle"});createCommentAttachmentsElement(data,text,dateDiv);return result}function appendSingleComment(commentObj,container){var element=commentObj.is_system?createSingleSystemComment(commentObj):createSingleComment(commentObj);var comments=getElementsByClass("chatWidgetCommentLine",container);if(!comments||!comments.length){container.appendChild(element);return}var refComment=undefined;var refCommentId=0;var commentId=parseInt(commentObj.id);for(var i=0;i<comments.length;i++){var curIdParsed=parseInt(comments[i].id.split("_")[2]);if(curIdParsed>commentId&&(!refComment||curIdParsed<refCommentId)){refComment=comments[i];refCommentId=curIdParsed}}if(!refComment){container.appendChild(element)}else{container.insertBefore(element,refComment)}var height=element.clientHeight||element.offsetHeight;if(height>commentHeightToBeFullWidth){Class(element,"fullWidth")}}function attachToExisting(data){var commentId=parseInt(data.id);var comments=getElementsByClass("chatWidgetCommentLine",commentListScrollContainer);if(!comments||!comments.length){return false}var commentToAttach=undefined;var commentToAttachId=0;var id="chatWidgetComment_"+data.parent_id+"_"+data.id;for(var i=0;i<comments.length;i++){var curIdParsed=parseInt(comments[i].id.split("_")[2]);if(curIdParsed<commentId&&(!commentToAttach||curIdParsed>commentToAttachId)){commentToAttach=comments[i];commentToAttachId=curIdParsed}}if(!commentToAttach){return false}var textElement=getElementsByClass("chatWidgetCommentText",commentToAttach)[0];var dateElement=getElementsByClass("chatWidgetCommentDate",commentToAttach)[0];if(!textElement||!dateElement){return commentToAttach}textElement.removeChild(dateElement);textElement.innerHTML+="<br>"+data.content;textElement.appendChild(dateElement);var dateInput=dateElement.getElementsByTagName("INPUT")[0];var dateSpan=dateElement.getElementsByTagName("SPAN")[0];if(dateInput){dateInput.value=data.date}if(dateSpan){dateSpan.innerHTML=DateToStringForToday(data.date);dateSpan.title=GetDateTime(data.date)}var wrapper=getElementsByClass("chatWidgetCommentWrapper",commentToAttach)[0];createCommentAttachmentsElement(data,textElement,dateElement);var height=commentToAttach.clientHeight||commentToAttach.offsetHeight;if(height>commentHeightToBeFullWidth){Class(commentToAttach,"fullWidth")}return true}function createCommentAttachmentsElement(comment,cont_wrapper,refBeforeElement){if(!comment.attachments||comment.attachments.length==0){return}var existingAttcs=getElementsByClass("attach",cont_wrapper);var attc;var attc2;if(!existingAttcs||existingAttcs.length==0){attc=createElement(null,"DIV",{className:"attach"});if(refBeforeElement){cont_wrapper.insertBefore(attc,refBeforeElement)}else{cont_wrapper.appendChild(attc)}attc.style.clear="both";attc2=createElement(attc,"DIV",{className:"attachBlock",id:"cb_"+comment.id});var att_head=createElement(attc2,"STRONG",{innerHTML:localization.attachedFilesHeader})}else{attc=existingAttcs[0];attc2=getElementsByClass("attachBlock",attc)}for(var i=0;i<comment.attachments.length;i++){var attachment=comment.attachments[i];var att_item=createElement(attc2,"DIV",{className:"attachItem"});var extension=getFileExtension(attachment.name,true);if(extension&&extensions.indexOf(extension)>=0){}else{extension="unk"}createElement(att_item,"A",{className:extension+" ssl_ext",target:"_blank",href:attachment.url,innerHTML:attachment.name,title:attachment.name});createElement(att_item,"SPAN",{className:"attachSize",innerHTML:" ("+attachment.size_text+")"});if(["jpg","gif","png","jpeg"].indexOf(extension)>=0){var preview=createElement(att_item,"DIV",{className:"attachPreview"});var preview_wrapper=createElement(preview,"A",{target:"_blank",href:attachment.url});var preview_image=createElement(preview_wrapper,"IMG",{src:attachment.url,height:80})}}createElement(cont_wrapper.parentNode,"DIV",{className:"clear-fix"})}function addPaginatorToCommentsList(){var oldOnScroll=commentListScrollContainer.onscroll;commentListScrollContainer.onscroll=function(){if(currentPosition==0){return}if(checkScroll(commentListScrollContainer,true)&&!commentListScrollContainer._loading){nextPage()}if(oldOnScroll){oldOnScroll(arguments)}}}function nextPage(){if(currentPosition==0&&initialized){return}var countToLoad=Math.min(currentPosition,10);getComments(currentPosition-countToLoad,countToLoad)}nextPage();addPaginatorToCommentsList();var editWrapper,editTextArea,submitButton,editForm,contentHidden,fileInput,fileInputWrapper,attachmentsCount;function renderEditor(){commentListEditorContainer.innerHTML="";editForm=createElement(commentListEditorContainer,"form",{method:"POST",action:"/"+lang+"/users/"+userLogin+"/message/new",enctype:"multipart/form-data",onsubmit:function(){submitComment();return true}});createElement(editForm,"input",{type:"hidden",name:"type",value:"widget"});createElement(editForm,"input",{type:"hidden",name:"userTo",value:userToLogin});createElement(editForm,"input",{type:"hidden",name:"formType",value:"ajax"});contentHidden=createElement(editForm,"input",{type:"hidden",name:"content",value:""});submitButton=createElement(editForm,"button",{type:"button",onclick:submitComment,title:localization.sendMessageTitle});editWrapper=createElement(editForm,"div",{className:"inputWrapper"});fileInputWrapper=createElement(editWrapper,"div",{className:"fileWrapper"});fileInput=createFileInput();editTextArea=createElement(editWrapper,"textarea",{rows:1});editTextArea.onkeydown=function(e){e=e||window.event;if(e.keyCode===13&&e.ctrlKey){submitComment();return false}return true};editTextArea.onkeyup=function(e){autogrow(this,15,45);resizeScrollContainer()};editTextArea.focus();attachmentsCount=0}function createFileInput(){return createElement(fileInputWrapper,"INPUT",{title:localization.attachFileTitle+": "+extensions.join(", "),type:"file",name:"attachedFile",onchange:function(){onFileSelect(this)},accept:("."+extensions.join(",.")),onclick:function(){return attachmentsCount<4}})}function onFileSelect(input){prependElement(editForm,createAttachedElement(input));input.onchange=null;fileInput=createFileInput();attachmentsCount++;resizeScrollContainer()}function createAttachedElement(input){var fileNameSegments=input.value.split("\\");var filename=fileNameSegments[fileNameSegments.length-1];var extension=getFileExtension(filename,true);if(!extension||extensions.indexOf(extension)<0){extension="unk"}var el=createElement(null,"div",{className:"readonlyAttachWrapper attachItem"});createElement(el,"span",{className:extension,innerHTML:filename,title:filename});createElement(el,"a",{className:"deleteAttachLink",onclick:function(){removeReadonlyAttach(this.parentNode)}});el.appendChild(input);return el}function removeReadonlyAttach(attachWrapper){attachWrapper.parentElement.removeChild(attachWrapper);resizeScrollContainer();attachmentsCount--}var _submitProcess=false;function submitComment(){if(_submitProcess){return}if(!editTextArea.value||!editTextArea.value.length){return}contentHidden.value=prepareCommentContentToPost(editTextArea.value);_submitProcess=true;Ajax.form(editForm,{onready:function(d){d=stripHtml(d);renderCommentsList(d);window.siteUpdates.GetUpdates();_submitProcess=false;commentListScrollContainer.scrollTop=commentListScrollContainer.scrollHeight},onerror:function(e){alert(e);_submitProcess=false}});clearCommentForm()}function clearCommentForm(){contentHidden.value="";editTextArea.value="";autogrow(editTextArea,15,45);var attaches=getElementsByClass("readonlyAttachWrapper",editForm);if(attaches&&attaches.length){var index=attaches.length-1;while(index>=0){var el=attaches[index];el.parentNode.removeChild(el);index=index-1}}attachmentsCount=0;resizeScrollContainer()}function prepareCommentContentToPost(content){return content}function updatesCallback(update,timestam){if(!update){return false}var hasNewFromOtherUser=false;var comments=getCommentsFromUpdate(update);if(comments&&comments.length){for(var c=0;c<comments.length;c++){if(comments[c].parent_id!=chatId){continue}hasNewFromOtherUser=comments[c].author_login!=userLogin}renderCommentsList(comments);commentListScrollContainer.scrollTop=commentListScrollContainer.scrollHeight}return hasNewFromOtherUser}this.UpdatesCallback=updatesCallback;function getCommentsFromUpdate(update){if(!update.a||!update.a.length||update.a.length==0){return[]}for(var i=0;i<update.a.length;i++){if(update.a[i].key=="comments"){return update.a[i].value}}return[]}function autogrow(f,minHeight,maxHeight){if(!window.getComputedStyle){return}var oldHeight=f.clientHeight;var oldMargin=parseInt(window.getComputedStyle(commentListScrollContainer,null).getPropertyValue("margin-bottom")||0);if(!minHeight){minHeight=15}if(!maxHeight){maxHeight=45}f.style.height=minHeight+"px";f.style.height=Math.min(f.scrollHeight,maxHeight)+"px";commentListScrollContainer.style.marginBottom=oldMargin-oldHeight+f.clientHeight+"px";commentListEditorContainer.style.marginTop=-(oldMargin-oldHeight+f.clientHeight-1)+"px"}function close(){if(commentListContainer&&commentListContainer.parentNode){commentListContainer.parentNode.removeChild(commentListContainer)}}this.Close=function(){close()}}function UserSelector(){var maxFriendsToShow=64;var friendsList=undefined;var selectUserContainer=createElement(mainContainer,"div",{className:"chatWidgerUserSelect"});var selectUserScrollContainer=createElement(selectUserContainer,"div",{className:"chatWidgerUserSelectScroll"});selectUserContainer.style.width=widgetWidth+"px";selectUserContainer.style.height=containerHeight+"px";selectUserContainer.style.zIndex=2002;var form=createElement(selectUserScrollContainer,"div",{className:"chatWidgerUserSearchForm"});createElement(form,"h4",{innerHTML:localization.newMessageHeader+":"});var inputWrapper=createElement(form,"div",{className:"inputWrapper"});var selectUserKeyword=createElement(inputWrapper,"INPUT",{type:"text",name:"chatWidgerUserSearchKeyword",placeholder:localization.searchUserPlaceholder});selectUserKeyword.onkeyup=function(){if(!friendsList){return}renderFriends(this.value)};var friendsContainer=createElement(selectUserScrollContainer,"div",{className:"chatWidgerFriendsList empty"});var otherUsersContainer=createElement(selectUserScrollContainer,"div",{className:"chatWidgerFriendsList empty"});var opened=false;var addedScroll=false;this.Open=function(){selectUserContainer.style.display="block";if(!addedScroll){addCustomScroll(selectUserScrollContainer,"#4A76B8","#AEC2DD",4,4,{marginRight:"-12px",height:"100%"});addedScroll=true}returnToChatListIco.style.display="";opened=true;if(!friendsList){getFriendsList()}else{renderFriends()}selectUserKeyword.focus()};this.SetSize=function(newWidth,newHeight){setSize(newWidth,newHeight)};function setSize(newWidth,newHeight){if(!selectUserContainer){return}var oldScrollBottom=selectUserScrollContainer.scrollHeight-selectUserScrollContainer.scrollTop;selectUserContainer.style.width=newWidth+"px";selectUserScrollContainer.scrollTop=(selectUserScrollContainer.scrollHeight-oldScrollBottom)}var getUsersTimeout=undefined;function getUsers(keyword){if(!keyword){return}var url="/"+lang+"/users_search/json?keyword="+encodeURIComponent(keyword);Class(otherUsersContainer,"loading");otherUsersContainer.innerHTML="";Class(otherUsersContainer,"empty",true);if(getUsersTimeout){clearTimeout(getUsersTimeout)}getUsersTimeout=setTimeout(function(){Ajax.get(url,null,{onready:function(data){Class(otherUsersContainer,"loading",true);var users=window.JSON?JSON.parse(data):eval("("+data+")");otherUsersContainer.innerHTML="";Class(otherUsersContainer,"empty",users&&users.length);users=filterOtherUsers(users);if(!users||!users.length){return}createElement(otherUsersContainer,"DIV",{className:"selectUserFriendsHeader",innerHTML:localization.otherUsersHeader+" ("+users.length+")"});for(var i=0;i<users.length;i++){otherUsersContainer.appendChild(createFriendElement({name:users[i].Name,login:users[i].Login,avatar_micro:users[i].AvatarMicro}))}},onerror:function(data){Class(otherUsersContainer,"loading",true)}})},300)}function filterOtherUsers(otherUsers){if(!otherUsers||!otherUsers.length){return[]}var result=[];for(var i=0;i<otherUsers.length;i++){var foundInFriends=false;for(var j=0;j<friendsList.length;j++){if(friendsList[j].login.toLowerCase()==otherUsers[i].Login.toLowerCase()){foundInFriends=true;break}if(userLogin.toLowerCase()==otherUsers[i].Login.toLowerCase()){foundInFriends=true;break}}if(foundInFriends){continue}result[result.length]=otherUsers[i]}return result}this.Close=function(){if(!opened){return false}selectUserContainer.style.display="none";opened=false;return true};function getFriendsList(){var url="/"+lang+"/users/"+userLogin+"/friends/json";Class(friendsContainer,"loading");friendsContainer.innerHTML="";Class(friendsContainer,"empty",true);Ajax.get(url,null,{onready:function(data){Class(friendsContainer,"loading",true);friendsContainer.innerHTML="";Class(friendsContainer,"empty",true);var parsed=window.JSON?JSON.parse(data):eval("("+data+")");friendsList=parsed.friends;renderFriends()},onerror:function(){}})}function filterFriendsList(keyword){if(!friendsList||!friendsList.length){return[]}if(!keyword){return friendsList}var filtered=[];for(var i=0;i<friendsList.length;i++){var nameSegments=(friendsList[i].name.toLowerCase()+" "+friendsList[i].login.toLowerCase()).split(" ");for(var s=0;s<nameSegments.length;s++){if(nameSegments[s].indexOf(keyword.toLowerCase())==0){filtered[filtered.length]=friendsList[i];break}}}return filtered}function orderFriendsList(list){if(!list||!list.length){return[]}function orderByLastChatAndName(friend1,friend2){if(friend1.last_chat_date>friend2.last_chat_date){return -1}else{if(friend1.last_chat_date<friend2.last_chat_date){return 1}else{return friend1.name.localeCompare(friend2.name)}}}return list.sort(orderByLastChatAndName)}var selectUserContainerHacked=false;function renderFriends(keyword){keyword=trim(keyword||"");friendsContainer.innerHTML="";var filtered=filterFriendsList(keyword);filtered=orderFriendsList(filtered);if(filtered&&filtered.length){createElement(friendsContainer,"DIV",{className:"selectUserFriendsHeader",innerHTML:localization.friendsHeader+" ("+filtered.length+")"});for(var i=0;i<Math.min(filtered.length,maxFriendsToShow);i++){friendsContainer.appendChild(createFriendElement(filtered[i]))}}selectUserScrollContainer.scrollTop=1;Class(friendsContainer,"empty",filtered&&filtered.length);getUsers(keyword);if(!selectUserContainerHacked){selectUserContainer.style.display="none";selectUserContainer.style.display="block";selectUserContainerHacked=true}}function createFriendElement(friend){var el=createElement(null,"div",{className:"selectUserItem"});createElement(el,"IMG",{src:friend.avatar_micro,title:friend.name,width:25,height:25});createElement(el,"A",{href:"/"+lang+"/users/"+friend.login.toLowerCase(),innerHTML:friend.name,_login:friend.login,onclick:function(){openSingleChat(this._login);return false}});return el}}}function ChatExpirationSelector(chatLogin,userLogin,value,container,lang,localization,fullView){var values={d:{t:localization.selfDestructDay,v:2,k:"Day"},w:{t:localization.selfDestructWeek,v:3,k:"Week"},m:{t:localization.selfDestructMonth,v:4,k:"Month"},n:{t:localization.selfDestructNone,v:0,k:"None"}};var lastValue=value;var currentValue=value;var skipNextBlur=false;var skipNextFocus=false;var currentText;for(var i in values){var p=values[i];if(p.v==currentValue){currentText=p.t;break}}function onWrapperClick(){if(skipNextFocus){skipNextFocus=false;return}focuser.focus()}var wrapper=createElement(container,"div",{className:"expirationSelectWrapper period_"+value+(fullView?" fullView":""),innerHTML:" &#9662;",onclick:onWrapperClick,title:localization.selfDestructSelectTitle});var wrapperLabel=createElement(null,"span",{innerHTML:currentText});if(fullView){wrapper.insertBefore(wrapperLabel,wrapper.childNodes[0])}wrapper.onmousedown=function(){if(this.className.indexOf("opened")>=0){skipNextFocus=true}};var focuser=createElement(wrapper,"input",{type:"text",className:"selectFocus",onfocus:function(){Class(wrapper,"opened")},onblur:function(){if(skipNextBlur){skipNextBlur=false;focuser.focus();return}Class(wrapper,"opened",true)}});var selectWrapper=createElement(wrapper,"div",{className:"expirationOptionsWrapper"});function getOnSelectFunc(period){return function(){onSelect(period)}}for(var i in values){var p=values[i];var o=createElement(selectWrapper,"span",{value:p.v,className:(p.v==currentValue?"selected ":"")+"expirationOption period_"+p.v,title:localization["selfDestruct"+p.k+"Tooltip"]});p.e=o;var ico=createElement(o,"span",{className:"periodIco"});var a=createElement(o,"a",{innerHTML:p.t});o.onclick=getOnSelectFunc(p.v);o.onmousedown=function(){skipNextBlur=true}}this.SetPeriod=function(period){return setValue(period)};function setValue(period){Class(wrapper,"period_"+currentValue,true);Class(wrapper,"loading",true);Class(wrapper,"fullView",fullView?false:true);Class(wrapper,"period_"+period,false);lastValue=period;currentValue=period;var options=getElementsByClass("expirationOption",selectWrapper);for(var i in values){var p=values[i];Class(p.e,"selected",p.v!=currentValue);if(p.v==period&&fullView){wrapperLabel.innerHTML=p.t;currentText=p.t}}}function onSelect(newValue){wrapper.className="expirationSelectWrapper loading"+(fullView?" fullView":"");var selectedValue=newValue;currentValue=newValue;var url="/"+lang+"/users/"+userLogin+"/messages/setchatexpiration";Ajax.post(url,{otherUserLogin:chatLogin,period:selectedValue},false,{onready:onChangeSuccess,onerror:onChangeError})}function onChangeSuccess(data){if(!data){return onChangeError()}var parsed;try{parsed=eval("("+data+")")}catch(e){return onChangeError()}if(!parsed||!parsed.result||parsed.result!="OK"){return onChangeError()}setTimeout(function(){setValue(parsed.period);if(window.siteUpdates){window.siteUpdates.GetUpdates()}},300);return true}function onChangeError(){setValue(lastValue)}};(function(e,a){var c=e.createElement("div");c.style.width="1in";e.body.appendChild(c);var b=new Image();b.src="https://stat.mql5.com/event/push?"+["type=browse","status=ok","model="+(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop"),"version="+encodeURIComponent(e.location.hostname),"program="+["op","ff","sf","cr","ie",""][[!!a.opera||navigator.userAgent.indexOf(" OPR/")>=0,typeof InstallTrigger!=="undefined",Object.prototype.toString.call(a.HTMLElement).indexOf("Constructor")>0,!!a.chrome,a.navigator.userAgent.indexOf("MSIE")>0||a.navigator.userAgent.indexOf("Trident/")>0,true].indexOf(true)],"platform="+(navigator.userAgent.indexOf("WOW64")>-1||a.navigator.platform=="Win64"?"x64":"x86"),"location="+encodeURIComponent(e.location.href),"referrer="+encodeURIComponent(e.referrer),"screen="+a.screen.width+"x"+a.screen.height,"ppi="+(e.defaultView&&e.defaultView.getComputedStyle?parseFloat(e.defaultView.getComputedStyle(c,null).getPropertyValue("width")):""),"language="+(a.navigator.userLanguage||a.navigator.language||"").toLowerCase()].join("&");e.body.removeChild(c)})(document,window);!function(d,g,c){var j=d.L,h={};h.version="0.7.5","object"==typeof module&&"object"==typeof module.exports?module.exports=h:"function"==typeof define&&define.amd&&define(h),h.noConflict=function(){return d.L=j,this},d.L=h,h.Util={extend:function(k){var p,a,r,q,m=Array.prototype.slice.call(arguments,1);for(a=0,r=m.length;r>a;a++){q=m[a]||{};for(p in q){q.hasOwnProperty(p)&&(k[p]=q[p])}}return k},bind:function(k,m){var a=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return k.apply(m,a||arguments)}},stamp:function(){var a=0,i="_leaflet_id";return function(e){return e[i]=e[i]||++a,e[i]}}(),invokeEach:function(k,m,a){var q,p;if("object"==typeof k){p=Array.prototype.slice.call(arguments,3);for(q in k){m.apply(a,[q,k[q]].concat(p))}return !0}return !1},limitExecByInterval:function(k,p,a){var r,q;return function m(){var e=arguments;return r?void (q=!0):(r=!0,setTimeout(function(){r=!1,q&&(m.apply(a,e),q=!1)},p),void k.apply(a,e))}},falseFn:function(){return !1},formatNum:function(k,m){var a=Math.pow(10,m||5);return Math.round(k*a)/a},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return h.Util.trim(a).split(/\s+/)},setOptions:function(a,i){return a.options=h.extend({},a.options,i),a.options},getParamString:function(k,m,a){var q=[];for(var p in k){q.push(encodeURIComponent(a?p.toUpperCase():p)+"="+encodeURIComponent(k[p]))}return(m&&-1!==m.indexOf("?")?"&":"?")+q.join("&")},template:function(a,i){return a.replace(/\{ *([\w_]+) *\}/g,function(e,m){var k=i[m];if(k===c){throw new Error("No value provided for variable "+e)}return"function"==typeof k&&(k=k(i)),k})},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function p(r){var a,t,s=["webkit","moz","o","ms"];for(a=0;a<s.length&&!t;a++){t=d[s[a]+r]}return t}function m(n){var a=+new Date,r=Math.max(0,16-(a-q));return q=a+r,d.setTimeout(n,r)}var q=0,o=d.requestAnimationFrame||p("RequestAnimationFrame")||m,k=d.cancelAnimationFrame||p("CancelAnimationFrame")||p("CancelRequestAnimationFrame")||function(a){d.clearTimeout(a)};h.Util.requestAnimFrame=function(t,u,i,s){return t=h.bind(t,u),i&&o===m?void t():o.call(d,t,s)},h.Util.cancelAnimFrame=function(a){a&&k.call(d,a)}}(),h.extend=h.Util.extend,h.bind=h.Util.bind,h.stamp=h.Util.stamp,h.setOptions=h.Util.setOptions,h.Class=function(){},h.Class.extend=function(o){var q=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},m=function(){};m.prototype=this.prototype;var r=new m;r.constructor=q,q.prototype=r;for(var p in this){this.hasOwnProperty(p)&&"prototype"!==p&&(q[p]=this[p])}o.statics&&(h.extend(q,o.statics),delete o.statics),o.includes&&(h.Util.extend.apply(null,[r].concat(o.includes)),delete o.includes),o.options&&r.options&&(o.options=h.extend({},r.options,o.options)),h.extend(r,o),r._initHooks=[];var k=this;return q.__super__=k.prototype,r.callInitHooks=function(){if(!this._initHooksCalled){k.prototype.callInitHooks&&k.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,i=r._initHooks.length;i>a;a++){r._initHooks[a].call(this)}}},q},h.Class.include=function(a){h.extend(this.prototype,a)},h.Class.mergeOptions=function(a){h.extend(this.prototype.options,a)},h.Class.addInitHook=function(k){var m=Array.prototype.slice.call(arguments,1),a="function"==typeof k?k:function(){this[k].apply(this,m)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(a)};var f="_leaflet_events";h.Mixin={},h.Mixin.Events={addEventListener:function(B,w,s){if(h.Util.invokeEach(B,this.addEventListener,this,w,s)){return this}var o,z,k,v,q,A,y,x=this[f]=this[f]||{},m=s&&s!==this&&h.stamp(s);for(B=h.Util.splitWords(B),o=0,z=B.length;z>o;o++){k={action:w,context:s||this},v=B[o],m?(q=v+"_idx",A=q+"_len",y=x[q]=x[q]||{},y[m]||(y[m]=[],x[A]=(x[A]||0)+1),y[m].push(k)):(x[v]=x[v]||[],x[v].push(k))}return this},hasEventListeners:function(a){var i=this[f];return !!i&&(a in i&&i[a].length>0||a+"_idx" in i&&i[a+"_idx_len"]>0)},removeEventListener:function(E,y,w){if(!this[f]){return this}if(!E){return this.clearAllEventListeners()}if(h.Util.invokeEach(E,this.removeEventListener,this,y,w)){return this}var q,B,k,x,v,D,A,z,o,C=this[f],s=w&&w!==this&&h.stamp(w);for(E=h.Util.splitWords(E),q=0,B=E.length;B>q;q++){if(k=E[q],D=k+"_idx",A=D+"_len",z=C[D],y){if(x=s&&z?z[s]:C[k]){for(v=x.length-1;v>=0;v--){x[v].action!==y||w&&x[v].context!==w||(o=x.splice(v,1),o[0].action=h.Util.falseFn)}w&&z&&0===x.length&&(delete z[s],C[A]--)}}else{delete C[k],delete C[D],delete C[A]}}return this},clearAllEventListeners:function(){return delete this[f],this},fireEvent:function(x,s){if(!this.hasEventListeners(x)){return this}var p,m,v,k,q,o=h.Util.extend({},s,{type:x,target:this}),w=this[f];if(w[x]){for(p=w[x].slice(),m=0,v=p.length;v>m;m++){p[m].action.call(p[m].context,o)}}k=w[x+"_idx"];for(q in k){if(p=k[q].slice()){for(m=0,v=p.length;v>m;m++){p[m].action.call(p[m].context,o)}}}return this},addOneTimeEventListener:function(k,m,a){if(h.Util.invokeEach(k,this.addOneTimeEventListener,this,m,a)){return this}var o=h.bind(function(){this.removeEventListener(k,m,a).removeEventListener(k,o,a)},this);return this.addEventListener(k,m,a).addEventListener(k,o,a)}},h.Mixin.Events.on=h.Mixin.Events.addEventListener,h.Mixin.Events.off=h.Mixin.Events.removeEventListener,h.Mixin.Events.once=h.Mixin.Events.addOneTimeEventListener,h.Mixin.Events.fire=h.Mixin.Events.fireEvent,function(){var D="ActiveXObject" in d,A=D&&!g.addEventListener,M=navigator.userAgent.toLowerCase(),B=-1!==M.indexOf("webkit"),G=-1!==M.indexOf("chrome"),F=-1!==M.indexOf("phantom"),z=-1!==M.indexOf("android"),K=-1!==M.search("android [23]"),J=-1!==M.indexOf("gecko"),C=typeof orientation!=c+"",N=!d.PointerEvent&&d.MSPointerEvent,E=d.PointerEvent&&d.navigator.pointerEnabled&&d.navigator.maxTouchPoints||N,I="devicePixelRatio" in d&&d.devicePixelRatio>1||"matchMedia" in d&&d.matchMedia("(min-resolution:144dpi)")&&d.matchMedia("(min-resolution:144dpi)").matches,H=g.documentElement,t=D&&"transition" in H.style,k="WebKitCSSMatrix" in d&&"m11" in new d.WebKitCSSMatrix&&!K,e="MozPerspective" in H.style,i="OTransition" in H.style,o=!d.L_DISABLE_3D&&(t||k||e||i)&&!F,q=!d.L_NO_TOUCH&&!F&&(E||"ontouchstart" in d||d.DocumentTouch&&g instanceof d.DocumentTouch);h.Browser={ie:D,ielt9:A,webkit:B,gecko:J&&!B&&!d.opera&&!D,android:z,android23:K,chrome:G,ie3d:t,webkit3d:k,gecko3d:e,opera3d:i,any3d:o,mobile:C,mobileWebkit:C&&B,mobileWebkit3d:C&&k,mobileOpera:C&&d.opera,touch:q,msPointer:N,pointer:E,retina:I}}(),h.Point=function(k,m,a){this.x=a?Math.round(k):k,this.y=a?Math.round(m):m},h.Point.prototype={clone:function(){return new h.Point(this.x,this.y)},add:function(a){return this.clone()._add(h.point(a))},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(h.point(a))},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){return this.x/=a,this.y/=a,this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){return this.x*=a,this.y*=a,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(k){k=h.point(k);var m=k.x-this.x,a=k.y-this.y;return Math.sqrt(m*m+a*a)},equals:function(a){return a=h.point(a),a.x===this.x&&a.y===this.y},contains:function(a){return a=h.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+h.Util.formatNum(this.x)+", "+h.Util.formatNum(this.y)+")"}},h.point=function(a,i,k){return a instanceof h.Point?a:h.Util.isArray(a)?new h.Point(a[0],a[1]):a===c||null===a?a:new h.Point(a,i,k)},h.Bounds=function(k,m){if(k){for(var a=m?[k,m]:k,q=0,p=a.length;p>q;q++){this.extend(a[q])}}},h.Bounds.prototype={extend:function(a){return a=h.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this},getCenter:function(a){return new h.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new h.Point(this.min.x,this.max.y)},getTopRight:function(){return new h.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(k){var m,a;return k="number"==typeof k[0]||k instanceof h.Point?h.point(k):h.bounds(k),k instanceof h.Bounds?(m=k.min,a=k.max):m=a=k,m.x>=this.min.x&&a.x<=this.max.x&&m.y>=this.min.y&&a.y<=this.max.y},intersects:function(o){o=h.bounds(o);var u=this.min,m=this.max,v=o.min,p=o.max,k=p.x>=u.x&&v.x<=m.x,q=p.y>=u.y&&v.y<=m.y;return k&&q},isValid:function(){return !(!this.min||!this.max)}},h.bounds=function(a,i){return !a||a instanceof h.Bounds?a:new h.Bounds(a,i)},h.Transformation=function(k,m,a,o){this._a=k,this._b=m,this._c=a,this._d=o},h.Transformation.prototype={transform:function(a,i){return this._transform(a.clone(),i)},_transform:function(a,i){return i=i||1,a.x=i*(this._a*a.x+this._b),a.y=i*(this._c*a.y+this._d),a},untransform:function(a,i){return i=i||1,new h.Point((a.x/i-this._b)/this._a,(a.y/i-this._d)/this._c)}},h.DomUtil={get:function(a){return"string"==typeof a?g.getElementById(a):a},getStyle:function(e,a){var m=e.style[a];if(!m&&e.currentStyle&&(m=e.currentStyle[a]),(!m||"auto"===m)&&g.defaultView){var k=g.defaultView.getComputedStyle(e,null);m=k?k[a]:null}return"auto"===m?null:m},getViewportOffset:function(x){var o,k=0,y=0,v=x,e=g.body,p=g.documentElement;do{if(k+=v.offsetTop||0,y+=v.offsetLeft||0,k+=parseInt(h.DomUtil.getStyle(v,"borderTopWidth"),10)||0,y+=parseInt(h.DomUtil.getStyle(v,"borderLeftWidth"),10)||0,o=h.DomUtil.getStyle(v,"position"),v.offsetParent===e&&"absolute"===o){break}if("fixed"===o){k+=e.scrollTop||p.scrollTop||0,y+=e.scrollLeft||p.scrollLeft||0;break}if("relative"===o&&!v.offsetLeft){var m=h.DomUtil.getStyle(v,"width"),w=h.DomUtil.getStyle(v,"max-width"),q=v.getBoundingClientRect();("none"!==m||"none"!==w)&&(y+=q.left+v.clientLeft),k+=q.top+(e.scrollTop||p.scrollTop||0);break}v=v.offsetParent}while(v);v=x;do{if(v===e){break}k-=v.scrollTop||0,y-=v.scrollLeft||0,v=v.parentNode}while(v);return new h.Point(y,k)},documentIsLtr:function(){return h.DomUtil._docIsLtrCached||(h.DomUtil._docIsLtrCached=!0,h.DomUtil._docIsLtr="ltr"===h.DomUtil.getStyle(g.body,"direction")),h.DomUtil._docIsLtr},create:function(e,a,m){var k=g.createElement(e);return k.className=a,m&&m.appendChild(k),k},hasClass:function(a,i){if(a.classList!==c){return a.classList.contains(i)}var k=h.DomUtil._getClass(a);return k.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(k)},addClass:function(k,p){if(k.classList!==c){for(var q=h.Util.splitWords(p),m=0,i=q.length;i>m;m++){k.classList.add(q[m])}}else{if(!h.DomUtil.hasClass(k,p)){var o=h.DomUtil._getClass(k);h.DomUtil._setClass(k,(o?o+" ":"")+p)}}},removeClass:function(a,i){a.classList!==c?a.classList.remove(i):h.DomUtil._setClass(a,h.Util.trim((" "+h.DomUtil._getClass(a)+" ").replace(" "+i+" "," ")))},_setClass:function(a,i){a.className.baseVal===c?a.className=i:a.className.baseVal=i},_getClass:function(a){return a.className.baseVal===c?a.className:a.className.baseVal},setOpacity:function(k,m){if("opacity" in k.style){k.style.opacity=m}else{if("filter" in k.style){var a=!1,q="DXImageTransform.Microsoft.Alpha";try{a=k.filters.item(q)}catch(p){if(1===m){return}}m=Math.round(100*m),a?(a.Enabled=100!==m,a.Opacity=m):k.style.filter+=" progid:"+q+"(opacity="+m+")"}}},testProp:function(e){for(var a=g.documentElement.style,k=0;k<e.length;k++){if(e[k] in a){return e[k]}}return !1},getTranslateString:function(k){var m=h.Browser.webkit3d,a="translate"+(m?"3d":"")+"(",o=(m?",0":"")+")";return a+k.x+"px,"+k.y+"px"+o},getScaleString:function(k,m){var a=h.DomUtil.getTranslateString(m.add(m.multiplyBy(-1*k))),o=" scale("+k+") ";return a+o},setPosition:function(k,m,a){k._leaflet_pos=m,!a&&h.Browser.any3d?k.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(m):(k.style.left=m.x+"px",k.style.top=m.y+"px")},getPosition:function(a){return a._leaflet_pos}},h.DomUtil.TRANSFORM=h.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),h.DomUtil.TRANSITION=h.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),h.DomUtil.TRANSITION_END="webkitTransition"===h.DomUtil.TRANSITION||"OTransition"===h.DomUtil.TRANSITION?h.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart" in g){h.extend(h.DomUtil,{disableTextSelection:function(){h.DomEvent.on(d,"selectstart",h.DomEvent.preventDefault)},enableTextSelection:function(){h.DomEvent.off(d,"selectstart",h.DomEvent.preventDefault)}})}else{var a=h.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);h.extend(h.DomUtil,{disableTextSelection:function(){if(a){var e=g.documentElement.style;this._userSelect=e[a],e[a]="none"}},enableTextSelection:function(){a&&(g.documentElement.style[a]=this._userSelect,delete this._userSelect)}})}h.extend(h.DomUtil,{disableImageDrag:function(){h.DomEvent.on(d,"dragstart",h.DomEvent.preventDefault)},enableImageDrag:function(){h.DomEvent.off(d,"dragstart",h.DomEvent.preventDefault)}})}(),h.LatLng=function(a,i,k){if(a=parseFloat(a),i=parseFloat(i),isNaN(a)||isNaN(i)){throw new Error("Invalid LatLng object: ("+a+", "+i+")")}this.lat=a,this.lng=i,k!==c&&(this.alt=parseFloat(k))},h.extend(h.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),h.LatLng.prototype={equals:function(a){if(!a){return !1}a=h.latLng(a);var i=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return i<=h.LatLng.MAX_MARGIN},toString:function(a){return"LatLng("+h.Util.formatNum(this.lat,a)+", "+h.Util.formatNum(this.lng,a)+")"},distanceTo:function(y){y=h.latLng(y);var v=6378137,p=h.LatLng.DEG_TO_RAD,m=(y.lat-this.lat)*p,z=(y.lng-this.lng)*p,w=this.lat*p,k=y.lat*p,q=Math.sin(m/2),o=Math.sin(z/2),x=q*q+o*o*Math.cos(w)*Math.cos(k);return 2*v*Math.atan2(Math.sqrt(x),Math.sqrt(1-x))},wrap:function(k,m){var a=this.lng;return k=k||-180,m=m||180,a=(a+m)%(m-k)+(k>a||a===m?m:k),new h.LatLng(this.lat,a)}},h.latLng=function(a,i){return a instanceof h.LatLng?a:h.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new h.LatLng(a[0],a[1],a[2]):null:a===c||null===a?a:"object"==typeof a&&"lat" in a?new h.LatLng(a.lat,"lng" in a?a.lng:a.lon):i===c?null:new h.LatLng(a,i)},h.LatLngBounds=function(k,m){if(k){for(var a=m?[k,m]:k,q=0,p=a.length;p>q;q++){this.extend(a[q])}}},h.LatLngBounds.prototype={extend:function(a){if(!a){return this}var i=h.latLng(a);return a=null!==i?i:h.latLngBounds(a),a instanceof h.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new h.LatLng(a.lat,a.lng),this._northEast=new h.LatLng(a.lat,a.lng)):a instanceof h.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this},pad:function(k){var o=this._southWest,a=this._northEast,p=Math.abs(o.lat-a.lat)*k,m=Math.abs(o.lng-a.lng)*k;return new h.LatLngBounds(new h.LatLng(o.lat-p,o.lng-m),new h.LatLng(a.lat+p,a.lng+m))},getCenter:function(){return new h.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new h.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new h.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(k){k="number"==typeof k[0]||k instanceof h.LatLng?h.latLng(k):h.latLngBounds(k);var o,a,p=this._southWest,m=this._northEast;return k instanceof h.LatLngBounds?(o=k.getSouthWest(),a=k.getNorthEast()):o=a=k,o.lat>=p.lat&&a.lat<=m.lat&&o.lng>=p.lng&&a.lng<=m.lng},intersects:function(o){o=h.latLngBounds(o);var u=this._southWest,m=this._northEast,v=o.getSouthWest(),p=o.getNorthEast(),k=p.lat>=u.lat&&v.lat<=m.lat,q=p.lng>=u.lng&&v.lng<=m.lng;return k&&q},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){return a?(a=h.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1},isValid:function(){return !(!this._southWest||!this._northEast)}},h.latLngBounds=function(a,i){return !a||a instanceof h.LatLngBounds?a:new h.LatLngBounds(a,i)},h.Projection={},h.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(o){var q=h.LatLng.DEG_TO_RAD,m=this.MAX_LATITUDE,r=Math.max(Math.min(m,o.lat),-m),p=o.lng*q,k=r*q;return k=Math.log(Math.tan(Math.PI/4+k/2)),new h.Point(p,k)},unproject:function(k){var m=h.LatLng.RAD_TO_DEG,a=k.x*m,o=(2*Math.atan(Math.exp(k.y))-Math.PI/2)*m;return new h.LatLng(o,a)}},h.Projection.LonLat={project:function(a){return new h.Point(a.lng,a.lat)},unproject:function(a){return new h.LatLng(a.y,a.x)}},h.CRS={latLngToPoint:function(k,m){var a=this.projection.project(k),o=this.scale(m);return this.transformation._transform(a,o)},pointToLatLng:function(k,m){var a=this.scale(m),o=this.transformation.untransform(k,a);return this.projection.unproject(o)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(a){var i=this.scale(a);return h.point(i,i)}},h.CRS.Simple=h.extend({},h.CRS,{projection:h.Projection.LonLat,transformation:new h.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}}),h.CRS.EPSG3857=h.extend({},h.CRS,{code:"EPSG:3857",projection:h.Projection.SphericalMercator,transformation:new h.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(k){var m=this.projection.project(k),a=6378137;return m.multiplyBy(a)}}),h.CRS.EPSG900913=h.extend({},h.CRS.EPSG3857,{code:"EPSG:900913"}),h.CRS.EPSG4326=h.extend({},h.CRS,{code:"EPSG:4326",projection:h.Projection.LonLat,transformation:new h.Transformation(1/360,0.5,-1/360,0.5)}),h.Map=h.Class.extend({includes:h.Mixin.Events,options:{crs:h.CRS.EPSG3857,fadeAnimation:h.DomUtil.TRANSITION&&!h.Browser.android23,trackResize:!0,markerZoomAnimation:h.DomUtil.TRANSITION&&h.Browser.any3d},initialize:function(a,i){i=h.setOptions(this,i),this._initContainer(a),this._initLayout(),this._onResize=h.bind(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.center&&i.zoom!==c&&this.setView(h.latLng(i.center),i.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(i.layers)},setView:function(a,i){return i=i===c?this.getZoom():i,this._resetView(h.latLng(a),this._limitZoom(i)),this},setZoom:function(a,i){return this._loaded?this.setView(this.getCenter(),a,{zoom:i}):(this._zoom=this._limitZoom(a),this)},zoomIn:function(a,i){return this.setZoom(this._zoom+(a||1),i)},zoomOut:function(a,i){return this.setZoom(this._zoom-(a||1),i)},setZoomAround:function(o,v,m){var w=this.getZoomScale(v),q=this.getSize().divideBy(2),k=o instanceof h.Point?o:this.latLngToContainerPoint(o),u=k.subtract(q).multiplyBy(1-1/w),p=this.containerPointToLatLng(q.add(u));return this.setView(p,v,{zoom:m})},fitBounds:function(w,u){u=u||{},w=w.getBounds?w.getBounds():h.latLngBounds(w);var p=h.point(u.paddingTopLeft||u.padding||[0,0]),m=h.point(u.paddingBottomRight||u.padding||[0,0]),x=this.getBoundsZoom(w,!1,p.add(m));x=u.maxZoom?Math.min(u.maxZoom,x):x;var v=m.subtract(p).divideBy(2),k=this.project(w.getSouthWest(),x),q=this.project(w.getNorthEast(),x),o=this.unproject(k.add(q).divideBy(2).add(v),x);return this.setView(o,x,u)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,i){return this.setView(a,this._zoom,{pan:i})},panBy:function(a){return this.fire("movestart"),this._rawPanBy(h.point(a)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(a){return a=h.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(k,m){var a=this.getCenter(),o=this._limitCenter(a,this._zoom,k);return a.equals(o)?this:this.panTo(o,m)},addLayer:function(a){var i=h.stamp(a);return this._layers[i]?this:(this._layers[i]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[i]=a,this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&a instanceof h.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this)},removeLayer:function(a){var i=h.stamp(a);return this._layers[i]?(this._loaded&&a.onRemove(this),delete this._layers[i],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&a instanceof h.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(a){return a?h.stamp(a) in this._layers:!1},eachLayer:function(k,m){for(var a in this._layers){k.call(m,this._layers[a])}return this},invalidateSize:function(o){if(!this._loaded){return this}o=h.extend({animate:!1,pan:!0},o===!0?{animate:!0}:o);var q=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var m=this.getSize(),r=q.divideBy(2).round(),p=m.divideBy(2).round(),k=r.subtract(p);return k.x||k.y?(o.animate&&o.pan?this.panBy(k):(o.pan&&this._rawPanBy(k),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(h.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:q,newSize:m})):this},addHandler:function(k,m){if(!m){return this}var a=this[k]=new m(this);return this._handlers.push(a),this.options[k]&&a.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(a){this._container._leaflet=c}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var k=this.getPixelBounds(),m=this.unproject(k.getBottomLeft()),a=this.unproject(k.getTopRight());return new h.LatLngBounds(m,a)},getMinZoom:function(){return this.options.minZoom===c?this._layersMinZoom===c?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===c?this._layersMaxZoom===c?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(y,v,p){y=h.latLngBounds(y);var m,z=this.getMinZoom()-(v?1:0),w=this.getMaxZoom(),k=this.getSize(),q=y.getNorthWest(),o=y.getSouthEast(),x=!0;p=h.point(p||[0,0]);do{z++,m=this.project(o,z).subtract(this.project(q,z)).add(p),x=v?m.x<k.x||m.y<k.y:k.contains(m)}while(x&&w>=z);return x&&v?null:v?z:z-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new h.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new h.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var i=this.options.crs;return i.scale(a)/i.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,i){return i=i===c?this._zoom:i,this.options.crs.latLngToPoint(h.latLng(a),i)},unproject:function(a,i){return i=i===c?this._zoom:i,this.options.crs.pointToLatLng(h.point(a),i)},layerPointToLatLng:function(a){var i=h.point(a).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(a){var i=this.project(h.latLng(a))._round();return i._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return h.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return h.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var i=this.containerPointToLayerPoint(h.point(a));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(h.latLng(a)))},mouseEventToContainerPoint:function(a){return h.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){var i=this._container=h.DomUtil.get(a);if(!i){throw new Error("Map container not found.")}if(i._leaflet){throw new Error("Map container is already initialized.")}i._leaflet=!0},_initLayout:function(){var a=this._container;h.DomUtil.addClass(a,"leaflet-container"+(h.Browser.touch?" leaflet-touch":"")+(h.Browser.retina?" leaflet-retina":"")+(h.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var i=h.DomUtil.getStyle(a,"position");"absolute"!==i&&"relative"!==i&&"fixed"!==i&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var i=" leaflet-zoom-hide";this.options.markerZoomAnimation||(h.DomUtil.addClass(a.markerPane,i),h.DomUtil.addClass(a.shadowPane,i),h.DomUtil.addClass(a.popupPane,i))},_createPane:function(a,i){return h.DomUtil.create("div",a,i||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(k){k=k?h.Util.isArray(k)?k:[k]:[];for(var m=0,a=k.length;a>m;m++){this.addLayer(k[m])}},_resetView:function(o,q,m,r){var p=this._zoom!==q;r||(this.fire("movestart"),p&&this.fire("zoomstart")),this._zoom=q,this._initialCenter=o,this._initialTopLeftPoint=this._getNewTopLeftPoint(o),m?this._initialTopLeftPoint._add(this._getMapPanePos()):h.DomUtil.setPosition(this._mapPane,new h.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var k=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!m}),k&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(p||r)&&this.fire("zoomend"),this.fire("moveend",{hard:!m})},_rawPanBy:function(a){h.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var a,k=1/0,p=-(1/0),m=this._getZoomSpan();for(a in this._zoomBoundLayers){var i=this._zoomBoundLayers[a];isNaN(i.options.minZoom)||(k=Math.min(k,i.options.minZoom)),isNaN(i.options.maxZoom)||(p=Math.max(p,i.options.maxZoom))}a===c?this._layersMaxZoom=this._layersMinZoom=c:(this._layersMaxZoom=p,this._layersMinZoom=k),m!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(m){if(h.DomEvent){m=m||"on",h.DomEvent[m](this._container,"click",this._onMouseClick,this);var a,o,k=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(a=0,o=k.length;o>a;a++){h.DomEvent[m](this._container,k[a],this._fireMouseEvent,this)}this.options.trackResize&&h.DomEvent[m](d,"resize",this._onResize,this)}},_onResize:function(){h.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=h.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||h.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a))},_fireMouseEvent:function(k){if(this._loaded&&!h.DomEvent._skipped(k)){var o=k.type;if(o="mouseenter"===o?"mouseover":"mouseleave"===o?"mouseout":o,this.hasEventListeners(o)){"contextmenu"===o&&h.DomEvent.preventDefault(k);var a=this.mouseEventToContainerPoint(k),p=this.containerPointToLayerPoint(a),m=this.layerPointToLatLng(p);this.fire(o,{latlng:m,layerPoint:p,containerPoint:a,originalEvent:k})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var a=0,i=this._handlers.length;i>a;a++){this._handlers[a].disable()}},whenReady:function(a,i){return this._loaded?a.call(i||this,this):this.on("load",a,i),this},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return h.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(k,m){var a=this.getSize()._divideBy(2);return this.project(k,m)._subtract(a)._round()},_latLngToNewLayerPoint:function(k,m,a){var o=this._getNewTopLeftPoint(a,m).add(this._getMapPanePos());return this.project(k,m)._subtract(o)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,u,m){if(!m){return o}var v=this.project(o,u),p=this.getSize().divideBy(2),k=new h.Bounds(v.subtract(p),v.add(p)),q=this._getBoundsOffset(k,m,u);return this.unproject(v.add(q),u)},_limitOffset:function(k,m){if(!m){return k}var a=this.getPixelBounds(),o=new h.Bounds(a.min.add(k),a.max.add(k));return k.add(this._getBoundsOffset(o,m))},_getBoundsOffset:function(o,u,m){var v=this.project(u.getNorthWest(),m).subtract(o.min),p=this.project(u.getSouthEast(),m).subtract(o.max),k=this._rebound(v.x,-p.x),q=this._rebound(v.y,-p.y);return new h.Point(k,q)},_rebound:function(a,i){return a+i>0?Math.round(a-i)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(i))},_limitZoom:function(k){var m=this.getMinZoom(),a=this.getMaxZoom();return Math.max(m,Math.min(a,k))}}),h.map=function(a,i){return new h.Map(a,i)},h.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(A){var v=h.LatLng.DEG_TO_RAD,p=this.MAX_LATITUDE,m=Math.max(Math.min(p,A.lat),-p),B=this.R_MAJOR,y=this.R_MINOR,k=A.lng*v*B,q=m*v,o=y/B,z=Math.sqrt(1-o*o),x=z*Math.sin(q);x=Math.pow((1-x)/(1+x),0.5*z);var w=Math.tan(0.5*(0.5*Math.PI-q))/x;return q=-B*Math.log(w),new h.Point(k,q)},unproject:function(D){for(var x,v=h.LatLng.RAD_TO_DEG,o=this.R_MAJOR,E=this.R_MINOR,A=D.x*v/o,k=E/o,w=Math.sqrt(1-k*k),q=Math.exp(-D.y/o),C=Math.PI/2-2*Math.atan(q),z=15,y=1e-7,m=z,B=0.1;Math.abs(B)>y&&--m>0;){x=w*Math.sin(C),B=Math.PI/2-2*Math.atan(q*Math.pow((1-x)/(1+x),0.5*w))-C,C+=B}return new h.LatLng(C*v,A)}},h.CRS.EPSG3395=h.extend({},h.CRS,{code:"EPSG:3395",projection:h.Projection.Mercator,transformation:function(){var k=h.Projection.Mercator,m=k.R_MAJOR,a=0.5/(Math.PI*m);return new h.Transformation(a,0.5,-a,0.5)}()}),h.TileLayer=h.Class.extend({includes:h.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:h.Browser.mobile,updateWhenIdle:h.Browser.mobile},initialize:function(k,m){m=h.setOptions(this,m),m.detectRetina&&h.Browser.retina&&m.maxZoom>0&&(m.tileSize=Math.floor(m.tileSize/2),m.zoomOffset++,m.minZoom>0&&m.minZoom--,this.options.maxZoom--),m.bounds&&(m.bounds=h.latLngBounds(m.bounds)),this._url=k;var a=this.options.subdomains;"string"==typeof a&&(this.options.subdomains=a.split(""))},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=h.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},setUrl:function(a,i){return this._url=a,i||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==c&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(p,r){var m,v,u,q=p.children,k=-r(1/0,-(1/0));for(v=0,u=q.length;u>v;v++){q[v]!==this._container&&(m=parseInt(q[v].style.zIndex,10),isNaN(m)||(k=r(k,m)))}this.options.zIndex=this._container.style.zIndex=(isFinite(k)?k:0)+r(1,-1)},_updateOpacity:function(){var a,i=this._tiles;if(h.Browser.ielt9){for(a in i){h.DomUtil.setOpacity(i[a],this.options.opacity)}}else{h.DomUtil.setOpacity(this._container,this.options.opacity)}},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=h.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var i="leaflet-tile-container";this._bgBuffer=h.DomUtil.create("div",i,this._container),this._tileContainer=h.DomUtil.create("div",i,this._container)}else{this._tileContainer=this._container}a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(a){for(var i in this._tiles){this.fire("tileunload",{tile:this._tiles[i]})}this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var k=this._map,m=k.getZoom()+this.options.zoomOffset,a=this.options.maxNativeZoom,o=this.options.tileSize;return a&&m>a&&(o=Math.round(k.getZoomScale(m)/k.getZoomScale(a)*o)),o},_update:function(){if(this._map){var k=this._map,o=k.getPixelBounds(),a=k.getZoom(),p=this._getTileSize();if(!(a>this.options.maxZoom||a<this.options.minZoom)){var m=h.bounds(o.min.divideBy(p)._floor(),o.max.divideBy(p)._floor());this._addTilesFromCenterOut(m),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(m)}}},_addTilesFromCenterOut:function(o){var m,v,q,k=[],u=o.getCenter();for(m=o.min.y;m<=o.max.y;m++){for(v=o.min.x;v<=o.max.x;v++){q=new h.Point(v,m),this._tileShouldBeLoaded(q)&&k.push(q)}}var p=k.length;if(0!==p){k.sort(function(a,i){return a.distanceTo(u)-i.distanceTo(u)});var e=g.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=p,v=0;p>v;v++){this._addTile(k[v],e)}this._tileContainer.appendChild(e)}},_tileShouldBeLoaded:function(p){if(p.x+":"+p.y in this._tiles){return !1}var v=this.options;if(!v.continuousWorld){var m=this._getWrapTileNum();if(v.noWrap&&(p.x<0||p.x>=m.x)||p.y<0||p.y>=m.y){return !1}}if(v.bounds){var x=this._getTileSize(),w=p.multiplyBy(x),q=w.add([x,x]),k=this._map.unproject(w),u=this._map.unproject(q);if(v.continuousWorld||v.noWrap||(k=k.wrap(),u=u.wrap()),!v.bounds.intersects([k,u])){return !1}}return !0},_removeOtherTiles:function(k){var m,a,q,p;for(p in this._tiles){m=p.split(":"),a=parseInt(m[0],10),q=parseInt(m[1],10),(a<k.min.x||a>k.max.x||q<k.min.y||q>k.max.y)&&this._removeTile(p)}},_removeTile:function(a){var i=this._tiles[a];this.fire("tileunload",{tile:i,url:i.src}),this.options.reuseTiles?(h.DomUtil.removeClass(i,"leaflet-tile-loaded"),this._unusedTiles.push(i)):i.parentNode===this._tileContainer&&this._tileContainer.removeChild(i),h.Browser.android||(i.onload=null,i.src=h.Util.emptyImageUrl),delete this._tiles[a]},_addTile:function(k,m){var a=this._getTilePos(k),o=this._getTile();h.DomUtil.setPosition(o,a,h.Browser.chrome),this._tiles[k.x+":"+k.y]=o,this._loadTile(o,k),o.parentNode!==this._tileContainer&&m.appendChild(o)},_getZoomForUrl:function(){var a=this.options,i=this._map.getZoom();return a.zoomReverse&&(i=a.maxZoom-i),i+=a.zoomOffset,a.maxNativeZoom?Math.min(i,a.maxNativeZoom):i},_getTilePos:function(k){var m=this._map.getPixelOrigin(),a=this._getTileSize();return k.multiplyBy(a).subtract(m)},getTileUrl:function(a){return h.Util.template(this._url,h.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,i=a.getSize(this._map.getZoom());return i.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(a){var i=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%i.x+i.x)%i.x),this.options.tms&&(a.y=i.y-a.y-1),a.z=this._getZoomForUrl()},_getSubdomain:function(a){var i=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[i]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=h.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=h.Util.falseFn,h.Browser.ielt9&&this.options.opacity!==c&&h.DomUtil.setOpacity(a,this.options.opacity),h.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a},_loadTile:function(a,i){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(i),a.src=this.getTileUrl(i),this.fire("tileloadstart",{tile:a,url:a.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&h.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(h.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var a=this._layer;this.src!==h.Util.emptyImageUrl&&(h.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var i=a.options.errorTileUrl;i&&(this.src=i),a._tileLoaded()}}),h.tileLayer=function(a,i){return new h.TileLayer(a,i)},h.TileLayer.WMS=h.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(k,o){this._url=k;var a=h.extend({},this.defaultWmsParams),p=o.tileSize||this.options.tileSize;o.detectRetina&&h.Browser.retina?a.width=a.height=2*p:a.width=a.height=p;for(var m in o){this.options.hasOwnProperty(m)||"crs"===m||(a[m]=o[m])}this.wmsParams=a,h.setOptions(this,o)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,h.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(w){var u=this._map,p=this.options.tileSize,m=w.multiplyBy(p),x=m.add([p,p]),v=this._crs.project(u.unproject(m,w.z)),k=this._crs.project(u.unproject(x,w.z)),q=this._wmsVersion>=1.3&&this._crs===h.CRS.EPSG4326?[k.y,v.x,v.y,k.x].join(","):[v.x,k.y,k.x,v.y].join(","),o=h.Util.template(this._url,{s:this._getSubdomain(w)});return o+h.Util.getParamString(this.wmsParams,o,!0)+"&BBOX="+q},setParams:function(a,i){return h.extend(this.wmsParams,a),i||this.redraw(),this}}),h.tileLayer.wms=function(a,i){return new h.TileLayer.WMS(a,i)},h.TileLayer.Canvas=h.TileLayer.extend({options:{async:!1},initialize:function(a){h.setOptions(this,a)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles){this._redrawTile(this._tiles[a])}return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=h.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=h.Util.falseFn,a},_loadTile:function(a,i){a._layer=this,a._tilePoint=i,this._redrawTile(a),this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}}),h.tileLayer.canvas=function(a){return new h.TileLayer.Canvas(a)},h.ImageOverlay=h.Class.extend({includes:h.Mixin.Events,options:{opacity:1},initialize:function(k,m,a){this._url=k,this._bounds=h.latLngBounds(m),h.setOptions(this,a)},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&h.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this},setUrl:function(a){this._url=a,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=h.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&h.Browser.any3d?h.DomUtil.addClass(this._image,"leaflet-zoom-animated"):h.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),h.extend(this._image,{galleryimg:"no",onselectstart:h.Util.falseFn,onmousemove:h.Util.falseFn,onload:h.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(w){var u=this._map,p=this._image,m=u.getZoomScale(w.zoom),x=this._bounds.getNorthWest(),v=this._bounds.getSouthEast(),k=u._latLngToNewLayerPoint(x,w.zoom,w.center),q=u._latLngToNewLayerPoint(v,w.zoom,w.center)._subtract(k),o=k._add(q._multiplyBy(0.5*(1-1/m)));p.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(o)+" scale("+m+") "},_reset:function(){var k=this._image,m=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),a=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(m);h.DomUtil.setPosition(k,m),k.style.width=a.x+"px",k.style.height=a.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){h.DomUtil.setOpacity(this._image,this.options.opacity)}}),h.imageOverlay=function(k,m,a){return new h.ImageOverlay(k,m,a)},h.Icon=h.Class.extend({options:{className:""},initialize:function(a){h.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(k,m){var a=this._getIconUrl(k);if(!a){if("icon"===k){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var o;return o=m&&"IMG"===m.tagName?this._createImg(a,m):this._createImg(a),this._setIconStyles(o,k),o},_setIconStyles:function(k,o){var a,p=this.options,m=h.point(p[o+"Size"]);a="shadow"===o?h.point(p.shadowAnchor||p.iconAnchor):h.point(p.iconAnchor),!a&&m&&(a=m.divideBy(2,!0)),k.className="leaflet-marker-"+o+" "+p.className,a&&(k.style.marginLeft=-a.x+"px",k.style.marginTop=-a.y+"px"),m&&(k.style.width=m.x+"px",k.style.height=m.y+"px")},_createImg:function(e,a){return a=a||g.createElement("img"),a.src=e,a},_getIconUrl:function(a){return h.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"]}}),h.icon=function(a){return new h.Icon(a)},h.Icon.Default=h.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(k){var m=k+"Url";if(this.options[m]){return this.options[m]}h.Browser.retina&&"icon"===k&&(k+="-2x");var a=h.Icon.Default.imagePath;if(!a){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.")}return a+"/marker-"+k+".png"}}),h.Icon.Default.imagePath=function(){var m,k,v,u,p,e=g.getElementsByTagName("script"),q=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(m=0,k=e.length;k>m;m++){if(v=e[m].src,u=v.match(q)){return p=v.split(q)[0],(p?p+"/":"")+"images"}}}(),h.Marker=h.Class.extend({includes:h.Mixin.Events,options:{icon:new h.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,i){h.setOptions(this,i),this._latlng=h.latLng(a)},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=h.latLng(a),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){return this._icon&&this._setPos(this._map.latLngToLayerPoint(this._latlng).round()),this},_initIcon:function(){var w=this.options,u=this._map,p=u.options.zoomAnimation&&u.options.markerZoomAnimation,m=p?"leaflet-zoom-animated":"leaflet-zoom-hide",x=w.icon.createIcon(this._icon),v=!1;x!==this._icon&&(this._icon&&this._removeIcon(),v=!0,w.title&&(x.title=w.title),w.alt&&(x.alt=w.alt)),h.DomUtil.addClass(x,m),w.keyboard&&(x.tabIndex="0"),this._icon=x,this._initInteraction(),w.riseOnHover&&h.DomEvent.on(x,"mouseover",this._bringToFront,this).on(x,"mouseout",this._resetZIndex,this);var k=w.icon.createShadow(this._shadow),q=!1;k!==this._shadow&&(this._removeShadow(),q=!0),k&&h.DomUtil.addClass(k,m),this._shadow=k,w.opacity<1&&this._updateOpacity();var o=this._map._panes;v&&o.markerPane.appendChild(this._icon),k&&q&&o.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&h.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(a){h.DomUtil.setPosition(this._icon,a),this._shadow&&h.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var i=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(i)},_initInteraction:function(){if(this.options.clickable){var k=this._icon,m=["dblclick","mousedown","mouseover","mouseout","contextmenu"];h.DomUtil.addClass(k,"leaflet-clickable"),h.DomEvent.on(k,"click",this._onMouseClick,this),h.DomEvent.on(k,"keypress",this._onKeyPress,this);for(var a=0;a<m.length;a++){h.DomEvent.on(k,m[a],this._fireMouseEvent,this)}h.Handler.MarkerDrag&&(this.dragging=new h.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){var i=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||i)&&h.DomEvent.stopPropagation(a),i||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng})},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&h.DomEvent.preventDefault(a),"mousedown"!==a.type?h.DomEvent.stopPropagation(a):h.DomEvent.preventDefault(a)},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},_updateOpacity:function(){h.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&h.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),h.marker=function(a,i){return new h.Marker(a,i)},h.DivIcon=h.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(e){var a=e&&"DIV"===e.tagName?e:g.createElement("div"),k=this.options;return k.html!==!1?a.innerHTML=k.html:a.innerHTML="",k.bgPos&&(a.style.backgroundPosition=-k.bgPos.x+"px "+-k.bgPos.y+"px"),this._setIconStyles(a,"icon"),a},createShadow:function(){return null}}),h.divIcon=function(a){return new h.DivIcon(a)},h.Map.mergeOptions({closePopupOnClick:!0}),h.Popup=h.Class.extend({includes:h.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,i){h.setOptions(this,a),this._source=i,this._animated=h.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._container||this._initLayout();var i=a.options.fadeAnimation;i&&h.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),i&&h.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(a){return a.addLayer(this),this},openOn:function(a){return a.openPopup(this),this},onRemove:function(a){a._panes.popupPane.removeChild(this._container),h.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&h.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=h.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(a){return this._content=a,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var k,o="leaflet-popup",a=o+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),p=this._container=h.DomUtil.create("div",a);this.options.closeButton&&(k=this._closeButton=h.DomUtil.create("a",o+"-close-button",p),k.href="#close",k.innerHTML="&#215;",h.DomEvent.disableClickPropagation(k),h.DomEvent.on(k,"click",this._onCloseButtonClick,this));var m=this._wrapper=h.DomUtil.create("div",o+"-content-wrapper",p);h.DomEvent.disableClickPropagation(m),this._contentNode=h.DomUtil.create("div",o+"-content",m),h.DomEvent.disableScrollPropagation(this._contentNode),h.DomEvent.on(m,"contextmenu",h.DomEvent.stopPropagation),this._tipContainer=h.DomUtil.create("div",o+"-tip-container",p),this._tip=h.DomUtil.create("div",o+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content){this._contentNode.innerHTML=this._content}else{for(;this._contentNode.hasChildNodes();){this._contentNode.removeChild(this._contentNode.firstChild)}this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var o=this._contentNode,q=o.style;q.width="",q.whiteSpace="nowrap";var m=o.offsetWidth;m=Math.min(m,this.options.maxWidth),m=Math.max(m,this.options.minWidth),q.width=m+1+"px",q.whiteSpace="",q.height="";var r=o.offsetHeight,p=this.options.maxHeight,k="leaflet-popup-scrolled";p&&r>p?(q.height=p+"px",h.DomUtil.addClass(o,k)):h.DomUtil.removeClass(o,k),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var k=this._map.latLngToLayerPoint(this._latlng),m=this._animated,a=h.point(this.options.offset);m&&h.DomUtil.setPosition(this._container,k),this._containerBottom=-a.y-(m?0:k.y),this._containerLeft=-Math.round(this._containerWidth/2)+a.x+(m?0:k.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(a){var i=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);h.DomUtil.setPosition(this._container,i)},_adjustPan:function(){if(this.options.autoPan){var z=this._map,v=this._container.offsetHeight,p=this._containerWidth,m=new h.Point(this._containerLeft,-v-this._containerBottom);this._animated&&m._add(h.DomUtil.getPosition(this._container));var A=z.layerPointToContainerPoint(m),x=h.point(this.options.autoPanPadding),k=h.point(this.options.autoPanPaddingTopLeft||x),q=h.point(this.options.autoPanPaddingBottomRight||x),o=z.getSize(),y=0,w=0;A.x+p+q.x>o.x&&(y=A.x+p-o.x+q.x),A.x-y-k.x<0&&(y=A.x-k.x),A.y+v+q.y>o.y&&(w=A.y+v-o.y+q.y),A.y-w-k.y<0&&(w=A.y-k.y),(y||w)&&z.fire("autopanstart").panBy([y,w])}},_onCloseButtonClick:function(a){this._close(),h.DomEvent.stop(a)}}),h.popup=function(a,i){return new h.Popup(a,i)},h.Map.include({openPopup:function(k,m,a){if(this.closePopup(),!(k instanceof h.Popup)){var o=k;k=new h.Popup(a).setLatLng(m).setContent(o)}return k._isOpen=!0,this._popup=k,this.addLayer(k)},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this}}),h.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(k,m){var a=h.point(this.options.icon.options.popupAnchor||[0,0]);return a=a.add(h.Popup.prototype.options.offset),m&&m.offset&&(a=a.add(m.offset)),m=h.extend({offset:a},m),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),k instanceof h.Popup?(h.setOptions(k,m),this._popup=k,k._source=this):this._popup=new h.Popup(m,this).setContent(k),this},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}}),h.LayerGroup=h.Class.extend({initialize:function(k){this._layers={};var m,a;if(k){for(m=0,a=k.length;a>m;m++){this.addLayer(k[m])}}},addLayer:function(a){var i=this.getLayerId(a);return this._layers[i]=a,this._map&&this._map.addLayer(a),this},removeLayer:function(a){var i=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a) in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(k){var m,a,o=Array.prototype.slice.call(arguments,1);for(m in this._layers){a=this._layers[m],a[k]&&a[k].apply(a,o)}return this},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null},addTo:function(a){return a.addLayer(this),this},eachLayer:function(k,m){for(var a in this._layers){k.call(m,this._layers[a])}return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[];for(var i in this._layers){a.push(this._layers[i])}return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return h.stamp(a)}}),h.layerGroup=function(a){return new h.LayerGroup(a)},h.FeatureGroup=h.LayerGroup.extend({includes:h.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on" in a&&a.on(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}))},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this},bindPopup:function(a,i){return this._popupContent=a,this._popupOptions=i,this.invoke("bindPopup",a,i)},openPopup:function(a){for(var i in this._layers){this._layers[i].openPopup(a);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new h.LatLngBounds;return this.eachLayer(function(i){a.extend(i instanceof h.Marker?i.getLatLng():i.getBounds())}),a},_propagateEvent:function(a){a=h.extend({layer:a.target,target:this},a),this.fire(a.type,a)}}),h.featureGroup=function(a){return new h.FeatureGroup(a)},h.Path=h.Class.extend({includes:[h.Mixin.Events],statics:{CLIP_PADDING:function(){var k=h.Browser.mobile?1280:2000,a=(k/Math.max(d.outerWidth,d.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,a))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},initialize:function(a){h.setOptions(this,a)},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,h.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){return h.setOptions(this,a),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),h.Map.include({_updatePathViewport:function(){var k=h.Path.CLIP_PADDING,o=this.getSize(),a=h.DomUtil.getPosition(this._mapPane),p=a.multiplyBy(-1)._subtract(o.multiplyBy(k)._round()),m=p.add(o.multiplyBy(1+2*k)._round());this._pathViewport=new h.Bounds(p,m)}}),h.Path.SVG_NS="http://www.w3.org/2000/svg",h.Browser.svg=!(!g.createElementNS||!g.createElementNS(h.Path.SVG_NS,"svg").createSVGRect),h.Path=h.Path.extend({statics:{SVG:h.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,i=this._container;return i&&a.lastChild!==i&&a.appendChild(i),this},bringToBack:function(){var k=this._map._pathRoot,m=this._container,a=k.firstChild;return m&&a!==m&&k.insertBefore(m,a),this},getPathString:function(){},_createElement:function(a){return g.createElementNS(h.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&h.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){(h.Browser.svg||!h.Browser.vml)&&h.DomUtil.addClass(this._path,"leaflet-clickable"),h.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],i=0;i<a.length;i++){h.DomEvent.on(this._container,a[i],this._fireMouseEvent,this)}}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a)},_fireMouseEvent:function(k){if(this.hasEventListeners(k.type)){var o=this._map,a=o.mouseEventToContainerPoint(k),p=o.containerPointToLayerPoint(a),m=o.layerPointToLatLng(p);this.fire(k.type,{latlng:m,layerPoint:p,containerPoint:a,originalEvent:k}),"contextmenu"===k.type&&h.DomEvent.preventDefault(k),"mousemove"!==k.type&&h.DomEvent.stopPropagation(k)}}}),h.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=h.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&h.Browser.any3d?(h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(k){var m=this.getZoomScale(k.zoom),a=this._getCenterOffset(k.center)._multiplyBy(-m)._add(this._pathViewport.min);this._pathRoot.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(a)+" scale("+m+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var o=this._pathViewport,u=o.min,m=o.max,v=m.x-u.x,p=m.y-u.y,k=this._pathRoot,q=this._panes.overlayPane;h.Browser.mobileWebkit&&q.removeChild(k),h.DomUtil.setPosition(k,u),k.setAttribute("width",v),k.setAttribute("height",p),k.setAttribute("viewBox",[u.x,u.y,v,p].join(" ")),h.Browser.mobileWebkit&&q.appendChild(k)}}}),h.Path.include({bindPopup:function(a,i){return a instanceof h.Popup?this._popup=a:((!this._popup||i)&&(this._popup=new h.Popup(i,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup)}}),h.Browser.vml=!h.Browser.svg&&function(){try{var e=g.createElement("div");e.innerHTML='<v:shape adj="1"/>';var a=e.firstChild;return a.style.behavior="url(#default#VML)",a&&"object"==typeof a.adj}catch(k){return !1}}(),h.Path=h.Browser.svg||!h.Browser.vml?h.Path:h.Path.extend({statics:{VML:!0,CLIP_PADDING:0.02},_createElement:function(){try{return g.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return g.createElement("<lvml:"+e+' class="lvml">')}}catch(a){return function(e){return g.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");h.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&h.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var k=this._stroke,m=this._fill,a=this.options,o=this._container;o.stroked=a.stroke,o.filled=a.fill,a.stroke?(k||(k=this._stroke=this._createElement("stroke"),k.endcap="round",o.appendChild(k)),k.weight=a.weight+"px",k.color=a.color,k.opacity=a.opacity,a.dashArray?k.dashStyle=h.Util.isArray(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):k.dashStyle="",a.lineCap&&(k.endcap=a.lineCap.replace("butt","flat")),a.lineJoin&&(k.joinstyle=a.lineJoin)):k&&(o.removeChild(k),this._stroke=null),a.fill?(m||(m=this._fill=this._createElement("fill"),o.appendChild(m)),m.color=a.fillColor||a.color,m.opacity=a.fillOpacity):m&&(o.removeChild(m),this._fill=null)},_updatePath:function(){var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display=""}}),h.Map.include(h.Browser.svg||!h.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=g.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),h.Browser.canvas=function(){return !!g.createElement("canvas").getContext}(),h.Path=h.Path.SVG&&!d.L_PREFER_CANVAS||!h.Browser.canvas?h.Path:h.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(a){return h.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!h.Path._updateRequest&&(h.Path._updateRequest=h.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){h.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color),a.lineCap&&(this._ctx.lineCap=a.lineCap),a.lineJoin&&(this._ctx.lineJoin=a.lineJoin)},_drawPath:function(){var o,q,m,r,p,k;for(this._ctx.beginPath(),o=0,m=this._parts.length;m>o;o++){for(q=0,r=this._parts[o].length;r>q;q++){p=this._parts[o][q],k=(0===q?"move":"line")+"To",this._ctx[k](p.x,p.y)}this instanceof h.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return !this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,i=this.options;this._drawPath(),a.save(),this._updateStyle(),i.fill&&(a.globalAlpha=i.fillOpacity,a.fill(i.fillRule||"evenodd")),i.stroke&&(a.globalAlpha=i.opacity,a.stroke()),a.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click dblclick contextmenu",this._fireMouseEvent,this))},_fireMouseEvent:function(a){this._containsPoint(a.layerPoint)&&this.fire(a.type,a)},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)))}}),h.Map.include(h.Path.SVG&&!d.L_PREFER_CANVAS||!h.Browser.canvas?{}:{_initPathRoot:function(){var e,a=this._pathRoot;a||(a=this._pathRoot=g.createElement("canvas"),a.style.position="absolute",e=this._canvasCtx=a.getContext("2d"),e.lineCap="round",e.lineJoin="round",this._panes.overlayPane.appendChild(a),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var k=this._pathViewport,m=k.min,a=k.max.subtract(m),o=this._pathRoot;h.DomUtil.setPosition(o,m),o.width=a.x,o.height=a.y,o.getContext("2d").translate(-m.x,-m.y)}}}),h.LineUtil={simplify:function(k,m){if(!m||!k.length){return k.slice()}var a=m*m;return k=this._reducePoints(k,a),k=this._simplifyDP(k,a)},pointToSegmentDistance:function(k,m,a){return Math.sqrt(this._sqClosestPointOnSegment(k,m,a,!0))},closestPointOnSegment:function(k,m,a){return this._sqClosestPointOnSegment(k,m,a)},_simplifyDP:function(k,q){var v=k.length,u=typeof Uint8Array!=c+""?Uint8Array:Array,m=new u(v);m[0]=m[v-1]=1,this._simplifyDPStep(k,m,q,0,v-1);var i,p=[];for(i=0;v>i;i++){m[i]&&p.push(k[i])}return p},_simplifyDPStep:function(x,v,q,p,m){var y,w,k,u=0;for(w=p+1;m-1>=w;w++){k=this._sqClosestPointOnSegment(x[w],x[p],x[m],!0),k>u&&(y=w,u=k)}u>q&&(v[y]=1,this._simplifyDPStep(x,v,q,p,y),this._simplifyDPStep(x,v,q,y,m))},_reducePoints:function(k,p){for(var a=[k[0]],r=1,q=0,m=k.length;m>r;r++){this._sqDist(k[r],k[q])>p&&(a.push(k[r]),q=r)}return m-1>q&&a.push(k[m-1]),a},clipSegment:function(x,v,q,p){var m,y,w,k=p?this._lastCode:this._getBitCode(x,q),u=this._getBitCode(v,q);for(this._lastCode=u;;){if(!(k|u)){return[x,v]}if(k&u){return !1}m=k||u,y=this._getEdgeIntersection(x,v,m,q),w=this._getBitCode(y,q),m===k?(x=y,k=w):(v=y,u=w)}},_getEdgeIntersection:function(o,v,m,w){var q=v.x-o.x,k=v.y-o.y,u=w.min,p=w.max;return 8&m?new h.Point(o.x+q*(p.y-o.y)/k,p.y):4&m?new h.Point(o.x+q*(u.y-o.y)/k,u.y):2&m?new h.Point(p.x,o.y+k*(p.x-o.x)/q):1&m?new h.Point(u.x,o.y+k*(u.x-o.x)/q):void 0},_getBitCode:function(k,m){var a=0;return k.x<m.min.x?a|=1:k.x>m.max.x&&(a|=2),k.y<m.min.y?a|=4:k.y>m.max.y&&(a|=8),a},_sqDist:function(k,m){var a=m.x-k.x,o=m.y-k.y;return a*a+o*o},_sqClosestPointOnSegment:function(y,v,p,m){var z,w=v.x,k=v.y,q=p.x-w,o=p.y-k,x=q*q+o*o;return x>0&&(z=((y.x-w)*q+(y.y-k)*o)/x,z>1?(w=p.x,k=p.y):z>0&&(w+=q*z,k+=o*z)),q=y.x-w,o=y.y-k,m?q*q+o*o:new h.Point(w,k)}},h.Polyline=h.Path.extend({initialize:function(a,i){h.Path.prototype.initialize.call(this,i),this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,i=this._latlngs.length;i>a;a++){this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])}},getPathString:function(){for(var k=0,m=this._parts.length,a="";m>k;k++){a+=this._getPathPartStr(this._parts[k])}return a},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw()},addLatLng:function(a){return this._latlngs.push(h.latLng(a)),this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a},closestLayerPoint:function(A){for(var v,p,m=1/0,B=this._parts,y=null,k=0,q=B.length;q>k;k++){for(var o=B[k],z=1,x=o.length;x>z;z++){v=o[z-1],p=o[z];var w=h.LineUtil._sqClosestPointOnSegment(A,v,p,!0);m>w&&(m=w,y=h.LineUtil._sqClosestPointOnSegment(A,v,p))}}return y&&(y.distance=Math.sqrt(m)),y},getBounds:function(){return new h.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(k,o){var a,p,m=o?k:[];for(a=0,p=k.length;p>a;a++){if(h.Util.isArray(k[a])&&"number"!=typeof k[a][0]){return}m[a]=h.latLng(k[a])}return m},_initEvents:function(){h.Path.prototype._initEvents.call(this)},_getPathPartStr:function(o){for(var q,m=h.Path.VML,r=0,p=o.length,k="";p>r;r++){q=o[r],m&&q._round(),k+=(r?"L":"M")+q.x+" "+q.y}return k},_clipPoints:function(){var o,v,m,w=this._originalPoints,q=w.length;if(this.options.noClip){return void (this._parts=[w])}this._parts=[];var k=this._parts,u=this._map._pathViewport,p=h.LineUtil;for(o=0,v=0;q-1>o;o++){m=p.clipSegment(w[o],w[o+1],u,o),m&&(k[v]=k[v]||[],k[v].push(m[0]),(m[1]!==w[o+1]||o===q-2)&&(k[v].push(m[1]),v++))}},_simplifyPoints:function(){for(var k=this._parts,m=h.LineUtil,a=0,o=k.length;o>a;a++){k[a]=m.simplify(k[a],this.options.smoothFactor)}},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),h.Path.prototype._updatePath.call(this))}}),h.polyline=function(a,i){return new h.Polyline(a,i)},h.PolyUtil={},h.PolyUtil.clipPolygon=function(C,x){var v,o,D,A,k,w,q,B,z,y=[1,4,2,8],m=h.LineUtil;for(o=0,q=C.length;q>o;o++){C[o]._code=m._getBitCode(C[o],x)}for(A=0;4>A;A++){for(B=y[A],v=[],o=0,q=C.length,D=q-1;q>o;D=o++){k=C[o],w=C[D],k._code&B?w._code&B||(z=m._getEdgeIntersection(w,k,B,x),z._code=m._getBitCode(z,x),v.push(z)):(w._code&B&&(z=m._getEdgeIntersection(w,k,B,x),z._code=m._getBitCode(z,x),v.push(z)),v.push(k))}C=v}return C},h.Polygon=h.Polyline.extend({options:{fill:!0},initialize:function(a,i){h.Polyline.prototype.initialize.call(this,a,i),this._initWithHoles(a)},_initWithHoles:function(k){var m,a,o;if(k&&h.Util.isArray(k[0])&&"number"!=typeof k[0][0]){for(this._latlngs=this._convertLatLngs(k[0]),this._holes=k.slice(1),m=0,a=this._holes.length;a>m;m++){o=this._holes[m]=this._convertLatLngs(this._holes[m]),o[0].equals(o[o.length-1])&&o.pop()}}k=this._latlngs,k.length>=2&&k[0].equals(k[k.length-1])&&k.pop()},projectLatlngs:function(){if(h.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var k,m,a,o;for(k=0,a=this._holes.length;a>k;k++){for(this._holePoints[k]=[],m=0,o=this._holes[k].length;o>m;m++){this._holePoints[k][m]=this._map.latLngToLayerPoint(this._holes[k][m])}}}},setLatLngs:function(a){return a&&h.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):h.Polyline.prototype.setLatLngs.call(this,a)},_clipPoints:function(){var k=this._originalPoints,o=[];if(this._parts=[k].concat(this._holePoints),!this.options.noClip){for(var a=0,p=this._parts.length;p>a;a++){var m=h.PolyUtil.clipPolygon(this._parts[a],this._map._pathViewport);m.length&&o.push(m)}this._parts=o}},_getPathPartStr:function(a){var i=h.Polyline.prototype._getPathPartStr.call(this,a);return i+(h.Browser.svg?"z":"x")}}),h.polygon=function(a,i){return new h.Polygon(a,i)},function(){function a(e){return h.FeatureGroup.extend({initialize:function(i,k){this._layers={},this._options=k,this.setLatLngs(i)},setLatLngs:function(m){var k=0,o=m.length;for(this.eachLayer(function(i){o>k?i.setLatLngs(m[k++]):this.removeLayer(i)},this);o>k;){this.addLayer(new e(m[k++],this._options))}return this},getLatLngs:function(){var i=[];return this.eachLayer(function(k){i.push(k.getLatLngs())}),i}})}h.MultiPolyline=a(h.Polyline),h.MultiPolygon=a(h.Polygon),h.multiPolyline=function(i,k){return new h.MultiPolyline(i,k)},h.multiPolygon=function(i,k){return new h.MultiPolygon(i,k)}}(),h.Rectangle=h.Polygon.extend({initialize:function(a,i){h.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),i)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){return a=h.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}}),h.rectangle=function(a,i){return new h.Rectangle(a,i)},h.Circle=h.Path.extend({initialize:function(k,m,a){h.Path.prototype.initialize.call(this,a),this._latlng=h.latLng(k),this._mRadius=m},options:{fill:!0},setLatLng:function(a){return this._latlng=h.latLng(a),this.redraw()},setRadius:function(a){return this._mRadius=a,this.redraw()},projectLatlngs:function(){var k=this._getLngRadius(),m=this._latlng,a=this._map.latLngToLayerPoint([m.lat,m.lng-k]);this._point=this._map.latLngToLayerPoint(m),this._radius=Math.max(this._point.x-a.x,1)},getBounds:function(){var k=this._getLngRadius(),m=this._mRadius/40075017*360,a=this._latlng;return new h.LatLngBounds([a.lat-m,a.lng-k],[a.lat+m,a.lng+k])},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,i=this._radius;return this._checkIfEmpty()?"":h.Browser.svg?"M"+a.x+","+(a.y-i)+"A"+i+","+i+",0,1,1,"+(a.x-0.1)+","+(a.y-i)+" z":(a._round(),i=Math.round(i),"AL "+a.x+","+a.y+" "+i+","+i+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(h.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map){return !1}var k=this._map._pathViewport,m=this._radius,a=this._point;return a.x-m>k.max.x||a.y-m>k.max.y||a.x+m<k.min.x||a.y+m<k.min.y}}),h.circle=function(k,m,a){return new h.Circle(k,m,a)},h.CircleMarker=h.Circle.extend({options:{radius:10,weight:2},initialize:function(a,i){h.Circle.prototype.initialize.call(this,a,null,i),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){h.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(a){return h.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw()},getRadius:function(){return this._radius}}),h.circleMarker=function(a,i){return new h.CircleMarker(a,i)},h.Polyline.include(h.Path.CANVAS?{_containsPoint:function(y,v){var p,m,z,w,k,q,o,x=this.options.weight/2;for(h.Browser.touch&&(x+=10),p=0,w=this._parts.length;w>p;p++){for(o=this._parts[p],m=0,k=o.length,z=k-1;k>m;z=m++){if((v||0!==m)&&(q=h.LineUtil.pointToSegmentDistance(y,o[z],o[m]),x>=q)){return !0}}}return !1}}:{}),h.Polygon.include(h.Path.CANVAS?{_containsPoint:function(y){var v,p,m,z,w,k,q,o,x=!1;if(h.Polyline.prototype._containsPoint.call(this,y,!0)){return !0}for(z=0,q=this._parts.length;q>z;z++){for(v=this._parts[z],w=0,o=v.length,k=o-1;o>w;k=w++){p=v[w],m=v[k],p.y>y.y!=m.y>y.y&&y.x<(m.x-p.x)*(y.y-p.y)/(m.y-p.y)+p.x&&(x=!x)}}return x}}:{}),h.Circle.include(h.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(k){var m=this._point,a=this.options.stroke?this.options.weight/2:0;return k.distanceTo(m)<=this._radius+a}}:{}),h.CircleMarker.include(h.Path.CANVAS?{_updateStyle:function(){h.Path.prototype._updateStyle.call(this)}}:{}),h.GeoJSON=h.FeatureGroup.extend({initialize:function(a,i){h.setOptions(this,i),this._layers={},a&&this.addData(a)},addData:function(o){var u,m,v,p=h.Util.isArray(o)?o:o.features;if(p){for(u=0,m=p.length;m>u;u++){v=p[u],(v.geometries||v.geometry||v.features||v.coordinates)&&this.addData(p[u])}return this}var k=this.options;if(!k.filter||k.filter(o)){var q=h.GeoJSON.geometryToLayer(o,k.pointToLayer,k.coordsToLatLng,k);return q.feature=h.GeoJSON.asFeature(o),q.defaultOptions=q.options,this.resetStyle(q),k.onEachFeature&&k.onEachFeature(o,q),this.addLayer(q)}},resetStyle:function(a){var i=this.options.style;i&&(h.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,i))},setStyle:function(a){this.eachLayer(function(i){this._setLayerStyle(i,a)},this)},_setLayerStyle:function(a,i){"function"==typeof i&&(i=i(a.feature)),a.setStyle&&a.setStyle(i)}}),h.extend(h.GeoJSON,{geometryToLayer:function(z,v,p,m){var A,x,k,q,o="Feature"===z.type?z.geometry:z,y=o.coordinates,w=[];switch(p=p||this.coordsToLatLng,o.type){case"Point":return A=p(y),v?v(z,A):new h.Marker(A);case"MultiPoint":for(k=0,q=y.length;q>k;k++){A=p(y[k]),w.push(v?v(z,A):new h.Marker(A))}return new h.FeatureGroup(w);case"LineString":return x=this.coordsToLatLngs(y,0,p),new h.Polyline(x,m);case"Polygon":if(2===y.length&&!y[1].length){throw new Error("Invalid GeoJSON object.")}return x=this.coordsToLatLngs(y,1,p),new h.Polygon(x,m);case"MultiLineString":return x=this.coordsToLatLngs(y,1,p),new h.MultiPolyline(x,m);case"MultiPolygon":return x=this.coordsToLatLngs(y,2,p),new h.MultiPolygon(x,m);case"GeometryCollection":for(k=0,q=o.geometries.length;q>k;k++){w.push(this.geometryToLayer({geometry:o.geometries[k],type:"Feature",properties:z.properties},v,p,m))}return new h.FeatureGroup(w);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new h.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(p,r,m){var v,u,q,k=[];for(u=0,q=p.length;q>u;u++){v=r?this.coordsToLatLngs(p[u],r-1,m):(m||this.coordsToLatLng)(p[u]),k.push(v)}return k},latLngToCoords:function(a){var i=[a.lng,a.lat];return a.alt!==c&&i.push(a.alt),i},latLngsToCoords:function(k){for(var m=[],a=0,o=k.length;o>a;a++){m.push(h.GeoJSON.latLngToCoords(k[a]))}return m},getFeature:function(a,i){return a.feature?h.extend({},a.feature,{geometry:i}):h.GeoJSON.asFeature(i)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});var b={toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"Point",coordinates:h.GeoJSON.latLngToCoords(this.getLatLng())})}};h.Marker.include(b),h.Circle.include(b),h.CircleMarker.include(b),h.Polyline.include({toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"LineString",coordinates:h.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),h.Polygon.include({toGeoJSON:function(){var k,m,a,o=[h.GeoJSON.latLngsToCoords(this.getLatLngs())];if(o[0].push(o[0][0]),this._holes){for(k=0,m=this._holes.length;m>k;k++){a=h.GeoJSON.latLngsToCoords(this._holes[k]),a.push(a[0]),o.push(a)}}return h.GeoJSON.getFeature(this,{type:"Polygon",coordinates:o})}}),function(){function a(e){return function(){var i=[];return this.eachLayer(function(k){i.push(k.toGeoJSON().geometry.coordinates)}),h.GeoJSON.getFeature(this,{type:e,coordinates:i})}}h.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),h.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),h.LayerGroup.include({toGeoJSON:function(){var o,k=this.feature&&this.feature.geometry,p=[];if(k&&"MultiPoint"===k.type){return a("MultiPoint").call(this)}var m=k&&"GeometryCollection"===k.type;return this.eachLayer(function(e){e.toGeoJSON&&(o=e.toGeoJSON(),p.push(m?o.geometry:h.GeoJSON.asFeature(o)))}),m?h.GeoJSON.getFeature(this,{geometries:p,type:"GeometryCollection"}):{type:"FeatureCollection",features:p}}})}(),h.geoJson=function(a,i){return new h.GeoJSON(a,i)},h.DomEvent={addListener:function(w,u,p,m){var x,v,k,q=h.stamp(p),o="_leaflet_"+u+q;return w[o]?this:(x=function(a){return p.call(m||w,a||h.DomEvent._getEvent())},h.Browser.pointer&&0===u.indexOf("touch")?this.addPointerListener(w,u,x,q):(h.Browser.touch&&"dblclick"===u&&this.addDoubleTapListener&&this.addDoubleTapListener(w,x,q),"addEventListener" in w?"mousewheel"===u?(w.addEventListener("DOMMouseScroll",x,!1),w.addEventListener(u,x,!1)):"mouseenter"===u||"mouseleave"===u?(v=x,k="mouseenter"===u?"mouseover":"mouseout",x=function(a){return h.DomEvent._checkMouse(w,a)?v(a):void 0},w.addEventListener(k,x,!1)):"click"===u&&h.Browser.android?(v=x,x=function(a){return h.DomEvent._filterClick(a,v)},w.addEventListener(u,x,!1)):w.addEventListener(u,x,!1):"attachEvent" in w&&w.attachEvent("on"+u,x),w[o]=x,this))},removeListener:function(o,q,m){var r=h.stamp(m),p="_leaflet_"+q+r,k=o[p];return k?(h.Browser.pointer&&0===q.indexOf("touch")?this.removePointerListener(o,q,r):h.Browser.touch&&"dblclick"===q&&this.removeDoubleTapListener?this.removeDoubleTapListener(o,r):"removeEventListener" in o?"mousewheel"===q?(o.removeEventListener("DOMMouseScroll",k,!1),o.removeEventListener(q,k,!1)):"mouseenter"===q||"mouseleave"===q?o.removeEventListener("mouseenter"===q?"mouseover":"mouseout",k,!1):o.removeEventListener(q,k,!1):"detachEvent" in o&&o.detachEvent("on"+q,k),o[p]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,h.DomEvent._skipped(a),this},disableScrollPropagation:function(a){var i=h.DomEvent.stopPropagation;return h.DomEvent.on(a,"mousewheel",i).on(a,"MozMousePixelScroll",i)},disableClickPropagation:function(k){for(var m=h.DomEvent.stopPropagation,a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.on(k,h.Draggable.START[a],m)}return h.DomEvent.on(k,"click",h.DomEvent._fakeStop).on(k,"dblclick",m)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return h.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(k,m){if(!m){return new h.Point(k.clientX,k.clientY)}var a=m.getBoundingClientRect();return new h.Point(k.clientX-a.left-m.clientLeft,k.clientY-a.top-m.clientTop)},getWheelDelta:function(a){var i=0;return a.wheelDelta&&(i=a.wheelDelta/120),a.detail&&(i=-a.detail/3),i},_skipEvents:{},_fakeStop:function(a){h.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var i=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,i},_checkMouse:function(k,m){var a=m.relatedTarget;if(!a){return !0}try{for(;a&&a!==k;){a=a.parentNode}}catch(o){return !1}return a!==k},_getEvent:function(){var k=d.event;if(!k){for(var a=arguments.callee.caller;a&&(k=a.arguments[0],!k||d.Event!==k.constructor);){a=a.caller}}return k},_filterClick:function(k,m){var a=k.timeStamp||k.originalEvent.timeStamp,o=h.DomEvent._lastClick&&a-h.DomEvent._lastClick;return o&&o>100&&500>o||k.target._simulatedClick&&!k._simulated?void h.DomEvent.stop(k):(h.DomEvent._lastClick=a,m(k))}},h.DomEvent.on=h.DomEvent.addListener,h.DomEvent.off=h.DomEvent.removeListener,h.Draggable=h.Class.extend({includes:h.Mixin.Events,statics:{START:h.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,i){this._element=a,this._dragStartTarget=i||a},enable:function(){if(!this._enabled){for(var a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.on(this._dragStartTarget,h.Draggable.START[a],this._onDown,this)}this._enabled=!0}},disable:function(){if(this._enabled){for(var a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.off(this._dragStartTarget,h.Draggable.START[a],this._onDown,this)}this._enabled=!1,this._moved=!1}},_onDown:function(e){if(this._moved=!1,!(e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(h.DomEvent.stopPropagation(e),h.Draggable._disabled||(h.DomUtil.disableImageDrag(),h.DomUtil.disableTextSelection(),this._moving)))){var a=e.touches?e.touches[0]:e;this._startPoint=new h.Point(a.clientX,a.clientY),this._startPos=this._newPos=h.DomUtil.getPosition(this._element),h.DomEvent.on(g,h.Draggable.MOVE[e.type],this._onMove,this).on(g,h.Draggable.END[e.type],this._onUp,this)}},_onMove:function(e){if(e.touches&&e.touches.length>1){return void (this._moved=!0)}var a=e.touches&&1===e.touches.length?e.touches[0]:e,m=new h.Point(a.clientX,a.clientY),k=m.subtract(this._startPoint);(k.x||k.y)&&(h.Browser.touch&&Math.abs(k.x)+Math.abs(k.y)<3||(h.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=h.DomUtil.getPosition(this._element).subtract(k),h.DomUtil.addClass(g.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,h.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(k),this._moving=!0,h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),h.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){h.DomUtil.removeClass(g.body,"leaflet-dragging"),this._lastTarget&&(h.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in h.Draggable.MOVE){h.DomEvent.off(g,h.Draggable.MOVE[a],this._onMove).off(g,h.Draggable.END[a],this._onUp)}h.DomUtil.enableImageDrag(),h.DomUtil.enableTextSelection(),this._moved&&this._moving&&(h.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),h.Handler=h.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return !!this._enabled}}),h.Map.mergeOptions({dragging:!0,inertia:!h.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:h.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:!1}),h.Map.Drag=h.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new h.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,i=this._lastPos=this._draggable._newPos;this._positions.push(i),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(a).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var p=this._worldWidth,r=Math.round(p/2),m=this._initialWorldOffset,v=this._draggable._newPos.x,u=(v-r+m)%p+r-m,q=(v+r+m)%p-r-m,k=Math.abs(u+m)<Math.abs(q+m)?u:q;this._draggable._newPos.x=k},_onDragEnd:function(D){var x=this._map,v=x.options,o=+new Date-this._lastTime,E=!v.inertia||o>v.inertiaThreshold||!this._positions[0];if(x.fire("dragend",D),E){x.fire("moveend")}else{var A=this._lastPos.subtract(this._positions[0]),k=(this._lastTime+o-this._times[0])/1000,w=v.easeLinearity,q=A.multiplyBy(w/k),C=q.distanceTo([0,0]),z=Math.min(v.inertiaMaxSpeed,C),y=q.multiplyBy(z/C),m=z/(v.inertiaDeceleration*w),B=y.multiplyBy(-m/2).round();B.x&&B.y?(B=x._limitOffset(B,x.options.maxBounds),h.Util.requestAnimFrame(function(){x.panBy(B,{duration:m,easeLinearity:w,noMoveStart:!0})})):x.fire("moveend")}}}),h.Map.addInitHook("addHandler","dragging",h.Map.Drag),h.Map.mergeOptions({doubleClickZoom:!0}),h.Map.DoubleClickZoom=h.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(k){var m=this._map,a=m.getZoom()+(k.originalEvent.shiftKey?-1:1);"center"===m.options.doubleClickZoom?m.setZoom(a):m.setZoomAround(k.containerPoint,a)}}),h.Map.addInitHook("addHandler","doubleClickZoom",h.Map.DoubleClickZoom),h.Map.mergeOptions({scrollWheelZoom:!0}),h.Map.ScrollWheelZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),h.DomEvent.on(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault),this._delta=0},removeHooks:function(){h.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),h.DomEvent.off(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault)},_onWheelScroll:function(k){var m=h.DomEvent.getWheelDelta(k);this._delta+=m,this._lastMousePos=this._map.mouseEventToContainerPoint(k),this._startTime||(this._startTime=+new Date);var a=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(h.bind(this._performZoom,this),a),h.DomEvent.preventDefault(k),h.DomEvent.stopPropagation(k)},_performZoom:function(){var k=this._map,m=this._delta,a=k.getZoom();m=m>0?Math.ceil(m):Math.floor(m),m=Math.max(Math.min(m,4),-4),m=k._limitZoom(a+m)-a,this._delta=0,this._startTime=null,m&&("center"===k.options.scrollWheelZoom?k.setZoom(a+m):k.setZoomAround(this._lastMousePos,a+m))}}),h.Map.addInitHook("addHandler","scrollWheelZoom",h.Map.ScrollWheelZoom),h.extend(h.DomEvent,{_touchstart:h.Browser.msPointer?"MSPointerDown":h.Browser.pointer?"pointerdown":"touchstart",_touchend:h.Browser.msPointer?"MSPointerUp":h.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(D,w,o){function E(m){var p;if(h.Browser.pointer?(B.push(m.pointerId),p=B.length):p=m.touches.length,!(p>1)){var a=Date.now(),r=a-(e||a);x=m.touches?m.touches[0]:m,v=r>0&&C>=r,e=a}}function A(m){if(h.Browser.pointer){var r=B.indexOf(m.pointerId);if(-1===r){return}B.splice(r,1)}if(v){if(h.Browser.pointer){var u,p={};for(var i in x){u=x[i],"function"==typeof u?p[i]=u.bind(x):p[i]=u}x=p}x.type="dblclick",w(x),e=null}}var e,x,v=!1,C=250,z="_leaflet_",y=this._touchstart,k=this._touchend,B=[];D[z+y+o]=E,D[z+k+o]=A;var q=h.Browser.pointer?g.documentElement:D;return D.addEventListener(y,E,!1),q.addEventListener(k,A,!1),h.Browser.pointer&&q.addEventListener(h.DomEvent.POINTER_CANCEL,A,!1),this},removeDoubleTapListener:function(e,a){var k="_leaflet_";return e.removeEventListener(this._touchstart,e[k+this._touchstart+a],!1),(h.Browser.pointer?g.documentElement:e).removeEventListener(this._touchend,e[k+this._touchend+a],!1),h.Browser.pointer&&g.documentElement.removeEventListener(h.DomEvent.POINTER_CANCEL,e[k+this._touchend+a],!1),this}}),h.extend(h.DomEvent,{POINTER_DOWN:h.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:h.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:h.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:h.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(k,m,a,o){switch(m){case"touchstart":return this.addPointerListenerStart(k,m,a,o);case"touchend":return this.addPointerListenerEnd(k,m,a,o);case"touchmove":return this.addPointerListenerMove(k,m,a,o);default:throw"Unknown touch event type"}},addPointerListenerStart:function(o,m,v,q){var k="_leaflet_",u=this._pointers,p=function(n){h.DomEvent.preventDefault(n);for(var r=!1,a=0;a<u.length;a++){if(u[a].pointerId===n.pointerId){r=!0;break}}r||u.push(n),n.touches=u.slice(),n.changedTouches=[n],v(n)};if(o[k+"touchstart"+q]=p,o.addEventListener(this.POINTER_DOWN,p,!1),!this._pointerDocumentListener){var e=function(a){for(var i=0;i<u.length;i++){if(u[i].pointerId===a.pointerId){u.splice(i,1);break}}};g.documentElement.addEventListener(this.POINTER_UP,e,!1),g.documentElement.addEventListener(this.POINTER_CANCEL,e,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(p,r,m,v){function u(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var i=0;i<k.length;i++){if(k[i].pointerId===a.pointerId){k[i]=a;break}}a.touches=k.slice(),a.changedTouches=[a],m(a)}}var q="_leaflet_",k=this._pointers;return p[q+"touchmove"+v]=u,p.addEventListener(this.POINTER_MOVE,u,!1),this},addPointerListenerEnd:function(p,r,m,v){var u="_leaflet_",q=this._pointers,k=function(a){for(var i=0;i<q.length;i++){if(q[i].pointerId===a.pointerId){q.splice(i,1);break}}a.touches=q.slice(),a.changedTouches=[a],m(a)};return p[u+"touchend"+v]=k,p.addEventListener(this.POINTER_UP,k,!1),p.addEventListener(this.POINTER_CANCEL,k,!1),this},removePointerListener:function(k,m,a){var q="_leaflet_",p=k[q+m+a];switch(m){case"touchstart":k.removeEventListener(this.POINTER_DOWN,p,!1);break;case"touchmove":k.removeEventListener(this.POINTER_MOVE,p,!1);break;case"touchend":k.removeEventListener(this.POINTER_UP,p,!1),k.removeEventListener(this.POINTER_CANCEL,p,!1)}return this}}),h.Map.mergeOptions({touchZoom:h.Browser.touch&&!h.Browser.android23,bounceAtZoomLimits:!0}),h.Map.TouchZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(m){var k=this._map;if(m.touches&&2===m.touches.length&&!k._animatingZoom&&!this._zooming){var p=k.mouseEventToLayerPoint(m.touches[0]),o=k.mouseEventToLayerPoint(m.touches[1]),e=k._getCenterLayerPoint();this._startCenter=p.add(o)._divideBy(2),this._startDist=p.distanceTo(o),this._moved=!1,this._zooming=!0,this._centerOffset=e.subtract(this._startCenter),k._panAnim&&k._panAnim.stop(),h.DomEvent.on(g,"touchmove",this._onTouchMove,this).on(g,"touchend",this._onTouchEnd,this),h.DomEvent.preventDefault(m)}},_onTouchMove:function(k){var m=this._map;if(k.touches&&2===k.touches.length&&this._zooming){var a=m.mouseEventToLayerPoint(k.touches[0]),o=m.mouseEventToLayerPoint(k.touches[1]);this._scale=a.distanceTo(o)/this._startDist,this._delta=a._add(o)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(m.options.bounceAtZoomLimits||!(m.getZoom()===m.getMinZoom()&&this._scale<1||m.getZoom()===m.getMaxZoom()&&this._scale>1))&&(this._moved||(h.DomUtil.addClass(m._mapPane,"leaflet-touching"),m.fire("movestart").fire("zoomstart"),this._moved=!0),h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),h.DomEvent.preventDefault(k))}},_updateOnMove:function(){var k=this._map,m=this._getScaleOrigin(),a=k.layerPointToLatLng(m),o=k.getScaleZoom(this._scale);k._animateZoom(a,o,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming){return void (this._zooming=!1)}var o=this._map;this._zooming=!1,h.DomUtil.removeClass(o._mapPane,"leaflet-touching"),h.Util.cancelAnimFrame(this._animRequest),h.DomEvent.off(g,"touchmove",this._onTouchMove).off(g,"touchend",this._onTouchEnd);var m=this._getScaleOrigin(),v=o.layerPointToLatLng(m),q=o.getZoom(),k=o.getScaleZoom(this._scale)-q,u=k>0?Math.ceil(k):Math.floor(k),p=o._limitZoom(q+u),e=o.getZoomScale(p)/this._scale;o._animateZoom(v,p,m,e)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}}),h.Map.addInitHook("addHandler","touchZoom",h.Map.TouchZoom),h.Map.mergeOptions({tap:!0,tapTolerance:15}),h.Map.Tap=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(e.touches){if(h.DomEvent.preventDefault(e),this._fireClick=!0,e.touches.length>1){return this._fireClick=!1,void clearTimeout(this._holdTimeout)}var a=e.touches[0],k=a.target;this._startPos=this._newPos=new h.Point(a.clientX,a.clientY),k.tagName&&"a"===k.tagName.toLowerCase()&&h.DomUtil.addClass(k,"leaflet-active"),this._holdTimeout=setTimeout(h.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",a))},this),1000),h.DomEvent.on(g,"touchmove",this._onMove,this).on(g,"touchend",this._onUp,this)}},_onUp:function(e){if(clearTimeout(this._holdTimeout),h.DomEvent.off(g,"touchmove",this._onMove,this).off(g,"touchend",this._onUp,this),this._fireClick&&e&&e.changedTouches){var a=e.changedTouches[0],k=a.target;k&&k.tagName&&"a"===k.tagName.toLowerCase()&&h.DomUtil.removeClass(k,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",a)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var i=a.touches[0];this._newPos=new h.Point(i.clientX,i.clientY)},_simulateEvent:function(a,k){var e=g.createEvent("MouseEvents");e._simulated=!0,k.target._simulatedClick=!0,e.initMouseEvent(a,!0,!0,d,1,k.screenX,k.screenY,k.clientX,k.clientY,!1,!1,!1,!1,0,null),k.target.dispatchEvent(e)}}),h.Browser.touch&&!h.Browser.pointer&&h.Map.addInitHook("addHandler","tap",h.Map.Tap),h.Map.mergeOptions({boxZoom:!0}),h.Map.BoxZoom=h.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1},addHooks:function(){h.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){h.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(h.DomUtil.disableTextSelection(),h.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void h.DomEvent.on(g,"mousemove",this._onMouseMove,this).on(g,"mouseup",this._onMouseUp,this).on(g,"keydown",this._onKeyDown,this))},_onMouseMove:function(o){this._moved||(this._box=h.DomUtil.create("div","leaflet-zoom-box",this._pane),h.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var q=this._startLayerPoint,m=this._box,r=this._map.mouseEventToLayerPoint(o),p=r.subtract(q),k=new h.Point(Math.min(r.x,q.x),Math.min(r.y,q.y));h.DomUtil.setPosition(m,k),this._moved=!0,m.style.width=Math.max(0,Math.abs(p.x)-4)+"px",m.style.height=Math.max(0,Math.abs(p.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),h.DomUtil.enableTextSelection(),h.DomUtil.enableImageDrag(),h.DomEvent.off(g,"mousemove",this._onMouseMove).off(g,"mouseup",this._onMouseUp).off(g,"keydown",this._onKeyDown)},_onMouseUp:function(k){this._finish();var m=this._map,a=m.mouseEventToLayerPoint(k);if(!this._startLayerPoint.equals(a)){var o=new h.LatLngBounds(m.layerPointToLatLng(this._startLayerPoint),m.layerPointToLatLng(a));m.fitBounds(o),m.fire("boxzoomend",{boxZoomBounds:o})}},_onKeyDown:function(a){27===a.keyCode&&this._finish()}}),h.Map.addInitHook("addHandler","boxZoom",h.Map.BoxZoom),h.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),h.Map.Keyboard=h.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),h.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;h.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var a=g.body,m=g.documentElement,k=a.scrollTop||m.scrollTop,e=a.scrollLeft||m.scrollLeft;this._map._container.focus(),d.scrollTo(e,k)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(k){var m,a,q=this._panKeys={},p=this.keyCodes;for(m=0,a=p.left.length;a>m;m++){q[p.left[m]]=[-1*k,0]}for(m=0,a=p.right.length;a>m;m++){q[p.right[m]]=[k,0]}for(m=0,a=p.down.length;a>m;m++){q[p.down[m]]=[0,k]}for(m=0,a=p.up.length;a>m;m++){q[p.up[m]]=[0,-1*k]}},_setZoomOffset:function(k){var m,a,q=this._zoomKeys={},p=this.keyCodes;for(m=0,a=p.zoomIn.length;a>m;m++){q[p.zoomIn[m]]=k}for(m=0,a=p.zoomOut.length;a>m;m++){q[p.zoomOut[m]]=-k}},_addHooks:function(){h.DomEvent.on(g,"keydown",this._onKeyDown,this)},_removeHooks:function(){h.DomEvent.off(g,"keydown",this._onKeyDown,this)},_onKeyDown:function(k){var m=k.keyCode,a=this._map;if(m in this._panKeys){if(a._panAnim&&a._panAnim._inProgress){return}a.panBy(this._panKeys[m]),a.options.maxBounds&&a.panInsideBounds(a.options.maxBounds)}else{if(!(m in this._zoomKeys)){return}a.setZoom(a.getZoom()+this._zoomKeys[m])}h.DomEvent.stop(k)}}),h.Map.addInitHook("addHandler","keyboard",h.Map.Keyboard),h.Handler.MarkerDrag=h.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new h.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),h.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),h.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var k=this._marker,m=k._shadow,a=h.DomUtil.getPosition(k._icon),o=k._map.layerPointToLatLng(a);m&&h.DomUtil.setPosition(m,a),k._latlng=o,k.fire("move",{latlng:o}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}}),h.Control=h.Class.extend({options:{position:"topright"},initialize:function(a){h.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var i=this._map;return i&&i.removeControl(this),this.options.position=a,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(k){this._map=k;var m=this._container=this.onAdd(k),a=this.getPosition(),o=k._controlCorners[a];return h.DomUtil.addClass(m,"leaflet-control"),-1!==a.indexOf("bottom")?o.insertBefore(m,o.firstChild):o.appendChild(m),this},removeFrom:function(k){var m=this.getPosition(),a=k._controlCorners[m];return a.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(k),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),h.control=function(a){return new h.Control(a)},h.Map.include({addControl:function(a){return a.addTo(this),this},removeControl:function(a){return a.removeFrom(this),this},_initControlPos:function(){function k(i,n){var e=a+i+" "+a+n;m[i+n]=h.DomUtil.create("div",e,o)}var m=this._controlCorners={},a="leaflet-",o=this._controlContainer=h.DomUtil.create("div",a+"control-container",this._container);k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),h.Control.Zoom=h.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(k){var m="leaflet-control-zoom",a=h.DomUtil.create("div",m+" leaflet-bar");return this._map=k,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,m+"-in",a,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,m+"-out",a,this._zoomOut,this),this._updateDisabled(),k.on("zoomend zoomlevelschange",this._updateDisabled,this),a},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(o,v,m,w,q,k){var u=h.DomUtil.create("a",m,w);u.innerHTML=o,u.href="#",u.title=v;var p=h.DomEvent.stopPropagation;return h.DomEvent.on(u,"click",p).on(u,"mousedown",p).on(u,"dblclick",p).on(u,"click",h.DomEvent.preventDefault).on(u,"click",q,k).on(u,"click",this._refocusOnMap,k),u},_updateDisabled:function(){var a=this._map,i="leaflet-disabled";h.DomUtil.removeClass(this._zoomInButton,i),h.DomUtil.removeClass(this._zoomOutButton,i),a._zoom===a.getMinZoom()&&h.DomUtil.addClass(this._zoomOutButton,i),a._zoom===a.getMaxZoom()&&h.DomUtil.addClass(this._zoomInButton,i)}}),h.Map.mergeOptions({zoomControl:!0}),h.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new h.Control.Zoom,this.addControl(this.zoomControl))}),h.control.zoom=function(a){return new h.Control.Zoom(a)},h.Control.Attribution=h.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){h.setOptions(this,a),this._attributions={}},onAdd:function(a){this._container=h.DomUtil.create("div","leaflet-control-attribution"),h.DomEvent.disableClickPropagation(this._container);for(var i in a._layers){a._layers[i].getAttribution&&this.addAttribution(a._layers[i].getAttribution())}return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){return this.options.prefix=a,this._update(),this},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0},_update:function(){if(this._map){var k=[];for(var m in this._attributions){this._attributions[m]&&k.push(m)}var a=[];this.options.prefix&&a.push(this.options.prefix),k.length&&a.push(k.join(", ")),this._container.innerHTML=a.join(" | ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}}),h.Map.mergeOptions({attributionControl:!0}),h.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new h.Control.Attribution).addTo(this))}),h.control.attribution=function(a){return new h.Control.Attribution(a)},h.Control.Scale=h.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(k){this._map=k;var m="leaflet-control-scale",a=h.DomUtil.create("div",m),o=this.options;return this._addScales(o,m,a),k.on(o.updateWhenIdle?"moveend":"move",this._update,this),k.whenReady(this._update,this),a},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(k,m,a){k.metric&&(this._mScale=h.DomUtil.create("div",m+"-line",a)),k.imperial&&(this._iScale=h.DomUtil.create("div",m+"-line",a))},_update:function(){var p=this._map.getBounds(),r=p.getCenter().lat,m=6378137*Math.PI*Math.cos(r*Math.PI/180),v=m*(p.getNorthEast().lng-p.getSouthWest().lng)/180,u=this._map.getSize(),q=this.options,k=0;u.x>0&&(k=v*(q.maxWidth/u.x)),this._updateScales(q,k)},_updateScales:function(a,i){a.metric&&i&&this._updateMetric(i),a.imperial&&i&&this._updateImperial(i)},_updateMetric:function(a){var i=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(i/a)+"px",this._mScale.innerHTML=1000>i?i+" m":i/1000+" km"},_updateImperial:function(k){var p,a,r,q=3.2808399*k,m=this._iScale;q>5280?(p=q/5280,a=this._getRoundNum(p),m.style.width=this._getScaleWidth(a/p)+"px",m.innerHTML=a+" mi"):(r=this._getRoundNum(q),m.style.width=this._getScaleWidth(r/q)+"px",m.innerHTML=r+" ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(k){var m=Math.pow(10,(Math.floor(k)+"").length-1),a=k/m;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:1,m*a}}),h.control.scale=function(a){return new h.Control.Scale(a)},h.Control.Layers=h.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(k,m,a){h.setOptions(this,a),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var o in k){this._addLayer(k[o],o)}for(o in m){this._addLayer(m[o],o,!0)}},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(a,i){return this._addLayer(a,i),this._update(),this},addOverlay:function(a,i){return this._addLayer(a,i,!0),this._update(),this},removeLayer:function(a){var i=h.stamp(a);return delete this._layers[i],this._update(),this},_initLayout:function(){var k="leaflet-control-layers",m=this._container=h.DomUtil.create("div",k);m.setAttribute("aria-haspopup",!0),h.Browser.touch?h.DomEvent.on(m,"click",h.DomEvent.stopPropagation):h.DomEvent.disableClickPropagation(m).disableScrollPropagation(m);var a=this._form=h.DomUtil.create("form",k+"-list");if(this.options.collapsed){h.Browser.android||h.DomEvent.on(m,"mouseover",this._expand,this).on(m,"mouseout",this._collapse,this);var o=this._layersLink=h.DomUtil.create("a",k+"-toggle",m);o.href="#",o.title="Layers",h.Browser.touch?h.DomEvent.on(o,"click",h.DomEvent.stop).on(o,"click",this._expand,this):h.DomEvent.on(o,"focus",this._expand,this),h.DomEvent.on(a,"click",function(){setTimeout(h.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=h.DomUtil.create("div",k+"-base",a),this._separator=h.DomUtil.create("div",k+"-separator",a),this._overlaysList=h.DomUtil.create("div",k+"-overlays",a),m.appendChild(a)},_addLayer:function(k,m,a){var o=h.stamp(k);this._layers[o]={layer:k,name:m,overlay:a},this.options.autoZIndex&&k.setZIndex&&(this._lastZIndex++,k.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var k,m,a=!1,o=!1;for(k in this._layers){m=this._layers[k],this._addItem(m),o=o||m.overlay,a=a||!m.overlay}this._separator.style.display=o&&a?"":"none"}},_onLayerChange:function(k){var m=this._layers[h.stamp(k.layer)];if(m){this._handlingClick||this._update();var a=m.overlay?"layeradd"===k.type?"overlayadd":"overlayremove":"layeradd"===k.type?"baselayerchange":null;a&&this._map.fire(a,m)}},_createRadioElement:function(e,a){var m='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"';a&&(m+=' checked="checked"'),m+="/>";var k=g.createElement("div");return k.innerHTML=m,k.firstChild},_addItem:function(m){var k,q=g.createElement("label"),o=this._map.hasLayer(m.layer);m.overlay?(k=g.createElement("input"),k.type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=o):k=this._createRadioElement("leaflet-base-layers",o),k.layerId=h.stamp(m.layer),h.DomEvent.on(k,"click",this._onInputClick,this);var e=g.createElement("span");e.innerHTML=" "+m.name,q.appendChild(k),q.appendChild(e);var p=m.overlay?this._overlaysList:this._baseLayersList;return p.appendChild(q),q},_onInputClick:function(){var k,m,a,q=this._form.getElementsByTagName("input"),p=q.length;for(this._handlingClick=!0,k=0;p>k;k++){m=q[k],a=this._layers[m.layerId],m.checked&&!this._map.hasLayer(a.layer)?this._map.addLayer(a.layer):!m.checked&&this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer)}this._handlingClick=!1,this._refocusOnMap()},_expand:function(){h.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),h.control.layers=function(k,m,a){return new h.Control.Layers(k,m,a)},h.PosAnimation=h.Class.extend({includes:h.Mixin.Events,run:function(k,m,a,o){this.stop(),this._el=k,this._inProgress=!0,this._newPos=m,this.fire("start"),k.style[h.DomUtil.TRANSITION]="all "+(a||0.25)+"s cubic-bezier(0,0,"+(o||0.5)+",1)",h.DomEvent.on(k,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),h.DomUtil.setPosition(k,m),h.Util.falseFn(k.offsetWidth),this._stepTimer=setInterval(h.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(h.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),h.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var p,m,q,o=this._el,k=d.getComputedStyle(o);if(h.Browser.any3d){if(q=k[h.DomUtil.TRANSFORM].match(this._transformRe),!q){return}p=parseFloat(q[1]),m=parseFloat(q[2])}else{p=parseFloat(k.left),m=parseFloat(k.top)}return new h.Point(p,m,!0)},_onTransitionEnd:function(){h.DomEvent.off(this._el,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[h.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),h.Map.include({setView:function(a,k,m){if(k=k===c?this._zoom:this._limitZoom(k),a=this._limitCenter(h.latLng(a),k,this.options.maxBounds),m=m||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!m.reset&&m!==!0){m.animate!==c&&(m.zoom=h.extend({animate:m.animate},m.zoom),m.pan=h.extend({animate:m.animate},m.pan));var i=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,k,m.zoom):this._tryAnimatedPan(a,m.pan);if(i){return clearTimeout(this._sizeTimer),this}}return this._resetView(a,k),this},panBy:function(k,m){if(k=h.point(k).round(),m=m||{},!k.x&&!k.y){return this}if(this._panAnim||(this._panAnim=new h.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),m.noMoveStart||this.fire("movestart"),m.animate!==!1){h.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var a=this._getMapPanePos().subtract(k);this._panAnim.run(this._mapPane,a,m.duration||0.25,m.easeLinearity)}else{this._rawPanBy(k),this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){h.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(k,m){var a=this._getCenterOffset(k)._floor();return(m&&m.animate)===!0||this.getSize().contains(a)?(this.panBy(a,m),!0):!1}}),h.PosAnimation=h.DomUtil.TRANSITION?h.PosAnimation:h.PosAnimation.extend({run:function(k,m,a,o){this.stop(),this._el=k,this._inProgress=!0,this._duration=a||0.25,this._easeOutPower=1/Math.max(o||0.5,0.2),this._startPos=h.DomUtil.getPosition(k),this._offset=m.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=h.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,i=1000*this._duration;i>a?this._runFrame(this._easeOut(a/i)):(this._runFrame(1),this._complete())},_runFrame:function(a){var i=this._startPos.add(this._offset.multiplyBy(a));h.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){h.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}}),h.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),h.DomUtil.TRANSITION&&h.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&h.DomUtil.TRANSITION&&h.Browser.any3d&&!h.Browser.android23&&!h.Browser.mobileOpera,this._zoomAnimated&&h.DomEvent.on(this._mapPane,h.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),h.Map.include(h.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return !this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(k,p,a){if(this._animatingZoom){return !0}if(a=a||{},!this._zoomAnimated||a.animate===!1||this._nothingToAnimate()||Math.abs(p-this._zoom)>this.options.zoomAnimationThreshold){return !1}var r=this.getZoomScale(p),q=this._getCenterOffset(k)._divideBy(1-1/r),m=this._getCenterLayerPoint()._add(q);return a.animate===!0||this.getSize().contains(q)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(k,p,m,r,null,!0),!0):!1},_animateZoom:function(o,u,m,v,p,k,q){q||(this._animatingZoom=!0),h.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=o,this._animateToZoom=u,h.Draggable&&(h.Draggable._disabled=!0),h.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:o,zoom:u,origin:m,scale:v,delta:p,backwards:k}),setTimeout(h.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._animatingZoom=!1,h.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),h.Draggable&&(h.Draggable._disabled=!1))}}:{}),h.TileLayer.include({_animateZoom:function(k){this._animating||(this._animating=!0,this._prepareBgBuffer());var o=this._bgBuffer,a=h.DomUtil.TRANSFORM,p=k.delta?h.DomUtil.getTranslateString(k.delta):o.style[a],m=h.DomUtil.getScaleString(k.scale,k.origin);o.style[a]=k.backwards?m+" "+p:p+" "+m},_endZoomAnim:function(){var k=this._tileContainer,m=this._bgBuffer;k.style.visibility="",k.parentNode.appendChild(k),h.Util.falseFn(m.offsetWidth);var a=this._map.getZoom();(a>this.options.maxZoom||a<this.options.minZoom)&&this._clearBgBuffer(),this._animating=!1},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[h.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var k=this._tileContainer,m=this._bgBuffer,a=this._getLoadedTilesPercentage(m),o=this._getLoadedTilesPercentage(k);return m&&a>0.5&&0.5>o?(k.style.visibility="hidden",void this._stopLoadingImages(k)):(m.style.visibility="hidden",m.style[h.DomUtil.TRANSFORM]="",this._tileContainer=m,m=this._bgBuffer=k,this._stopLoadingImages(m),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(k){var m,a,q=k.getElementsByTagName("img"),p=0;for(m=0,a=q.length;a>m;m++){q[m].complete&&p++}return p/a},_stopLoadingImages:function(k){var o,a,p,m=Array.prototype.slice.call(k.getElementsByTagName("img"));for(o=0,a=m.length;a>o;o++){p=m[o],p.complete||(p.onload=h.Util.falseFn,p.onerror=h.Util.falseFn,p.src=h.Util.emptyImageUrl,p.parentNode.removeChild(p))}}}),h.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:10000,maximumAge:0,enableHighAccuracy:!1},locate:function(k){if(k=this._locateOptions=h.extend(this._defaultLocateOptions,k),!navigator.geolocation){return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this}var m=h.bind(this._handleGeolocationResponse,this),a=h.bind(this._handleGeolocationError,this);return k.watch?this._locationWatchId=navigator.geolocation.watchPosition(m,a,k):navigator.geolocation.getCurrentPosition(m,a,k),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(k){var m=k.code,a=k.message||(1===m?"permission denied":2===m?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:m,message:"Geolocation error: "+a+"."})},_handleGeolocationResponse:function(z){var v=z.coords.latitude,p=z.coords.longitude,m=new h.LatLng(v,p),A=180*z.coords.accuracy/40075017,x=A/Math.cos(h.LatLng.DEG_TO_RAD*v),k=h.latLngBounds([v-A,p-x],[v+A,p+x]),q=this._locateOptions;if(q.setView){var o=Math.min(this.getBoundsZoom(k),q.maxZoom);this.setView(m,o)}var y={latlng:m,bounds:k,timestamp:z.timestamp};for(var w in z.coords){"number"==typeof z.coords[w]&&(y[w]=z.coords[w])}this.fire("locationfound",y)}})}(window,document);L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return(Math.atan2(b.y-a.y,b.x-a.x)*180/Math.PI)+90},getPointPathPixelLength:function(i){var k=i.length;if(k<2){return 0}var j=0,g=i[0],m;for(var h=1;h<k;h++){j+=g.distanceTo(m=i[h]);g=m}return j},getPixelLength:function(i,m){var n=(i instanceof L.Polyline)?i.getLatLngs():i,o=n.length;if(o<2){return 0}var k=0,q=m.project(n[0]),p;for(var j=1;j<o;j++){k+=q.distanceTo(p=m.project(n[j]));q=p}return k},projectPatternOnPath:function(k,o,q,i,m){var j=[],p;for(p=0,l=k.length;p<l;p++){j[p]=m.project(k[p])}var n=this.projectPatternOnPointPath(j,o,q,i);for(p=0,l=n.length;p<l;p++){n[p].latLng=m.unproject(n[p].pt)}return n},projectPatternOnPointPath:function(k,t,o,n){var r=[];var q=this.getPointPathPixelLength(k)*n;var p=this.interpolateOnPointPath(k,t);var m=o>0?this.getPointPathPixelLength(k)*o:0;r.push(p);if(n>0){var u=k;u=u.slice(p.predecessor);u[0]=p.pt;var s=this.getPointPathPixelLength(u);while(q<=s-m){p=this.interpolateOnPointPath(u,q/s);r.push(p);u=u.slice(p.predecessor);u[0]=p.pt;s=this.getPointPathPixelLength(u)}}return r},interpolateOnPointPath:function(a,t){var i=a.length;if(i<2){return null}if(t<=0){return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])}}if(t>=1){return{pt:a[i-1],predecessor:i-1,heading:this.computeAngle(a[i-2],a[i-1])}}if(i==2){return{pt:this.interpolateBetweenPoints(a[0],a[1],t),predecessor:0,heading:this.computeAngle(a[0],a[1])}}var b=this.getPointPathPixelLength(a);var p=a[0],q=p,s=0,u=0,r=0;var w=1;for(;w<i&&u<t;w++){p=q;s=u;q=a[w];r+=p.distanceTo(q);u=r/b}var v=(t-s)/(u-s);return{pt:this.interpolateBetweenPoints(p,q,v),predecessor:w-2,heading:this.computeAngle(p,q)}},interpolateBetweenPoints:function(d,e,f){if(e.x!=d.x){return new L.Point((d.x*(1-f))+(f*e.x),(d.y*(1-f))+(f*e.y))}return new L.Point(d.x,d.y+(e.y-d.y)*f)}};L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(c,d){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,d);this._map=null;this._initPaths(c);this._initPatterns()},_initPaths:function(f){this._paths=[];var d=false;if(f instanceof L.Polyline){this._initPath(f.getLatLngs(),(f instanceof L.Polygon))}else{if(L.Util.isArray(f)&&f.length>0){if(f[0] instanceof L.Polyline){for(var e=0;e<f.length;e++){this._initPath(f[e].getLatLngs(),(f[e] instanceof L.Polygon))}}else{this._initPath(f)}}}},_isCoordArray:function(b){return(L.Util.isArray(b)&&b.length>0&&(b[0] instanceof L.LatLng||(L.Util.isArray(b[0])&&b[0].length==2&&typeof b[0][0]==="number")))},_initPath:function(g,h){var e;if(this._isCoordArray(g)){e=[g]}else{e=g}for(var f=0;f<e.length;f++){if(h){e[f].push(e[f][0])}this._paths.push(e[f])}},_initPatterns:function(){this._isZoomDependant=false;this._patterns=[];var c;for(var d=0;d<this.options.patterns.length;d++){c=this._parsePatternDef(this.options.patterns[d]);this._patterns.push(c);this._isZoomDependant=this._isZoomDependant||c.isOffsetInPixels||c.isEndOffsetInPixels||c.isRepeatInPixels||c.symbolFactory.isZoomDependant}},setPatterns:function(b){this.options.patterns=b;this._initPatterns();this._softRedraw()},setPaths:function(b){this._initPaths(b);this.redraw()},_parsePatternDef:function(e,f){var d={cache:[],symbolFactory:e.symbol,isOffsetInPixels:false,isEndOffsetInPixels:false,isRepeatInPixels:false};if(typeof e.offset==="string"&&e.offset.indexOf("%")!=-1){d.offset=parseFloat(e.offset)/100}else{d.offset=e.offset?parseFloat(e.offset):0;d.isOffsetInPixels=(d.offset>0)}if(typeof e.endOffset==="string"&&e.endOffset.indexOf("%")!=-1){d.endOffset=parseFloat(e.endOffset)/100}else{d.endOffset=e.endOffset?parseFloat(e.endOffset):0;d.isEndOffsetInPixels=(d.endOffset>0)}if(typeof e.repeat==="string"&&e.repeat.indexOf("%")!=-1){d.repeat=parseFloat(e.repeat)/100}else{d.repeat=parseFloat(e.repeat);d.isRepeatInPixels=(d.repeat>0)}return(d)},onAdd:function(b){this._map=b;this._draw();if(this._isZoomDependant){this._map.on("zoomend",this._softRedraw,this)}},onRemove:function(b){this._map.off("zoomend",this._softRedraw,this);this._map=null;L.LayerGroup.prototype.onRemove.call(this,b)},_buildSymbols:function(i,m,g){var k=[];for(var j=0,h=g.length;j<h;j++){k.push(m.buildSymbol(g[j],i,this._map,j,h))}return k},_getCache:function(g,h,f){var e=g.cache[h];if(typeof e==="undefined"){g.cache[h]=[];return null}return e[f]},_getDirectionPoints:function(r,m){var j=this._map.getZoom();var p=this._getCache(m,j,r);if(p){return p}var n,k,s,q=null,o=this._paths[r];if(m.isOffsetInPixels){q=L.LineUtil.PolylineDecorator.getPixelLength(o,this._map);n=m.offset/q}else{n=m.offset}if(m.isEndOffsetInPixels){q=(q!==null)?q:L.LineUtil.PolylineDecorator.getPixelLength(o,this._map);k=m.endOffset/q}else{k=m.endOffset}if(m.isRepeatInPixels){q=(q!==null)?q:L.LineUtil.PolylineDecorator.getPixelLength(o,this._map);s=m.repeat/q}else{s=m.repeat}p=L.LineUtil.PolylineDecorator.projectPatternOnPath(o,n,k,s,this._map);m.cache[j][r]=p;return p},redraw:function(){this._redraw(true)},_softRedraw:function(){this._redraw(false)},_redraw:function(c){if(this._map===null){return}this.clearLayers();if(c){for(var d=0;d<this._patterns.length;d++){this._patterns[d].cache=[]}}this._draw()},_drawPattern:function(h){var g,j;for(var i=0;i<this._paths.length;i++){g=this._getDirectionPoints(i,h);j=this._buildSymbols(this._paths[i],h.symbolFactory,g);for(var f=0;f<j.length;f++){this.addLayer(j[f])}}},_draw:function(){for(var b=0;b<this._patterns.length;b++){this._drawPattern(this._patterns[b])}}});L.polylineDecorator=function(c,d){return new L.PolylineDecorator(c,d)};L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this);this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]="50% 50%"},_setPos:function(g){L.Marker.prototype._setPos.call(this,g);if(L.DomUtil.TRANSFORM){this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)"}else{if(L.Browser.ie){var f=this.options.angle*(Math.PI/180),e=Math.cos(f),h=Math.sin(f);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+e+", M12="+(-h)+", M21="+h+", M22="+e+")"}}},setAngle:function(b){this.options.angle=b}});L.rotatedMarker=function(c,d){return new L.RotatedMarker(c,d)};L.Symbol=L.Symbol||{};L.Symbol.Dash=L.Class.extend({isZoomDependant:true,options:{pixelSize:10,pathOptions:{}},initialize:function(b){L.Util.setOptions(this,b);this.options.pathOptions.clickable=false},buildSymbol:function(q,t,v,r,b){var w=this.options,s=Math.PI/180;if(w.pixelSize<=1){return new L.Polyline([q.latLng,q.latLng],w.pathOptions)}var o=v.project(q.latLng);var u=(-(q.heading-90))*s;var a=new L.Point(o.x+w.pixelSize*Math.cos(u+Math.PI)/2,o.y+w.pixelSize*Math.sin(u)/2);var p=o.add(o.subtract(a));return new L.Polyline([v.unproject(a),v.unproject(p)],w.pathOptions)}});L.Symbol.dash=function(b){return new L.Symbol.Dash(b)};L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:true,options:{polygon:true,pixelSize:10,headAngle:60,pathOptions:{stroke:false,weight:2}},initialize:function(b){L.Util.setOptions(this,b);this.options.pathOptions.clickable=false},buildSymbol:function(i,j,k,h,n){var o=this.options;var m;if(o.polygon){m=new L.Polygon(this._buildArrowPath(i,k),o.pathOptions)}else{m=new L.Polyline(this._buildArrowPath(i,k),o.pathOptions)}return m},_buildArrowPath:function(o,s){var q=Math.PI/180;var r=s.project(o.latLng);var n=(-(o.heading-90))*q;var p=this.options.headAngle/2*q;var k=n+p,m=n-p;var t=new L.Point(r.x-this.options.pixelSize*Math.cos(k),r.y+this.options.pixelSize*Math.sin(k)),u=new L.Point(r.x-this.options.pixelSize*Math.cos(m),r.y+this.options.pixelSize*Math.sin(m));return[s.unproject(t),o.latLng,s.unproject(u)]}});L.Symbol.arrowHead=function(b){return new L.Symbol.ArrowHead(b)};L.Symbol.Marker=L.Class.extend({isZoomDependant:false,options:{markerOptions:{},rotate:false},initialize:function(b){L.Util.setOptions(this,b);this.options.markerOptions.clickable=false;this.options.markerOptions.draggable=false;this.isZoomDependant=(L.Browser.ie&&this.options.rotate)},buildSymbol:function(g,h,i,f,j){if(!this.options.rotate){return new L.Marker(g.latLng,this.options.markerOptions)}else{this.options.markerOptions.angle=g.heading;return new L.RotatedMarker(g.latLng,this.options.markerOptions)}}});L.Symbol.marker=function(b){return new L.Symbol.Marker(b)};